
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../../../assets/dl-logo-big-512x512-color.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.0.5">
    
    
      
        <title>Time Series - Bitcoin Price Forecast - DrLiptons</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.a617204b.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.9204c3b2.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../stylesheets/extra.css">
    
      <link rel="stylesheet" href="../../../../stylesheets/contact-style.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  <link rel="stylesheet" href="../../../../overrides/assets/stylesheets/main.d9227bb8.min.css">

  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="indigo" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#time-series-bitcoin-price-forecast" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="DrLiptons" class="md-header__button md-logo" aria-label="DrLiptons" data-md-component="logo">
      
  <img src="../../../../assets/dl-logo-big-512x512-color.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DrLiptons
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Time Series - Bitcoin Price Forecast
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="" data-md-color-primary="indigo" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../../about/" class="md-tabs__link">
      About
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../reference/" class="md-tabs__link">
        Reference
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../resource/" class="md-tabs__link md-tabs__link--active">
        Resource
      </a>
    </li>
  

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../../contact/" class="md-tabs__link">
      Contact
    </a>
  </li>

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="DrLiptons" class="md-nav__button md-logo" aria-label="DrLiptons" data-md-component="logo">
      
  <img src="../../../../assets/dl-logo-big-512x512-color.png" alt="logo">

    </a>
    DrLiptons
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../about/" class="md-nav__link">
        About
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3">
          Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../reference/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2" type="checkbox" id="__nav_3_2" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_2">
          Python
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Python" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          Python
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/get-live-financial-data/" class="md-nav__link">
        Get Live Financial Data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/flight-deals/" class="md-nav__link">
        Flight Deals
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/alien-invaders/" class="md-nav__link">
        Alien Invaders
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/auto-job-app/" class="md-nav__link">
        Automated Job Application
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/price-tracker/" class="md-nav__link">
        Price Tracker
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/password-manager/" class="md-nav__link">
        Password Manager
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/text-2-morse-code/" class="md-nav__link">
        Text2MorseCode
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/stock-news-alerts/" class="md-nav__link">
        Stock News Alert
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/tetris/" class="md-nav__link">
        Tetris Clone
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3" type="checkbox" id="__nav_3_3" >
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_3">
          TensorFlow
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="TensorFlow" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          TensorFlow
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3_1" type="checkbox" id="__nav_3_3_1" >
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_3_1">
          Plant Disease Detection
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Plant Disease Detection" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_3_1">
          <span class="md-nav__icon md-icon"></span>
          Plant Disease Detection
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/pdd/plant-disease-detection/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/pdd/part-1-create-ml-model/" class="md-nav__link">
        Part 1 - Create ML Model
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/pdd/part-2-create-app/" class="md-nav__link">
        Part 2 - Desktop App
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/pdd/part-3-make-exe/" class="md-nav__link">
        Part 3 - Make Executable
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/object-detection/" class="md-nav__link">
        Object Detection
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_4" type="checkbox" id="__nav_3_4" >
      
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_4">
          Applications
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Applications" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_4">
          <span class="md-nav__icon md-icon"></span>
          Applications
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/untitled-project-1/pt/" class="md-nav__link">
        Untitled Project 1
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4">
          Resource
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Resource" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Resource
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../resource/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2" type="checkbox" id="__nav_4_2" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_2">
          Python
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Python" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          Python
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../python/scikit-learn/" class="md-nav__link">
        Scikit-Learn
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../python/matplotlib/" class="md-nav__link">
        Matplotlib
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../python/numpy/" class="md-nav__link">
        Numpy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../python/pandas/" class="md-nav__link">
        Pandas
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../python/mplfinance/" class="md-nav__link">
        mplfinance
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3" type="checkbox" id="__nav_4_3" checked>
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_3">
          TensorFlow
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="TensorFlow" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_3">
          <span class="md-nav__icon md-icon"></span>
          TensorFlow
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3_1" type="checkbox" id="__nav_4_3_1" >
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_3_1">
          TensorFlow Exam
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="TensorFlow Exam" data-md-level="3">
        <label class="md-nav__title" for="__nav_4_3_1">
          <span class="md-nav__icon md-icon"></span>
          TensorFlow Exam
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tf-exam/tf-exam-overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3_1_2" type="checkbox" id="__nav_4_3_1_2" >
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_3_1_2">
          Coursera - DeepLearning.AI TensorFlow Developer
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Coursera - DeepLearning.AI TensorFlow Developer" data-md-level="4">
        <label class="md-nav__title" for="__nav_4_3_1_2">
          <span class="md-nav__icon md-icon"></span>
          Coursera - DeepLearning.AI TensorFlow Developer
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tf-exam/cs-part-1/" class="md-nav__link">
        Part 1 - Introduction to TF
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tf-exam/cs-part-2/" class="md-nav__link">
        Part 2 - CNN in TF
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tf-exam/cs-part-3/" class="md-nav__link">
        Part 3 -  NLP in TF
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tf-exam/cs-part-4/" class="md-nav__link">
        Part 4 - Time Series
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tf-exam/pass-tensorflow-cert/" class="md-nav__link">
        How I past TensorFlow Exam
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tf-model-bp/" class="md-nav__link">
        TensorFlow Blueprint
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3_3" type="checkbox" id="__nav_4_3_3" checked>
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_3_3">
          TensorFlow Models
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="TensorFlow Models" data-md-level="3">
        <label class="md-nav__title" for="__nav_4_3_3">
          <span class="md-nav__icon md-icon"></span>
          TensorFlow Models
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../model-list/" class="md-nav__link">
        List of Models
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3_3_2" type="checkbox" id="__nav_4_3_3_2" >
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_3_3_2">
          Neural Network Regressions
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Neural Network Regressions" data-md-level="4">
        <label class="md-nav__title" for="__nav_4_3_3_2">
          <span class="md-nav__icon md-icon"></span>
          Neural Network Regressions
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../simple-regression/" class="md-nav__link">
        NNR - House Prices
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../regression-boston-housing/" class="md-nav__link">
        NNR - Boston Housing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../titanic/" class="md-nav__link">
        NNR - Titanic
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3_3_3" type="checkbox" id="__nav_4_3_3_3" >
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_3_3_3">
          Image Classification
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Image Classification" data-md-level="4">
        <label class="md-nav__title" for="__nav_4_3_3_3">
          <span class="md-nav__icon md-icon"></span>
          Image Classification
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../basic-fmnist/" class="md-nav__link">
        Basic Image Classification - FMNIST
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../image-classification-dogs-cats/" class="md-nav__link">
        Image Classification - Dogs & Cats
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cnn-fmnist/" class="md-nav__link">
        CNN - FMNIST
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3_3_4" type="checkbox" id="__nav_4_3_3_4" >
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_3_3_4">
          Natural Language Processing
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Natural Language Processing" data-md-level="4">
        <label class="md-nav__title" for="__nav_4_3_3_4">
          <span class="md-nav__icon md-icon"></span>
          Natural Language Processing
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../imdb/" class="md-nav__link">
        NLP - Binary-Class IMDB
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../nlp-1-binary/" class="md-nav__link">
        NLP - Binary-Class Disaster Tweets
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../nlp-2-multi/" class="md-nav__link">
        NLP - Multi-Class PedMed
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../nlp-3-sentiment/" class="md-nav__link">
        NLP - Multi-Class Sentiment Analysis
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3_3_5" type="checkbox" id="__nav_4_3_3_5" checked>
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_3_3_5">
          Time Series
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Time Series" data-md-level="4">
        <label class="md-nav__title" for="__nav_4_3_3_5">
          <span class="md-nav__icon md-icon"></span>
          Time Series
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Time Series - Bitcoin Price Forecast
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Time Series - Bitcoin Price Forecast
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#at-a-glance" class="md-nav__link">
    At a Glance
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#import-dependencies" class="md-nav__link">
    Import Dependencies
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utility-functions" class="md-nav__link">
    Utility Functions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-data" class="md-nav__link">
    The Data
  </a>
  
    <nav class="md-nav" aria-label="The Data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#download-data" class="md-nav__link">
    Download Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inspect-the-data" class="md-nav__link">
    Inspect the Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prepare-the-data" class="md-nav__link">
    Prepare the Data
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-0-naive-forecast" class="md-nav__link">
    Model 0: Na誰ve Forecast
  </a>
  
    <nav class="md-nav" aria-label="Model 0: Na誰ve Forecast">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-compile-and-fit-model" class="md-nav__link">
    Create, Compile, and Fit Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inspect-model" class="md-nav__link">
    Inspect Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate-model" class="md-nav__link">
    Evaluate Model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-1-dense-window7-horizon1" class="md-nav__link">
    Model 1: Dense (window=7, horizon=1)
  </a>
  
    <nav class="md-nav" aria-label="Model 1: Dense (window=7, horizon=1)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prepare-data" class="md-nav__link">
    Prepare Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-compile-and-fit-model_1" class="md-nav__link">
    Create, Compile, and Fit Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate-model_1" class="md-nav__link">
    Evaluate Model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-2-dense-window30-horizon1" class="md-nav__link">
    Model 2: Dense (window=30, horizon=1)
  </a>
  
    <nav class="md-nav" aria-label="Model 2: Dense (window=30, horizon=1)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prepare-data_1" class="md-nav__link">
    Prepare Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-compile-and-fit-model_2" class="md-nav__link">
    Create, Compile, and Fit Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate-model_2" class="md-nav__link">
    Evaluate Model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-3-dense-window30-horizon7" class="md-nav__link">
    Model 3: Dense (window=30, horizon=7)
  </a>
  
    <nav class="md-nav" aria-label="Model 3: Dense (window=30, horizon=7)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prepare-data_2" class="md-nav__link">
    Prepare Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-compile-and-fit-model_3" class="md-nav__link">
    Create, Compile, and Fit Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate-model_3" class="md-nav__link">
    Evaluate Model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-4-conv1d" class="md-nav__link">
    Model 4: Conv1D
  </a>
  
    <nav class="md-nav" aria-label="Model 4: Conv1D">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prepare-data_3" class="md-nav__link">
    Prepare Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-compile-and-fit-model_4" class="md-nav__link">
    Create, Compile, and Fit Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate-model_4" class="md-nav__link">
    Evaluate Model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-5-rnn-lstm" class="md-nav__link">
    Model 5: RNN (LSTM)
  </a>
  
    <nav class="md-nav" aria-label="Model 5: RNN (LSTM)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-compile-and-fit-model_5" class="md-nav__link">
    Create, Compile, and Fit Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate-model_5" class="md-nav__link">
    Evaluate Model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-6-dense-multivariate-time-series" class="md-nav__link">
    Model 6: Dense (Multivariate Time Series)
  </a>
  
    <nav class="md-nav" aria-label="Model 6: Dense (Multivariate Time Series)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prepare-data_4" class="md-nav__link">
    Prepare Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-compile-and-fit-model_6" class="md-nav__link">
    Create, Compile, and Fit Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate-model_6" class="md-nav__link">
    Evaluate Model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-7-n-beats" class="md-nav__link">
    Model 7: N-BEATS
  </a>
  
    <nav class="md-nav" aria-label="Model 7: N-BEATS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prepare-custom-layer" class="md-nav__link">
    Prepare Custom Layer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prepare-data_5" class="md-nav__link">
    Prepare Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-compile-and-fit-model_7" class="md-nav__link">
    Create, Compile, and Fit Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate-model_7" class="md-nav__link">
    Evaluate Model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-8-stacking-models" class="md-nav__link">
    Model 8: Stacking Models
  </a>
  
    <nav class="md-nav" aria-label="Model 8: Stacking Models">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-compile-and-fit-model_8" class="md-nav__link">
    Create, Compile, and Fit Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate-model_8" class="md-nav__link">
    Evaluate Model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-9-full-history" class="md-nav__link">
    Model 9: Full History
  </a>
  
    <nav class="md-nav" aria-label="Model 9: Full History">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prepare-data_6" class="md-nav__link">
    Prepare Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-compile-and-fit-model_9" class="md-nav__link">
    Create, Compile, and Fit Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate-model_9" class="md-nav__link">
    Evaluate Model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-10-turkey-problem" class="md-nav__link">
    Model 10: Turkey Problem
  </a>
  
    <nav class="md-nav" aria-label="Model 10: Turkey Problem">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prepare-data_7" class="md-nav__link">
    Prepare Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-compile-and-fit-model_10" class="md-nav__link">
    Create, Compile, and Fit Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate-model_10" class="md-nav__link">
    Evaluate Model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compare-models" class="md-nav__link">
    Compare Models
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ts-weather/" class="md-nav__link">
        Time Series - Weather Forecast
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3_3_6" type="checkbox" id="__nav_4_3_3_6" >
      
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_3_3_6">
          Miscellaneous
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Miscellaneous" data-md-level="4">
        <label class="md-nav__title" for="__nav_4_3_3_6">
          <span class="md-nav__icon md-icon"></span>
          Miscellaneous
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utilities/" class="md-nav__link">
        Utility Functions
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_4" type="checkbox" id="__nav_4_4" >
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_4">
          Microsoft Certification
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Microsoft Certification" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_4">
          <span class="md-nav__icon md-icon"></span>
          Microsoft Certification
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ms/ms-overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ms/az-900/" class="md-nav__link">
        Azure Fundamentals
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ms/ai-900/" class="md-nav__link">
        Azure AI Fundamentals
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ms/dp-900/" class="md-nav__link">
        Azure Data Fundamentals
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../contact/" class="md-nav__link">
        Contact
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#at-a-glance" class="md-nav__link">
    At a Glance
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#import-dependencies" class="md-nav__link">
    Import Dependencies
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utility-functions" class="md-nav__link">
    Utility Functions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-data" class="md-nav__link">
    The Data
  </a>
  
    <nav class="md-nav" aria-label="The Data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#download-data" class="md-nav__link">
    Download Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inspect-the-data" class="md-nav__link">
    Inspect the Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prepare-the-data" class="md-nav__link">
    Prepare the Data
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-0-naive-forecast" class="md-nav__link">
    Model 0: Na誰ve Forecast
  </a>
  
    <nav class="md-nav" aria-label="Model 0: Na誰ve Forecast">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-compile-and-fit-model" class="md-nav__link">
    Create, Compile, and Fit Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inspect-model" class="md-nav__link">
    Inspect Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate-model" class="md-nav__link">
    Evaluate Model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-1-dense-window7-horizon1" class="md-nav__link">
    Model 1: Dense (window=7, horizon=1)
  </a>
  
    <nav class="md-nav" aria-label="Model 1: Dense (window=7, horizon=1)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prepare-data" class="md-nav__link">
    Prepare Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-compile-and-fit-model_1" class="md-nav__link">
    Create, Compile, and Fit Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate-model_1" class="md-nav__link">
    Evaluate Model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-2-dense-window30-horizon1" class="md-nav__link">
    Model 2: Dense (window=30, horizon=1)
  </a>
  
    <nav class="md-nav" aria-label="Model 2: Dense (window=30, horizon=1)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prepare-data_1" class="md-nav__link">
    Prepare Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-compile-and-fit-model_2" class="md-nav__link">
    Create, Compile, and Fit Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate-model_2" class="md-nav__link">
    Evaluate Model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-3-dense-window30-horizon7" class="md-nav__link">
    Model 3: Dense (window=30, horizon=7)
  </a>
  
    <nav class="md-nav" aria-label="Model 3: Dense (window=30, horizon=7)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prepare-data_2" class="md-nav__link">
    Prepare Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-compile-and-fit-model_3" class="md-nav__link">
    Create, Compile, and Fit Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate-model_3" class="md-nav__link">
    Evaluate Model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-4-conv1d" class="md-nav__link">
    Model 4: Conv1D
  </a>
  
    <nav class="md-nav" aria-label="Model 4: Conv1D">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prepare-data_3" class="md-nav__link">
    Prepare Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-compile-and-fit-model_4" class="md-nav__link">
    Create, Compile, and Fit Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate-model_4" class="md-nav__link">
    Evaluate Model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-5-rnn-lstm" class="md-nav__link">
    Model 5: RNN (LSTM)
  </a>
  
    <nav class="md-nav" aria-label="Model 5: RNN (LSTM)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-compile-and-fit-model_5" class="md-nav__link">
    Create, Compile, and Fit Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate-model_5" class="md-nav__link">
    Evaluate Model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-6-dense-multivariate-time-series" class="md-nav__link">
    Model 6: Dense (Multivariate Time Series)
  </a>
  
    <nav class="md-nav" aria-label="Model 6: Dense (Multivariate Time Series)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prepare-data_4" class="md-nav__link">
    Prepare Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-compile-and-fit-model_6" class="md-nav__link">
    Create, Compile, and Fit Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate-model_6" class="md-nav__link">
    Evaluate Model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-7-n-beats" class="md-nav__link">
    Model 7: N-BEATS
  </a>
  
    <nav class="md-nav" aria-label="Model 7: N-BEATS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prepare-custom-layer" class="md-nav__link">
    Prepare Custom Layer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prepare-data_5" class="md-nav__link">
    Prepare Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-compile-and-fit-model_7" class="md-nav__link">
    Create, Compile, and Fit Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate-model_7" class="md-nav__link">
    Evaluate Model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-8-stacking-models" class="md-nav__link">
    Model 8: Stacking Models
  </a>
  
    <nav class="md-nav" aria-label="Model 8: Stacking Models">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-compile-and-fit-model_8" class="md-nav__link">
    Create, Compile, and Fit Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate-model_8" class="md-nav__link">
    Evaluate Model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-9-full-history" class="md-nav__link">
    Model 9: Full History
  </a>
  
    <nav class="md-nav" aria-label="Model 9: Full History">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prepare-data_6" class="md-nav__link">
    Prepare Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-compile-and-fit-model_9" class="md-nav__link">
    Create, Compile, and Fit Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate-model_9" class="md-nav__link">
    Evaluate Model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-10-turkey-problem" class="md-nav__link">
    Model 10: Turkey Problem
  </a>
  
    <nav class="md-nav" aria-label="Model 10: Turkey Problem">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prepare-data_7" class="md-nav__link">
    Prepare Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-compile-and-fit-model_10" class="md-nav__link">
    Create, Compile, and Fit Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate-model_10" class="md-nav__link">
    Evaluate Model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compare-models" class="md-nav__link">
    Compare Models
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

<h1 id="time-series-bitcoin-price-forecast">Time Series - Bitcoin Price Forecast</h1>
<p>This notebook will use machine learning to predict the Bitcoin price with time series data. We will be going to build 
several models to try to make the best attempt to forecast how the bitcoin price will change over time. The data we 
will use is the price of Bitcoin between October 1, 2012, to May 18, 2021.</p>
<p>This notebook was part of the study material based on the Udemy course: Zero to Mastery TensorFlow for Deep Learning by 
Daniel Bourke.</p>
<h2 id="at-a-glance"><b>At a Glance</b></h2>
<details class="example" open="open">
<summary>What to expect</summary>
<ul>
<li><a href="#model-0">Model 0: Naive Forecast</a></li>
<li><a href="#model-1">Model 1: Dense (window=7, horizon=1)</a></li>
<li><a href="#model-2">Model 2: Dense (window=30, horizon=1)</a></li>
<li><a href="#model-3">Model 3: Dense (window=30, horizon=7)</a></li>
<li><a href="#model-4">Model 4: Conv1D</a></li>
<li><a href="#model-5">Model 5: RNN (LSTM)</a></li>
<li><a href="#model-6">Model 6: Dense (Multivariate Time Series)</a></li>
<li><a href="#model-7">Model 7: N-BEATS</a></li>
<li><a href="#model-8">Model 8: Stacking Models</a></li>
<li><a href="#model-9">Model 9: Full History</a></li>
<li><a href="#model-10">Model 10: Turkey Problem</a></li>
<li><a href="#compare-models">Compare Models</a></li>
</ul>
</details>
<p><a name="import"></a></p>
<h2 id="import-dependencies"><strong>Import Dependencies</strong></h2>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-0-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-0-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-0-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-0-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="kn">import</span> <span class="nn">random</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="kn">import</span> <span class="nn">os</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="kn">import</span> <span class="nn">matplotlib.image</span> <span class="k">as</span> <span class="nn">mpimg</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="c1"># tensorflow dataset</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="kn">import</span> <span class="nn">tensorflow_datasets</span> <span class="k">as</span> <span class="nn">tfds</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="kn">import</span> <span class="nn">csv</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="c1"># import wget as wget # only for PyCharm</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="kn">import</span> <span class="nn">zipfile</span> <span class="k">as</span> <span class="nn">zf</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="kn">import</span> <span class="nn">pathlib</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="kn">import</span> <span class="nn">random</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="c1"># Used in Prepare the data</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.layers.experimental.preprocessing</span> <span class="kn">import</span> <span class="n">TextVectorization</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.preprocessing.image</span> <span class="kn">import</span> <span class="n">ImageDataGenerator</span> <span class="c1"># Use for preprocessing the data</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span><span class="p">,</span> <span class="n">LabelEncoder</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="c1"># Use in the model</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.models</span> <span class="kn">import</span> <span class="n">Sequential</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">Conv2D</span><span class="p">,</span> <span class="n">MaxPool2D</span><span class="p">,</span> <span class="n">Flatten</span><span class="p">,</span> <span class="n">Dense</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="kn">import</span> <span class="nn">tensorflow_hub</span> <span class="k">as</span> <span class="nn">hub</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.layers.experimental</span> <span class="kn">import</span> <span class="n">preprocessing</span> <span class="c1"># for data augmentation</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="kn">from</span> <span class="nn">sklearn.naive_bayes</span> <span class="kn">import</span> <span class="n">MultinomialNB</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.utils</span> <span class="kn">import</span> <span class="n">plot_model</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="c1"># Evaluate model</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span><span class="p">,</span> <span class="n">classification_report</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">precision_recall_fscore_support</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="c1"># Utility scripts (confusion matrix)</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="kn">import</span> <span class="nn">itertools</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">confusion_matrix</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="c1"># mixed_precision</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="kn">from</span> <span class="nn">tensorflow.keras</span> <span class="kn">import</span> <span class="n">mixed_precision</span>
</code></pre></div>
</td></tr></table>
<p><a name="utility"></a></p>
<h2 id="utility-functions"><strong>Utility Functions</strong></h2>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">  1</a></span>
<span class="normal"><a href="#__codelineno-1-2">  2</a></span>
<span class="normal"><a href="#__codelineno-1-3">  3</a></span>
<span class="normal"><a href="#__codelineno-1-4">  4</a></span>
<span class="normal"><a href="#__codelineno-1-5">  5</a></span>
<span class="normal"><a href="#__codelineno-1-6">  6</a></span>
<span class="normal"><a href="#__codelineno-1-7">  7</a></span>
<span class="normal"><a href="#__codelineno-1-8">  8</a></span>
<span class="normal"><a href="#__codelineno-1-9">  9</a></span>
<span class="normal"><a href="#__codelineno-1-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-1-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-1-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-1-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-1-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-1-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-1-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-1-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-1-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-1-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-1-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-1-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-1-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-1-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-1-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-1-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-1-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-1-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-1-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-1-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-1-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-1-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-1-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-1-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-1-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-1-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-1-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-1-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-1-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-1-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-1-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-1-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-1-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-1-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-1-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-1-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-1-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-1-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-1-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-1-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-1-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-1-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-1-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-1-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-1-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-1-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-1-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-1-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-1-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-1-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-1-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-1-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-1-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-1-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-1-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-1-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-1-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-1-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-1-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-1-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-1-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-1-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-1-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-1-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-1-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-1-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-1-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-1-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-1-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-1-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-1-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-1-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-1-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-1-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-1-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-1-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-1-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-1-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-1-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-1-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-1-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-1-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-1-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-1-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-1-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-1-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-1-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-1-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-1-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-1-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-1-100">100</a></span>
<span class="normal"><a href="#__codelineno-1-101">101</a></span>
<span class="normal"><a href="#__codelineno-1-102">102</a></span>
<span class="normal"><a href="#__codelineno-1-103">103</a></span>
<span class="normal"><a href="#__codelineno-1-104">104</a></span>
<span class="normal"><a href="#__codelineno-1-105">105</a></span>
<span class="normal"><a href="#__codelineno-1-106">106</a></span>
<span class="normal"><a href="#__codelineno-1-107">107</a></span>
<span class="normal"><a href="#__codelineno-1-108">108</a></span>
<span class="normal"><a href="#__codelineno-1-109">109</a></span>
<span class="normal"><a href="#__codelineno-1-110">110</a></span>
<span class="normal"><a href="#__codelineno-1-111">111</a></span>
<span class="normal"><a href="#__codelineno-1-112">112</a></span>
<span class="normal"><a href="#__codelineno-1-113">113</a></span>
<span class="normal"><a href="#__codelineno-1-114">114</a></span>
<span class="normal"><a href="#__codelineno-1-115">115</a></span>
<span class="normal"><a href="#__codelineno-1-116">116</a></span>
<span class="normal"><a href="#__codelineno-1-117">117</a></span>
<span class="normal"><a href="#__codelineno-1-118">118</a></span>
<span class="normal"><a href="#__codelineno-1-119">119</a></span>
<span class="normal"><a href="#__codelineno-1-120">120</a></span>
<span class="normal"><a href="#__codelineno-1-121">121</a></span>
<span class="normal"><a href="#__codelineno-1-122">122</a></span>
<span class="normal"><a href="#__codelineno-1-123">123</a></span>
<span class="normal"><a href="#__codelineno-1-124">124</a></span>
<span class="normal"><a href="#__codelineno-1-125">125</a></span>
<span class="normal"><a href="#__codelineno-1-126">126</a></span>
<span class="normal"><a href="#__codelineno-1-127">127</a></span>
<span class="normal"><a href="#__codelineno-1-128">128</a></span>
<span class="normal"><a href="#__codelineno-1-129">129</a></span>
<span class="normal"><a href="#__codelineno-1-130">130</a></span>
<span class="normal"><a href="#__codelineno-1-131">131</a></span>
<span class="normal"><a href="#__codelineno-1-132">132</a></span>
<span class="normal"><a href="#__codelineno-1-133">133</a></span>
<span class="normal"><a href="#__codelineno-1-134">134</a></span>
<span class="normal"><a href="#__codelineno-1-135">135</a></span>
<span class="normal"><a href="#__codelineno-1-136">136</a></span>
<span class="normal"><a href="#__codelineno-1-137">137</a></span>
<span class="normal"><a href="#__codelineno-1-138">138</a></span>
<span class="normal"><a href="#__codelineno-1-139">139</a></span>
<span class="normal"><a href="#__codelineno-1-140">140</a></span>
<span class="normal"><a href="#__codelineno-1-141">141</a></span>
<span class="normal"><a href="#__codelineno-1-142">142</a></span>
<span class="normal"><a href="#__codelineno-1-143">143</a></span>
<span class="normal"><a href="#__codelineno-1-144">144</a></span>
<span class="normal"><a href="#__codelineno-1-145">145</a></span>
<span class="normal"><a href="#__codelineno-1-146">146</a></span>
<span class="normal"><a href="#__codelineno-1-147">147</a></span>
<span class="normal"><a href="#__codelineno-1-148">148</a></span>
<span class="normal"><a href="#__codelineno-1-149">149</a></span>
<span class="normal"><a href="#__codelineno-1-150">150</a></span>
<span class="normal"><a href="#__codelineno-1-151">151</a></span>
<span class="normal"><a href="#__codelineno-1-152">152</a></span>
<span class="normal"><a href="#__codelineno-1-153">153</a></span>
<span class="normal"><a href="#__codelineno-1-154">154</a></span>
<span class="normal"><a href="#__codelineno-1-155">155</a></span>
<span class="normal"><a href="#__codelineno-1-156">156</a></span>
<span class="normal"><a href="#__codelineno-1-157">157</a></span>
<span class="normal"><a href="#__codelineno-1-158">158</a></span>
<span class="normal"><a href="#__codelineno-1-159">159</a></span>
<span class="normal"><a href="#__codelineno-1-160">160</a></span>
<span class="normal"><a href="#__codelineno-1-161">161</a></span>
<span class="normal"><a href="#__codelineno-1-162">162</a></span>
<span class="normal"><a href="#__codelineno-1-163">163</a></span>
<span class="normal"><a href="#__codelineno-1-164">164</a></span>
<span class="normal"><a href="#__codelineno-1-165">165</a></span>
<span class="normal"><a href="#__codelineno-1-166">166</a></span>
<span class="normal"><a href="#__codelineno-1-167">167</a></span>
<span class="normal"><a href="#__codelineno-1-168">168</a></span>
<span class="normal"><a href="#__codelineno-1-169">169</a></span>
<span class="normal"><a href="#__codelineno-1-170">170</a></span>
<span class="normal"><a href="#__codelineno-1-171">171</a></span>
<span class="normal"><a href="#__codelineno-1-172">172</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="c1"># Create a function to plot time series data</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="k">def</span> <span class="nf">plot_time_series</span><span class="p">(</span><span class="n">timesteps</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a>  <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="sd">  Plots a timesteps (a series of points in time) against values (a series of values across timesteps).</span>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="sd">  Parameters</span>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="sd">  ---------</span>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="sd">  timesteps : array of timesteps</span>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="sd">  values : array of values across time</span>
<a id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="sd">  format : style of plot, default &quot;.&quot;</span>
<a id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="sd">  start : where to start the plot (setting a value will index from start of timesteps &amp; values)</span>
<a id="__codelineno-1-12" name="__codelineno-1-12"></a><span class="sd">  end : where to end the plot (setting a value will index from end of timesteps &amp; values)</span>
<a id="__codelineno-1-13" name="__codelineno-1-13"></a><span class="sd">  label : label to show on plot of values</span>
<a id="__codelineno-1-14" name="__codelineno-1-14"></a><span class="sd">  &quot;&quot;&quot;</span>
<a id="__codelineno-1-15" name="__codelineno-1-15"></a>  <span class="c1"># Plot the series</span>
<a id="__codelineno-1-16" name="__codelineno-1-16"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timesteps</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">],</span> <span class="nb">format</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
<a id="__codelineno-1-17" name="__codelineno-1-17"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">)</span>
<a id="__codelineno-1-18" name="__codelineno-1-18"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;BTC Price&quot;</span><span class="p">)</span>
<a id="__codelineno-1-19" name="__codelineno-1-19"></a>  <span class="k">if</span> <span class="n">label</span><span class="p">:</span>
<a id="__codelineno-1-20" name="__codelineno-1-20"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span> <span class="c1"># make label bigger</span>
<a id="__codelineno-1-21" name="__codelineno-1-21"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-1-22" name="__codelineno-1-22"></a>
<a id="__codelineno-1-23" name="__codelineno-1-23"></a>
<a id="__codelineno-1-24" name="__codelineno-1-24"></a><span class="c1"># MASE implemented courtesy of sktime - https://github.com/alan-turing-institute/sktime/blob/ee7a06843a44f4aaec7582d847e36073a9ab0566/sktime/performance_metrics/forecasting/_functions.py#L16</span>
<a id="__codelineno-1-25" name="__codelineno-1-25"></a><span class="k">def</span> <span class="nf">mean_absolute_scaled_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
<a id="__codelineno-1-26" name="__codelineno-1-26"></a>  <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-1-27" name="__codelineno-1-27"></a><span class="sd">  Implement MASE (assuming no seasonality of data).</span>
<a id="__codelineno-1-28" name="__codelineno-1-28"></a><span class="sd">  &quot;&quot;&quot;</span>
<a id="__codelineno-1-29" name="__codelineno-1-29"></a>  <span class="n">mae</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_true</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">))</span>
<a id="__codelineno-1-30" name="__codelineno-1-30"></a>
<a id="__codelineno-1-31" name="__codelineno-1-31"></a>  <span class="c1"># Find MAE of naive forecast (no seasonality)</span>
<a id="__codelineno-1-32" name="__codelineno-1-32"></a>  <span class="n">mae_naive_no_season</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_true</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">y_true</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span> <span class="c1"># our seasonality is 1 day (hence the shifting of 1 day)</span>
<a id="__codelineno-1-33" name="__codelineno-1-33"></a>
<a id="__codelineno-1-34" name="__codelineno-1-34"></a>  <span class="k">return</span> <span class="n">mae</span> <span class="o">/</span> <span class="n">mae_naive_no_season</span>
<a id="__codelineno-1-35" name="__codelineno-1-35"></a>
<a id="__codelineno-1-36" name="__codelineno-1-36"></a>
<a id="__codelineno-1-37" name="__codelineno-1-37"></a><span class="k">def</span> <span class="nf">evaluate_preds</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
<a id="__codelineno-1-38" name="__codelineno-1-38"></a>  <span class="c1"># Make sure float32 (for metric calculations)</span>
<a id="__codelineno-1-39" name="__codelineno-1-39"></a>  <span class="n">y_true</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-1-40" name="__codelineno-1-40"></a>  <span class="n">y_pred</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-1-41" name="__codelineno-1-41"></a>
<a id="__codelineno-1-42" name="__codelineno-1-42"></a>  <span class="c1"># Calculate various metrics</span>
<a id="__codelineno-1-43" name="__codelineno-1-43"></a>  <span class="n">mae</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<a id="__codelineno-1-44" name="__codelineno-1-44"></a>  <span class="n">mse</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span> <span class="c1"># puts and emphasis on outliers (all errors get squared)</span>
<a id="__codelineno-1-45" name="__codelineno-1-45"></a>  <span class="n">rmse</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mse</span><span class="p">)</span>
<a id="__codelineno-1-46" name="__codelineno-1-46"></a>  <span class="n">mape</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_percentage_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<a id="__codelineno-1-47" name="__codelineno-1-47"></a>  <span class="n">mase</span> <span class="o">=</span> <span class="n">mean_absolute_scaled_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<a id="__codelineno-1-48" name="__codelineno-1-48"></a>
<a id="__codelineno-1-49" name="__codelineno-1-49"></a>  <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;mae&quot;</span><span class="p">:</span> <span class="n">mae</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-1-50" name="__codelineno-1-50"></a>          <span class="s2">&quot;mse&quot;</span><span class="p">:</span> <span class="n">mse</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-1-51" name="__codelineno-1-51"></a>          <span class="s2">&quot;rmse&quot;</span><span class="p">:</span> <span class="n">rmse</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-1-52" name="__codelineno-1-52"></a>          <span class="s2">&quot;mape&quot;</span><span class="p">:</span> <span class="n">mape</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-1-53" name="__codelineno-1-53"></a>          <span class="s2">&quot;mase&quot;</span><span class="p">:</span> <span class="n">mase</span><span class="o">.</span><span class="n">numpy</span><span class="p">()}</span>
<a id="__codelineno-1-54" name="__codelineno-1-54"></a>
<a id="__codelineno-1-55" name="__codelineno-1-55"></a>
<a id="__codelineno-1-56" name="__codelineno-1-56"></a><span class="c1"># Create function to label windowed data</span>
<a id="__codelineno-1-57" name="__codelineno-1-57"></a><span class="k">def</span> <span class="nf">get_labelled_windows</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">horizon</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-1-58" name="__codelineno-1-58"></a>  <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-1-59" name="__codelineno-1-59"></a><span class="sd">  Creates labels for windowed dataset.</span>
<a id="__codelineno-1-60" name="__codelineno-1-60"></a>
<a id="__codelineno-1-61" name="__codelineno-1-61"></a><span class="sd">  E.g. if horizon=1 (default)</span>
<a id="__codelineno-1-62" name="__codelineno-1-62"></a><span class="sd">  Input: [1, 2, 3, 4, 5, 6] -&gt; Output: ([1, 2, 3, 4, 5], [6])</span>
<a id="__codelineno-1-63" name="__codelineno-1-63"></a><span class="sd">  &quot;&quot;&quot;</span>
<a id="__codelineno-1-64" name="__codelineno-1-64"></a>  <span class="k">return</span> <span class="n">x</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="n">horizon</span><span class="p">],</span> <span class="n">x</span><span class="p">[:,</span> <span class="o">-</span><span class="n">horizon</span><span class="p">:]</span>
<a id="__codelineno-1-65" name="__codelineno-1-65"></a>
<a id="__codelineno-1-66" name="__codelineno-1-66"></a>
<a id="__codelineno-1-67" name="__codelineno-1-67"></a><span class="c1"># Create function to view NumPy arrays as windows </span>
<a id="__codelineno-1-68" name="__codelineno-1-68"></a><span class="k">def</span> <span class="nf">make_windows</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">window_size</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">horizon</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-1-69" name="__codelineno-1-69"></a>  <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-1-70" name="__codelineno-1-70"></a><span class="sd">  Turns a 1D array into a 2D array of sequential windows of window_size.</span>
<a id="__codelineno-1-71" name="__codelineno-1-71"></a><span class="sd">  &quot;&quot;&quot;</span>
<a id="__codelineno-1-72" name="__codelineno-1-72"></a>  <span class="c1"># 1. Create a window of specific window_size (add the horizon on the end for later labelling)</span>
<a id="__codelineno-1-73" name="__codelineno-1-73"></a>  <span class="n">window_step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">window_size</span><span class="o">+</span><span class="n">horizon</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-1-74" name="__codelineno-1-74"></a>  <span class="c1"># print(f&quot;Window step:\n {window_step}&quot;)</span>
<a id="__codelineno-1-75" name="__codelineno-1-75"></a>
<a id="__codelineno-1-76" name="__codelineno-1-76"></a>  <span class="c1"># 2. Create a 2D array of multiple window steps (minus 1 to account for 0 indexing)</span>
<a id="__codelineno-1-77" name="__codelineno-1-77"></a>  <span class="n">window_indexes</span> <span class="o">=</span> <span class="n">window_step</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">window_size</span><span class="o">+</span><span class="n">horizon</span><span class="o">-</span><span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="c1"># create 2D array of windows of size window_size</span>
<a id="__codelineno-1-78" name="__codelineno-1-78"></a>  <span class="c1"># print(f&quot;Window indexes:\n {window_indexes[:3], window_indexes[-3:], window_indexes.shape}&quot;)</span>
<a id="__codelineno-1-79" name="__codelineno-1-79"></a>
<a id="__codelineno-1-80" name="__codelineno-1-80"></a>  <span class="c1"># 3. Index on the target array (time series) with 2D array of multiple window steps</span>
<a id="__codelineno-1-81" name="__codelineno-1-81"></a>  <span class="n">windowed_array</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">window_indexes</span><span class="p">]</span>
<a id="__codelineno-1-82" name="__codelineno-1-82"></a>
<a id="__codelineno-1-83" name="__codelineno-1-83"></a>  <span class="c1"># 4. Get the labelled windows</span>
<a id="__codelineno-1-84" name="__codelineno-1-84"></a>  <span class="n">windows</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">get_labelled_windows</span><span class="p">(</span><span class="n">windowed_array</span><span class="p">,</span> <span class="n">horizon</span><span class="o">=</span><span class="n">horizon</span><span class="p">)</span>
<a id="__codelineno-1-85" name="__codelineno-1-85"></a>
<a id="__codelineno-1-86" name="__codelineno-1-86"></a>  <span class="k">return</span> <span class="n">windows</span><span class="p">,</span> <span class="n">labels</span>
<a id="__codelineno-1-87" name="__codelineno-1-87"></a>
<a id="__codelineno-1-88" name="__codelineno-1-88"></a>
<a id="__codelineno-1-89" name="__codelineno-1-89"></a><span class="c1"># Make the train/test splits</span>
<a id="__codelineno-1-90" name="__codelineno-1-90"></a><span class="k">def</span> <span class="nf">make_train_test_splits</span><span class="p">(</span><span class="n">windows</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">test_split</span><span class="o">=</span><span class="mf">0.2</span><span class="p">):</span>
<a id="__codelineno-1-91" name="__codelineno-1-91"></a>  <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-1-92" name="__codelineno-1-92"></a><span class="sd">  Splits matching pairs of windows and labels into train and test splits.</span>
<a id="__codelineno-1-93" name="__codelineno-1-93"></a><span class="sd">  &quot;&quot;&quot;</span>
<a id="__codelineno-1-94" name="__codelineno-1-94"></a>  <span class="n">split_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">windows</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">test_split</span><span class="p">))</span> <span class="c1"># this will default to 80% train/20% test</span>
<a id="__codelineno-1-95" name="__codelineno-1-95"></a>  <span class="n">train_windows</span> <span class="o">=</span> <span class="n">windows</span><span class="p">[:</span><span class="n">split_size</span><span class="p">]</span>
<a id="__codelineno-1-96" name="__codelineno-1-96"></a>  <span class="n">train_labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[:</span><span class="n">split_size</span><span class="p">]</span>
<a id="__codelineno-1-97" name="__codelineno-1-97"></a>  <span class="n">test_windows</span> <span class="o">=</span> <span class="n">windows</span><span class="p">[</span><span class="n">split_size</span><span class="p">:]</span>
<a id="__codelineno-1-98" name="__codelineno-1-98"></a>  <span class="n">test_labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">split_size</span><span class="p">:]</span>
<a id="__codelineno-1-99" name="__codelineno-1-99"></a>  <span class="k">return</span> <span class="n">train_windows</span><span class="p">,</span> <span class="n">test_windows</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">test_labels</span>
<a id="__codelineno-1-100" name="__codelineno-1-100"></a>
<a id="__codelineno-1-101" name="__codelineno-1-101"></a>
<a id="__codelineno-1-102" name="__codelineno-1-102"></a><span class="c1"># Create a function to implement a ModelCheckpoint callback with a specific filename </span>
<a id="__codelineno-1-103" name="__codelineno-1-103"></a><span class="k">def</span> <span class="nf">create_model_checkpoint</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="s2">&quot;model_experiments&quot;</span><span class="p">):</span>
<a id="__codelineno-1-104" name="__codelineno-1-104"></a>  <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">ModelCheckpoint</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">model_name</span><span class="p">),</span> <span class="c1"># create filepath to save model</span>
<a id="__codelineno-1-105" name="__codelineno-1-105"></a>                                            <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="c1"># only output a limited amount of text</span>
<a id="__codelineno-1-106" name="__codelineno-1-106"></a>                                            <span class="n">save_best_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># save only the best model to file</span>
<a id="__codelineno-1-107" name="__codelineno-1-107"></a>
<a id="__codelineno-1-108" name="__codelineno-1-108"></a>
<a id="__codelineno-1-109" name="__codelineno-1-109"></a><span class="k">def</span> <span class="nf">make_preds</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">input_data</span><span class="p">):</span>
<a id="__codelineno-1-110" name="__codelineno-1-110"></a>  <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-1-111" name="__codelineno-1-111"></a><span class="sd">  Uses model to make predictions on input_data.</span>
<a id="__codelineno-1-112" name="__codelineno-1-112"></a>
<a id="__codelineno-1-113" name="__codelineno-1-113"></a><span class="sd">  Parameters</span>
<a id="__codelineno-1-114" name="__codelineno-1-114"></a><span class="sd">  ----------</span>
<a id="__codelineno-1-115" name="__codelineno-1-115"></a><span class="sd">  model: trained model </span>
<a id="__codelineno-1-116" name="__codelineno-1-116"></a><span class="sd">  input_data: windowed input data (same kind of data model was trained on)</span>
<a id="__codelineno-1-117" name="__codelineno-1-117"></a>
<a id="__codelineno-1-118" name="__codelineno-1-118"></a><span class="sd">  Returns model predictions on input_data.</span>
<a id="__codelineno-1-119" name="__codelineno-1-119"></a><span class="sd">  &quot;&quot;&quot;</span>
<a id="__codelineno-1-120" name="__codelineno-1-120"></a>  <span class="n">forecast</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span>
<a id="__codelineno-1-121" name="__codelineno-1-121"></a>  <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">forecast</span><span class="p">)</span> <span class="c1"># return 1D array of predictions</span>
<a id="__codelineno-1-122" name="__codelineno-1-122"></a>
<a id="__codelineno-1-123" name="__codelineno-1-123"></a>
<a id="__codelineno-1-124" name="__codelineno-1-124"></a><span class="k">def</span> <span class="nf">evaluate_preds</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
<a id="__codelineno-1-125" name="__codelineno-1-125"></a>  <span class="c1"># Make sure float32 (for metric calculations)</span>
<a id="__codelineno-1-126" name="__codelineno-1-126"></a>  <span class="n">y_true</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-1-127" name="__codelineno-1-127"></a>  <span class="n">y_pred</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-1-128" name="__codelineno-1-128"></a>
<a id="__codelineno-1-129" name="__codelineno-1-129"></a>  <span class="c1"># Calculate various metrics</span>
<a id="__codelineno-1-130" name="__codelineno-1-130"></a>  <span class="n">mae</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<a id="__codelineno-1-131" name="__codelineno-1-131"></a>  <span class="n">mse</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<a id="__codelineno-1-132" name="__codelineno-1-132"></a>  <span class="n">rmse</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mse</span><span class="p">)</span>
<a id="__codelineno-1-133" name="__codelineno-1-133"></a>  <span class="n">mape</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_percentage_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<a id="__codelineno-1-134" name="__codelineno-1-134"></a>  <span class="n">mase</span> <span class="o">=</span> <span class="n">mean_absolute_scaled_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<a id="__codelineno-1-135" name="__codelineno-1-135"></a>
<a id="__codelineno-1-136" name="__codelineno-1-136"></a>  <span class="c1"># Account for different sized metrics (for longer horizons, reduce to single number)</span>
<a id="__codelineno-1-137" name="__codelineno-1-137"></a>  <span class="k">if</span> <span class="n">mae</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># if mae isn&#39;t already a scalar, reduce it to one by aggregating tensors to mean</span>
<a id="__codelineno-1-138" name="__codelineno-1-138"></a>    <span class="n">mae</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">mae</span><span class="p">)</span>
<a id="__codelineno-1-139" name="__codelineno-1-139"></a>    <span class="n">mse</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">mse</span><span class="p">)</span>
<a id="__codelineno-1-140" name="__codelineno-1-140"></a>    <span class="n">rmse</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">rmse</span><span class="p">)</span>
<a id="__codelineno-1-141" name="__codelineno-1-141"></a>    <span class="n">mape</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">mape</span><span class="p">)</span>
<a id="__codelineno-1-142" name="__codelineno-1-142"></a>    <span class="n">mase</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">mase</span><span class="p">)</span>
<a id="__codelineno-1-143" name="__codelineno-1-143"></a>
<a id="__codelineno-1-144" name="__codelineno-1-144"></a>  <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;mae&quot;</span><span class="p">:</span> <span class="n">mae</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-1-145" name="__codelineno-1-145"></a>          <span class="s2">&quot;mse&quot;</span><span class="p">:</span> <span class="n">mse</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-1-146" name="__codelineno-1-146"></a>          <span class="s2">&quot;rmse&quot;</span><span class="p">:</span> <span class="n">rmse</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-1-147" name="__codelineno-1-147"></a>          <span class="s2">&quot;mape&quot;</span><span class="p">:</span> <span class="n">mape</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-1-148" name="__codelineno-1-148"></a>          <span class="s2">&quot;mase&quot;</span><span class="p">:</span> <span class="n">mase</span><span class="o">.</span><span class="n">numpy</span><span class="p">()}</span>
<a id="__codelineno-1-149" name="__codelineno-1-149"></a>
<a id="__codelineno-1-150" name="__codelineno-1-150"></a>
<a id="__codelineno-1-151" name="__codelineno-1-151"></a><span class="c1"># Create a function which uses a list of trained models to make and return a list of predictions</span>
<a id="__codelineno-1-152" name="__codelineno-1-152"></a><span class="k">def</span> <span class="nf">make_ensemble_preds</span><span class="p">(</span><span class="n">ensemble_models</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<a id="__codelineno-1-153" name="__codelineno-1-153"></a>  <span class="n">ensemble_preds</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-1-154" name="__codelineno-1-154"></a>  <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">ensemble_models</span><span class="p">:</span>
<a id="__codelineno-1-155" name="__codelineno-1-155"></a>    <span class="n">preds</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="c1"># make predictions with current ensemble model</span>
<a id="__codelineno-1-156" name="__codelineno-1-156"></a>    <span class="n">ensemble_preds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">preds</span><span class="p">)</span>
<a id="__codelineno-1-157" name="__codelineno-1-157"></a>  <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">ensemble_preds</span><span class="p">))</span>
<a id="__codelineno-1-158" name="__codelineno-1-158"></a>
<a id="__codelineno-1-159" name="__codelineno-1-159"></a>
<a id="__codelineno-1-160" name="__codelineno-1-160"></a><span class="c1"># Find upper and lower bounds of ensemble predictions</span>
<a id="__codelineno-1-161" name="__codelineno-1-161"></a><span class="k">def</span> <span class="nf">get_upper_lower</span><span class="p">(</span><span class="n">preds</span><span class="p">):</span> <span class="c1"># 1. Take the predictions of multiple randomly initialized deep learning neural networks</span>
<a id="__codelineno-1-162" name="__codelineno-1-162"></a>
<a id="__codelineno-1-163" name="__codelineno-1-163"></a>  <span class="c1"># 2. Measure the standard deviation of the predictions</span>
<a id="__codelineno-1-164" name="__codelineno-1-164"></a>  <span class="n">std</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">reduce_std</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-1-165" name="__codelineno-1-165"></a>
<a id="__codelineno-1-166" name="__codelineno-1-166"></a>  <span class="c1"># 3. Multiply the standard deviation by 1.96</span>
<a id="__codelineno-1-167" name="__codelineno-1-167"></a>  <span class="n">interval</span> <span class="o">=</span> <span class="mf">1.96</span> <span class="o">*</span> <span class="n">std</span> <span class="c1"># https://en.wikipedia.org/wiki/1.96 </span>
<a id="__codelineno-1-168" name="__codelineno-1-168"></a>
<a id="__codelineno-1-169" name="__codelineno-1-169"></a>  <span class="c1"># 4. Get the prediction interval upper and lower bounds</span>
<a id="__codelineno-1-170" name="__codelineno-1-170"></a>  <span class="n">preds_mean</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-1-171" name="__codelineno-1-171"></a>  <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">preds_mean</span> <span class="o">-</span> <span class="n">interval</span><span class="p">,</span> <span class="n">preds_mean</span> <span class="o">+</span> <span class="n">interval</span>
<a id="__codelineno-1-172" name="__codelineno-1-172"></a>  <span class="k">return</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span>
</code></pre></div>
</td></tr></table>
<p><a name="data"></a></p>
<h2 id="the-data"><strong>The Data</strong></h2>
<p><a name="download"></a></p>
<h3 id="download-data">Download Data</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span>
<span class="normal"><a href="#__codelineno-2-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="c1"># Download Bitcoin historical data from GitHub </span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="c1"># Note: you&#39;ll need to select &quot;Raw&quot; to download the data in the correct format</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="err">!</span><span class="n">wget</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">raw</span><span class="o">.</span><span class="n">githubusercontent</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">mrdbourke</span><span class="o">/</span><span class="n">tensorflow</span><span class="o">-</span><span class="n">deep</span><span class="o">-</span><span class="n">learning</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">extras</span><span class="o">/</span><span class="n">BTC_USD_2013</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">01_2021</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">18</span><span class="o">-</span><span class="n">CoinDesk</span><span class="o">.</span><span class="n">csv</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    --2021-12-03 01:47:05--  https://raw.githubusercontent.com/mrdbourke/tensorflow-deep-learning/main/extras/BTC_USD_2013-10-01_2021-05-18-CoinDesk.csv
    Resolving raw.githubusercontent.com (raw.githubusercontent.com)... 185.199.108.133, 185.199.109.133, 185.199.110.133, ...
    Connecting to raw.githubusercontent.com (raw.githubusercontent.com)|185.199.108.133|:443... connected.
    HTTP request sent, awaiting response... 200 OK
    Length: 178509 (174K) [text/plain]
    Saving to: BTC_USD_2013-10-01_2021-05-18-CoinDesk.csv.2

    BTC_USD_2013-10-01_ 100%[===================>] 174.33K  --.-KB/s    in 0.03s   

    2021-12-03 01:47:05 (6.08 MB/s) - BTC_USD_2013-10-01_2021-05-18-CoinDesk.csv.2 saved [178509/178509]
</pre>
</div>

<p><a name=""></a></p>
<h3 id="inspect-the-data">Inspect the Data</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span>
<span class="normal"><a href="#__codelineno-3-2">2</a></span>
<span class="normal"><a href="#__codelineno-3-3">3</a></span>
<span class="normal"><a href="#__codelineno-3-4">4</a></span>
<span class="normal"><a href="#__codelineno-3-5">5</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="c1"># Parse dates and set date column to index</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;/content/BTC_USD_2013-10-01_2021-05-18-CoinDesk.csv&quot;</span><span class="p">,</span> 
<a id="__codelineno-3-3" name="__codelineno-3-3"></a>                 <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Date&quot;</span><span class="p">],</span> 
<a id="__codelineno-3-4" name="__codelineno-3-4"></a>                 <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Date&quot;</span><span class="p">])</span> <span class="c1"># parse the date column (tell pandas column 1 is a datetime)</span>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
                Currency    Closing Price (USD)     24h Open (USD)  24h High (USD)  24h Low (USD)
    Date                    
    2013-10-01  BTC         123.65499               124.30466       124.75166       122.56349
    2013-10-02  BTC         125.45500               123.65499       125.75850       123.63383
    2013-10-03  BTC         108.58483               125.45500       125.66566       83.32833
    2013-10-04  BTC         118.67466               108.58483       118.67500       107.05816
    2013-10-05  BTC         121.33866               118.67466       121.93633       118.00566
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    class 'pandas.core.frame.DataFrame'
    DatetimeIndex: 2787 entries, 2013-10-01 to 2021-05-18
    Data columns (total 5 columns):
     #   Column               Non-Null Count  Dtype  
    ---  ------               --------------  -----  
     0   Currency             2787 non-null   object 
     1   Closing Price (USD)  2787 non-null   float64
     2   24h Open (USD)       2787 non-null   float64
     3   24h High (USD)       2787 non-null   float64
     4   24h Low (USD)        2787 non-null   float64
    dtypes: float64(4), object(1)
    memory usage: 130.6+ KB
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">1</a></span>
<span class="normal"><a href="#__codelineno-5-2">2</a></span>
<span class="normal"><a href="#__codelineno-5-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="c1"># Only want closing price for each day </span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="n">bitcoin_prices</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Closing Price (USD)&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Closing Price (USD)&quot;</span><span class="p">:</span> <span class="s2">&quot;Price&quot;</span><span class="p">})</span>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="n">bitcoin_prices</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
                Price
        Date    
    2013-10-01  123.65499
    2013-10-02  125.45500
    2013-10-03  108.58483
    2013-10-04  118.67466
    2013-10-05  121.33866
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1">1</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    2787
</pre>
</div>

<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1">1</a></span>
<span class="normal"><a href="#__codelineno-7-2">2</a></span>
<span class="normal"><a href="#__codelineno-7-3">3</a></span>
<span class="normal"><a href="#__codelineno-7-4">4</a></span>
<span class="normal"><a href="#__codelineno-7-5">5</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="c1"># Let&#39;s plot the data</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="n">bitcoin_prices</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;BTC Price&quot;</span><span class="p">)</span>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Price of Bitcoin from 1 Oct 2013 to 18 May 2021&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<a id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
</code></pre></div>
</td></tr></table>
<img alt="bitcoin-1" src="../../../images/bitcoin-1.png" /></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-8-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-8-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-8-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-8-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-8-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-8-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-8-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-8-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-8-10">10</a></span>
<span class="normal"><a href="#__codelineno-8-11">11</a></span>
<span class="normal"><a href="#__codelineno-8-12">12</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="c1"># Importing and formatting historical Bitcoin data with Python</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="n">timesteps</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="n">btc_price</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;/content/BTC_USD_2013-10-01_2021-05-18-CoinDesk.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-8-5" name="__codelineno-8-5"></a>  <span class="n">csv_reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="c1"># read in the target CSV</span>
<a id="__codelineno-8-6" name="__codelineno-8-6"></a>  <span class="nb">next</span><span class="p">(</span><span class="n">csv_reader</span><span class="p">)</span> <span class="c1"># skip first line (this gets rid of the column titles)</span>
<a id="__codelineno-8-7" name="__codelineno-8-7"></a>  <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">csv_reader</span><span class="p">:</span>
<a id="__codelineno-8-8" name="__codelineno-8-8"></a>    <span class="n">timesteps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">))</span> <span class="c1"># get the dates as dates (not strings), strptime = string parse time</span>
<a id="__codelineno-8-9" name="__codelineno-8-9"></a>    <span class="n">btc_price</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span> <span class="c1"># get the closing price as float</span>
<a id="__codelineno-8-10" name="__codelineno-8-10"></a>
<a id="__codelineno-8-11" name="__codelineno-8-11"></a><span class="c1"># View first 10 of each</span>
<a id="__codelineno-8-12" name="__codelineno-8-12"></a><span class="n">timesteps</span><span class="p">[:</span><span class="mi">10</span><span class="p">],</span> <span class="n">btc_price</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    ([datetime.datetime(2013, 10, 1, 0, 0),
      datetime.datetime(2013, 10, 2, 0, 0),
      datetime.datetime(2013, 10, 3, 0, 0),
      datetime.datetime(2013, 10, 4, 0, 0),
      datetime.datetime(2013, 10, 5, 0, 0),
      datetime.datetime(2013, 10, 6, 0, 0),
      datetime.datetime(2013, 10, 7, 0, 0),
      datetime.datetime(2013, 10, 8, 0, 0),
      datetime.datetime(2013, 10, 9, 0, 0),
      datetime.datetime(2013, 10, 10, 0, 0)],
     [123.65499,
      125.455,
      108.58483,
      118.67466,
      121.33866,
      120.65533,
      121.795,
      123.033,
      124.049,
      125.96116])
</pre>
</div>

<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1">1</a></span>
<span class="normal"><a href="#__codelineno-9-2">2</a></span>
<span class="normal"><a href="#__codelineno-9-3">3</a></span>
<span class="normal"><a href="#__codelineno-9-4">4</a></span>
<span class="normal"><a href="#__codelineno-9-5">5</a></span>
<span class="normal"><a href="#__codelineno-9-6">6</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="c1"># What does it look like?</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<a id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timesteps</span><span class="p">,</span> <span class="n">btc_price</span><span class="p">)</span>
<a id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Price of Bitcoin from 1 Oct 2013 to 18 May 2021&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<a id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Date&quot;</span><span class="p">)</span>
<a id="__codelineno-9-6" name="__codelineno-9-6"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;BTC Price&quot;</span><span class="p">);</span>
</code></pre></div>
</td></tr></table>
<img alt="bitcoin-2" src="../../../images/bitcoin-2.png" /></p>
<h3 id="prepare-the-data">Prepare the Data</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1">1</a></span>
<span class="normal"><a href="#__codelineno-10-2">2</a></span>
<span class="normal"><a href="#__codelineno-10-3">3</a></span>
<span class="normal"><a href="#__codelineno-10-4">4</a></span>
<span class="normal"><a href="#__codelineno-10-5">5</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="c1"># Get bitcoin date array</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="n">timesteps</span> <span class="o">=</span> <span class="n">bitcoin_prices</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="n">prices</span> <span class="o">=</span> <span class="n">bitcoin_prices</span><span class="p">[</span><span class="s2">&quot;Price&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a>
<a id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="n">timesteps</span><span class="p">[:</span><span class="mi">10</span><span class="p">],</span> <span class="n">prices</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (array(['2013-10-01T00:00:00.000000000', '2013-10-02T00:00:00.000000000',
            '2013-10-03T00:00:00.000000000', '2013-10-04T00:00:00.000000000',
            '2013-10-05T00:00:00.000000000', '2013-10-06T00:00:00.000000000',
            '2013-10-07T00:00:00.000000000', '2013-10-08T00:00:00.000000000',
            '2013-10-09T00:00:00.000000000', '2013-10-10T00:00:00.000000000'],
           dtype='datetime64[ns]'),
     array([123.65499, 125.455  , 108.58483, 118.67466, 121.33866, 120.65533,
            121.795  , 123.033  , 124.049  , 125.96116]))
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-11-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-11-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-11-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-11-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-11-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-11-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-11-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-11-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-11-10">10</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="c1"># Create train and test splits the right way for time series data</span>
<a id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="n">split_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.8</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">prices</span><span class="p">))</span> <span class="c1"># 80% train, 20% test</span>
<a id="__codelineno-11-3" name="__codelineno-11-3"></a>
<a id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="c1"># Create train data splits (everything before the split)</span>
<a id="__codelineno-11-5" name="__codelineno-11-5"></a><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">timesteps</span><span class="p">[:</span><span class="n">split_size</span><span class="p">],</span> <span class="n">prices</span><span class="p">[:</span><span class="n">split_size</span><span class="p">]</span>
<a id="__codelineno-11-6" name="__codelineno-11-6"></a>
<a id="__codelineno-11-7" name="__codelineno-11-7"></a><span class="c1"># Create test data splits (everything after the split)</span>
<a id="__codelineno-11-8" name="__codelineno-11-8"></a><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">timesteps</span><span class="p">[</span><span class="n">split_size</span><span class="p">:],</span> <span class="n">prices</span><span class="p">[</span><span class="n">split_size</span><span class="p">:]</span>
<a id="__codelineno-11-9" name="__codelineno-11-9"></a>
<a id="__codelineno-11-10" name="__codelineno-11-10"></a><span class="nb">len</span><span class="p">(</span><span class="n">X_train</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_test</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_train</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (2229, 558, 2229, 558)
</pre>
</div>

<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1">1</a></span>
<span class="normal"><a href="#__codelineno-12-2">2</a></span>
<span class="normal"><a href="#__codelineno-12-3">3</a></span>
<span class="normal"><a href="#__codelineno-12-4">4</a></span>
<span class="normal"><a href="#__codelineno-12-5">5</a></span>
<span class="normal"><a href="#__codelineno-12-6">6</a></span>
<span class="normal"><a href="#__codelineno-12-7">7</a></span>
<span class="normal"><a href="#__codelineno-12-8">8</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="c1"># Plot the splits</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<a id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Train data&quot;</span><span class="p">)</span>
<a id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test data&quot;</span><span class="p">)</span>
<a id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Date&quot;</span><span class="p">)</span>
<a id="__codelineno-12-6" name="__codelineno-12-6"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;BTC Price&quot;</span><span class="p">)</span>
<a id="__codelineno-12-7" name="__codelineno-12-7"></a><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<a id="__codelineno-12-8" name="__codelineno-12-8"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">();</span>
</code></pre></div>
</td></tr></table>
<img alt="bitcoin-3" src="../../../images/bitcoin-3.png" /></p>
<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1">1</a></span>
<span class="normal"><a href="#__codelineno-13-2">2</a></span>
<span class="normal"><a href="#__codelineno-13-3">3</a></span>
<span class="normal"><a href="#__codelineno-13-4">4</a></span>
<span class="normal"><a href="#__codelineno-13-5">5</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="c1"># Create a function to plot time series data (see Utility scripts) and</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="c1"># Try out our plotting function</span>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="n">plot_time_series</span><span class="p">(</span><span class="n">timesteps</span><span class="o">=</span><span class="n">X_train</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">y_train</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Train data&quot;</span><span class="p">)</span>
<a id="__codelineno-13-5" name="__codelineno-13-5"></a><span class="n">plot_time_series</span><span class="p">(</span><span class="n">timesteps</span><span class="o">=</span><span class="n">X_test</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">y_test</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test data&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<img alt="bitcoin-4" src="../../../images/bitcoin-4.png" /></p>
<p><a name="model-0"></a></p>
<h2 id="model-0-naive-forecast"><strong>Model 0: Na誰ve Forecast</strong></h2>
<p><a name=""></a></p>
<h3 id="create-compile-and-fit-model">Create, Compile, and Fit Model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1">1</a></span>
<span class="normal"><a href="#__codelineno-14-2">2</a></span>
<span class="normal"><a href="#__codelineno-14-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="c1"># Create a na誰ve forecast</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="n">naive_forecast</span> <span class="o">=</span> <span class="n">y_test</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># Na誰ve forecast equals every value excluding the last value</span>
<a id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="n">naive_forecast</span><span class="p">[:</span><span class="mi">10</span><span class="p">],</span> <span class="n">naive_forecast</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">:]</span> <span class="c1"># View frist 10 and last 10</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (array([9226.48582088, 8794.35864452, 8798.04205463, 9081.18687849,
            8711.53433917, 8760.89271814, 8749.52059102, 8656.97092235,
            8500.64355816, 8469.2608989 ]),
     array([57107.12067189, 58788.20967893, 58102.19142623, 55715.54665129,
            56573.5554719 , 52147.82118698, 49764.1320816 , 50032.69313676,
            47885.62525472, 45604.61575361]))
</pre>
</div>

<p><a name=""></a></p>
<h3 id="inspect-model">Inspect Model</h3>
<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1">1</a></span>
<span class="normal"><a href="#__codelineno-15-2">2</a></span>
<span class="normal"><a href="#__codelineno-15-3">3</a></span>
<span class="normal"><a href="#__codelineno-15-4">4</a></span>
<span class="normal"><a href="#__codelineno-15-5">5</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="c1"># Plot naive forecast</span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<a id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="n">plot_time_series</span><span class="p">(</span><span class="n">timesteps</span><span class="o">=</span><span class="n">X_train</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">y_train</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Train data&quot;</span><span class="p">)</span>
<a id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="n">plot_time_series</span><span class="p">(</span><span class="n">timesteps</span><span class="o">=</span><span class="n">X_test</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">y_test</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test data&quot;</span><span class="p">)</span>
<a id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="n">plot_time_series</span><span class="p">(</span><span class="n">timesteps</span><span class="o">=</span><span class="n">X_test</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">values</span><span class="o">=</span><span class="n">naive_forecast</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Naive forecast&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<img alt="bitcoin-5" src="../../../images/bitcoin-5.png" /></p>
<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1">1</a></span>
<span class="normal"><a href="#__codelineno-16-2">2</a></span>
<span class="normal"><a href="#__codelineno-16-3">3</a></span>
<span class="normal"><a href="#__codelineno-16-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="n">offset</span> <span class="o">=</span> <span class="mi">300</span> <span class="c1"># offset the values by 300 timesteps </span>
<a id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="n">plot_time_series</span><span class="p">(</span><span class="n">timesteps</span><span class="o">=</span><span class="n">X_test</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">y_test</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test data&quot;</span><span class="p">)</span>
<a id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="n">plot_time_series</span><span class="p">(</span><span class="n">timesteps</span><span class="o">=</span><span class="n">X_test</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">values</span><span class="o">=</span><span class="n">naive_forecast</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Naive forecast&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<img alt="bitcoin-6" src="../../../images/bitcoin-6.png" /></p>
<p><a name=""></a></p>
<h3 id="evaluate-model">Evaluate Model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1">1</a></span>
<span class="normal"><a href="#__codelineno-17-2">2</a></span>
<span class="normal"><a href="#__codelineno-17-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="n">naive_results</span> <span class="o">=</span> <span class="n">evaluate_preds</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">y_test</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>
<a id="__codelineno-17-2" name="__codelineno-17-2"></a>                               <span class="n">y_pred</span><span class="o">=</span><span class="n">naive_forecast</span><span class="p">)</span>
<a id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="n">naive_results</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    {'mae': 567.9802,
     'mape': 2.516525,
     'mase': 0.99957,
     'mse': 1147547.0,
     'rmse': 1071.2362}
</pre>
</div>

<p><a name="model-1"></a></p>
<h2 id="model-1-dense-window7-horizon1"><strong>Model 1: Dense (window=7, horizon=1)</strong></h2>
<p><a name=""></a></p>
<h3 id="prepare-data">Prepare Data</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1">1</a></span>
<span class="normal"><a href="#__codelineno-18-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="n">HORIZON</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># predict 1 step at a time</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="n">WINDOW_SIZE</span> <span class="o">=</span> <span class="mi">7</span> <span class="c1"># use a week worth of timesteps to predict the horizon</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1">1</a></span>
<span class="normal"><a href="#__codelineno-19-2">2</a></span>
<span class="normal"><a href="#__codelineno-19-3">3</a></span>
<span class="normal"><a href="#__codelineno-19-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="c1"># Create function to label windowed data (see utility script)</span>
<a id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="c1"># Test out the window labelling function</span>
<a id="__codelineno-19-3" name="__codelineno-19-3"></a><span class="n">test_window</span><span class="p">,</span> <span class="n">test_label</span> <span class="o">=</span> <span class="n">get_labelled_windows</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">horizon</span><span class="o">=</span><span class="n">HORIZON</span><span class="p">)</span>
<a id="__codelineno-19-4" name="__codelineno-19-4"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Window: </span><span class="si">{</span><span class="n">tf</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">test_window</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="si">}</span><span class="s2"> -&gt; Label: </span><span class="si">{</span><span class="n">tf</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">test_label</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Window: [1 2 3 4 5 6 7] -> Label: 8
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1">1</a></span>
<span class="normal"><a href="#__codelineno-20-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="n">full_windows</span><span class="p">,</span> <span class="n">full_labels</span> <span class="o">=</span> <span class="n">make_windows</span><span class="p">(</span><span class="n">prices</span><span class="p">,</span> <span class="n">window_size</span><span class="o">=</span><span class="n">WINDOW_SIZE</span><span class="p">,</span> <span class="n">horizon</span><span class="o">=</span><span class="n">HORIZON</span><span class="p">)</span>
<a id="__codelineno-20-2" name="__codelineno-20-2"></a><span class="nb">len</span><span class="p">(</span><span class="n">full_windows</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">full_labels</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (2780, 2780)
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1">1</a></span>
<span class="normal"><a href="#__codelineno-21-2">2</a></span>
<span class="normal"><a href="#__codelineno-21-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="c1"># View the first 3 windows/labels</span>
<a id="__codelineno-21-2" name="__codelineno-21-2"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
<a id="__codelineno-21-3" name="__codelineno-21-3"></a>  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Window: </span><span class="si">{</span><span class="n">full_windows</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2"> -&gt; Label: </span><span class="si">{</span><span class="n">full_labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Window: [123.65499 125.455   108.58483 118.67466 121.33866 120.65533 121.795  ] -> Label: [123.033]
    Window: [125.455   108.58483 118.67466 121.33866 120.65533 121.795   123.033  ] -> Label: [124.049]
    Window: [108.58483 118.67466 121.33866 120.65533 121.795   123.033   124.049  ] -> Label: [125.96116]
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1">1</a></span>
<span class="normal"><a href="#__codelineno-22-2">2</a></span>
<span class="normal"><a href="#__codelineno-22-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="c1"># View the last 3 windows/labels</span>
<a id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
<a id="__codelineno-22-3" name="__codelineno-22-3"></a>  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Window: </span><span class="si">{</span><span class="n">full_windows</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="si">}</span><span class="s2"> -&gt; Label: </span><span class="si">{</span><span class="n">full_labels</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Window: [58788.20967893 58102.19142623 55715.54665129 56573.5554719
     52147.82118698 49764.1320816  50032.69313676] -> Label: [47885.62525472]
    Window: [58102.19142623 55715.54665129 56573.5554719  52147.82118698
     49764.1320816  50032.69313676 47885.62525472] -> Label: [45604.61575361]
    Window: [55715.54665129 56573.5554719  52147.82118698 49764.1320816
     50032.69313676 47885.62525472 45604.61575361] -> Label: [43144.47129086]
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1">1</a></span>
<span class="normal"><a href="#__codelineno-23-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="n">train_windows</span><span class="p">,</span> <span class="n">test_windows</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">test_labels</span> <span class="o">=</span> <span class="n">make_train_test_splits</span><span class="p">(</span><span class="n">full_windows</span><span class="p">,</span> <span class="n">full_labels</span><span class="p">)</span>
<a id="__codelineno-23-2" name="__codelineno-23-2"></a><span class="nb">len</span><span class="p">(</span><span class="n">train_windows</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_windows</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_labels</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_labels</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (2224, 556, 2224, 556)
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1">1</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="n">train_windows</span><span class="p">[:</span><span class="mi">5</span><span class="p">],</span> <span class="n">train_labels</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (array([[123.65499, 125.455  , 108.58483, 118.67466, 121.33866, 120.65533,
             121.795  ],
            [125.455  , 108.58483, 118.67466, 121.33866, 120.65533, 121.795  ,
             123.033  ],
            [108.58483, 118.67466, 121.33866, 120.65533, 121.795  , 123.033  ,
             124.049  ],
            [118.67466, 121.33866, 120.65533, 121.795  , 123.033  , 124.049  ,
             125.96116],
            [121.33866, 120.65533, 121.795  , 123.033  , 124.049  , 125.96116,
             125.27966]]), array([[123.033  ],
            [124.049  ],
            [125.96116],
            [125.27966],
            [125.9275 ]]))
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1">1</a></span>
<span class="normal"><a href="#__codelineno-25-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="c1"># Check to see if same (accounting for horizon and window size)</span>
<a id="__codelineno-25-2" name="__codelineno-25-2"></a><span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">train_labels</span><span class="p">[:</span><span class="o">-</span><span class="n">HORIZON</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">y_train</span><span class="p">[</span><span class="n">WINDOW_SIZE</span><span class="p">:])</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    True
</pre>
</div>

<p><a name=""></a></p>
<h3 id="create-compile-and-fit-model_1">Create, Compile, and Fit Model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-26-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-26-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-26-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-26-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-26-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-26-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-26-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-26-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-26-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-26-10">10</a></span>
<span class="normal"><a href="#__codelineno-26-11">11</a></span>
<span class="normal"><a href="#__codelineno-26-12">12</a></span>
<span class="normal"><a href="#__codelineno-26-13">13</a></span>
<span class="normal"><a href="#__codelineno-26-14">14</a></span>
<span class="normal"><a href="#__codelineno-26-15">15</a></span>
<span class="normal"><a href="#__codelineno-26-16">16</a></span>
<span class="normal"><a href="#__codelineno-26-17">17</a></span>
<span class="normal"><a href="#__codelineno-26-18">18</a></span>
<span class="normal"><a href="#__codelineno-26-19">19</a></span>
<span class="normal"><a href="#__codelineno-26-20">20</a></span>
<span class="normal"><a href="#__codelineno-26-21">21</a></span>
<span class="normal"><a href="#__codelineno-26-22">22</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="c1"># Set random seed for as reproducible results as possible</span>
<a id="__codelineno-26-2" name="__codelineno-26-2"></a><span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">set_seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<a id="__codelineno-26-3" name="__codelineno-26-3"></a>
<a id="__codelineno-26-4" name="__codelineno-26-4"></a><span class="c1"># CREATE MODEL</span>
<a id="__codelineno-26-5" name="__codelineno-26-5"></a><span class="n">model_1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
<a id="__codelineno-26-6" name="__codelineno-26-6"></a>  <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;relu&quot;</span><span class="p">),</span>
<a id="__codelineno-26-7" name="__codelineno-26-7"></a>  <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">HORIZON</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">)</span> <span class="c1"># linear activation is the same as having no activation                        </span>
<a id="__codelineno-26-8" name="__codelineno-26-8"></a><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;model_1_dense&quot;</span><span class="p">)</span> <span class="c1"># give the model a name so we can save it</span>
<a id="__codelineno-26-9" name="__codelineno-26-9"></a>
<a id="__codelineno-26-10" name="__codelineno-26-10"></a><span class="c1"># COMPILE MODEL</span>
<a id="__codelineno-26-11" name="__codelineno-26-11"></a><span class="n">model_1</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s2">&quot;mae&quot;</span><span class="p">,</span>
<a id="__codelineno-26-12" name="__codelineno-26-12"></a>                <span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(),</span>
<a id="__codelineno-26-13" name="__codelineno-26-13"></a>                <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mae&quot;</span><span class="p">])</span> <span class="c1"># we don&#39;t necessarily need this when the loss function is already MAE</span>
<a id="__codelineno-26-14" name="__codelineno-26-14"></a>
<a id="__codelineno-26-15" name="__codelineno-26-15"></a><span class="c1"># FIT MODEL</span>
<a id="__codelineno-26-16" name="__codelineno-26-16"></a><span class="n">model_1</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">train_windows</span><span class="p">,</span> <span class="c1"># train windows of 7 timesteps of Bitcoin prices</span>
<a id="__codelineno-26-17" name="__codelineno-26-17"></a>            <span class="n">y</span><span class="o">=</span><span class="n">train_labels</span><span class="p">,</span> <span class="c1"># horizon value of 1 (using the previous 7 timesteps to predict next day)</span>
<a id="__codelineno-26-18" name="__codelineno-26-18"></a>            <span class="n">epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-26-19" name="__codelineno-26-19"></a>            <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-26-20" name="__codelineno-26-20"></a>            <span class="n">batch_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
<a id="__codelineno-26-21" name="__codelineno-26-21"></a>            <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">test_windows</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">),</span>
<a id="__codelineno-26-22" name="__codelineno-26-22"></a>            <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">create_model_checkpoint</span><span class="p">(</span><span class="n">model_name</span><span class="o">=</span><span class="n">model_1</span><span class="o">.</span><span class="n">name</span><span class="p">)])</span> <span class="c1"># create ModelCheckpoint callback to save best model</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Epoch 1/100
    17/18 [===========================>..] - ETA: 0s - loss: 788.6984 - mae: 788.6984  INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    18/18 [==============================] - 1s 46ms/step - loss: 780.3455 - mae: 780.3455 - val_loss: 2279.6526 - val_mae: 2279.6526
    Epoch 2/100
    17/18 [===========================>..] - ETA: 0s - loss: 250.6439 - mae: 250.6439INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    18/18 [==============================] - 1s 41ms/step - loss: 247.6756 - mae: 247.6756 - val_loss: 1005.9991 - val_mae: 1005.9991
    Epoch 3/100
    17/18 [===========================>..] - ETA: 0s - loss: 190.2321 - mae: 190.2321INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    18/18 [==============================] - 1s 37ms/step - loss: 188.4116 - mae: 188.4116 - val_loss: 923.2862 - val_mae: 923.2862
    Epoch 4/100
    17/18 [===========================>..] - ETA: 0s - loss: 170.9412 - mae: 170.9412INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    18/18 [==============================] - 1s 37ms/step - loss: 169.4340 - mae: 169.4340 - val_loss: 900.5872 - val_mae: 900.5872
    Epoch 5/100
    18/18 [==============================] - ETA: 0s - loss: 165.0895 - mae: 165.0895INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    18/18 [==============================] - 1s 39ms/step - loss: 165.0895 - mae: 165.0895 - val_loss: 895.2238 - val_mae: 895.2238
    Epoch 6/100
    17/18 [===========================>..] - ETA: 0s - loss: 156.6034 - mae: 156.6034INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    18/18 [==============================] - 1s 38ms/step - loss: 158.5210 - mae: 158.5210 - val_loss: 855.1982 - val_mae: 855.1982
    Epoch 7/100
    15/18 [========================>.....] - ETA: 0s - loss: 155.5176 - mae: 155.5176INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    18/18 [==============================] - 1s 36ms/step - loss: 151.3566 - mae: 151.3566 - val_loss: 840.9168 - val_mae: 840.9168
    Epoch 8/100
    17/18 [===========================>..] - ETA: 0s - loss: 145.3278 - mae: 145.3278INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    18/18 [==============================] - 1s 37ms/step - loss: 145.2560 - mae: 145.2560 - val_loss: 803.5956 - val_mae: 803.5956
    Epoch 9/100
    18/18 [==============================] - ETA: 0s - loss: 144.3546 - mae: 144.3546INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    18/18 [==============================] - 1s 38ms/step - loss: 144.3546 - mae: 144.3546 - val_loss: 799.5455 - val_mae: 799.5455
    Epoch 10/100
    17/18 [===========================>..] - ETA: 0s - loss: 140.3382 - mae: 140.3382INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    18/18 [==============================] - 1s 38ms/step - loss: 141.2943 - mae: 141.2943 - val_loss: 763.5010 - val_mae: 763.5010
    Epoch 11/100
    18/18 [==============================] - 0s 5ms/step - loss: 135.6595 - mae: 135.6595 - val_loss: 771.3357 - val_mae: 771.3357
    Epoch 12/100
    18/18 [==============================] - 0s 5ms/step - loss: 134.1700 - mae: 134.1700 - val_loss: 782.8079 - val_mae: 782.8079
    Epoch 13/100
    18/18 [==============================] - 0s 6ms/step - loss: 134.6015 - mae: 134.6015 - val_loss: 784.4449 - val_mae: 784.4449
    Epoch 14/100
    17/18 [===========================>..] - ETA: 0s - loss: 127.6787 - mae: 127.6787INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    18/18 [==============================] - 1s 38ms/step - loss: 130.6127 - mae: 130.6127 - val_loss: 751.3234 - val_mae: 751.3234
    Epoch 15/100
    16/18 [=========================>....] - ETA: 0s - loss: 130.3331 - mae: 130.3331INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    18/18 [==============================] - 1s 39ms/step - loss: 128.8347 - mae: 128.8347 - val_loss: 696.5757 - val_mae: 696.5757
    Epoch 16/100
    18/18 [==============================] - 0s 6ms/step - loss: 124.7739 - mae: 124.7739 - val_loss: 702.4698 - val_mae: 702.4698
    Epoch 17/100
    18/18 [==============================] - 0s 6ms/step - loss: 123.4474 - mae: 123.4474 - val_loss: 704.9241 - val_mae: 704.9241
    Epoch 18/100
    17/18 [===========================>..] - ETA: 0s - loss: 123.1271 - mae: 123.1271INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    18/18 [==============================] - 1s 57ms/step - loss: 122.2105 - mae: 122.2105 - val_loss: 667.9725 - val_mae: 667.9725
    Epoch 19/100
    18/18 [==============================] - 0s 5ms/step - loss: 121.7263 - mae: 121.7263 - val_loss: 718.8797 - val_mae: 718.8797
    Epoch 20/100
    17/18 [===========================>..] - ETA: 0s - loss: 119.0798 - mae: 119.0798INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    18/18 [==============================] - 1s 36ms/step - loss: 119.2420 - mae: 119.2420 - val_loss: 657.0667 - val_mae: 657.0667
    Epoch 21/100
    18/18 [==============================] - ETA: 0s - loss: 121.2275 - mae: 121.2275INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    18/18 [==============================] - 1s 36ms/step - loss: 121.2275 - mae: 121.2275 - val_loss: 637.0330 - val_mae: 637.0330
    Epoch 22/100
    18/18 [==============================] - 0s 5ms/step - loss: 119.9544 - mae: 119.9544 - val_loss: 671.2490 - val_mae: 671.2490
    Epoch 23/100
    17/18 [===========================>..] - ETA: 0s - loss: 120.9507 - mae: 120.9507INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    18/18 [==============================] - 1s 37ms/step - loss: 121.9248 - mae: 121.9248 - val_loss: 633.3593 - val_mae: 633.3593
    Epoch 24/100
    16/18 [=========================>....] - ETA: 0s - loss: 117.3495 - mae: 117.3495INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    18/18 [==============================] - 1s 38ms/step - loss: 116.3666 - mae: 116.3666 - val_loss: 624.4852 - val_mae: 624.4852
    Epoch 25/100
    18/18 [==============================] - ETA: 0s - loss: 114.6816 - mae: 114.6816INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    18/18 [==============================] - 1s 38ms/step - loss: 114.6816 - mae: 114.6816 - val_loss: 619.7571 - val_mae: 619.7571
    Epoch 26/100
    17/18 [===========================>..] - ETA: 0s - loss: 115.9696 - mae: 115.9696INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    18/18 [==============================] - 1s 37ms/step - loss: 116.4455 - mae: 116.4455 - val_loss: 615.6364 - val_mae: 615.6364
    Epoch 27/100
    18/18 [==============================] - 0s 6ms/step - loss: 116.5868 - mae: 116.5868 - val_loss: 615.9631 - val_mae: 615.9631
    Epoch 28/100
    17/18 [===========================>..] - ETA: 0s - loss: 113.5246 - mae: 113.5246INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    18/18 [==============================] - 1s 38ms/step - loss: 113.4691 - mae: 113.4691 - val_loss: 608.0920 - val_mae: 608.0920
    Epoch 29/100
    18/18 [==============================] - 0s 5ms/step - loss: 113.7598 - mae: 113.7598 - val_loss: 621.9306 - val_mae: 621.9306
    Epoch 30/100
    18/18 [==============================] - ETA: 0s - loss: 116.8613 - mae: 116.8613INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    18/18 [==============================] - 1s 36ms/step - loss: 116.8613 - mae: 116.8613 - val_loss: 604.4056 - val_mae: 604.4056
    Epoch 31/100
    18/18 [==============================] - 0s 5ms/step - loss: 111.9375 - mae: 111.9375 - val_loss: 609.3882 - val_mae: 609.3882
    Epoch 32/100
    17/18 [===========================>..] - ETA: 0s - loss: 112.7391 - mae: 112.7391INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    18/18 [==============================] - 1s 37ms/step - loss: 112.4175 - mae: 112.4175 - val_loss: 603.0588 - val_mae: 603.0588
    Epoch 33/100
    18/18 [==============================] - 0s 6ms/step - loss: 112.6697 - mae: 112.6697 - val_loss: 645.6975 - val_mae: 645.6975
    Epoch 34/100
    18/18 [==============================] - 0s 5ms/step - loss: 111.9867 - mae: 111.9867 - val_loss: 604.7632 - val_mae: 604.7632
    Epoch 35/100
    17/18 [===========================>..] - ETA: 0s - loss: 111.1695 - mae: 111.1695INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    18/18 [==============================] - 1s 39ms/step - loss: 110.9451 - mae: 110.9451 - val_loss: 593.4648 - val_mae: 593.4648
    Epoch 36/100
    18/18 [==============================] - 0s 6ms/step - loss: 114.4816 - mae: 114.4816 - val_loss: 608.0073 - val_mae: 608.0073
    Epoch 37/100
    18/18 [==============================] - 0s 6ms/step - loss: 110.2017 - mae: 110.2017 - val_loss: 597.2309 - val_mae: 597.2309
    Epoch 38/100
    18/18 [==============================] - 0s 5ms/step - loss: 112.2372 - mae: 112.2372 - val_loss: 637.9797 - val_mae: 637.9797
    Epoch 39/100
    17/18 [===========================>..] - ETA: 0s - loss: 114.8985 - mae: 114.8985INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    18/18 [==============================] - 1s 38ms/step - loss: 115.1289 - mae: 115.1289 - val_loss: 587.4679 - val_mae: 587.4679
    Epoch 40/100
    18/18 [==============================] - 0s 6ms/step - loss: 110.0854 - mae: 110.0854 - val_loss: 592.7117 - val_mae: 592.7117
    Epoch 41/100
    18/18 [==============================] - 0s 5ms/step - loss: 110.6343 - mae: 110.6343 - val_loss: 593.8997 - val_mae: 593.8997
    Epoch 42/100
    18/18 [==============================] - 0s 5ms/step - loss: 113.5762 - mae: 113.5762 - val_loss: 636.3674 - val_mae: 636.3674
    Epoch 43/100
    18/18 [==============================] - 0s 6ms/step - loss: 116.2286 - mae: 116.2286 - val_loss: 662.9264 - val_mae: 662.9264
    Epoch 44/100
    18/18 [==============================] - 0s 6ms/step - loss: 120.0192 - mae: 120.0192 - val_loss: 635.6360 - val_mae: 635.6360
    Epoch 45/100
    18/18 [==============================] - 0s 5ms/step - loss: 110.9675 - mae: 110.9675 - val_loss: 601.9926 - val_mae: 601.9926
    Epoch 46/100
    18/18 [==============================] - 0s 6ms/step - loss: 111.6012 - mae: 111.6012 - val_loss: 593.3531 - val_mae: 593.3531
    Epoch 47/100
    18/18 [==============================] - 0s 6ms/step - loss: 109.6161 - mae: 109.6161 - val_loss: 637.0014 - val_mae: 637.0014
    Epoch 48/100
    18/18 [==============================] - 0s 5ms/step - loss: 109.1368 - mae: 109.1368 - val_loss: 598.4199 - val_mae: 598.4199
    Epoch 49/100
    17/18 [===========================>..] - ETA: 0s - loss: 112.7001 - mae: 112.7001INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    18/18 [==============================] - 1s 38ms/step - loss: 112.4355 - mae: 112.4355 - val_loss: 579.7040 - val_mae: 579.7040
    Epoch 50/100
    18/18 [==============================] - 0s 5ms/step - loss: 110.2108 - mae: 110.2108 - val_loss: 639.2326 - val_mae: 639.2326
    Epoch 51/100
    18/18 [==============================] - 0s 6ms/step - loss: 111.0958 - mae: 111.0958 - val_loss: 597.3575 - val_mae: 597.3575
    Epoch 52/100
    18/18 [==============================] - 0s 5ms/step - loss: 110.7351 - mae: 110.7351 - val_loss: 580.7227 - val_mae: 580.7227
    Epoch 53/100
    18/18 [==============================] - 0s 5ms/step - loss: 111.1785 - mae: 111.1785 - val_loss: 648.3588 - val_mae: 648.3588
    Epoch 54/100
    18/18 [==============================] - 0s 5ms/step - loss: 114.0832 - mae: 114.0832 - val_loss: 593.2007 - val_mae: 593.2007
    Epoch 55/100
    18/18 [==============================] - ETA: 0s - loss: 110.4910 - mae: 110.4910INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    18/18 [==============================] - 1s 37ms/step - loss: 110.4910 - mae: 110.4910 - val_loss: 579.5065 - val_mae: 579.5065
    Epoch 56/100
    18/18 [==============================] - 0s 6ms/step - loss: 108.0489 - mae: 108.0489 - val_loss: 807.3851 - val_mae: 807.3851
    Epoch 57/100
    18/18 [==============================] - 0s 6ms/step - loss: 125.0614 - mae: 125.0614 - val_loss: 674.1654 - val_mae: 674.1654
    Epoch 58/100
    18/18 [==============================] - 0s 5ms/step - loss: 115.4340 - mae: 115.4340 - val_loss: 582.2698 - val_mae: 582.2698
    Epoch 59/100
    18/18 [==============================] - 0s 5ms/step - loss: 110.0881 - mae: 110.0881 - val_loss: 606.7637 - val_mae: 606.7637
    Epoch 60/100
    18/18 [==============================] - 0s 6ms/step - loss: 108.7156 - mae: 108.7156 - val_loss: 602.3102 - val_mae: 602.3102
    Epoch 61/100
    16/18 [=========================>....] - ETA: 0s - loss: 109.3896 - mae: 109.3896INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    18/18 [==============================] - 1s 38ms/step - loss: 108.1525 - mae: 108.1525 - val_loss: 573.9990 - val_mae: 573.9990
    Epoch 62/100
    18/18 [==============================] - 0s 5ms/step - loss: 107.3727 - mae: 107.3727 - val_loss: 581.7012 - val_mae: 581.7012
    Epoch 63/100
    18/18 [==============================] - 0s 5ms/step - loss: 110.7667 - mae: 110.7667 - val_loss: 637.5252 - val_mae: 637.5252
    Epoch 64/100
    18/18 [==============================] - 0s 5ms/step - loss: 110.1539 - mae: 110.1539 - val_loss: 586.6601 - val_mae: 586.6601
    Epoch 65/100
    17/18 [===========================>..] - ETA: 0s - loss: 109.1682 - mae: 109.1682INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    18/18 [==============================] - 1s 39ms/step - loss: 108.2325 - mae: 108.2325 - val_loss: 573.5620 - val_mae: 573.5620
    Epoch 66/100
    16/18 [=========================>....] - ETA: 0s - loss: 109.3475 - mae: 109.3475INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    18/18 [==============================] - 1s 37ms/step - loss: 108.6825 - mae: 108.6825 - val_loss: 572.2206 - val_mae: 572.2206
    Epoch 67/100
    18/18 [==============================] - 0s 7ms/step - loss: 106.6371 - mae: 106.6371 - val_loss: 646.6349 - val_mae: 646.6349
    Epoch 68/100
    18/18 [==============================] - 0s 7ms/step - loss: 114.1603 - mae: 114.1603 - val_loss: 681.8561 - val_mae: 681.8561
    Epoch 69/100
    18/18 [==============================] - 0s 5ms/step - loss: 124.5514 - mae: 124.5514 - val_loss: 655.9885 - val_mae: 655.9885
    Epoch 70/100
    18/18 [==============================] - 0s 7ms/step - loss: 125.0235 - mae: 125.0235 - val_loss: 601.0032 - val_mae: 601.0032
    Epoch 71/100
    18/18 [==============================] - 0s 6ms/step - loss: 110.3652 - mae: 110.3652 - val_loss: 595.3962 - val_mae: 595.3962
    Epoch 72/100
    18/18 [==============================] - 0s 6ms/step - loss: 107.9285 - mae: 107.9285 - val_loss: 573.7085 - val_mae: 573.7085
    Epoch 73/100
    18/18 [==============================] - 0s 5ms/step - loss: 109.5085 - mae: 109.5085 - val_loss: 580.4180 - val_mae: 580.4180
    Epoch 74/100
    18/18 [==============================] - 0s 6ms/step - loss: 108.7380 - mae: 108.7380 - val_loss: 576.1211 - val_mae: 576.1211
    Epoch 75/100
    18/18 [==============================] - 0s 6ms/step - loss: 107.9404 - mae: 107.9404 - val_loss: 591.1477 - val_mae: 591.1477
    Epoch 76/100
    18/18 [==============================] - 0s 5ms/step - loss: 109.4232 - mae: 109.4232 - val_loss: 597.8605 - val_mae: 597.8605
    Epoch 77/100
    16/18 [=========================>....] - ETA: 0s - loss: 109.4509 - mae: 109.4509INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    18/18 [==============================] - 1s 39ms/step - loss: 107.5879 - mae: 107.5879 - val_loss: 571.9299 - val_mae: 571.9299
    Epoch 78/100
    18/18 [==============================] - 0s 6ms/step - loss: 108.1598 - mae: 108.1598 - val_loss: 575.2383 - val_mae: 575.2383
    Epoch 79/100
    18/18 [==============================] - 0s 6ms/step - loss: 107.9175 - mae: 107.9175 - val_loss: 617.3071 - val_mae: 617.3071
    Epoch 80/100
    18/18 [==============================] - 0s 6ms/step - loss: 108.9510 - mae: 108.9510 - val_loss: 583.4847 - val_mae: 583.4847
    Epoch 81/100
    14/18 [======================>.......] - ETA: 0s - loss: 105.1163 - mae: 105.1163INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    18/18 [==============================] - 1s 39ms/step - loss: 106.0505 - mae: 106.0505 - val_loss: 570.0802 - val_mae: 570.0802
    Epoch 82/100
    18/18 [==============================] - 0s 5ms/step - loss: 115.6827 - mae: 115.6827 - val_loss: 575.7382 - val_mae: 575.7382
    Epoch 83/100
    18/18 [==============================] - 0s 5ms/step - loss: 110.9379 - mae: 110.9379 - val_loss: 659.6570 - val_mae: 659.6570
    Epoch 84/100
    18/18 [==============================] - 0s 5ms/step - loss: 111.4836 - mae: 111.4836 - val_loss: 570.1959 - val_mae: 570.1959
    Epoch 85/100
    18/18 [==============================] - 0s 7ms/step - loss: 107.5948 - mae: 107.5948 - val_loss: 601.5945 - val_mae: 601.5945
    Epoch 86/100
    18/18 [==============================] - 0s 5ms/step - loss: 108.9426 - mae: 108.9426 - val_loss: 592.8107 - val_mae: 592.8107
    Epoch 87/100
    18/18 [==============================] - 0s 6ms/step - loss: 105.7717 - mae: 105.7717 - val_loss: 603.6169 - val_mae: 603.6169
    Epoch 88/100
    15/18 [========================>.....] - ETA: 0s - loss: 111.7593 - mae: 111.7593INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    18/18 [==============================] - 1s 39ms/step - loss: 107.9217 - mae: 107.9217 - val_loss: 569.0500 - val_mae: 569.0500
    Epoch 89/100
    18/18 [==============================] - ETA: 0s - loss: 106.0344 - mae: 106.0344INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    18/18 [==============================] - 1s 38ms/step - loss: 106.0344 - mae: 106.0344 - val_loss: 568.9512 - val_mae: 568.9512
    Epoch 90/100
    18/18 [==============================] - 0s 7ms/step - loss: 105.4977 - mae: 105.4977 - val_loss: 581.7681 - val_mae: 581.7681
    Epoch 91/100
    18/18 [==============================] - 0s 6ms/step - loss: 108.8468 - mae: 108.8468 - val_loss: 573.6023 - val_mae: 573.6023
    Epoch 92/100
    18/18 [==============================] - 0s 6ms/step - loss: 110.8884 - mae: 110.8884 - val_loss: 576.8247 - val_mae: 576.8247
    Epoch 93/100
    18/18 [==============================] - 0s 5ms/step - loss: 113.8781 - mae: 113.8781 - val_loss: 608.3018 - val_mae: 608.3018
    Epoch 94/100
    18/18 [==============================] - 0s 5ms/step - loss: 110.5763 - mae: 110.5763 - val_loss: 601.6047 - val_mae: 601.6047
    Epoch 95/100
    18/18 [==============================] - 0s 6ms/step - loss: 106.5906 - mae: 106.5906 - val_loss: 570.3652 - val_mae: 570.3652
    Epoch 96/100
    18/18 [==============================] - 0s 7ms/step - loss: 116.9515 - mae: 116.9515 - val_loss: 615.2581 - val_mae: 615.2581
    Epoch 97/100
    18/18 [==============================] - 0s 6ms/step - loss: 108.0739 - mae: 108.0739 - val_loss: 580.3073 - val_mae: 580.3073
    Epoch 98/100
    18/18 [==============================] - 0s 7ms/step - loss: 108.7102 - mae: 108.7102 - val_loss: 586.6512 - val_mae: 586.6512
    Epoch 99/100
    18/18 [==============================] - 0s 5ms/step - loss: 109.0488 - mae: 109.0488 - val_loss: 570.0629 - val_mae: 570.0629
    Epoch 100/100
    18/18 [==============================] - 0s 6ms/step - loss: 106.1845 - mae: 106.1845 - val_loss: 585.9763 - val_mae: 585.9763
    (keras.callbacks.History at 0x7f12f711f450)
</pre>
</div>

<p><a name=""></a></p>
<h3 id="evaluate-model_1">Evaluate Model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-27-1">1</a></span>
<span class="normal"><a href="#__codelineno-27-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="c1"># Evaluate model on test data</span>
<a id="__codelineno-27-2" name="__codelineno-27-2"></a><span class="n">model_1</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">test_windows</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    18/18 [==============================] - 0s 3ms/step - loss: 585.9762 - mae: 585.9762
    [585.9761962890625, 585.9761962890625]
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-28-1">1</a></span>
<span class="normal"><a href="#__codelineno-28-2">2</a></span>
<span class="normal"><a href="#__codelineno-28-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="c1"># Load in saved best performing model_1 and evaluate on test data</span>
<a id="__codelineno-28-2" name="__codelineno-28-2"></a><span class="n">model_1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="s2">&quot;model_experiments/model_1_dense&quot;</span><span class="p">)</span>
<a id="__codelineno-28-3" name="__codelineno-28-3"></a><span class="n">model_1</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">test_windows</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    18/18 [==============================] - 0s 3ms/step - loss: 568.9512 - mae: 568.9512
    [568.951171875, 568.951171875]
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-29-1">1</a></span>
<span class="normal"><a href="#__codelineno-29-2">2</a></span>
<span class="normal"><a href="#__codelineno-29-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="c1"># Make predictions using model_1 on the test dataset and view the results</span>
<a id="__codelineno-29-2" name="__codelineno-29-2"></a><span class="n">model_1_preds</span> <span class="o">=</span> <span class="n">make_preds</span><span class="p">(</span><span class="n">model_1</span><span class="p">,</span> <span class="n">test_windows</span><span class="p">)</span>
<a id="__codelineno-29-3" name="__codelineno-29-3"></a><span class="nb">len</span><span class="p">(</span><span class="n">model_1_preds</span><span class="p">),</span> <span class="n">model_1_preds</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (556, (tf.Tensor: shape=(10,), dtype=float32, numpy=
     array([8861.711, 8769.886, 9015.71 , 8795.517, 8723.809, 8730.11 ,
            8691.95 , 8502.054, 8460.961, 8516.547], dtype=float32)))
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-30-1">1</a></span>
<span class="normal"><a href="#__codelineno-30-2">2</a></span>
<span class="normal"><a href="#__codelineno-30-3">3</a></span>
<span class="normal"><a href="#__codelineno-30-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1"></a><span class="c1"># Evaluate preds</span>
<a id="__codelineno-30-2" name="__codelineno-30-2"></a><span class="n">model_1_results</span> <span class="o">=</span> <span class="n">evaluate_preds</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">test_labels</span><span class="p">),</span> <span class="c1"># reduce to right shape</span>
<a id="__codelineno-30-3" name="__codelineno-30-3"></a>                                 <span class="n">y_pred</span><span class="o">=</span><span class="n">model_1_preds</span><span class="p">)</span>
<a id="__codelineno-30-4" name="__codelineno-30-4"></a><span class="n">model_1_results</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    {'mae': 568.95123,
     'mape': 2.5448983,
     'mase': 0.9994897,
     'mse': 1171744.0,
     'rmse': 1082.4713}
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-31-1">1</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1"></a><span class="n">naive_results</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    {'mae': 567.9802,
     'mape': 2.516525,
     'mase': 0.99957,
     'mse': 1147547.0,
     'rmse': 1071.2362}
</pre>
</div>

<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-32-1">1</a></span>
<span class="normal"><a href="#__codelineno-32-2">2</a></span>
<span class="normal"><a href="#__codelineno-32-3">3</a></span>
<span class="normal"><a href="#__codelineno-32-4">4</a></span>
<span class="normal"><a href="#__codelineno-32-5">5</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1"></a><span class="n">offset</span> <span class="o">=</span> <span class="mi">300</span>
<a id="__codelineno-32-2" name="__codelineno-32-2"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<a id="__codelineno-32-3" name="__codelineno-32-3"></a><span class="c1"># Account for the test_window offset and index into test_labels to ensure correct plotting</span>
<a id="__codelineno-32-4" name="__codelineno-32-4"></a><span class="n">plot_time_series</span><span class="p">(</span><span class="n">timesteps</span><span class="o">=</span><span class="n">X_test</span><span class="p">[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">test_windows</span><span class="p">):],</span> <span class="n">values</span><span class="o">=</span><span class="n">test_labels</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">start</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test_data&quot;</span><span class="p">)</span>
<a id="__codelineno-32-5" name="__codelineno-32-5"></a><span class="n">plot_time_series</span><span class="p">(</span><span class="n">timesteps</span><span class="o">=</span><span class="n">X_test</span><span class="p">[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">test_windows</span><span class="p">):],</span> <span class="n">values</span><span class="o">=</span><span class="n">model_1_preds</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;model_1_preds&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<img alt="bitcoin-7" src="../../../images/bitcoin-7.png" /></p>
<p><a name="model-2"></a></p>
<h2 id="model-2-dense-window30-horizon1"><strong>Model 2: Dense (window=30, horizon=1)</strong></h2>
<p><a name=""></a></p>
<h3 id="prepare-data_1">Prepare Data</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-33-1">1</a></span>
<span class="normal"><a href="#__codelineno-33-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="n">HORIZON</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># predict one step at a time</span>
<a id="__codelineno-33-2" name="__codelineno-33-2"></a><span class="n">WINDOW_SIZE</span> <span class="o">=</span> <span class="mi">30</span> <span class="c1"># use 30 timesteps in the past</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-34-1">1</a></span>
<span class="normal"><a href="#__codelineno-34-2">2</a></span>
<span class="normal"><a href="#__codelineno-34-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1"></a><span class="c1"># Make windowed data with appropriate horizon and window sizes</span>
<a id="__codelineno-34-2" name="__codelineno-34-2"></a><span class="n">full_windows</span><span class="p">,</span> <span class="n">full_labels</span> <span class="o">=</span> <span class="n">make_windows</span><span class="p">(</span><span class="n">prices</span><span class="p">,</span> <span class="n">window_size</span><span class="o">=</span><span class="n">WINDOW_SIZE</span><span class="p">,</span> <span class="n">horizon</span><span class="o">=</span><span class="n">HORIZON</span><span class="p">)</span>
<a id="__codelineno-34-3" name="__codelineno-34-3"></a><span class="nb">len</span><span class="p">(</span><span class="n">full_windows</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">full_labels</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (2757, 2757)
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-35-1">1</a></span>
<span class="normal"><a href="#__codelineno-35-2">2</a></span>
<span class="normal"><a href="#__codelineno-35-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1"></a><span class="c1"># Make train and testing windows</span>
<a id="__codelineno-35-2" name="__codelineno-35-2"></a><span class="n">train_windows</span><span class="p">,</span> <span class="n">test_windows</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">test_labels</span> <span class="o">=</span> <span class="n">make_train_test_splits</span><span class="p">(</span><span class="n">windows</span><span class="o">=</span><span class="n">full_windows</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">full_labels</span><span class="p">)</span>
<a id="__codelineno-35-3" name="__codelineno-35-3"></a><span class="nb">len</span><span class="p">(</span><span class="n">train_windows</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_windows</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_labels</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_labels</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (2205, 552, 2205, 552)
</pre>
</div>

<p><a name=""></a></p>
<h3 id="create-compile-and-fit-model_2">Create, Compile, and Fit Model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-36-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-36-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-36-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-36-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-36-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-36-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-36-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-36-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-36-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-36-10">10</a></span>
<span class="normal"><a href="#__codelineno-36-11">11</a></span>
<span class="normal"><a href="#__codelineno-36-12">12</a></span>
<span class="normal"><a href="#__codelineno-36-13">13</a></span>
<span class="normal"><a href="#__codelineno-36-14">14</a></span>
<span class="normal"><a href="#__codelineno-36-15">15</a></span>
<span class="normal"><a href="#__codelineno-36-16">16</a></span>
<span class="normal"><a href="#__codelineno-36-17">17</a></span>
<span class="normal"><a href="#__codelineno-36-18">18</a></span>
<span class="normal"><a href="#__codelineno-36-19">19</a></span>
<span class="normal"><a href="#__codelineno-36-20">20</a></span>
<span class="normal"><a href="#__codelineno-36-21">21</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1"></a><span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">set_seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<a id="__codelineno-36-2" name="__codelineno-36-2"></a>
<a id="__codelineno-36-3" name="__codelineno-36-3"></a><span class="c1"># CREATE MODEL (same model as model 1 but data input will be different)</span>
<a id="__codelineno-36-4" name="__codelineno-36-4"></a><span class="n">model_2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
<a id="__codelineno-36-5" name="__codelineno-36-5"></a>  <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;relu&quot;</span><span class="p">),</span>
<a id="__codelineno-36-6" name="__codelineno-36-6"></a>  <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">HORIZON</span><span class="p">)</span> <span class="c1"># need to predict horizon number of steps into the future</span>
<a id="__codelineno-36-7" name="__codelineno-36-7"></a><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;model_2_dense&quot;</span><span class="p">)</span>
<a id="__codelineno-36-8" name="__codelineno-36-8"></a>
<a id="__codelineno-36-9" name="__codelineno-36-9"></a>
<a id="__codelineno-36-10" name="__codelineno-36-10"></a><span class="c1"># COMPILE MODEL</span>
<a id="__codelineno-36-11" name="__codelineno-36-11"></a><span class="n">model_2</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s2">&quot;mae&quot;</span><span class="p">,</span>
<a id="__codelineno-36-12" name="__codelineno-36-12"></a>                <span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">())</span>
<a id="__codelineno-36-13" name="__codelineno-36-13"></a>
<a id="__codelineno-36-14" name="__codelineno-36-14"></a><span class="c1"># FIT MODEL</span>
<a id="__codelineno-36-15" name="__codelineno-36-15"></a><span class="n">model_2</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_windows</span><span class="p">,</span>
<a id="__codelineno-36-16" name="__codelineno-36-16"></a>            <span class="n">train_labels</span><span class="p">,</span>
<a id="__codelineno-36-17" name="__codelineno-36-17"></a>            <span class="n">epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-36-18" name="__codelineno-36-18"></a>            <span class="n">batch_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
<a id="__codelineno-36-19" name="__codelineno-36-19"></a>            <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-36-20" name="__codelineno-36-20"></a>            <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">test_windows</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">),</span>
<a id="__codelineno-36-21" name="__codelineno-36-21"></a>            <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">create_model_checkpoint</span><span class="p">(</span><span class="n">model_name</span><span class="o">=</span><span class="n">model_2</span><span class="o">.</span><span class="n">name</span><span class="p">)])</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_dense/assets
    (keras.callbacks.History at 0x7f12f5c90550)
</pre>
</div>

<p><a name=""></a></p>
<h3 id="evaluate-model_2">Evaluate Model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-37-1">1</a></span>
<span class="normal"><a href="#__codelineno-37-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1"></a><span class="c1"># Evaluate model 2 preds</span>
<a id="__codelineno-37-2" name="__codelineno-37-2"></a><span class="n">model_2</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">test_windows</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    18/18 [==============================] - 0s 2ms/step - loss: 608.9615
    608.9614868164062
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-38-1">1</a></span>
<span class="normal"><a href="#__codelineno-38-2">2</a></span>
<span class="normal"><a href="#__codelineno-38-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1"></a><span class="c1"># Load in best performing model</span>
<a id="__codelineno-38-2" name="__codelineno-38-2"></a><span class="n">model_2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="s2">&quot;model_experiments/model_2_dense/&quot;</span><span class="p">)</span>
<a id="__codelineno-38-3" name="__codelineno-38-3"></a><span class="n">model_2</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">test_windows</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    18/18 [==============================] - 0s 2ms/step - loss: 608.9615
    608.9614868164062
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-39-1">1</a></span>
<span class="normal"><a href="#__codelineno-39-2">2</a></span>
<span class="normal"><a href="#__codelineno-39-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1"></a><span class="c1"># Get forecast predictions</span>
<a id="__codelineno-39-2" name="__codelineno-39-2"></a><span class="n">model_2_preds</span> <span class="o">=</span> <span class="n">make_preds</span><span class="p">(</span><span class="n">model_2</span><span class="p">,</span>
<a id="__codelineno-39-3" name="__codelineno-39-3"></a>                           <span class="n">input_data</span><span class="o">=</span><span class="n">test_windows</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-40-1">1</a></span>
<span class="normal"><a href="#__codelineno-40-2">2</a></span>
<span class="normal"><a href="#__codelineno-40-3">3</a></span>
<span class="normal"><a href="#__codelineno-40-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1"></a><span class="c1"># Evaluate results for model 2 predictions</span>
<a id="__codelineno-40-2" name="__codelineno-40-2"></a><span class="n">model_2_results</span> <span class="o">=</span> <span class="n">evaluate_preds</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">test_labels</span><span class="p">),</span> <span class="c1"># remove 1 dimension of test labels</span>
<a id="__codelineno-40-3" name="__codelineno-40-3"></a>                                 <span class="n">y_pred</span><span class="o">=</span><span class="n">model_2_preds</span><span class="p">)</span>
<a id="__codelineno-40-4" name="__codelineno-40-4"></a><span class="n">model_2_results</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    {'mae': 608.9615,
     'mape': 2.7693388,
     'mase': 1.0644706,
     'mse': 1281438.9,
     'rmse': 1132.0066}
</pre>
</div>

<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-41-1">1</a></span>
<span class="normal"><a href="#__codelineno-41-2">2</a></span>
<span class="normal"><a href="#__codelineno-41-3">3</a></span>
<span class="normal"><a href="#__codelineno-41-4">4</a></span>
<span class="normal"><a href="#__codelineno-41-5">5</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1"></a><span class="n">offset</span> <span class="o">=</span> <span class="mi">300</span>
<a id="__codelineno-41-2" name="__codelineno-41-2"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<a id="__codelineno-41-3" name="__codelineno-41-3"></a><span class="c1"># Account for the test_window offset</span>
<a id="__codelineno-41-4" name="__codelineno-41-4"></a><span class="n">plot_time_series</span><span class="p">(</span><span class="n">timesteps</span><span class="o">=</span><span class="n">X_test</span><span class="p">[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">test_windows</span><span class="p">):],</span> <span class="n">values</span><span class="o">=</span><span class="n">test_labels</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">start</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;test_data&quot;</span><span class="p">)</span>
<a id="__codelineno-41-5" name="__codelineno-41-5"></a><span class="n">plot_time_series</span><span class="p">(</span><span class="n">timesteps</span><span class="o">=</span><span class="n">X_test</span><span class="p">[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">test_windows</span><span class="p">):],</span> <span class="n">values</span><span class="o">=</span><span class="n">model_2_preds</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;model_2_preds&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<img alt="bitcoin-8" src="../../../images/bitcoin-8.png" /></p>
<p><a name="model-3"></a></p>
<h2 id="model-3-dense-window30-horizon7"><strong>Model 3: Dense (window=30, horizon=7)</strong></h2>
<p><a name=""></a></p>
<h3 id="prepare-data_2">Prepare Data</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-42-1">1</a></span>
<span class="normal"><a href="#__codelineno-42-2">2</a></span>
<span class="normal"><a href="#__codelineno-42-3">3</a></span>
<span class="normal"><a href="#__codelineno-42-4">4</a></span>
<span class="normal"><a href="#__codelineno-42-5">5</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1"></a><span class="n">HORIZON</span> <span class="o">=</span> <span class="mi">7</span>
<a id="__codelineno-42-2" name="__codelineno-42-2"></a><span class="n">WINDOW_SIZE</span> <span class="o">=</span> <span class="mi">30</span>
<a id="__codelineno-42-3" name="__codelineno-42-3"></a>
<a id="__codelineno-42-4" name="__codelineno-42-4"></a><span class="n">full_windows</span><span class="p">,</span> <span class="n">full_labels</span> <span class="o">=</span> <span class="n">make_windows</span><span class="p">(</span><span class="n">prices</span><span class="p">,</span> <span class="n">window_size</span><span class="o">=</span><span class="n">WINDOW_SIZE</span><span class="p">,</span> <span class="n">horizon</span><span class="o">=</span><span class="n">HORIZON</span><span class="p">)</span>
<a id="__codelineno-42-5" name="__codelineno-42-5"></a><span class="nb">len</span><span class="p">(</span><span class="n">full_windows</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">full_labels</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (2751, 2751)
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-43-1">1</a></span>
<span class="normal"><a href="#__codelineno-43-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1"></a><span class="n">train_windows</span><span class="p">,</span> <span class="n">test_windows</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">test_labels</span> <span class="o">=</span> <span class="n">make_train_test_splits</span><span class="p">(</span><span class="n">windows</span><span class="o">=</span><span class="n">full_windows</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">full_labels</span><span class="p">,</span> <span class="n">test_split</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<a id="__codelineno-43-2" name="__codelineno-43-2"></a><span class="nb">len</span><span class="p">(</span><span class="n">train_windows</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_windows</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_labels</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_labels</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (2200, 551, 2200, 551)
</pre>
</div>

<p><a name=""></a></p>
<h3 id="create-compile-and-fit-model_3">Create, Compile, and Fit Model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-44-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-44-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-44-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-44-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-44-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-44-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-44-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-44-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-44-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-44-10">10</a></span>
<span class="normal"><a href="#__codelineno-44-11">11</a></span>
<span class="normal"><a href="#__codelineno-44-12">12</a></span>
<span class="normal"><a href="#__codelineno-44-13">13</a></span>
<span class="normal"><a href="#__codelineno-44-14">14</a></span>
<span class="normal"><a href="#__codelineno-44-15">15</a></span>
<span class="normal"><a href="#__codelineno-44-16">16</a></span>
<span class="normal"><a href="#__codelineno-44-17">17</a></span>
<span class="normal"><a href="#__codelineno-44-18">18</a></span>
<span class="normal"><a href="#__codelineno-44-19">19</a></span>
<span class="normal"><a href="#__codelineno-44-20">20</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1"></a><span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">set_seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<a id="__codelineno-44-2" name="__codelineno-44-2"></a>
<a id="__codelineno-44-3" name="__codelineno-44-3"></a><span class="c1"># CREATE MODEL (same as model_1 except with different data input size)</span>
<a id="__codelineno-44-4" name="__codelineno-44-4"></a><span class="n">model_3</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
<a id="__codelineno-44-5" name="__codelineno-44-5"></a>  <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;relu&quot;</span><span class="p">),</span>
<a id="__codelineno-44-6" name="__codelineno-44-6"></a>  <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">HORIZON</span><span class="p">)</span>
<a id="__codelineno-44-7" name="__codelineno-44-7"></a><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;model_3_dense&quot;</span><span class="p">)</span>
<a id="__codelineno-44-8" name="__codelineno-44-8"></a>
<a id="__codelineno-44-9" name="__codelineno-44-9"></a><span class="c1"># COMPILE MODEL</span>
<a id="__codelineno-44-10" name="__codelineno-44-10"></a><span class="n">model_3</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s2">&quot;mae&quot;</span><span class="p">,</span>
<a id="__codelineno-44-11" name="__codelineno-44-11"></a>                <span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">())</span>
<a id="__codelineno-44-12" name="__codelineno-44-12"></a>
<a id="__codelineno-44-13" name="__codelineno-44-13"></a><span class="c1"># FIT MODEL</span>
<a id="__codelineno-44-14" name="__codelineno-44-14"></a><span class="n">model_3</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_windows</span><span class="p">,</span>
<a id="__codelineno-44-15" name="__codelineno-44-15"></a>            <span class="n">train_labels</span><span class="p">,</span>
<a id="__codelineno-44-16" name="__codelineno-44-16"></a>            <span class="n">batch_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
<a id="__codelineno-44-17" name="__codelineno-44-17"></a>            <span class="n">epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-44-18" name="__codelineno-44-18"></a>            <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-44-19" name="__codelineno-44-19"></a>            <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">test_windows</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">),</span>
<a id="__codelineno-44-20" name="__codelineno-44-20"></a>            <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">create_model_checkpoint</span><span class="p">(</span><span class="n">model_name</span><span class="o">=</span><span class="n">model_3</span><span class="o">.</span><span class="n">name</span><span class="p">)])</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    INFO:tensorflow:Assets written to: model_experiments/model_3_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_3_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_3_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_3_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_3_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_3_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_3_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_3_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_3_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_3_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_3_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_3_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_3_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_3_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_3_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_3_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_3_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_3_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_3_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_3_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_3_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_3_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_3_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_3_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_3_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_3_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_3_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_3_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_3_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_3_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_3_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_3_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_3_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_3_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_3_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_3_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_3_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_3_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_3_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_3_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_3_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_3_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_3_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_3_dense/assets
    (keras.callbacks.History at 0x7f12f6f93610)
</pre>
</div>

<p><a name=""></a></p>
<h3 id="evaluate-model_3">Evaluate Model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-45-1">1</a></span>
<span class="normal"><a href="#__codelineno-45-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1"></a><span class="c1"># How did our model with a larger window size and horizon go?</span>
<a id="__codelineno-45-2" name="__codelineno-45-2"></a><span class="n">model_3</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">test_windows</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    18/18 [==============================] - 0s 2ms/step - loss: 1321.5204
    1321.5203857421875
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-46-1">1</a></span>
<span class="normal"><a href="#__codelineno-46-2">2</a></span>
<span class="normal"><a href="#__codelineno-46-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1"></a><span class="c1"># Load in best version of model_3 and evaluate</span>
<a id="__codelineno-46-2" name="__codelineno-46-2"></a><span class="n">model_3</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="s2">&quot;model_experiments/model_3_dense/&quot;</span><span class="p">)</span>
<a id="__codelineno-46-3" name="__codelineno-46-3"></a><span class="n">model_3</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">test_windows</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    18/18 [==============================] - 0s 3ms/step - loss: 1237.5065
    1237.5064697265625
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-47-1">1</a></span>
<span class="normal"><a href="#__codelineno-47-2">2</a></span>
<span class="normal"><a href="#__codelineno-47-3">3</a></span>
<span class="normal"><a href="#__codelineno-47-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1"></a><span class="c1"># The predictions are going to be 7 steps at a time (this is the HORIZON size)</span>
<a id="__codelineno-47-2" name="__codelineno-47-2"></a><span class="n">model_3_preds</span> <span class="o">=</span> <span class="n">make_preds</span><span class="p">(</span><span class="n">model_3</span><span class="p">,</span>
<a id="__codelineno-47-3" name="__codelineno-47-3"></a>                           <span class="n">input_data</span><span class="o">=</span><span class="n">test_windows</span><span class="p">)</span>
<a id="__codelineno-47-4" name="__codelineno-47-4"></a><span class="n">model_3_preds</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (tf.Tensor: shape=(5, 7), dtype=float32, numpy=
    array([[9004.693 , 9048.1   , 9425.088 , 9258.258 , 9495.798 , 9558.451 ,
            9357.354 ],
           [8735.507 , 8840.304 , 9247.793 , 8885.6   , 9097.188 , 9174.329 ,
            9156.819 ],
           [8672.508 , 8782.388 , 9123.8545, 8770.37  , 9007.13  , 9003.87  ,
            9042.724 ],
           [8874.398 , 8784.737 , 9043.901 , 8943.051 , 9033.478 , 9176.488 ,
            9039.676 ],
           [8825.891 , 8777.4375, 8926.779 , 8870.178 , 9213.232 , 9268.156 ,
            8942.485 ]], dtype=float32))
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-48-1">1</a></span>
<span class="normal"><a href="#__codelineno-48-2">2</a></span>
<span class="normal"><a href="#__codelineno-48-3">3</a></span>
<span class="normal"><a href="#__codelineno-48-4">4</a></span>
<span class="normal"><a href="#__codelineno-48-5">5</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1"></a><span class="c1"># Calculate model_3 results - these are going to be multi-dimensional because</span>
<a id="__codelineno-48-2" name="__codelineno-48-2"></a><span class="c1"># we&#39;re trying to predict more than one step at a time.</span>
<a id="__codelineno-48-3" name="__codelineno-48-3"></a><span class="n">model_3_results</span> <span class="o">=</span> <span class="n">evaluate_preds</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">test_labels</span><span class="p">),</span>
<a id="__codelineno-48-4" name="__codelineno-48-4"></a>                                 <span class="n">y_pred</span><span class="o">=</span><span class="n">model_3_preds</span><span class="p">)</span>
<a id="__codelineno-48-5" name="__codelineno-48-5"></a><span class="n">model_3_results</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    {'mae': 1237.5063,
     'mape': 5.5588784,
     'mase': 2.2020736,
     'mse': 5405198.5,
     'rmse': 1425.7477}
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-49-1">1</a></span>
<span class="normal"><a href="#__codelineno-49-2">2</a></span>
<span class="normal"><a href="#__codelineno-49-3">3</a></span>
<span class="normal"><a href="#__codelineno-49-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1"></a><span class="c1"># Get model_3 results aggregated to single values</span>
<a id="__codelineno-49-2" name="__codelineno-49-2"></a><span class="n">model_3_results</span> <span class="o">=</span> <span class="n">evaluate_preds</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">test_labels</span><span class="p">),</span>
<a id="__codelineno-49-3" name="__codelineno-49-3"></a>                                 <span class="n">y_pred</span><span class="o">=</span><span class="n">model_3_preds</span><span class="p">)</span>
<a id="__codelineno-49-4" name="__codelineno-49-4"></a><span class="n">model_3_results</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    {'mae': 1237.5063,
     'mape': 5.5588784,
     'mase': 2.2020736,
     'mse': 5405198.5,
     'rmse': 1425.7477}
</pre>
</div>

<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-50-1">1</a></span>
<span class="normal"><a href="#__codelineno-50-2">2</a></span>
<span class="normal"><a href="#__codelineno-50-3">3</a></span>
<span class="normal"><a href="#__codelineno-50-4">4</a></span>
<span class="normal"><a href="#__codelineno-50-5">5</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1"></a><span class="n">offset</span> <span class="o">=</span> <span class="mi">300</span>
<a id="__codelineno-50-2" name="__codelineno-50-2"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<a id="__codelineno-50-3" name="__codelineno-50-3"></a><span class="n">plot_time_series</span><span class="p">(</span><span class="n">timesteps</span><span class="o">=</span><span class="n">X_test</span><span class="p">[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">test_windows</span><span class="p">):],</span> <span class="n">values</span><span class="o">=</span><span class="n">test_labels</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">start</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test_data&quot;</span><span class="p">)</span>
<a id="__codelineno-50-4" name="__codelineno-50-4"></a><span class="c1"># Checking the shape of model_3_preds results in [n_test_samples, HORIZON] (this will screw up the plot)</span>
<a id="__codelineno-50-5" name="__codelineno-50-5"></a><span class="n">plot_time_series</span><span class="p">(</span><span class="n">timesteps</span><span class="o">=</span><span class="n">X_test</span><span class="p">[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">test_windows</span><span class="p">):],</span> <span class="n">values</span><span class="o">=</span><span class="n">model_3_preds</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;model_3_preds&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<img alt="bitcoin-9" src="../../../images/bitcoin-9.png" /></p>
<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-51-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-51-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-51-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-51-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-51-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-51-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-51-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-51-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-51-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-51-10">10</a></span>
<span class="normal"><a href="#__codelineno-51-11">11</a></span>
<span class="normal"><a href="#__codelineno-51-12">12</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1"></a><span class="n">offset</span> <span class="o">=</span> <span class="mi">300</span>
<a id="__codelineno-51-2" name="__codelineno-51-2"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<a id="__codelineno-51-3" name="__codelineno-51-3"></a><span class="c1"># Plot model_3_preds by aggregating them (note: this condenses information so the preds will look fruther ahead than the test data)</span>
<a id="__codelineno-51-4" name="__codelineno-51-4"></a><span class="n">plot_time_series</span><span class="p">(</span><span class="n">timesteps</span><span class="o">=</span><span class="n">X_test</span><span class="p">[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">test_windows</span><span class="p">):],</span> 
<a id="__codelineno-51-5" name="__codelineno-51-5"></a>                 <span class="n">values</span><span class="o">=</span><span class="n">test_labels</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> 
<a id="__codelineno-51-6" name="__codelineno-51-6"></a>                 <span class="n">start</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span> 
<a id="__codelineno-51-7" name="__codelineno-51-7"></a>                 <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test_data&quot;</span><span class="p">)</span>
<a id="__codelineno-51-8" name="__codelineno-51-8"></a><span class="n">plot_time_series</span><span class="p">(</span><span class="n">timesteps</span><span class="o">=</span><span class="n">X_test</span><span class="p">[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">test_windows</span><span class="p">):],</span> 
<a id="__codelineno-51-9" name="__codelineno-51-9"></a>                 <span class="n">values</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">model_3_preds</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> 
<a id="__codelineno-51-10" name="__codelineno-51-10"></a>                 <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
<a id="__codelineno-51-11" name="__codelineno-51-11"></a>                 <span class="n">start</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span> 
<a id="__codelineno-51-12" name="__codelineno-51-12"></a>                 <span class="n">label</span><span class="o">=</span><span class="s2">&quot;model_3_preds&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<img alt="bitcoin-10" src="../../../images/bitcoin-10.png" /></p>
<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-52-1">1</a></span>
<span class="normal"><a href="#__codelineno-52-2">2</a></span>
<span class="normal"><a href="#__codelineno-52-3">3</a></span>
<span class="normal"><a href="#__codelineno-52-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1"></a><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;naive&quot;</span><span class="p">:</span> <span class="n">naive_results</span><span class="p">[</span><span class="s2">&quot;mae&quot;</span><span class="p">],</span> 
<a id="__codelineno-52-2" name="__codelineno-52-2"></a>              <span class="s2">&quot;horizon_1_window_7&quot;</span><span class="p">:</span> <span class="n">model_1_results</span><span class="p">[</span><span class="s2">&quot;mae&quot;</span><span class="p">],</span> 
<a id="__codelineno-52-3" name="__codelineno-52-3"></a>              <span class="s2">&quot;horizon_1_window_30&quot;</span><span class="p">:</span> <span class="n">model_2_results</span><span class="p">[</span><span class="s2">&quot;mae&quot;</span><span class="p">],</span> 
<a id="__codelineno-52-4" name="__codelineno-52-4"></a>              <span class="s2">&quot;horizon_7_window_30&quot;</span><span class="p">:</span> <span class="n">model_3_results</span><span class="p">[</span><span class="s2">&quot;mae&quot;</span><span class="p">]},</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mae&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">);</span>
</code></pre></div>
</td></tr></table>
<img alt="bitcoin-11" src="../../../images/bitcoin-11.png" /></p>
<p><a name="model-4"></a></p>
<h2 id="model-4-conv1d"><strong>Model 4: Conv1D</strong></h2>
<p><a name=""></a></p>
<h3 id="prepare-data_3">Prepare Data</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-53-1">1</a></span>
<span class="normal"><a href="#__codelineno-53-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1"></a><span class="n">HORIZON</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># predict next day</span>
<a id="__codelineno-53-2" name="__codelineno-53-2"></a><span class="n">WINDOW_SIZE</span> <span class="o">=</span> <span class="mi">7</span> <span class="c1"># use previous week worth of data</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-54-1">1</a></span>
<span class="normal"><a href="#__codelineno-54-2">2</a></span>
<span class="normal"><a href="#__codelineno-54-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1"></a><span class="c1"># Create windowed dataset</span>
<a id="__codelineno-54-2" name="__codelineno-54-2"></a><span class="n">full_windows</span><span class="p">,</span> <span class="n">full_labels</span> <span class="o">=</span> <span class="n">make_windows</span><span class="p">(</span><span class="n">prices</span><span class="p">,</span> <span class="n">window_size</span><span class="o">=</span><span class="n">WINDOW_SIZE</span><span class="p">,</span> <span class="n">horizon</span><span class="o">=</span><span class="n">HORIZON</span><span class="p">)</span>
<a id="__codelineno-54-3" name="__codelineno-54-3"></a><span class="nb">len</span><span class="p">(</span><span class="n">full_windows</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">full_labels</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (2780, 2780)
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-55-1">1</a></span>
<span class="normal"><a href="#__codelineno-55-2">2</a></span>
<span class="normal"><a href="#__codelineno-55-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1"></a><span class="c1"># Create train/test splits</span>
<a id="__codelineno-55-2" name="__codelineno-55-2"></a><span class="n">train_windows</span><span class="p">,</span> <span class="n">test_windows</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">test_labels</span> <span class="o">=</span> <span class="n">make_train_test_splits</span><span class="p">(</span><span class="n">full_windows</span><span class="p">,</span> <span class="n">full_labels</span><span class="p">)</span>
<a id="__codelineno-55-3" name="__codelineno-55-3"></a><span class="nb">len</span><span class="p">(</span><span class="n">train_windows</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_windows</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_labels</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_labels</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (2224, 556, 2224, 556)
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-56-1">1</a></span>
<span class="normal"><a href="#__codelineno-56-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1"></a><span class="c1"># Check data sample shapes</span>
<a id="__codelineno-56-2" name="__codelineno-56-2"></a><span class="n">train_windows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="c1"># returns (WINDOW_SIZE, )</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (7,)
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-57-1">1</a></span>
<span class="normal"><a href="#__codelineno-57-2">2</a></span>
<span class="normal"><a href="#__codelineno-57-3">3</a></span>
<span class="normal"><a href="#__codelineno-57-4">4</a></span>
<span class="normal"><a href="#__codelineno-57-5">5</a></span>
<span class="normal"><a href="#__codelineno-57-6">6</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1"></a><span class="c1"># Before we pass our data to the Conv1D layer, we have to reshape it in order to make sure it works</span>
<a id="__codelineno-57-2" name="__codelineno-57-2"></a><span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">train_windows</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-57-3" name="__codelineno-57-3"></a><span class="n">expand_dims_layer</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Lambda</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span> <span class="c1"># add an extra dimension for timesteps</span>
<a id="__codelineno-57-4" name="__codelineno-57-4"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Original shape: </span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># (WINDOW_SIZE)</span>
<a id="__codelineno-57-5" name="__codelineno-57-5"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expanded shape: </span><span class="si">{</span><span class="n">expand_dims_layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># (WINDOW_SIZE, input_dim) </span>
<a id="__codelineno-57-6" name="__codelineno-57-6"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Original values with expanded shape:</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">expand_dims_layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Original shape: (7,)
    Expanded shape: (7, 1)
    Original values with expanded shape:
     [[123.65499]
     [125.455  ]
     [108.58483]
     [118.67466]
     [121.33866]
     [120.65533]
     [121.795  ]]
</pre>
</div>

<p><a name=""></a></p>
<h3 id="create-compile-and-fit-model_4">Create, Compile, and Fit Model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-58-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-58-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-58-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-58-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-58-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-58-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-58-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-58-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-58-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-58-10">10</a></span>
<span class="normal"><a href="#__codelineno-58-11">11</a></span>
<span class="normal"><a href="#__codelineno-58-12">12</a></span>
<span class="normal"><a href="#__codelineno-58-13">13</a></span>
<span class="normal"><a href="#__codelineno-58-14">14</a></span>
<span class="normal"><a href="#__codelineno-58-15">15</a></span>
<span class="normal"><a href="#__codelineno-58-16">16</a></span>
<span class="normal"><a href="#__codelineno-58-17">17</a></span>
<span class="normal"><a href="#__codelineno-58-18">18</a></span>
<span class="normal"><a href="#__codelineno-58-19">19</a></span>
<span class="normal"><a href="#__codelineno-58-20">20</a></span>
<span class="normal"><a href="#__codelineno-58-21">21</a></span>
<span class="normal"><a href="#__codelineno-58-22">22</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1"></a><span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">set_seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<a id="__codelineno-58-2" name="__codelineno-58-2"></a>
<a id="__codelineno-58-3" name="__codelineno-58-3"></a><span class="c1"># CREATE MODEL</span>
<a id="__codelineno-58-4" name="__codelineno-58-4"></a><span class="n">model_4</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
<a id="__codelineno-58-5" name="__codelineno-58-5"></a>  <span class="c1"># Create Lambda layer to reshape inputs, without this layer, the model will error</span>
<a id="__codelineno-58-6" name="__codelineno-58-6"></a>  <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Lambda</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)),</span> <span class="c1"># resize the inputs to adjust for window size / Conv1D 3D input requirements</span>
<a id="__codelineno-58-7" name="__codelineno-58-7"></a>  <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Conv1D</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s2">&quot;causal&quot;</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;relu&quot;</span><span class="p">),</span>
<a id="__codelineno-58-8" name="__codelineno-58-8"></a>  <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">HORIZON</span><span class="p">)</span>
<a id="__codelineno-58-9" name="__codelineno-58-9"></a><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;model_4_conv1D&quot;</span><span class="p">)</span>
<a id="__codelineno-58-10" name="__codelineno-58-10"></a>
<a id="__codelineno-58-11" name="__codelineno-58-11"></a><span class="c1"># COMPILE MODEL</span>
<a id="__codelineno-58-12" name="__codelineno-58-12"></a><span class="n">model_4</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s2">&quot;mae&quot;</span><span class="p">,</span>
<a id="__codelineno-58-13" name="__codelineno-58-13"></a>                <span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">())</span>
<a id="__codelineno-58-14" name="__codelineno-58-14"></a>
<a id="__codelineno-58-15" name="__codelineno-58-15"></a><span class="c1"># FIT MODEL</span>
<a id="__codelineno-58-16" name="__codelineno-58-16"></a><span class="n">model_4</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_windows</span><span class="p">,</span>
<a id="__codelineno-58-17" name="__codelineno-58-17"></a>            <span class="n">train_labels</span><span class="p">,</span>
<a id="__codelineno-58-18" name="__codelineno-58-18"></a>            <span class="n">batch_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> 
<a id="__codelineno-58-19" name="__codelineno-58-19"></a>            <span class="n">epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-58-20" name="__codelineno-58-20"></a>            <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-58-21" name="__codelineno-58-21"></a>            <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">test_windows</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">),</span>
<a id="__codelineno-58-22" name="__codelineno-58-22"></a>            <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">create_model_checkpoint</span><span class="p">(</span><span class="n">model_name</span><span class="o">=</span><span class="n">model_4</span><span class="o">.</span><span class="n">name</span><span class="p">)])</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    INFO:tensorflow:Assets written to: model_experiments/model_4_conv1D/assets
    INFO:tensorflow:Assets written to: model_experiments/model_4_conv1D/assets
    INFO:tensorflow:Assets written to: model_experiments/model_4_conv1D/assets
    INFO:tensorflow:Assets written to: model_experiments/model_4_conv1D/assets
    INFO:tensorflow:Assets written to: model_experiments/model_4_conv1D/assets
    INFO:tensorflow:Assets written to: model_experiments/model_4_conv1D/assets
    INFO:tensorflow:Assets written to: model_experiments/model_4_conv1D/assets
    INFO:tensorflow:Assets written to: model_experiments/model_4_conv1D/assets
    INFO:tensorflow:Assets written to: model_experiments/model_4_conv1D/assets
    INFO:tensorflow:Assets written to: model_experiments/model_4_conv1D/assets
    (keras.callbacks.History at 0x7f136b63b150)
</pre>
</div>

<p><a name=""></a></p>
<h3 id="evaluate-model_4">Evaluate Model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-59-1">1</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1"></a><span class="n">model_4</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Model: "model_4_conv1D"
    _________________________________________________________________
     Layer (type)                Output Shape              Param #   
    =================================================================
     lambda_5 (Lambda)           (None, 1, 7)              0         

     conv1d_1 (Conv1D)           (None, 1, 128)            4608      

     dense_140 (Dense)           (None, 1, 1)              129       

    =================================================================
    Total params: 4,737
    Trainable params: 4,737
    Non-trainable params: 0
    _________________________________________________________________
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-60-1">1</a></span>
<span class="normal"><a href="#__codelineno-60-2">2</a></span>
<span class="normal"><a href="#__codelineno-60-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1"></a><span class="c1"># Load in best performing Conv1D model and evaluate it on the test data</span>
<a id="__codelineno-60-2" name="__codelineno-60-2"></a><span class="n">model_4</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="s2">&quot;model_experiments/model_4_conv1D&quot;</span><span class="p">)</span>
<a id="__codelineno-60-3" name="__codelineno-60-3"></a><span class="n">model_4</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">test_windows</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    18/18 [==============================] - 0s 3ms/step - loss: 570.8284
    570.8284301757812
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-61-1">1</a></span>
<span class="normal"><a href="#__codelineno-61-2">2</a></span>
<span class="normal"><a href="#__codelineno-61-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1"></a><span class="c1"># Make predictions</span>
<a id="__codelineno-61-2" name="__codelineno-61-2"></a><span class="n">model_4_preds</span> <span class="o">=</span> <span class="n">make_preds</span><span class="p">(</span><span class="n">model_4</span><span class="p">,</span> <span class="n">test_windows</span><span class="p">)</span>
<a id="__codelineno-61-3" name="__codelineno-61-3"></a><span class="n">model_4_preds</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (tf.Tensor: shape=(10,), dtype=float32, numpy=
    array([8851.465, 8754.47 , 8983.928, 8759.672, 8703.628, 8708.294,
           8661.668, 8494.839, 8435.316, 8492.114], dtype=float32))
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-62-1">1</a></span>
<span class="normal"><a href="#__codelineno-62-2">2</a></span>
<span class="normal"><a href="#__codelineno-62-3">3</a></span>
<span class="normal"><a href="#__codelineno-62-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1"></a><span class="c1"># Evaluate predictions</span>
<a id="__codelineno-62-2" name="__codelineno-62-2"></a><span class="n">model_4_results</span> <span class="o">=</span> <span class="n">evaluate_preds</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">test_labels</span><span class="p">),</span>
<a id="__codelineno-62-3" name="__codelineno-62-3"></a>                                 <span class="n">y_pred</span><span class="o">=</span><span class="n">model_4_preds</span><span class="p">)</span>
<a id="__codelineno-62-4" name="__codelineno-62-4"></a><span class="n">model_4_results</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    {'mae': 570.8284,
     'mape': 2.5593357,
     'mase': 1.0027875,
     'mse': 1176671.5,
     'rmse': 1084.7449}
</pre>
</div>

<p><a name="model-5"></a></p>
<h2 id="model-5-rnn-lstm"><strong>Model 5: RNN (LSTM)</strong></h2>
<p><a name=""></a></p>
<h3 id="create-compile-and-fit-model_5">Create, Compile, and Fit Model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-63-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-63-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-63-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-63-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-63-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-63-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-63-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-63-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-63-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-63-10">10</a></span>
<span class="normal"><a href="#__codelineno-63-11">11</a></span>
<span class="normal"><a href="#__codelineno-63-12">12</a></span>
<span class="normal"><a href="#__codelineno-63-13">13</a></span>
<span class="normal"><a href="#__codelineno-63-14">14</a></span>
<span class="normal"><a href="#__codelineno-63-15">15</a></span>
<span class="normal"><a href="#__codelineno-63-16">16</a></span>
<span class="normal"><a href="#__codelineno-63-17">17</a></span>
<span class="normal"><a href="#__codelineno-63-18">18</a></span>
<span class="normal"><a href="#__codelineno-63-19">19</a></span>
<span class="normal"><a href="#__codelineno-63-20">20</a></span>
<span class="normal"><a href="#__codelineno-63-21">21</a></span>
<span class="normal"><a href="#__codelineno-63-22">22</a></span>
<span class="normal"><a href="#__codelineno-63-23">23</a></span>
<span class="normal"><a href="#__codelineno-63-24">24</a></span>
<span class="normal"><a href="#__codelineno-63-25">25</a></span>
<span class="normal"><a href="#__codelineno-63-26">26</a></span>
<span class="normal"><a href="#__codelineno-63-27">27</a></span>
<span class="normal"><a href="#__codelineno-63-28">28</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1"></a><span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">set_seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<a id="__codelineno-63-2" name="__codelineno-63-2"></a>
<a id="__codelineno-63-3" name="__codelineno-63-3"></a><span class="c1"># CREATE MODEL</span>
<a id="__codelineno-63-4" name="__codelineno-63-4"></a><span class="c1"># Let&#39;s build an LSTM model with the Functional API</span>
<a id="__codelineno-63-5" name="__codelineno-63-5"></a><span class="n">inputs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">WINDOW_SIZE</span><span class="p">))</span>
<a id="__codelineno-63-6" name="__codelineno-63-6"></a><span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Lambda</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))(</span><span class="n">inputs</span><span class="p">)</span> <span class="c1"># expand input dimension to be compatible with LSTM</span>
<a id="__codelineno-63-7" name="__codelineno-63-7"></a><span class="c1"># print(x.shape)</span>
<a id="__codelineno-63-8" name="__codelineno-63-8"></a><span class="c1"># x = layers.LSTM(128, activation=&quot;relu&quot;, return_sequences=True)(x) # this layer will error if the inputs are not the right shape</span>
<a id="__codelineno-63-9" name="__codelineno-63-9"></a><span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;relu&quot;</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span> <span class="c1"># using the tanh loss function results in a massive error</span>
<a id="__codelineno-63-10" name="__codelineno-63-10"></a><span class="c1"># print(x.shape)</span>
<a id="__codelineno-63-11" name="__codelineno-63-11"></a><span class="c1"># Add another optional dense layer (you could add more of these to see if they improve model performance)</span>
<a id="__codelineno-63-12" name="__codelineno-63-12"></a><span class="c1"># x = layers.Dense(32, activation=&quot;relu&quot;)(x)</span>
<a id="__codelineno-63-13" name="__codelineno-63-13"></a><span class="n">output</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">HORIZON</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-63-14" name="__codelineno-63-14"></a><span class="n">model_5</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">output</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;model_5_lstm&quot;</span><span class="p">)</span>
<a id="__codelineno-63-15" name="__codelineno-63-15"></a>
<a id="__codelineno-63-16" name="__codelineno-63-16"></a><span class="c1"># COMPILE MODEL</span>
<a id="__codelineno-63-17" name="__codelineno-63-17"></a><span class="n">model_5</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s2">&quot;mae&quot;</span><span class="p">,</span>
<a id="__codelineno-63-18" name="__codelineno-63-18"></a>                <span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">())</span>
<a id="__codelineno-63-19" name="__codelineno-63-19"></a>
<a id="__codelineno-63-20" name="__codelineno-63-20"></a><span class="c1"># FIT MODEL</span>
<a id="__codelineno-63-21" name="__codelineno-63-21"></a><span class="c1"># Seems when saving the model several warnings are appearing: https://github.com/tensorflow/tensorflow/issues/47554 </span>
<a id="__codelineno-63-22" name="__codelineno-63-22"></a><span class="n">model_5</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_windows</span><span class="p">,</span>
<a id="__codelineno-63-23" name="__codelineno-63-23"></a>            <span class="n">train_labels</span><span class="p">,</span>
<a id="__codelineno-63-24" name="__codelineno-63-24"></a>            <span class="n">epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-63-25" name="__codelineno-63-25"></a>            <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-63-26" name="__codelineno-63-26"></a>            <span class="n">batch_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
<a id="__codelineno-63-27" name="__codelineno-63-27"></a>            <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">test_windows</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">),</span>
<a id="__codelineno-63-28" name="__codelineno-63-28"></a>            <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">create_model_checkpoint</span><span class="p">(</span><span class="n">model_name</span><span class="o">=</span><span class="n">model_5</span><span class="o">.</span><span class="n">name</span><span class="p">)])</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    INFO:tensorflow:Assets written to: model_experiments/model_5_lstm/assets
    INFO:tensorflow:Assets written to: model_experiments/model_5_lstm/assets
    WARNING:absl:(keras.layers.recurrent.LSTMCell object at 0x7f136b663850> has the same name 'LSTMCell' as a built-in Keras object. Consider renaming (class 'keras.layers.recurrent.LSTMCell') to avoid naming conflicts when loading with `tf.keras.models.load_model`. If renaming is not possible, pass the object in the `custom_objects` parameter of the load function.
    INFO:tensorflow:Assets written to: model_experiments/model_5_lstm/assets
    INFO:tensorflow:Assets written to: model_experiments/model_5_lstm/assets
    WARNING:absl:(keras.layers.recurrent.LSTMCell object at 0x7f136b663850> has the same name 'LSTMCell' as a built-in Keras object. Consider renaming (class 'keras.layers.recurrent.LSTMCell') to avoid naming conflicts when loading with `tf.keras.models.load_model`. If renaming is not possible, pass the object in the `custom_objects` parameter of the load function.
    INFO:tensorflow:Assets written to: model_experiments/model_5_lstm/assets
    INFO:tensorflow:Assets written to: model_experiments/model_5_lstm/assets
    WARNING:absl:(keras.layers.recurrent.LSTMCell object at 0x7f136b663850> has the same name 'LSTMCell' as a built-in Keras object. Consider renaming (class 'keras.layers.recurrent.LSTMCell') to avoid naming conflicts when loading with `tf.keras.models.load_model`. If renaming is not possible, pass the object in the `custom_objects` parameter of the load function.
    (keras.callbacks.History at 0x7f12f5923350)
</pre>
</div>

<p><a name=""></a></p>
<h3 id="evaluate-model_5">Evaluate Model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-64-1">1</a></span>
<span class="normal"><a href="#__codelineno-64-2">2</a></span>
<span class="normal"><a href="#__codelineno-64-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1"></a><span class="c1"># Load in best version of model 5 and evaluate on the test data</span>
<a id="__codelineno-64-2" name="__codelineno-64-2"></a><span class="n">model_5</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="s2">&quot;model_experiments/model_5_lstm/&quot;</span><span class="p">)</span>
<a id="__codelineno-64-3" name="__codelineno-64-3"></a><span class="n">model_5</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">test_windows</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    WARNING:tensorflow:Layer lstm_1 will not use cuDNN kernels since it doesn't meet the criteria. It will use a generic GPU kernel as fallback when running on GPU.
    WARNING:tensorflow:Layer lstm_1 will not use cuDNN kernels since it doesn't meet the criteria. It will use a generic GPU kernel as fallback when running on GPU.
    18/18 [==============================] - 0s 3ms/step - loss: 598.6749
    598.6749267578125
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-65-1">1</a></span>
<span class="normal"><a href="#__codelineno-65-2">2</a></span>
<span class="normal"><a href="#__codelineno-65-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1"></a><span class="c1"># Make predictions with our LSTM model</span>
<a id="__codelineno-65-2" name="__codelineno-65-2"></a><span class="n">model_5_preds</span> <span class="o">=</span> <span class="n">make_preds</span><span class="p">(</span><span class="n">model_5</span><span class="p">,</span> <span class="n">test_windows</span><span class="p">)</span>
<a id="__codelineno-65-3" name="__codelineno-65-3"></a><span class="n">model_5_preds</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (tf.Tensor: shape=(10,), dtype=float32, numpy=
    array([8983.033, 8811.561, 8991.205, 8832.373, 8724.737, 8774.172,
           8732.739, 8537.5  , 8501.837, 8527.82 ], dtype=float32))
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-66-1">1</a></span>
<span class="normal"><a href="#__codelineno-66-2">2</a></span>
<span class="normal"><a href="#__codelineno-66-3">3</a></span>
<span class="normal"><a href="#__codelineno-66-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1"></a><span class="c1"># Evaluate model 5 preds</span>
<a id="__codelineno-66-2" name="__codelineno-66-2"></a><span class="n">model_5_results</span> <span class="o">=</span> <span class="n">evaluate_preds</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">test_labels</span><span class="p">),</span>
<a id="__codelineno-66-3" name="__codelineno-66-3"></a>                                 <span class="n">y_pred</span><span class="o">=</span><span class="n">model_5_preds</span><span class="p">)</span>
<a id="__codelineno-66-4" name="__codelineno-66-4"></a><span class="n">model_5_results</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    {'mae': 598.67487,
     'mape': 2.6902084,
     'mase': 1.051706,
     'mse': 1279866.4,
     'rmse': 1131.3118}
</pre>
</div>

<p><a name="model-6"></a></p>
<h2 id="model-6-dense-multivariate-time-series"><strong>Model 6: Dense (Multivariate Time Series)</strong></h2>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-67-1">1</a></span>
<span class="normal"><a href="#__codelineno-67-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1"></a><span class="c1"># Let&#39;s make a multivariate time series</span>
<a id="__codelineno-67-2" name="__codelineno-67-2"></a><span class="n">bitcoin_prices</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
                    Price
    Date    
    2013-10-01  123.65499
    2013-10-02  125.45500
    2013-10-03  108.58483
    2013-10-04  118.67466
    2013-10-05  121.33866
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-68-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-68-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-68-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-68-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-68-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-68-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-68-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-68-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-68-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-68-10">10</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1"></a><span class="c1"># Block reward values</span>
<a id="__codelineno-68-2" name="__codelineno-68-2"></a><span class="n">block_reward_1</span> <span class="o">=</span> <span class="mi">50</span> <span class="c1"># 3 January 2009 (2009-01-03) - this block reward isn&#39;t in our dataset (it starts from 01 October 2013)</span>
<a id="__codelineno-68-3" name="__codelineno-68-3"></a><span class="n">block_reward_2</span> <span class="o">=</span> <span class="mi">25</span> <span class="c1"># 28 November 2012 </span>
<a id="__codelineno-68-4" name="__codelineno-68-4"></a><span class="n">block_reward_3</span> <span class="o">=</span> <span class="mf">12.5</span> <span class="c1"># 9 July 2016</span>
<a id="__codelineno-68-5" name="__codelineno-68-5"></a><span class="n">block_reward_4</span> <span class="o">=</span> <span class="mf">6.25</span> <span class="c1"># 11 May 2020</span>
<a id="__codelineno-68-6" name="__codelineno-68-6"></a>
<a id="__codelineno-68-7" name="__codelineno-68-7"></a><span class="c1"># Block reward dates (datetime form of the above date stamps)</span>
<a id="__codelineno-68-8" name="__codelineno-68-8"></a><span class="n">block_reward_2_datetime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s2">&quot;2012-11-28&quot;</span><span class="p">)</span>
<a id="__codelineno-68-9" name="__codelineno-68-9"></a><span class="n">block_reward_3_datetime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s2">&quot;2016-07-09&quot;</span><span class="p">)</span>
<a id="__codelineno-68-10" name="__codelineno-68-10"></a><span class="n">block_reward_4_datetime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s2">&quot;2020-05-11&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-69-1">1</a></span>
<span class="normal"><a href="#__codelineno-69-2">2</a></span>
<span class="normal"><a href="#__codelineno-69-3">3</a></span>
<span class="normal"><a href="#__codelineno-69-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1"></a><span class="c1"># Get date indexes for when to add in different block dates</span>
<a id="__codelineno-69-2" name="__codelineno-69-2"></a><span class="n">block_reward_2_days</span> <span class="o">=</span> <span class="p">(</span><span class="n">block_reward_3_datetime</span> <span class="o">-</span> <span class="n">bitcoin_prices</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">days</span>
<a id="__codelineno-69-3" name="__codelineno-69-3"></a><span class="n">block_reward_3_days</span> <span class="o">=</span> <span class="p">(</span><span class="n">block_reward_4_datetime</span> <span class="o">-</span> <span class="n">bitcoin_prices</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">days</span>
<a id="__codelineno-69-4" name="__codelineno-69-4"></a><span class="n">block_reward_2_days</span><span class="p">,</span> <span class="n">block_reward_3_days</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (1012, 2414)
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-70-1">1</a></span>
<span class="normal"><a href="#__codelineno-70-2">2</a></span>
<span class="normal"><a href="#__codelineno-70-3">3</a></span>
<span class="normal"><a href="#__codelineno-70-4">4</a></span>
<span class="normal"><a href="#__codelineno-70-5">5</a></span>
<span class="normal"><a href="#__codelineno-70-6">6</a></span>
<span class="normal"><a href="#__codelineno-70-7">7</a></span>
<span class="normal"><a href="#__codelineno-70-8">8</a></span>
<span class="normal"><a href="#__codelineno-70-9">9</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1"></a><span class="c1"># Add block_reward column</span>
<a id="__codelineno-70-2" name="__codelineno-70-2"></a><span class="n">bitcoin_prices_block</span> <span class="o">=</span> <span class="n">bitcoin_prices</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-70-3" name="__codelineno-70-3"></a><span class="n">bitcoin_prices_block</span><span class="p">[</span><span class="s2">&quot;block_reward&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-70-4" name="__codelineno-70-4"></a>
<a id="__codelineno-70-5" name="__codelineno-70-5"></a><span class="c1"># Set values of block_reward column (it&#39;s the last column hence -1 indexing on iloc)</span>
<a id="__codelineno-70-6" name="__codelineno-70-6"></a><span class="n">bitcoin_prices_block</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">block_reward_2_days</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">block_reward_2</span>
<a id="__codelineno-70-7" name="__codelineno-70-7"></a><span class="n">bitcoin_prices_block</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">block_reward_2_days</span><span class="p">:</span><span class="n">block_reward_3_days</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">block_reward_3</span>
<a id="__codelineno-70-8" name="__codelineno-70-8"></a><span class="n">bitcoin_prices_block</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">block_reward_3_days</span><span class="p">:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">block_reward_4</span>
<a id="__codelineno-70-9" name="__codelineno-70-9"></a><span class="n">bitcoin_prices_block</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
                    Price   block_reward
    Date        
    2013-10-01  123.65499   25
    2013-10-02  125.45500   25
    2013-10-03  108.58483   25
    2013-10-04  118.67466   25
    2013-10-05  121.33866   25
</pre>
</div>

<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-71-1">1</a></span>
<span class="normal"><a href="#__codelineno-71-2">2</a></span>
<span class="normal"><a href="#__codelineno-71-3">3</a></span>
<span class="normal"><a href="#__codelineno-71-4">4</a></span>
<span class="normal"><a href="#__codelineno-71-5">5</a></span>
<span class="normal"><a href="#__codelineno-71-6">6</a></span>
<span class="normal"><a href="#__codelineno-71-7">7</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1"></a><span class="c1"># Plot the block reward/price over time</span>
<a id="__codelineno-71-2" name="__codelineno-71-2"></a><span class="c1"># Note: Because of the different scales of our values we&#39;ll scale them to be between 0 and 1.</span>
<a id="__codelineno-71-3" name="__codelineno-71-3"></a><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">minmax_scale</span>
<a id="__codelineno-71-4" name="__codelineno-71-4"></a><span class="n">scaled_price_block_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">minmax_scale</span><span class="p">(</span><span class="n">bitcoin_prices_block</span><span class="p">[[</span><span class="s2">&quot;Price&quot;</span><span class="p">,</span> <span class="s2">&quot;block_reward&quot;</span><span class="p">]]),</span> <span class="c1"># we need to scale the data first</span>
<a id="__codelineno-71-5" name="__codelineno-71-5"></a>                                     <span class="n">columns</span><span class="o">=</span><span class="n">bitcoin_prices_block</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
<a id="__codelineno-71-6" name="__codelineno-71-6"></a>                                     <span class="n">index</span><span class="o">=</span><span class="n">bitcoin_prices_block</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<a id="__codelineno-71-7" name="__codelineno-71-7"></a><span class="n">scaled_price_block_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">));</span>
</code></pre></div>
</td></tr></table>
<img alt="bitcoin-12" src="../../../images/bitcoin-12.png" /></p>
<p><a name=""></a></p>
<h3 id="prepare-data_4">Prepare Data</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-72-1">1</a></span>
<span class="normal"><a href="#__codelineno-72-2">2</a></span>
<span class="normal"><a href="#__codelineno-72-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1"></a><span class="c1"># Setup dataset hyperparameters</span>
<a id="__codelineno-72-2" name="__codelineno-72-2"></a><span class="n">HORIZON</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-72-3" name="__codelineno-72-3"></a><span class="n">WINDOW_SIZE</span> <span class="o">=</span> <span class="mi">7</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-73-1">1</a></span>
<span class="normal"><a href="#__codelineno-73-2">2</a></span>
<span class="normal"><a href="#__codelineno-73-3">3</a></span>
<span class="normal"><a href="#__codelineno-73-4">4</a></span>
<span class="normal"><a href="#__codelineno-73-5">5</a></span>
<span class="normal"><a href="#__codelineno-73-6">6</a></span>
<span class="normal"><a href="#__codelineno-73-7">7</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1"></a><span class="c1"># Make a copy of the Bitcoin historical data with block reward feature</span>
<a id="__codelineno-73-2" name="__codelineno-73-2"></a><span class="n">bitcoin_prices_windowed</span> <span class="o">=</span> <span class="n">bitcoin_prices_block</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-73-3" name="__codelineno-73-3"></a>
<a id="__codelineno-73-4" name="__codelineno-73-4"></a><span class="c1"># Add windowed columns</span>
<a id="__codelineno-73-5" name="__codelineno-73-5"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">WINDOW_SIZE</span><span class="p">):</span> <span class="c1"># Shift values for each step in WINDOW_SIZE</span>
<a id="__codelineno-73-6" name="__codelineno-73-6"></a>  <span class="n">bitcoin_prices_windowed</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Price+</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bitcoin_prices_windowed</span><span class="p">[</span><span class="s2">&quot;Price&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-73-7" name="__codelineno-73-7"></a><span class="n">bitcoin_prices_windowed</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
                    Price   block_reward    Price+1     Price+2     Price+3     Price+4     Price+5     Price+6     Price+7
    Date                                    
    2013-10-01  123.65499   25              NaN         NaN         NaN         NaN         NaN         NaN         NaN
    2013-10-02  125.45500   25              123.65499   NaN         NaN         NaN         NaN         NaN         NaN
    2013-10-03  108.58483   25              125.45500   123.65499   NaN         NaN         NaN         NaN         NaN
    2013-10-04  118.67466   25              108.58483   125.45500   123.65499   NaN         NaN         NaN         NaN
    2013-10-05  121.33866   25              118.67466   108.58483   125.45500   123.65499   NaN         NaN         NaN
    2013-10-06  120.65533   25              121.33866   118.67466   108.58483   125.45500   123.65499   NaN         NaN
    2013-10-07  121.79500   25              120.65533   121.33866   118.67466   108.58483   125.45500   123.65499   NaN
    2013-10-08  123.03300   25              121.79500   120.65533   121.33866   118.67466   108.58483   125.45500   123.65499
    2013-10-09  124.04900   25              123.03300   121.79500   120.65533   121.33866   118.67466   108.58483   125.45500
    2013-10-10  125.96116   25              124.04900   123.03300   121.79500   120.65533   121.33866   118.67466   108.58483
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-74-1">1</a></span>
<span class="normal"><a href="#__codelineno-74-2">2</a></span>
<span class="normal"><a href="#__codelineno-74-3">3</a></span>
<span class="normal"><a href="#__codelineno-74-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1"></a><span class="c1"># Let&#39;s create X &amp; y, remove the NaN&#39;s and convert to float32 to prevent TensorFlow errors </span>
<a id="__codelineno-74-2" name="__codelineno-74-2"></a><span class="n">X</span> <span class="o">=</span> <span class="n">bitcoin_prices_windowed</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;Price&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> 
<a id="__codelineno-74-3" name="__codelineno-74-3"></a><span class="n">y</span> <span class="o">=</span> <span class="n">bitcoin_prices_windowed</span><span class="o">.</span><span class="n">dropna</span><span class="p">()[</span><span class="s2">&quot;Price&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-74-4" name="__codelineno-74-4"></a><span class="n">X</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
                block_reward    Price+1     Price+2     Price+3     Price+4     Price+5     Price+6     Price+7
    Date                                
    2013-10-08  25.0            121.794998  120.655327  121.338661  118.674660  108.584831  125.455002  123.654991
    2013-10-09  25.0            123.032997  121.794998  120.655327  121.338661  118.674660  108.584831  125.455002
    2013-10-10  25.0            124.049004  123.032997  121.794998  120.655327  121.338661  118.674660  108.584831
    2013-10-11  25.0            125.961159  124.049004  123.032997  121.794998  120.655327  121.338661  118.674660
    2013-10-12  25.0            125.279663  125.961159  124.049004  123.032997  121.794998  120.655327  121.338661
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-75-1">1</a></span>
<span class="normal"><a href="#__codelineno-75-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1"></a><span class="c1"># View labels</span>
<a id="__codelineno-75-2" name="__codelineno-75-2"></a><span class="n">y</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
Date
    2013-10-08    123.032997
    2013-10-09    124.049004
    2013-10-10    125.961159
    2013-10-11    125.279663
    2013-10-12    125.927498
    Name: Price, dtype: float32
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-76-1">1</a></span>
<span class="normal"><a href="#__codelineno-76-2">2</a></span>
<span class="normal"><a href="#__codelineno-76-3">3</a></span>
<span class="normal"><a href="#__codelineno-76-4">4</a></span>
<span class="normal"><a href="#__codelineno-76-5">5</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-76-1" name="__codelineno-76-1"></a><span class="c1"># Make train and test sets</span>
<a id="__codelineno-76-2" name="__codelineno-76-2"></a><span class="n">split_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.8</span><span class="p">)</span>
<a id="__codelineno-76-3" name="__codelineno-76-3"></a><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:</span><span class="n">split_size</span><span class="p">],</span> <span class="n">y</span><span class="p">[:</span><span class="n">split_size</span><span class="p">]</span>
<a id="__codelineno-76-4" name="__codelineno-76-4"></a><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">split_size</span><span class="p">:],</span> <span class="n">y</span><span class="p">[</span><span class="n">split_size</span><span class="p">:]</span>
<a id="__codelineno-76-5" name="__codelineno-76-5"></a><span class="nb">len</span><span class="p">(</span><span class="n">X_train</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_train</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_test</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (2224, 2224, 556, 556)
</pre>
</div>

<p><a name=""></a></p>
<h3 id="create-compile-and-fit-model_6">Create, Compile, and Fit Model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-77-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-77-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-77-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-77-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-77-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-77-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-77-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-77-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-77-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-77-10">10</a></span>
<span class="normal"><a href="#__codelineno-77-11">11</a></span>
<span class="normal"><a href="#__codelineno-77-12">12</a></span>
<span class="normal"><a href="#__codelineno-77-13">13</a></span>
<span class="normal"><a href="#__codelineno-77-14">14</a></span>
<span class="normal"><a href="#__codelineno-77-15">15</a></span>
<span class="normal"><a href="#__codelineno-77-16">16</a></span>
<span class="normal"><a href="#__codelineno-77-17">17</a></span>
<span class="normal"><a href="#__codelineno-77-18">18</a></span>
<span class="normal"><a href="#__codelineno-77-19">19</a></span>
<span class="normal"><a href="#__codelineno-77-20">20</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-77-1" name="__codelineno-77-1"></a><span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">set_seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<a id="__codelineno-77-2" name="__codelineno-77-2"></a>
<a id="__codelineno-77-3" name="__codelineno-77-3"></a><span class="c1"># CREATE MODEL (Make multivariate time series model)</span>
<a id="__codelineno-77-4" name="__codelineno-77-4"></a><span class="n">model_6</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
<a id="__codelineno-77-5" name="__codelineno-77-5"></a>  <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;relu&quot;</span><span class="p">),</span>
<a id="__codelineno-77-6" name="__codelineno-77-6"></a>  <span class="c1"># tf.keras.layers.Dense(128, activation=&quot;relu&quot;), # adding an extra layer here should lead to beating the naive model</span>
<a id="__codelineno-77-7" name="__codelineno-77-7"></a>  <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">HORIZON</span><span class="p">)</span>
<a id="__codelineno-77-8" name="__codelineno-77-8"></a><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;model_6_dense_multivariate&quot;</span><span class="p">)</span>
<a id="__codelineno-77-9" name="__codelineno-77-9"></a>
<a id="__codelineno-77-10" name="__codelineno-77-10"></a><span class="c1"># COMPILE MODEL</span>
<a id="__codelineno-77-11" name="__codelineno-77-11"></a><span class="n">model_6</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s2">&quot;mae&quot;</span><span class="p">,</span>
<a id="__codelineno-77-12" name="__codelineno-77-12"></a>                <span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">())</span>
<a id="__codelineno-77-13" name="__codelineno-77-13"></a>
<a id="__codelineno-77-14" name="__codelineno-77-14"></a><span class="c1"># FIT MODEL</span>
<a id="__codelineno-77-15" name="__codelineno-77-15"></a><span class="n">model_6</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span>
<a id="__codelineno-77-16" name="__codelineno-77-16"></a>            <span class="n">epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-77-17" name="__codelineno-77-17"></a>            <span class="n">batch_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
<a id="__codelineno-77-18" name="__codelineno-77-18"></a>            <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="c1"># only print 1 line per epoch</span>
<a id="__codelineno-77-19" name="__codelineno-77-19"></a>            <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">),</span>
<a id="__codelineno-77-20" name="__codelineno-77-20"></a>            <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">create_model_checkpoint</span><span class="p">(</span><span class="n">model_name</span><span class="o">=</span><span class="n">model_6</span><span class="o">.</span><span class="n">name</span><span class="p">)])</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    INFO:tensorflow:Assets written to: model_experiments/model_6_dense_multivariate/assets
    INFO:tensorflow:Assets written to: model_experiments/model_6_dense_multivariate/assets
    INFO:tensorflow:Assets written to: model_experiments/model_6_dense_multivariate/assets
    INFO:tensorflow:Assets written to: model_experiments/model_6_dense_multivariate/assets
    INFO:tensorflow:Assets written to: model_experiments/model_6_dense_multivariate/assets
    INFO:tensorflow:Assets written to: model_experiments/model_6_dense_multivariate/assets
    INFO:tensorflow:Assets written to: model_experiments/model_6_dense_multivariate/assets
    INFO:tensorflow:Assets written to: model_experiments/model_6_dense_multivariate/assets
    INFO:tensorflow:Assets written to: model_experiments/model_6_dense_multivariate/assets
    INFO:tensorflow:Assets written to: model_experiments/model_6_dense_multivariate/assets
    (keras.callbacks.History at 0x7f12eeb7c510)
</pre>
</div>

<p><a name=""></a></p>
<h3 id="evaluate-model_6">Evaluate Model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-78-1">1</a></span>
<span class="normal"><a href="#__codelineno-78-2">2</a></span>
<span class="normal"><a href="#__codelineno-78-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-78-1" name="__codelineno-78-1"></a><span class="c1"># Make sure best model is loaded and evaluate</span>
<a id="__codelineno-78-2" name="__codelineno-78-2"></a><span class="n">model_6</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="s2">&quot;model_experiments/model_6_dense_multivariate&quot;</span><span class="p">)</span>
<a id="__codelineno-78-3" name="__codelineno-78-3"></a><span class="n">model_6</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    18/18 [==============================] - 0s 3ms/step - loss: 567.5873
    567.5873413085938
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-79-1">1</a></span>
<span class="normal"><a href="#__codelineno-79-2">2</a></span>
<span class="normal"><a href="#__codelineno-79-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-79-1" name="__codelineno-79-1"></a><span class="c1"># Make predictions on multivariate data</span>
<a id="__codelineno-79-2" name="__codelineno-79-2"></a><span class="n">model_6_preds</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">model_6</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">))</span>
<a id="__codelineno-79-3" name="__codelineno-79-3"></a><span class="n">model_6_preds</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (tf.Tensor: shape=(10,), dtype=float32, numpy=
    array([8836.276, 8763.8  , 9040.486, 8741.225, 8719.326, 8765.071,
           8661.102, 8496.891, 8463.231, 8521.585], dtype=float32))
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-80-1">1</a></span>
<span class="normal"><a href="#__codelineno-80-2">2</a></span>
<span class="normal"><a href="#__codelineno-80-3">3</a></span>
<span class="normal"><a href="#__codelineno-80-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-80-1" name="__codelineno-80-1"></a><span class="c1"># Evaluate preds</span>
<a id="__codelineno-80-2" name="__codelineno-80-2"></a><span class="n">model_6_results</span> <span class="o">=</span> <span class="n">evaluate_preds</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">y_test</span><span class="p">,</span>
<a id="__codelineno-80-3" name="__codelineno-80-3"></a>                                 <span class="n">y_pred</span><span class="o">=</span><span class="n">model_6_preds</span><span class="p">)</span>
<a id="__codelineno-80-4" name="__codelineno-80-4"></a><span class="n">model_6_results</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    {'mae': 567.5874,
     'mape': 2.541387,
     'mase': 0.99709386,
     'mse': 1161688.4,
     'rmse': 1077.8165}
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-81-1">1</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-81-1" name="__codelineno-81-1"></a><span class="n">model_1_results</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    {'mae': 568.95123,
     'mape': 2.5448983,
     'mase': 0.9994897,
     'mse': 1171744.0,
     'rmse': 1082.4713}
</pre>
</div>

<p><a name="model-7"></a></p>
<h2 id="model-7-n-beats"><strong>Model 7: N-BEATS</strong></h2>
<p><a name=""></a></p>
<h3 id="prepare-custom-layer">Prepare Custom Layer</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-82-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-82-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-82-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-82-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-82-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-82-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-82-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-82-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-82-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-82-10">10</a></span>
<span class="normal"><a href="#__codelineno-82-11">11</a></span>
<span class="normal"><a href="#__codelineno-82-12">12</a></span>
<span class="normal"><a href="#__codelineno-82-13">13</a></span>
<span class="normal"><a href="#__codelineno-82-14">14</a></span>
<span class="normal"><a href="#__codelineno-82-15">15</a></span>
<span class="normal"><a href="#__codelineno-82-16">16</a></span>
<span class="normal"><a href="#__codelineno-82-17">17</a></span>
<span class="normal"><a href="#__codelineno-82-18">18</a></span>
<span class="normal"><a href="#__codelineno-82-19">19</a></span>
<span class="normal"><a href="#__codelineno-82-20">20</a></span>
<span class="normal"><a href="#__codelineno-82-21">21</a></span>
<span class="normal"><a href="#__codelineno-82-22">22</a></span>
<span class="normal"><a href="#__codelineno-82-23">23</a></span>
<span class="normal"><a href="#__codelineno-82-24">24</a></span>
<span class="normal"><a href="#__codelineno-82-25">25</a></span>
<span class="normal"><a href="#__codelineno-82-26">26</a></span>
<span class="normal"><a href="#__codelineno-82-27">27</a></span>
<span class="normal"><a href="#__codelineno-82-28">28</a></span>
<span class="normal"><a href="#__codelineno-82-29">29</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-82-1" name="__codelineno-82-1"></a><span class="c1"># Create NBeatsBlock custom layer </span>
<a id="__codelineno-82-2" name="__codelineno-82-2"></a><span class="k">class</span> <span class="nc">NBeatsBlock</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Layer</span><span class="p">):</span>
<a id="__codelineno-82-3" name="__codelineno-82-3"></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="c1"># the constructor takes all the hyperparameters for the layer</span>
<a id="__codelineno-82-4" name="__codelineno-82-4"></a>               <span class="n">input_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-82-5" name="__codelineno-82-5"></a>               <span class="n">theta_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-82-6" name="__codelineno-82-6"></a>               <span class="n">horizon</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-82-7" name="__codelineno-82-7"></a>               <span class="n">n_neurons</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-82-8" name="__codelineno-82-8"></a>               <span class="n">n_layers</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-82-9" name="__codelineno-82-9"></a>               <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> <span class="c1"># the **kwargs argument takes care of all of the arguments for the parent class (input_shape, trainable, name)</span>
<a id="__codelineno-82-10" name="__codelineno-82-10"></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-82-11" name="__codelineno-82-11"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">input_size</span> <span class="o">=</span> <span class="n">input_size</span>
<a id="__codelineno-82-12" name="__codelineno-82-12"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">theta_size</span> <span class="o">=</span> <span class="n">theta_size</span>
<a id="__codelineno-82-13" name="__codelineno-82-13"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span> <span class="o">=</span> <span class="n">horizon</span>
<a id="__codelineno-82-14" name="__codelineno-82-14"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">n_neurons</span> <span class="o">=</span> <span class="n">n_neurons</span>
<a id="__codelineno-82-15" name="__codelineno-82-15"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">n_layers</span> <span class="o">=</span> <span class="n">n_layers</span>
<a id="__codelineno-82-16" name="__codelineno-82-16"></a>
<a id="__codelineno-82-17" name="__codelineno-82-17"></a>    <span class="c1"># Block contains stack of 4 fully connected layers each has ReLU activation</span>
<a id="__codelineno-82-18" name="__codelineno-82-18"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">hidden</span> <span class="o">=</span> <span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">n_neurons</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;relu&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_layers</span><span class="p">)]</span>
<a id="__codelineno-82-19" name="__codelineno-82-19"></a>    <span class="c1"># Output of block is a theta layer with linear activation</span>
<a id="__codelineno-82-20" name="__codelineno-82-20"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">theta_layer</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">theta_size</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;theta&quot;</span><span class="p">)</span>
<a id="__codelineno-82-21" name="__codelineno-82-21"></a>
<a id="__codelineno-82-22" name="__codelineno-82-22"></a>  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span> <span class="c1"># the call method is what runs when the layer is called </span>
<a id="__codelineno-82-23" name="__codelineno-82-23"></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">inputs</span> 
<a id="__codelineno-82-24" name="__codelineno-82-24"></a>    <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hidden</span><span class="p">:</span> <span class="c1"># pass inputs through each hidden layer </span>
<a id="__codelineno-82-25" name="__codelineno-82-25"></a>      <span class="n">x</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-82-26" name="__codelineno-82-26"></a>    <span class="n">theta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta_layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> 
<a id="__codelineno-82-27" name="__codelineno-82-27"></a>    <span class="c1"># Output the backcast and forecast from theta</span>
<a id="__codelineno-82-28" name="__codelineno-82-28"></a>    <span class="n">backcast</span><span class="p">,</span> <span class="n">forecast</span> <span class="o">=</span> <span class="n">theta</span><span class="p">[:,</span> <span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">input_size</span><span class="p">],</span> <span class="n">theta</span><span class="p">[:,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">horizon</span><span class="p">:]</span>
<a id="__codelineno-82-29" name="__codelineno-82-29"></a>    <span class="k">return</span> <span class="n">backcast</span><span class="p">,</span> <span class="n">forecast</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-83-1">1</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-83-1" name="__codelineno-83-1"></a>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">

</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-84-1">1</a></span>
<span class="normal"><a href="#__codelineno-84-2">2</a></span>
<span class="normal"><a href="#__codelineno-84-3">3</a></span>
<span class="normal"><a href="#__codelineno-84-4">4</a></span>
<span class="normal"><a href="#__codelineno-84-5">5</a></span>
<span class="normal"><a href="#__codelineno-84-6">6</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-84-1" name="__codelineno-84-1"></a><span class="c1"># Set up dummy NBeatsBlock layer to represent inputs and outputs</span>
<a id="__codelineno-84-2" name="__codelineno-84-2"></a><span class="n">dummy_nbeats_block_layer</span> <span class="o">=</span> <span class="n">NBeatsBlock</span><span class="p">(</span><span class="n">input_size</span><span class="o">=</span><span class="n">WINDOW_SIZE</span><span class="p">,</span> 
<a id="__codelineno-84-3" name="__codelineno-84-3"></a>                                       <span class="n">theta_size</span><span class="o">=</span><span class="n">WINDOW_SIZE</span><span class="o">+</span><span class="n">HORIZON</span><span class="p">,</span> <span class="c1"># backcast + forecast </span>
<a id="__codelineno-84-4" name="__codelineno-84-4"></a>                                       <span class="n">horizon</span><span class="o">=</span><span class="n">HORIZON</span><span class="p">,</span>
<a id="__codelineno-84-5" name="__codelineno-84-5"></a>                                       <span class="n">n_neurons</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
<a id="__codelineno-84-6" name="__codelineno-84-6"></a>                                       <span class="n">n_layers</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-85-1">1</a></span>
<span class="normal"><a href="#__codelineno-85-2">2</a></span>
<span class="normal"><a href="#__codelineno-85-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-85-1" name="__codelineno-85-1"></a><span class="c1"># Create dummy inputs (have to be same size as input_size)</span>
<a id="__codelineno-85-2" name="__codelineno-85-2"></a><span class="n">dummy_inputs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="n">WINDOW_SIZE</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># input shape to the model has to reflect Dense layer input requirements (ndim=2)</span>
<a id="__codelineno-85-3" name="__codelineno-85-3"></a><span class="n">dummy_inputs</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (tf.Tensor: shape=(1, 7), dtype=int32, numpy=array([[1, 2, 3, 4, 5, 6, 7]], dtype=int32))
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-86-1">1</a></span>
<span class="normal"><a href="#__codelineno-86-2">2</a></span>
<span class="normal"><a href="#__codelineno-86-3">3</a></span>
<span class="normal"><a href="#__codelineno-86-4">4</a></span>
<span class="normal"><a href="#__codelineno-86-5">5</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-86-1" name="__codelineno-86-1"></a><span class="c1"># Pass dummy inputs to dummy NBeatsBlock layer</span>
<a id="__codelineno-86-2" name="__codelineno-86-2"></a><span class="n">backcast</span><span class="p">,</span> <span class="n">forecast</span> <span class="o">=</span> <span class="n">dummy_nbeats_block_layer</span><span class="p">(</span><span class="n">dummy_inputs</span><span class="p">)</span>
<a id="__codelineno-86-3" name="__codelineno-86-3"></a><span class="c1"># These are the activation outputs of the theta layer (they&#39;ll be random due to no training of the model)</span>
<a id="__codelineno-86-4" name="__codelineno-86-4"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Backcast: </span><span class="si">{</span><span class="n">tf</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">backcast</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-86-5" name="__codelineno-86-5"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Forecast: </span><span class="si">{</span><span class="n">tf</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">forecast</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Backcast: [ 0.19014978  0.83798355 -0.32870018  0.25159916 -0.47540277 -0.77836645
     -0.5299447 ]
    Forecast: -0.7554212808609009
</pre>
</div>

<p><a name=""></a></p>
<h3 id="prepare-data_5">Prepare Data</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-87-1">1</a></span>
<span class="normal"><a href="#__codelineno-87-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-87-1" name="__codelineno-87-1"></a><span class="n">HORIZON</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># how far to predict forward</span>
<a id="__codelineno-87-2" name="__codelineno-87-2"></a><span class="n">WINDOW_SIZE</span> <span class="o">=</span> <span class="mi">7</span> <span class="c1"># how far to lookback</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-88-1">1</a></span>
<span class="normal"><a href="#__codelineno-88-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-88-1" name="__codelineno-88-1"></a><span class="c1"># Create NBEATS data inputs (NBEATS works with univariate time series)</span>
<a id="__codelineno-88-2" name="__codelineno-88-2"></a><span class="n">bitcoin_prices</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
                    Price
    Date    
    2013-10-01  123.65499
    2013-10-02  125.45500
    2013-10-03  108.58483
    2013-10-04  118.67466
    2013-10-05  121.33866
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-89-1">1</a></span>
<span class="normal"><a href="#__codelineno-89-2">2</a></span>
<span class="normal"><a href="#__codelineno-89-3">3</a></span>
<span class="normal"><a href="#__codelineno-89-4">4</a></span>
<span class="normal"><a href="#__codelineno-89-5">5</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-89-1" name="__codelineno-89-1"></a><span class="c1"># Add windowed columns</span>
<a id="__codelineno-89-2" name="__codelineno-89-2"></a><span class="n">bitcoin_prices_nbeats</span> <span class="o">=</span> <span class="n">bitcoin_prices</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-89-3" name="__codelineno-89-3"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">WINDOW_SIZE</span><span class="p">):</span>
<a id="__codelineno-89-4" name="__codelineno-89-4"></a>  <span class="n">bitcoin_prices_nbeats</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Price+</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bitcoin_prices_nbeats</span><span class="p">[</span><span class="s2">&quot;Price&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-89-5" name="__codelineno-89-5"></a><span class="n">bitcoin_prices_nbeats</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
                    Price   Price+1     Price+2     Price+3     Price+4     Price+5     Price+6     Price+7
    Date                                
    2013-10-08  123.03300   121.79500   120.65533   121.33866   118.67466   108.58483   125.45500   123.65499
    2013-10-09  124.04900   123.03300   121.79500   120.65533   121.33866   118.67466   108.58483   125.45500
    2013-10-10  125.96116   124.04900   123.03300   121.79500   120.65533   121.33866   118.67466   108.58483
    2013-10-11  125.27966   125.96116   124.04900   123.03300   121.79500   120.65533   121.33866   118.67466
    2013-10-12  125.92750   125.27966   125.96116   124.04900   123.03300   121.79500   120.65533   121.33866
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-90-1">1</a></span>
<span class="normal"><a href="#__codelineno-90-2">2</a></span>
<span class="normal"><a href="#__codelineno-90-3">3</a></span>
<span class="normal"><a href="#__codelineno-90-4">4</a></span>
<span class="normal"><a href="#__codelineno-90-5">5</a></span>
<span class="normal"><a href="#__codelineno-90-6">6</a></span>
<span class="normal"><a href="#__codelineno-90-7">7</a></span>
<span class="normal"><a href="#__codelineno-90-8">8</a></span>
<span class="normal"><a href="#__codelineno-90-9">9</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-90-1" name="__codelineno-90-1"></a><span class="c1"># Make features and labels</span>
<a id="__codelineno-90-2" name="__codelineno-90-2"></a><span class="n">X</span> <span class="o">=</span> <span class="n">bitcoin_prices_nbeats</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;Price&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-90-3" name="__codelineno-90-3"></a><span class="n">y</span> <span class="o">=</span> <span class="n">bitcoin_prices_nbeats</span><span class="o">.</span><span class="n">dropna</span><span class="p">()[</span><span class="s2">&quot;Price&quot;</span><span class="p">]</span>
<a id="__codelineno-90-4" name="__codelineno-90-4"></a>
<a id="__codelineno-90-5" name="__codelineno-90-5"></a><span class="c1"># Make train and test sets</span>
<a id="__codelineno-90-6" name="__codelineno-90-6"></a><span class="n">split_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.8</span><span class="p">)</span>
<a id="__codelineno-90-7" name="__codelineno-90-7"></a><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:</span><span class="n">split_size</span><span class="p">],</span> <span class="n">y</span><span class="p">[:</span><span class="n">split_size</span><span class="p">]</span>
<a id="__codelineno-90-8" name="__codelineno-90-8"></a><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">split_size</span><span class="p">:],</span> <span class="n">y</span><span class="p">[</span><span class="n">split_size</span><span class="p">:]</span>
<a id="__codelineno-90-9" name="__codelineno-90-9"></a><span class="nb">len</span><span class="p">(</span><span class="n">X_train</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_train</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_test</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (2224, 2224, 556, 556)
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-91-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-91-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-91-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-91-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-91-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-91-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-91-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-91-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-91-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-91-10">10</a></span>
<span class="normal"><a href="#__codelineno-91-11">11</a></span>
<span class="normal"><a href="#__codelineno-91-12">12</a></span>
<span class="normal"><a href="#__codelineno-91-13">13</a></span>
<span class="normal"><a href="#__codelineno-91-14">14</a></span>
<span class="normal"><a href="#__codelineno-91-15">15</a></span>
<span class="normal"><a href="#__codelineno-91-16">16</a></span>
<span class="normal"><a href="#__codelineno-91-17">17</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-91-1" name="__codelineno-91-1"></a><span class="c1"># 1. Turn train and test arrays into tensor Datasets</span>
<a id="__codelineno-91-2" name="__codelineno-91-2"></a><span class="n">train_features_dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_tensor_slices</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<a id="__codelineno-91-3" name="__codelineno-91-3"></a><span class="n">train_labels_dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_tensor_slices</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span>
<a id="__codelineno-91-4" name="__codelineno-91-4"></a>
<a id="__codelineno-91-5" name="__codelineno-91-5"></a><span class="n">test_features_dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_tensor_slices</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<a id="__codelineno-91-6" name="__codelineno-91-6"></a><span class="n">test_labels_dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_tensor_slices</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span>
<a id="__codelineno-91-7" name="__codelineno-91-7"></a>
<a id="__codelineno-91-8" name="__codelineno-91-8"></a><span class="c1"># 2. Combine features &amp; labels</span>
<a id="__codelineno-91-9" name="__codelineno-91-9"></a><span class="n">train_dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">zip</span><span class="p">((</span><span class="n">train_features_dataset</span><span class="p">,</span> <span class="n">train_labels_dataset</span><span class="p">))</span>
<a id="__codelineno-91-10" name="__codelineno-91-10"></a><span class="n">test_dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">zip</span><span class="p">((</span><span class="n">test_features_dataset</span><span class="p">,</span> <span class="n">test_labels_dataset</span><span class="p">))</span>
<a id="__codelineno-91-11" name="__codelineno-91-11"></a>
<a id="__codelineno-91-12" name="__codelineno-91-12"></a><span class="c1"># 3. Batch and prefetch for optimal performance</span>
<a id="__codelineno-91-13" name="__codelineno-91-13"></a><span class="n">BATCH_SIZE</span> <span class="o">=</span> <span class="mi">1024</span> <span class="c1"># taken from Appendix D in N-BEATS paper</span>
<a id="__codelineno-91-14" name="__codelineno-91-14"></a><span class="n">train_dataset</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="n">BATCH_SIZE</span><span class="p">)</span><span class="o">.</span><span class="n">prefetch</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">AUTOTUNE</span><span class="p">)</span>
<a id="__codelineno-91-15" name="__codelineno-91-15"></a><span class="n">test_dataset</span> <span class="o">=</span> <span class="n">test_dataset</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="n">BATCH_SIZE</span><span class="p">)</span><span class="o">.</span><span class="n">prefetch</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">AUTOTUNE</span><span class="p">)</span>
<a id="__codelineno-91-16" name="__codelineno-91-16"></a>
<a id="__codelineno-91-17" name="__codelineno-91-17"></a><span class="n">train_dataset</span><span class="p">,</span> <span class="n">test_dataset</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    ((PrefetchDataset shapes: ((None, 7), (None,)), types: (tf.float64, tf.float64)),
     (PrefetchDataset shapes: ((None, 7), (None,)), types: (tf.float64, tf.float64)))
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-92-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-92-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-92-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-92-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-92-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-92-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-92-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-92-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-92-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-92-10">10</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-92-1" name="__codelineno-92-1"></a><span class="c1"># Values from N-BEATS paper Figure 1 and Table 18/Appendix D</span>
<a id="__codelineno-92-2" name="__codelineno-92-2"></a><span class="n">N_EPOCHS</span> <span class="o">=</span> <span class="mi">5000</span> <span class="c1"># called &quot;Iterations&quot; in Table 18</span>
<a id="__codelineno-92-3" name="__codelineno-92-3"></a><span class="n">N_NEURONS</span> <span class="o">=</span> <span class="mi">512</span> <span class="c1"># called &quot;Width&quot; in Table 18</span>
<a id="__codelineno-92-4" name="__codelineno-92-4"></a><span class="n">N_LAYERS</span> <span class="o">=</span> <span class="mi">4</span>
<a id="__codelineno-92-5" name="__codelineno-92-5"></a><span class="n">N_STACKS</span> <span class="o">=</span> <span class="mi">30</span>
<a id="__codelineno-92-6" name="__codelineno-92-6"></a>
<a id="__codelineno-92-7" name="__codelineno-92-7"></a><span class="n">INPUT_SIZE</span> <span class="o">=</span> <span class="n">WINDOW_SIZE</span> <span class="o">*</span> <span class="n">HORIZON</span> <span class="c1"># called &quot;Lookback&quot; in Table 18</span>
<a id="__codelineno-92-8" name="__codelineno-92-8"></a><span class="n">THETA_SIZE</span> <span class="o">=</span> <span class="n">INPUT_SIZE</span> <span class="o">+</span> <span class="n">HORIZON</span>
<a id="__codelineno-92-9" name="__codelineno-92-9"></a>
<a id="__codelineno-92-10" name="__codelineno-92-10"></a><span class="n">INPUT_SIZE</span><span class="p">,</span> <span class="n">THETA_SIZE</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (7, 8)
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-93-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-93-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-93-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-93-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-93-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-93-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-93-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-93-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-93-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-93-10">10</a></span>
<span class="normal"><a href="#__codelineno-93-11">11</a></span>
<span class="normal"><a href="#__codelineno-93-12">12</a></span>
<span class="normal"><a href="#__codelineno-93-13">13</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-93-1" name="__codelineno-93-1"></a><span class="c1"># Make tensors</span>
<a id="__codelineno-93-2" name="__codelineno-93-2"></a><span class="n">tensor_1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="mi">10</span>
<a id="__codelineno-93-3" name="__codelineno-93-3"></a><span class="n">tensor_2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-93-4" name="__codelineno-93-4"></a>
<a id="__codelineno-93-5" name="__codelineno-93-5"></a><span class="c1"># Subtract</span>
<a id="__codelineno-93-6" name="__codelineno-93-6"></a><span class="n">subtracted</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">subtract</span><span class="p">([</span><span class="n">tensor_1</span><span class="p">,</span> <span class="n">tensor_2</span><span class="p">])</span>
<a id="__codelineno-93-7" name="__codelineno-93-7"></a>
<a id="__codelineno-93-8" name="__codelineno-93-8"></a><span class="c1"># Add</span>
<a id="__codelineno-93-9" name="__codelineno-93-9"></a><span class="n">added</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">add</span><span class="p">([</span><span class="n">tensor_1</span><span class="p">,</span> <span class="n">tensor_2</span><span class="p">])</span>
<a id="__codelineno-93-10" name="__codelineno-93-10"></a>
<a id="__codelineno-93-11" name="__codelineno-93-11"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input tensors: </span><span class="si">{</span><span class="n">tensor_1</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="si">}</span><span class="s2"> &amp; </span><span class="si">{</span><span class="n">tensor_2</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-93-12" name="__codelineno-93-12"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Subtracted: </span><span class="si">{</span><span class="n">subtracted</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-93-13" name="__codelineno-93-13"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added: </span><span class="si">{</span><span class="n">added</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Input tensors: [10 11 12 13 14 15 16 17 18 19] & [0 1 2 3 4 5 6 7 8 9]
    Subtracted: [10 10 10 10 10 10 10 10 10 10]
    Added: [10 12 14 16 18 20 22 24 26 28]
</pre>
</div>

<p><a name=""></a></p>
<h3 id="create-compile-and-fit-model_7">Create, Compile, and Fit Model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-94-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-94-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-94-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-94-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-94-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-94-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-94-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-94-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-94-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-94-10">10</a></span>
<span class="normal"><a href="#__codelineno-94-11">11</a></span>
<span class="normal"><a href="#__codelineno-94-12">12</a></span>
<span class="normal"><a href="#__codelineno-94-13">13</a></span>
<span class="normal"><a href="#__codelineno-94-14">14</a></span>
<span class="normal"><a href="#__codelineno-94-15">15</a></span>
<span class="normal"><a href="#__codelineno-94-16">16</a></span>
<span class="normal"><a href="#__codelineno-94-17">17</a></span>
<span class="normal"><a href="#__codelineno-94-18">18</a></span>
<span class="normal"><a href="#__codelineno-94-19">19</a></span>
<span class="normal"><a href="#__codelineno-94-20">20</a></span>
<span class="normal"><a href="#__codelineno-94-21">21</a></span>
<span class="normal"><a href="#__codelineno-94-22">22</a></span>
<span class="normal"><a href="#__codelineno-94-23">23</a></span>
<span class="normal"><a href="#__codelineno-94-24">24</a></span>
<span class="normal"><a href="#__codelineno-94-25">25</a></span>
<span class="normal"><a href="#__codelineno-94-26">26</a></span>
<span class="normal"><a href="#__codelineno-94-27">27</a></span>
<span class="normal"><a href="#__codelineno-94-28">28</a></span>
<span class="normal"><a href="#__codelineno-94-29">29</a></span>
<span class="normal"><a href="#__codelineno-94-30">30</a></span>
<span class="normal"><a href="#__codelineno-94-31">31</a></span>
<span class="normal"><a href="#__codelineno-94-32">32</a></span>
<span class="normal"><a href="#__codelineno-94-33">33</a></span>
<span class="normal"><a href="#__codelineno-94-34">34</a></span>
<span class="normal"><a href="#__codelineno-94-35">35</a></span>
<span class="normal"><a href="#__codelineno-94-36">36</a></span>
<span class="normal"><a href="#__codelineno-94-37">37</a></span>
<span class="normal"><a href="#__codelineno-94-38">38</a></span>
<span class="normal"><a href="#__codelineno-94-39">39</a></span>
<span class="normal"><a href="#__codelineno-94-40">40</a></span>
<span class="normal"><a href="#__codelineno-94-41">41</a></span>
<span class="normal"><a href="#__codelineno-94-42">42</a></span>
<span class="normal"><a href="#__codelineno-94-43">43</a></span>
<span class="normal"><a href="#__codelineno-94-44">44</a></span>
<span class="normal"><a href="#__codelineno-94-45">45</a></span>
<span class="normal"><a href="#__codelineno-94-46">46</a></span>
<span class="normal"><a href="#__codelineno-94-47">47</a></span>
<span class="normal"><a href="#__codelineno-94-48">48</a></span>
<span class="normal"><a href="#__codelineno-94-49">49</a></span>
<span class="normal"><a href="#__codelineno-94-50">50</a></span>
<span class="normal"><a href="#__codelineno-94-51">51</a></span>
<span class="normal"><a href="#__codelineno-94-52">52</a></span>
<span class="normal"><a href="#__codelineno-94-53">53</a></span>
<span class="normal"><a href="#__codelineno-94-54">54</a></span>
<span class="normal"><a href="#__codelineno-94-55">55</a></span>
<span class="normal"><a href="#__codelineno-94-56">56</a></span>
<span class="normal"><a href="#__codelineno-94-57">57</a></span>
<span class="normal"><a href="#__codelineno-94-58">58</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-94-1" name="__codelineno-94-1"></a><span class="o">%%</span><span class="n">time</span>
<a id="__codelineno-94-2" name="__codelineno-94-2"></a>
<a id="__codelineno-94-3" name="__codelineno-94-3"></a><span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">set_seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<a id="__codelineno-94-4" name="__codelineno-94-4"></a>
<a id="__codelineno-94-5" name="__codelineno-94-5"></a><span class="c1"># CREATE MODEL</span>
<a id="__codelineno-94-6" name="__codelineno-94-6"></a><span class="c1"># 1. Setup N-BEATS Block layer</span>
<a id="__codelineno-94-7" name="__codelineno-94-7"></a><span class="n">nbeats_block_layer</span> <span class="o">=</span> <span class="n">NBeatsBlock</span><span class="p">(</span><span class="n">input_size</span><span class="o">=</span><span class="n">INPUT_SIZE</span><span class="p">,</span>
<a id="__codelineno-94-8" name="__codelineno-94-8"></a>                                 <span class="n">theta_size</span><span class="o">=</span><span class="n">THETA_SIZE</span><span class="p">,</span>
<a id="__codelineno-94-9" name="__codelineno-94-9"></a>                                 <span class="n">horizon</span><span class="o">=</span><span class="n">HORIZON</span><span class="p">,</span>
<a id="__codelineno-94-10" name="__codelineno-94-10"></a>                                 <span class="n">n_neurons</span><span class="o">=</span><span class="n">N_NEURONS</span><span class="p">,</span>
<a id="__codelineno-94-11" name="__codelineno-94-11"></a>                                 <span class="n">n_layers</span><span class="o">=</span><span class="n">N_LAYERS</span><span class="p">,</span>
<a id="__codelineno-94-12" name="__codelineno-94-12"></a>                                 <span class="n">name</span><span class="o">=</span><span class="s2">&quot;InitialBlock&quot;</span><span class="p">)</span>
<a id="__codelineno-94-13" name="__codelineno-94-13"></a>
<a id="__codelineno-94-14" name="__codelineno-94-14"></a><span class="c1"># 2. Create input to stacks</span>
<a id="__codelineno-94-15" name="__codelineno-94-15"></a><span class="n">stack_input</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">INPUT_SIZE</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;stack_input&quot;</span><span class="p">)</span>
<a id="__codelineno-94-16" name="__codelineno-94-16"></a>
<a id="__codelineno-94-17" name="__codelineno-94-17"></a><span class="c1"># 3. Create initial backcast and forecast input (backwards predictions are referred to as residuals in the paper)</span>
<a id="__codelineno-94-18" name="__codelineno-94-18"></a><span class="n">backcast</span><span class="p">,</span> <span class="n">forecast</span> <span class="o">=</span> <span class="n">nbeats_block_layer</span><span class="p">(</span><span class="n">stack_input</span><span class="p">)</span>
<a id="__codelineno-94-19" name="__codelineno-94-19"></a><span class="c1"># Add in subtraction residual link, thank you to: https://github.com/mrdbourke/tensorflow-deep-learning/discussions/174 </span>
<a id="__codelineno-94-20" name="__codelineno-94-20"></a><span class="n">residuals</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">subtract</span><span class="p">([</span><span class="n">stack_input</span><span class="p">,</span> <span class="n">backcast</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;subtract_00&quot;</span><span class="p">)</span> 
<a id="__codelineno-94-21" name="__codelineno-94-21"></a>
<a id="__codelineno-94-22" name="__codelineno-94-22"></a><span class="c1"># 4. Create stacks of blocks</span>
<a id="__codelineno-94-23" name="__codelineno-94-23"></a><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N_STACKS</span><span class="o">-</span><span class="mi">1</span><span class="p">)):</span> <span class="c1"># first stack is already creted in (3)</span>
<a id="__codelineno-94-24" name="__codelineno-94-24"></a>
<a id="__codelineno-94-25" name="__codelineno-94-25"></a>  <span class="c1"># 5. Use the NBeatsBlock to calculate the backcast as well as block forecast</span>
<a id="__codelineno-94-26" name="__codelineno-94-26"></a>  <span class="n">backcast</span><span class="p">,</span> <span class="n">block_forecast</span> <span class="o">=</span> <span class="n">NBeatsBlock</span><span class="p">(</span>
<a id="__codelineno-94-27" name="__codelineno-94-27"></a>      <span class="n">input_size</span><span class="o">=</span><span class="n">INPUT_SIZE</span><span class="p">,</span>
<a id="__codelineno-94-28" name="__codelineno-94-28"></a>      <span class="n">theta_size</span><span class="o">=</span><span class="n">THETA_SIZE</span><span class="p">,</span>
<a id="__codelineno-94-29" name="__codelineno-94-29"></a>      <span class="n">horizon</span><span class="o">=</span><span class="n">HORIZON</span><span class="p">,</span>
<a id="__codelineno-94-30" name="__codelineno-94-30"></a>      <span class="n">n_neurons</span><span class="o">=</span><span class="n">N_NEURONS</span><span class="p">,</span>
<a id="__codelineno-94-31" name="__codelineno-94-31"></a>      <span class="n">n_layers</span><span class="o">=</span><span class="n">N_LAYERS</span><span class="p">,</span>
<a id="__codelineno-94-32" name="__codelineno-94-32"></a>      <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;NBeatsBlock_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-94-33" name="__codelineno-94-33"></a>  <span class="p">)(</span><span class="n">residuals</span><span class="p">)</span> <span class="c1"># pass it in residuals (the backcast)</span>
<a id="__codelineno-94-34" name="__codelineno-94-34"></a>
<a id="__codelineno-94-35" name="__codelineno-94-35"></a>  <span class="c1"># 6. Create the double residual stacking</span>
<a id="__codelineno-94-36" name="__codelineno-94-36"></a>  <span class="n">residuals</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">subtract</span><span class="p">([</span><span class="n">residuals</span><span class="p">,</span> <span class="n">backcast</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;subtract_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> 
<a id="__codelineno-94-37" name="__codelineno-94-37"></a>  <span class="n">forecast</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">add</span><span class="p">([</span><span class="n">forecast</span><span class="p">,</span> <span class="n">block_forecast</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;add_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-94-38" name="__codelineno-94-38"></a>
<a id="__codelineno-94-39" name="__codelineno-94-39"></a><span class="c1"># 7. Put the stack model together</span>
<a id="__codelineno-94-40" name="__codelineno-94-40"></a><span class="n">model_7</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">stack_input</span><span class="p">,</span> 
<a id="__codelineno-94-41" name="__codelineno-94-41"></a>                         <span class="n">outputs</span><span class="o">=</span><span class="n">forecast</span><span class="p">,</span> 
<a id="__codelineno-94-42" name="__codelineno-94-42"></a>                         <span class="n">name</span><span class="o">=</span><span class="s2">&quot;model_7_N-BEATS&quot;</span><span class="p">)</span>
<a id="__codelineno-94-43" name="__codelineno-94-43"></a>
<a id="__codelineno-94-44" name="__codelineno-94-44"></a><span class="c1"># COMPILE MODEL</span>
<a id="__codelineno-94-45" name="__codelineno-94-45"></a><span class="c1"># 8. Compile with MAE loss and Adam optimizer</span>
<a id="__codelineno-94-46" name="__codelineno-94-46"></a><span class="n">model_7</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s2">&quot;mae&quot;</span><span class="p">,</span>
<a id="__codelineno-94-47" name="__codelineno-94-47"></a>                <span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="mf">0.001</span><span class="p">),</span>
<a id="__codelineno-94-48" name="__codelineno-94-48"></a>                <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mae&quot;</span><span class="p">,</span> <span class="s2">&quot;mse&quot;</span><span class="p">])</span>
<a id="__codelineno-94-49" name="__codelineno-94-49"></a>
<a id="__codelineno-94-50" name="__codelineno-94-50"></a><span class="c1"># FIT MODEL</span>
<a id="__codelineno-94-51" name="__codelineno-94-51"></a><span class="c1"># 9. Fit the model with EarlyStopping and ReduceLROnPlateau callbacks</span>
<a id="__codelineno-94-52" name="__codelineno-94-52"></a><span class="n">model_7</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">,</span>
<a id="__codelineno-94-53" name="__codelineno-94-53"></a>            <span class="n">epochs</span><span class="o">=</span><span class="n">N_EPOCHS</span><span class="p">,</span>
<a id="__codelineno-94-54" name="__codelineno-94-54"></a>            <span class="n">validation_data</span><span class="o">=</span><span class="n">test_dataset</span><span class="p">,</span>
<a id="__codelineno-94-55" name="__codelineno-94-55"></a>            <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="c1"># prevent large amounts of training outputs</span>
<a id="__codelineno-94-56" name="__codelineno-94-56"></a>            <span class="c1"># callbacks=[create_model_checkpoint(model_name=stack_model.name)] # saving model every epoch consumes far too much time</span>
<a id="__codelineno-94-57" name="__codelineno-94-57"></a>            <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">EarlyStopping</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s2">&quot;val_loss&quot;</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">restore_best_weights</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-94-58" name="__codelineno-94-58"></a>                      <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">ReduceLROnPlateau</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s2">&quot;val_loss&quot;</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)])</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Epoch 00140: ReduceLROnPlateau reducing learning rate to 0.00010000000474974513.

    Epoch 00254: ReduceLROnPlateau reducing learning rate to 1.0000000474974514e-05.

    Epoch 00354: ReduceLROnPlateau reducing learning rate to 1.0000000656873453e-06.
    CPU times: user 2min 10s, sys: 3.41 s, total: 2min 13s
    Wall time: 2min 55s
</pre>
</div>

<p><a name=""></a></p>
<h3 id="evaluate-model_7">Evaluate Model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-95-1">1</a></span>
<span class="normal"><a href="#__codelineno-95-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-95-1" name="__codelineno-95-1"></a><span class="c1"># Evaluate N-BEATS model on the test dataset</span>
<a id="__codelineno-95-2" name="__codelineno-95-2"></a><span class="n">model_7</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">test_dataset</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    1/1 [==============================] - 0s 48ms/step - loss: 581.5648 - mae: 581.5648 - mse: 1182841.7500
    [581.5648193359375, 581.5648193359375, 1182841.75]
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-96-1">1</a></span>
<span class="normal"><a href="#__codelineno-96-2">2</a></span>
<span class="normal"><a href="#__codelineno-96-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-96-1" name="__codelineno-96-1"></a><span class="c1"># Make predictions with N-BEATS model</span>
<a id="__codelineno-96-2" name="__codelineno-96-2"></a><span class="n">model_7_preds</span> <span class="o">=</span> <span class="n">make_preds</span><span class="p">(</span><span class="n">model_7</span><span class="p">,</span> <span class="n">test_dataset</span><span class="p">)</span>
<a id="__codelineno-96-3" name="__codelineno-96-3"></a><span class="n">model_7_preds</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (tf.Tensor: shape=(10,), dtype=float32, numpy=
    array([8905.162, 8848.203, 9034.956, 8775.907, 8770.039, 8783.368,
           8664.136, 8547.343, 8530.216, 8532.196], dtype=float32))
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-97-1">1</a></span>
<span class="normal"><a href="#__codelineno-97-2">2</a></span>
<span class="normal"><a href="#__codelineno-97-3">3</a></span>
<span class="normal"><a href="#__codelineno-97-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-97-1" name="__codelineno-97-1"></a><span class="c1"># Evaluate N-BEATS model predictions</span>
<a id="__codelineno-97-2" name="__codelineno-97-2"></a><span class="n">model_7_results</span> <span class="o">=</span> <span class="n">evaluate_preds</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">y_test</span><span class="p">,</span>
<a id="__codelineno-97-3" name="__codelineno-97-3"></a>                                 <span class="n">y_pred</span><span class="o">=</span><span class="n">model_7_preds</span><span class="p">)</span>
<a id="__codelineno-97-4" name="__codelineno-97-4"></a><span class="n">model_7_results</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    {'mae': 581.5648,
     'mape': 2.6964092,
     'mase': 1.0216483,
     'mse': 1182841.8,
     'rmse': 1087.5852}
</pre>
</div>

<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-98-1">1</a></span>
<span class="normal"><a href="#__codelineno-98-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-98-1" name="__codelineno-98-1"></a><span class="c1"># Plot the N-BEATS model and inspect the architecture</span>
<a id="__codelineno-98-2" name="__codelineno-98-2"></a><span class="n">plot_model</span><span class="p">(</span><span class="n">model_7</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<img alt="bitcoin-13" src="../../../images/bitcoin-13.png" /></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-99-1">1</a></span>
<span class="normal"><a href="#__codelineno-99-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-99-1" name="__codelineno-99-1"></a><span class="c1"># This will error out unless a &quot;get_config()&quot; method is implemented - this could be extra curriculum</span>
<a id="__codelineno-99-2" name="__codelineno-99-2"></a><span class="n">model_7</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">model_7</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    WARNING:absl:Found untraced functions such as theta_layer_call_fn, theta_layer_call_and_return_conditional_losses, theta_layer_call_fn, theta_layer_call_and_return_conditional_losses, theta_layer_call_fn while saving (showing 5 of 750). These functions will not be directly callable after loading.
    INFO:tensorflow:Assets written to: model_7_N-BEATS/assets
    INFO:tensorflow:Assets written to: model_7_N-BEATS/assets
    /usr/local/lib/python3.7/dist-packages/keras/engine/functional.py:1410: CustomMaskWarning: Custom mask layers require a config and must override get_config. When loading, the custom mask layer must be passed to the custom_objects argument.
      layer_config = serialize_layer_fn(layer)
    /usr/local/lib/python3.7/dist-packages/keras/saving/saved_model/layer_serialization.py:112: CustomMaskWarning: Custom mask layers require a config and must override get_config. When loading, the custom mask layer must be passed to the custom_objects argument.
      return generic_utils.serialize_keras_object(obj)
</pre>
</div>

<p><a name="model-8"></a></p>
<h2 id="model-8-stacking-models"><strong>Model 8: Stacking Models</strong></h2>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-100-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-100-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-100-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-100-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-100-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-100-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-100-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-100-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-100-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-100-10">10</a></span>
<span class="normal"><a href="#__codelineno-100-11">11</a></span>
<span class="normal"><a href="#__codelineno-100-12">12</a></span>
<span class="normal"><a href="#__codelineno-100-13">13</a></span>
<span class="normal"><a href="#__codelineno-100-14">14</a></span>
<span class="normal"><a href="#__codelineno-100-15">15</a></span>
<span class="normal"><a href="#__codelineno-100-16">16</a></span>
<span class="normal"><a href="#__codelineno-100-17">17</a></span>
<span class="normal"><a href="#__codelineno-100-18">18</a></span>
<span class="normal"><a href="#__codelineno-100-19">19</a></span>
<span class="normal"><a href="#__codelineno-100-20">20</a></span>
<span class="normal"><a href="#__codelineno-100-21">21</a></span>
<span class="normal"><a href="#__codelineno-100-22">22</a></span>
<span class="normal"><a href="#__codelineno-100-23">23</a></span>
<span class="normal"><a href="#__codelineno-100-24">24</a></span>
<span class="normal"><a href="#__codelineno-100-25">25</a></span>
<span class="normal"><a href="#__codelineno-100-26">26</a></span>
<span class="normal"><a href="#__codelineno-100-27">27</a></span>
<span class="normal"><a href="#__codelineno-100-28">28</a></span>
<span class="normal"><a href="#__codelineno-100-29">29</a></span>
<span class="normal"><a href="#__codelineno-100-30">30</a></span>
<span class="normal"><a href="#__codelineno-100-31">31</a></span>
<span class="normal"><a href="#__codelineno-100-32">32</a></span>
<span class="normal"><a href="#__codelineno-100-33">33</a></span>
<span class="normal"><a href="#__codelineno-100-34">34</a></span>
<span class="normal"><a href="#__codelineno-100-35">35</a></span>
<span class="normal"><a href="#__codelineno-100-36">36</a></span>
<span class="normal"><a href="#__codelineno-100-37">37</a></span>
<span class="normal"><a href="#__codelineno-100-38">38</a></span>
<span class="normal"><a href="#__codelineno-100-39">39</a></span>
<span class="normal"><a href="#__codelineno-100-40">40</a></span>
<span class="normal"><a href="#__codelineno-100-41">41</a></span>
<span class="normal"><a href="#__codelineno-100-42">42</a></span>
<span class="normal"><a href="#__codelineno-100-43">43</a></span>
<span class="normal"><a href="#__codelineno-100-44">44</a></span>
<span class="normal"><a href="#__codelineno-100-45">45</a></span>
<span class="normal"><a href="#__codelineno-100-46">46</a></span>
<span class="normal"><a href="#__codelineno-100-47">47</a></span>
<span class="normal"><a href="#__codelineno-100-48">48</a></span>
<span class="normal"><a href="#__codelineno-100-49">49</a></span>
<span class="normal"><a href="#__codelineno-100-50">50</a></span>
<span class="normal"><a href="#__codelineno-100-51">51</a></span>
<span class="normal"><a href="#__codelineno-100-52">52</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-100-1" name="__codelineno-100-1"></a><span class="k">def</span> <span class="nf">get_ensemble_models</span><span class="p">(</span><span class="n">horizon</span><span class="o">=</span><span class="n">HORIZON</span><span class="p">,</span> 
<a id="__codelineno-100-2" name="__codelineno-100-2"></a>                        <span class="n">train_data</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span>
<a id="__codelineno-100-3" name="__codelineno-100-3"></a>                        <span class="n">test_data</span><span class="o">=</span><span class="n">test_dataset</span><span class="p">,</span>
<a id="__codelineno-100-4" name="__codelineno-100-4"></a>                        <span class="n">num_iter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> 
<a id="__codelineno-100-5" name="__codelineno-100-5"></a>                        <span class="n">num_epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> 
<a id="__codelineno-100-6" name="__codelineno-100-6"></a>                        <span class="n">loss_fns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mae&quot;</span><span class="p">,</span> <span class="s2">&quot;mse&quot;</span><span class="p">,</span> <span class="s2">&quot;mape&quot;</span><span class="p">]):</span>
<a id="__codelineno-100-7" name="__codelineno-100-7"></a>  <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-100-8" name="__codelineno-100-8"></a><span class="sd">  Returns a list of num_iter models each trained on MAE, MSE and MAPE loss.</span>
<a id="__codelineno-100-9" name="__codelineno-100-9"></a>
<a id="__codelineno-100-10" name="__codelineno-100-10"></a><span class="sd">  For example, if num_iter=10, a list of 30 trained models will be returned:</span>
<a id="__codelineno-100-11" name="__codelineno-100-11"></a><span class="sd">  10 * len([&quot;mae&quot;, &quot;mse&quot;, &quot;mape&quot;]).</span>
<a id="__codelineno-100-12" name="__codelineno-100-12"></a><span class="sd">  &quot;&quot;&quot;</span>
<a id="__codelineno-100-13" name="__codelineno-100-13"></a>  <span class="c1"># Make empty list for trained ensemble models</span>
<a id="__codelineno-100-14" name="__codelineno-100-14"></a>  <span class="n">ensemble_models</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-100-15" name="__codelineno-100-15"></a>
<a id="__codelineno-100-16" name="__codelineno-100-16"></a>  <span class="c1"># Create num_iter number of models per loss function</span>
<a id="__codelineno-100-17" name="__codelineno-100-17"></a>  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_iter</span><span class="p">):</span>
<a id="__codelineno-100-18" name="__codelineno-100-18"></a>    <span class="c1"># Build and fit a new model with a different loss function</span>
<a id="__codelineno-100-19" name="__codelineno-100-19"></a>    <span class="k">for</span> <span class="n">loss_function</span> <span class="ow">in</span> <span class="n">loss_fns</span><span class="p">:</span>
<a id="__codelineno-100-20" name="__codelineno-100-20"></a>      <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Optimizing model by reducing: </span><span class="si">{</span><span class="n">loss_function</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">num_epochs</span><span class="si">}</span><span class="s2"> epochs, model number: </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-100-21" name="__codelineno-100-21"></a>
<a id="__codelineno-100-22" name="__codelineno-100-22"></a>      <span class="c1"># Construct a simple model (similar to model_1)</span>
<a id="__codelineno-100-23" name="__codelineno-100-23"></a>      <span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
<a id="__codelineno-100-24" name="__codelineno-100-24"></a>        <span class="c1"># Initialize layers with normal (Gaussian) distribution so we can use the models for prediction</span>
<a id="__codelineno-100-25" name="__codelineno-100-25"></a>        <span class="c1"># interval estimation later: https://www.tensorflow.org/api_docs/python/tf/keras/initializers/HeNormal</span>
<a id="__codelineno-100-26" name="__codelineno-100-26"></a>        <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">kernel_initializer</span><span class="o">=</span><span class="s2">&quot;he_normal&quot;</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;relu&quot;</span><span class="p">),</span> 
<a id="__codelineno-100-27" name="__codelineno-100-27"></a>        <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">kernel_initializer</span><span class="o">=</span><span class="s2">&quot;he_normal&quot;</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;relu&quot;</span><span class="p">),</span>
<a id="__codelineno-100-28" name="__codelineno-100-28"></a>        <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">HORIZON</span><span class="p">)</span>                                 
<a id="__codelineno-100-29" name="__codelineno-100-29"></a>      <span class="p">])</span>
<a id="__codelineno-100-30" name="__codelineno-100-30"></a>
<a id="__codelineno-100-31" name="__codelineno-100-31"></a>      <span class="c1"># Compile simple model with current loss function</span>
<a id="__codelineno-100-32" name="__codelineno-100-32"></a>      <span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="n">loss_function</span><span class="p">,</span>
<a id="__codelineno-100-33" name="__codelineno-100-33"></a>                    <span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(),</span>
<a id="__codelineno-100-34" name="__codelineno-100-34"></a>                    <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mae&quot;</span><span class="p">,</span> <span class="s2">&quot;mse&quot;</span><span class="p">])</span>
<a id="__codelineno-100-35" name="__codelineno-100-35"></a>
<a id="__codelineno-100-36" name="__codelineno-100-36"></a>      <span class="c1"># Fit model</span>
<a id="__codelineno-100-37" name="__codelineno-100-37"></a>      <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span>
<a id="__codelineno-100-38" name="__codelineno-100-38"></a>                <span class="n">epochs</span><span class="o">=</span><span class="n">num_epochs</span><span class="p">,</span>
<a id="__codelineno-100-39" name="__codelineno-100-39"></a>                <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-100-40" name="__codelineno-100-40"></a>                <span class="n">validation_data</span><span class="o">=</span><span class="n">test_data</span><span class="p">,</span>
<a id="__codelineno-100-41" name="__codelineno-100-41"></a>                <span class="c1"># Add callbacks to prevent training from going/stalling for too long</span>
<a id="__codelineno-100-42" name="__codelineno-100-42"></a>                <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">EarlyStopping</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s2">&quot;val_loss&quot;</span><span class="p">,</span>
<a id="__codelineno-100-43" name="__codelineno-100-43"></a>                                                            <span class="n">patience</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
<a id="__codelineno-100-44" name="__codelineno-100-44"></a>                                                            <span class="n">restore_best_weights</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-100-45" name="__codelineno-100-45"></a>                           <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">ReduceLROnPlateau</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s2">&quot;val_loss&quot;</span><span class="p">,</span>
<a id="__codelineno-100-46" name="__codelineno-100-46"></a>                                                                <span class="n">patience</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-100-47" name="__codelineno-100-47"></a>                                                                <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)])</span>
<a id="__codelineno-100-48" name="__codelineno-100-48"></a>
<a id="__codelineno-100-49" name="__codelineno-100-49"></a>      <span class="c1"># Append fitted model to list of ensemble models</span>
<a id="__codelineno-100-50" name="__codelineno-100-50"></a>      <span class="n">ensemble_models</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<a id="__codelineno-100-51" name="__codelineno-100-51"></a>
<a id="__codelineno-100-52" name="__codelineno-100-52"></a>  <span class="k">return</span> <span class="n">ensemble_models</span> <span class="c1"># return list of trained models</span>
</code></pre></div>
</td></tr></table>
<p><a name=""></a></p>
<h3 id="create-compile-and-fit-model_8">Create, Compile, and Fit Model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-101-1">1</a></span>
<span class="normal"><a href="#__codelineno-101-2">2</a></span>
<span class="normal"><a href="#__codelineno-101-3">3</a></span>
<span class="normal"><a href="#__codelineno-101-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-101-1" name="__codelineno-101-1"></a><span class="o">%%</span><span class="n">time</span>
<a id="__codelineno-101-2" name="__codelineno-101-2"></a><span class="c1"># Get list of trained ensemble models</span>
<a id="__codelineno-101-3" name="__codelineno-101-3"></a><span class="n">ensemble_models</span> <span class="o">=</span> <span class="n">get_ensemble_models</span><span class="p">(</span><span class="n">num_iter</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-101-4" name="__codelineno-101-4"></a>                                      <span class="n">num_epochs</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Optimizing model by reducing: mae for 1000 epochs, model number: 0

    Epoch 00914: ReduceLROnPlateau reducing learning rate to 0.00010000000474974513.
    Optimizing model by reducing: mse for 1000 epochs, model number: 0

    Epoch 00543: ReduceLROnPlateau reducing learning rate to 0.00010000000474974513.

    Epoch 00643: ReduceLROnPlateau reducing learning rate to 1.0000000474974514e-05.
    Optimizing model by reducing: mape for 1000 epochs, model number: 0

    Epoch 00165: ReduceLROnPlateau reducing learning rate to 0.00010000000474974513.

    Epoch 00282: ReduceLROnPlateau reducing learning rate to 1.0000000474974514e-05.

    Epoch 00382: ReduceLROnPlateau reducing learning rate to 1.0000000656873453e-06.
    Optimizing model by reducing: mae for 1000 epochs, model number: 1
    Optimizing model by reducing: mse for 1000 epochs, model number: 1

    Epoch 00363: ReduceLROnPlateau reducing learning rate to 0.00010000000474974513.

    Epoch 00463: ReduceLROnPlateau reducing learning rate to 1.0000000474974514e-05.
    Optimizing model by reducing: mape for 1000 epochs, model number: 1

    Epoch 00185: ReduceLROnPlateau reducing learning rate to 0.00010000000474974513.

    Epoch 00734: ReduceLROnPlateau reducing learning rate to 1.0000000474974514e-05.

    Epoch 00834: ReduceLROnPlateau reducing learning rate to 1.0000000656873453e-06.
    Optimizing model by reducing: mae for 1000 epochs, model number: 2
    Optimizing model by reducing: mse for 1000 epochs, model number: 2
    Optimizing model by reducing: mape for 1000 epochs, model number: 2

    Epoch 00241: ReduceLROnPlateau reducing learning rate to 0.00010000000474974513.

    Epoch 00341: ReduceLROnPlateau reducing learning rate to 1.0000000474974514e-05.
    Optimizing model by reducing: mae for 1000 epochs, model number: 3

    Epoch 00572: ReduceLROnPlateau reducing learning rate to 0.00010000000474974513.
    Optimizing model by reducing: mse for 1000 epochs, model number: 3

    Epoch 00304: ReduceLROnPlateau reducing learning rate to 0.00010000000474974513.

    Epoch 00630: ReduceLROnPlateau reducing learning rate to 1.0000000474974514e-05.

    Epoch 00730: ReduceLROnPlateau reducing learning rate to 1.0000000656873453e-06.
    Optimizing model by reducing: mape for 1000 epochs, model number: 3

    Epoch 00361: ReduceLROnPlateau reducing learning rate to 0.00010000000474974513.

    Epoch 00461: ReduceLROnPlateau reducing learning rate to 1.0000000474974514e-05.
    Optimizing model by reducing: mae for 1000 epochs, model number: 4
    Optimizing model by reducing: mse for 1000 epochs, model number: 4

    Epoch 00664: ReduceLROnPlateau reducing learning rate to 0.00010000000474974513.

    Epoch 00764: ReduceLROnPlateau reducing learning rate to 1.0000000474974514e-05.
    Optimizing model by reducing: mape for 1000 epochs, model number: 4

    Epoch 00132: ReduceLROnPlateau reducing learning rate to 0.00010000000474974513.

    Epoch 00609: ReduceLROnPlateau reducing learning rate to 1.0000000474974514e-05.

    Epoch 00709: ReduceLROnPlateau reducing learning rate to 1.0000000656873453e-06.
    CPU times: user 7min 14s, sys: 47.6 s, total: 8min 2s
    Wall time: 7min 15s
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-102-1">1</a></span>
<span class="normal"><a href="#__codelineno-102-2">2</a></span>
<span class="normal"><a href="#__codelineno-102-3">3</a></span>
<span class="normal"><a href="#__codelineno-102-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-102-1" name="__codelineno-102-1"></a><span class="c1"># Create a list of ensemble predictions</span>
<a id="__codelineno-102-2" name="__codelineno-102-2"></a><span class="n">ensemble_preds</span> <span class="o">=</span> <span class="n">make_ensemble_preds</span><span class="p">(</span><span class="n">ensemble_models</span><span class="o">=</span><span class="n">ensemble_models</span><span class="p">,</span>
<a id="__codelineno-102-3" name="__codelineno-102-3"></a>                                     <span class="n">data</span><span class="o">=</span><span class="n">test_dataset</span><span class="p">)</span>
<a id="__codelineno-102-4" name="__codelineno-102-4"></a><span class="n">ensemble_preds</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    WARNING:tensorflow:5 out of the last 22 calls to (function Model.make_predict_function.(locals).predict_function at 0x7f12f03445f0) triggered tf.function retracing. Tracing is expensive and the excessive number of tracings could be due to (1) creating @tf.function repeatedly in a loop, (2) passing tensors with different shapes, (3) passing Python objects instead of tensors. For (1), please define your @tf.function outside of the loop. For (2), @tf.function has experimental_relax_shapes=True option that relaxes argument shapes that can avoid unnecessary retracing. For (3), please refer to https://www.tensorflow.org/guide/function#controlling_retracing and https://www.tensorflow.org/api_docs/python/tf/function for  more details.
    WARNING:tensorflow:5 out of the last 22 calls to (function Model.make_predict_function.(locals).predict_function at 0x7f12f03445f0) triggered tf.function retracing. Tracing is expensive and the excessive number of tracings could be due to (1) creating @tf.function repeatedly in a loop, (2) passing tensors with different shapes, (3) passing Python objects instead of tensors. For (1), please define your @tf.function outside of the loop. For (2), @tf.function has experimental_relax_shapes=True option that relaxes argument shapes that can avoid unnecessary retracing. For (3), please refer to https://www.tensorflow.org/guide/function#controlling_retracing and https://www.tensorflow.org/api_docs/python/tf/function for  more details.
    WARNING:tensorflow:6 out of the last 23 calls to (function Model.make_predict_function.(locals).predict_function at 0x7f12ee85b8c0) triggered tf.function retracing. Tracing is expensive and the excessive number of tracings could be due to (1) creating @tf.function repeatedly in a loop, (2) passing tensors with different shapes, (3) passing Python objects instead of tensors. For (1), please define your @tf.function outside of the loop. For (2), @tf.function has experimental_relax_shapes=True option that relaxes argument shapes that can avoid unnecessary retracing. For (3), please refer to https://www.tensorflow.org/guide/function#controlling_retracing and https://www.tensorflow.org/api_docs/python/tf/function for  more details.
    WARNING:tensorflow:6 out of the last 23 calls to (function Model.make_predict_function.(locals).predict_function at 0x7f12ee85b8c0) triggered tf.function retracing. Tracing is expensive and the excessive number of tracings could be due to (1) creating @tf.function repeatedly in a loop, (2) passing tensors with different shapes, (3) passing Python objects instead of tensors. For (1), please define your @tf.function outside of the loop. For (2), @tf.function has experimental_relax_shapes=True option that relaxes argument shapes that can avoid unnecessary retracing. For (3), please refer to https://www.tensorflow.org/guide/function#controlling_retracing and https://www.tensorflow.org/api_docs/python/tf/function for  more details.
    (tf.Tensor: shape=(15, 556), dtype=float32, numpy=
    array([[ 8799.819 ,  8771.819 ,  9029.219 , ..., 50179.406 , 49325.07  ,
            46711.64  ],
           [ 8789.308 ,  8752.389 ,  8970.732 , ..., 48968.97  , 48611.848 ,
            45442.113 ],
           [ 8732.57  ,  8719.407 ,  9093.386 , ..., 49921.9   , 47992.15  ,
            45316.45  ],
           ...,
           [ 8981.218 ,  8810.332 ,  9078.1045, ..., 49631.82  , 49910.02  ,
            46702.625 ],
           [ 8723.272 ,  8802.165 ,  9096.934 , ..., 49560.195 , 48494.336 ,
            45048.293 ],
           [ 8823.311 ,  8768.297 ,  9047.492 , ..., 49759.902 , 48090.945 ,
            45874.336 ]], dtype=float32))
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-103-1">1</a></span>
<span class="normal"><a href="#__codelineno-103-2">2</a></span>
<span class="normal"><a href="#__codelineno-103-3">3</a></span>
<span class="normal"><a href="#__codelineno-103-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-103-1" name="__codelineno-103-1"></a><span class="c1"># Evaluate ensemble model(s) predictions</span>
<a id="__codelineno-103-2" name="__codelineno-103-2"></a><span class="n">ensemble_results</span> <span class="o">=</span> <span class="n">evaluate_preds</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">y_test</span><span class="p">,</span>
<a id="__codelineno-103-3" name="__codelineno-103-3"></a>                                  <span class="n">y_pred</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">ensemble_preds</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span> <span class="c1"># take the median across all ensemble predictions</span>
<a id="__codelineno-103-4" name="__codelineno-103-4"></a><span class="n">ensemble_results</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    {'mae': 566.2171,
     'mape': 2.5761204,
     'mase': 0.9946866,
     'mse': 1137210.1,
     'rmse': 1066.4005}
</pre>
</div>

<p><a name=""></a></p>
<h3 id="evaluate-model_8">Evaluate Model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-104-1">1</a></span>
<span class="normal"><a href="#__codelineno-104-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-104-1" name="__codelineno-104-1"></a><span class="c1"># Get the upper and lower bounds of the 95% </span>
<a id="__codelineno-104-2" name="__codelineno-104-2"></a><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">get_upper_lower</span><span class="p">(</span><span class="n">preds</span><span class="o">=</span><span class="n">ensemble_preds</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-105-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-105-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-105-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-105-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-105-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-105-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-105-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-105-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-105-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-105-10">10</a></span>
<span class="normal"><a href="#__codelineno-105-11">11</a></span>
<span class="normal"><a href="#__codelineno-105-12">12</a></span>
<span class="normal"><a href="#__codelineno-105-13">13</a></span>
<span class="normal"><a href="#__codelineno-105-14">14</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-105-1" name="__codelineno-105-1"></a><span class="c1"># Get the median values of our ensemble preds</span>
<a id="__codelineno-105-2" name="__codelineno-105-2"></a><span class="n">ensemble_median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">ensemble_preds</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-105-3" name="__codelineno-105-3"></a>
<a id="__codelineno-105-4" name="__codelineno-105-4"></a><span class="c1"># Plot the median of our ensemble preds along with the prediction intervals (where the predictions fall between)</span>
<a id="__codelineno-105-5" name="__codelineno-105-5"></a><span class="n">offset</span><span class="o">=</span><span class="mi">500</span>
<a id="__codelineno-105-6" name="__codelineno-105-6"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<a id="__codelineno-105-7" name="__codelineno-105-7"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X_test</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">offset</span><span class="p">:],</span> <span class="n">y_test</span><span class="p">[</span><span class="n">offset</span><span class="p">:],</span> <span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test Data&quot;</span><span class="p">)</span>
<a id="__codelineno-105-8" name="__codelineno-105-8"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X_test</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">offset</span><span class="p">:],</span> <span class="n">ensemble_median</span><span class="p">[</span><span class="n">offset</span><span class="p">:],</span> <span class="s2">&quot;k-&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Ensemble Median&quot;</span><span class="p">)</span>
<a id="__codelineno-105-9" name="__codelineno-105-9"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Date&quot;</span><span class="p">)</span>
<a id="__codelineno-105-10" name="__codelineno-105-10"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;BTC Price&quot;</span><span class="p">)</span>
<a id="__codelineno-105-11" name="__codelineno-105-11"></a><span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">X_test</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">offset</span><span class="p">:],</span> 
<a id="__codelineno-105-12" name="__codelineno-105-12"></a>                 <span class="p">(</span><span class="n">lower</span><span class="p">)[</span><span class="n">offset</span><span class="p">:],</span> 
<a id="__codelineno-105-13" name="__codelineno-105-13"></a>                 <span class="p">(</span><span class="n">upper</span><span class="p">)[</span><span class="n">offset</span><span class="p">:],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Prediction Intervals&quot;</span><span class="p">)</span>
<a id="__codelineno-105-14" name="__codelineno-105-14"></a><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
</code></pre></div>
</td></tr></table>
<img alt="bitcoin-14" src="../../../images/bitcoin-14.png" /></p>
<p><a name="model-9"></a></p>
<h2 id="model-9-full-history"><strong>Model 9: Full History</strong></h2>
<p><a name=""></a></p>
<h3 id="prepare-data_6">Prepare Data</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-106-1">1</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-106-1" name="__codelineno-106-1"></a><span class="n">bitcoin_prices_windowed</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
                Price       block_reward    Price+1     Price+2     Price+3     Price+4     Price+5     Price+6     Price+7
    Date                                    
    2013-10-01  123.65499           25      NaN         NaN         NaN         NaN         NaN         NaN         NaN
    2013-10-02  125.45500           25      123.65499   NaN         NaN         NaN         NaN         NaN         NaN
    2013-10-03  108.58483           25      125.45500   123.65499   NaN         NaN         NaN         NaN         NaN
    2013-10-04  118.67466           25      108.58483   125.45500   123.65499   NaN         NaN         NaN         NaN
    2013-10-05  121.33866           25      118.67466   108.58483   125.45500   123.65499   NaN         NaN         NaN
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-107-1">1</a></span>
<span class="normal"><a href="#__codelineno-107-2">2</a></span>
<span class="normal"><a href="#__codelineno-107-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-107-1" name="__codelineno-107-1"></a><span class="c1"># Train model on entire data to make prediction for the next day </span>
<a id="__codelineno-107-2" name="__codelineno-107-2"></a><span class="n">X_all</span> <span class="o">=</span> <span class="n">bitcoin_prices_windowed</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;Price&quot;</span><span class="p">,</span> <span class="s2">&quot;block_reward&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span> <span class="c1"># only want prices, our future model can be a univariate model</span>
<a id="__codelineno-107-3" name="__codelineno-107-3"></a><span class="n">y_all</span> <span class="o">=</span> <span class="n">bitcoin_prices_windowed</span><span class="o">.</span><span class="n">dropna</span><span class="p">()[</span><span class="s2">&quot;Price&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-108-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-108-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-108-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-108-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-108-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-108-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-108-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-108-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-108-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-108-10">10</a></span>
<span class="normal"><a href="#__codelineno-108-11">11</a></span>
<span class="normal"><a href="#__codelineno-108-12">12</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-108-1" name="__codelineno-108-1"></a><span class="c1"># 1. Turn X and y into tensor Datasets</span>
<a id="__codelineno-108-2" name="__codelineno-108-2"></a><span class="n">features_dataset_all</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_tensor_slices</span><span class="p">(</span><span class="n">X_all</span><span class="p">)</span>
<a id="__codelineno-108-3" name="__codelineno-108-3"></a><span class="n">labels_dataset_all</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_tensor_slices</span><span class="p">(</span><span class="n">y_all</span><span class="p">)</span>
<a id="__codelineno-108-4" name="__codelineno-108-4"></a>
<a id="__codelineno-108-5" name="__codelineno-108-5"></a><span class="c1"># 2. Combine features &amp; labels</span>
<a id="__codelineno-108-6" name="__codelineno-108-6"></a><span class="n">dataset_all</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">zip</span><span class="p">((</span><span class="n">features_dataset_all</span><span class="p">,</span> <span class="n">labels_dataset_all</span><span class="p">))</span>
<a id="__codelineno-108-7" name="__codelineno-108-7"></a>
<a id="__codelineno-108-8" name="__codelineno-108-8"></a><span class="c1"># 3. Batch and prefetch for optimal performance</span>
<a id="__codelineno-108-9" name="__codelineno-108-9"></a><span class="n">BATCH_SIZE</span> <span class="o">=</span> <span class="mi">1024</span> <span class="c1"># taken from Appendix D in N-BEATS paper</span>
<a id="__codelineno-108-10" name="__codelineno-108-10"></a><span class="n">dataset_all</span> <span class="o">=</span> <span class="n">dataset_all</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="n">BATCH_SIZE</span><span class="p">)</span><span class="o">.</span><span class="n">prefetch</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">AUTOTUNE</span><span class="p">)</span>
<a id="__codelineno-108-11" name="__codelineno-108-11"></a>
<a id="__codelineno-108-12" name="__codelineno-108-12"></a><span class="n">dataset_all</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (PrefetchDataset shapes: ((None, 7), (None,)), types: (tf.float64, tf.float64))
</pre>
</div>

<p><a name=""></a></p>
<h3 id="create-compile-and-fit-model_9">Create, Compile, and Fit Model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-109-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-109-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-109-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-109-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-109-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-109-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-109-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-109-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-109-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-109-10">10</a></span>
<span class="normal"><a href="#__codelineno-109-11">11</a></span>
<span class="normal"><a href="#__codelineno-109-12">12</a></span>
<span class="normal"><a href="#__codelineno-109-13">13</a></span>
<span class="normal"><a href="#__codelineno-109-14">14</a></span>
<span class="normal"><a href="#__codelineno-109-15">15</a></span>
<span class="normal"><a href="#__codelineno-109-16">16</a></span>
<span class="normal"><a href="#__codelineno-109-17">17</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-109-1" name="__codelineno-109-1"></a><span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">set_seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<a id="__codelineno-109-2" name="__codelineno-109-2"></a>
<a id="__codelineno-109-3" name="__codelineno-109-3"></a><span class="c1"># Create model (nice and simple, just to test)</span>
<a id="__codelineno-109-4" name="__codelineno-109-4"></a><span class="n">model_9</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
<a id="__codelineno-109-5" name="__codelineno-109-5"></a>  <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;relu&quot;</span><span class="p">),</span>
<a id="__codelineno-109-6" name="__codelineno-109-6"></a>  <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;relu&quot;</span><span class="p">),</span>
<a id="__codelineno-109-7" name="__codelineno-109-7"></a>  <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">HORIZON</span><span class="p">)</span>
<a id="__codelineno-109-8" name="__codelineno-109-8"></a><span class="p">])</span>
<a id="__codelineno-109-9" name="__codelineno-109-9"></a>
<a id="__codelineno-109-10" name="__codelineno-109-10"></a><span class="c1"># Compile</span>
<a id="__codelineno-109-11" name="__codelineno-109-11"></a><span class="n">model_9</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">mae</span><span class="p">,</span>
<a id="__codelineno-109-12" name="__codelineno-109-12"></a>                <span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">())</span>
<a id="__codelineno-109-13" name="__codelineno-109-13"></a>
<a id="__codelineno-109-14" name="__codelineno-109-14"></a><span class="c1"># Fit model on all of the data to make future forecasts</span>
<a id="__codelineno-109-15" name="__codelineno-109-15"></a><span class="n">model_9</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">dataset_all</span><span class="p">,</span>
<a id="__codelineno-109-16" name="__codelineno-109-16"></a>            <span class="n">epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-109-17" name="__codelineno-109-17"></a>            <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># don&#39;t print out anything, we&#39;ve seen this all before</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (keras.callbacks.History at 0x7f12ed032b50)
</pre>
</div>

<p><a name=""></a></p>
<h3 id="evaluate-model_9">Evaluate Model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-110-1">1</a></span>
<span class="normal"><a href="#__codelineno-110-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-110-1" name="__codelineno-110-1"></a><span class="c1"># How many timesteps to predict into the future?</span>
<a id="__codelineno-110-2" name="__codelineno-110-2"></a><span class="n">INTO_FUTURE</span> <span class="o">=</span> <span class="mi">14</span> <span class="c1"># since our Bitcoin data is daily, this is for 14 days</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-111-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-111-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-111-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-111-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-111-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-111-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-111-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-111-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-111-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-111-10">10</a></span>
<span class="normal"><a href="#__codelineno-111-11">11</a></span>
<span class="normal"><a href="#__codelineno-111-12">12</a></span>
<span class="normal"><a href="#__codelineno-111-13">13</a></span>
<span class="normal"><a href="#__codelineno-111-14">14</a></span>
<span class="normal"><a href="#__codelineno-111-15">15</a></span>
<span class="normal"><a href="#__codelineno-111-16">16</a></span>
<span class="normal"><a href="#__codelineno-111-17">17</a></span>
<span class="normal"><a href="#__codelineno-111-18">18</a></span>
<span class="normal"><a href="#__codelineno-111-19">19</a></span>
<span class="normal"><a href="#__codelineno-111-20">20</a></span>
<span class="normal"><a href="#__codelineno-111-21">21</a></span>
<span class="normal"><a href="#__codelineno-111-22">22</a></span>
<span class="normal"><a href="#__codelineno-111-23">23</a></span>
<span class="normal"><a href="#__codelineno-111-24">24</a></span>
<span class="normal"><a href="#__codelineno-111-25">25</a></span>
<span class="normal"><a href="#__codelineno-111-26">26</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-111-1" name="__codelineno-111-1"></a><span class="c1"># 1. Create function to make predictions into the future</span>
<a id="__codelineno-111-2" name="__codelineno-111-2"></a><span class="k">def</span> <span class="nf">make_future_forecast</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">into_future</span><span class="p">,</span> <span class="n">window_size</span><span class="o">=</span><span class="n">WINDOW_SIZE</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<a id="__codelineno-111-3" name="__codelineno-111-3"></a>  <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-111-4" name="__codelineno-111-4"></a><span class="sd">  Makes future forecasts into_future steps after values ends.</span>
<a id="__codelineno-111-5" name="__codelineno-111-5"></a>
<a id="__codelineno-111-6" name="__codelineno-111-6"></a><span class="sd">  Returns future forecasts as list of floats.</span>
<a id="__codelineno-111-7" name="__codelineno-111-7"></a><span class="sd">  &quot;&quot;&quot;</span>
<a id="__codelineno-111-8" name="__codelineno-111-8"></a>  <span class="c1"># 2. Make an empty list for future forecasts/prepare data to forecast on</span>
<a id="__codelineno-111-9" name="__codelineno-111-9"></a>  <span class="n">future_forecast</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-111-10" name="__codelineno-111-10"></a>  <span class="n">last_window</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="n">WINDOW_SIZE</span><span class="p">:]</span> <span class="c1"># only want preds from the last window (this will get updated)</span>
<a id="__codelineno-111-11" name="__codelineno-111-11"></a>
<a id="__codelineno-111-12" name="__codelineno-111-12"></a>  <span class="c1"># 3. Make INTO_FUTURE number of predictions, altering the data which gets predicted on each time </span>
<a id="__codelineno-111-13" name="__codelineno-111-13"></a>  <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">into_future</span><span class="p">):</span>
<a id="__codelineno-111-14" name="__codelineno-111-14"></a>
<a id="__codelineno-111-15" name="__codelineno-111-15"></a>    <span class="c1"># Predict on last window then append it again, again, again (model starts to make forecasts on its own forecasts)</span>
<a id="__codelineno-111-16" name="__codelineno-111-16"></a>    <span class="n">future_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">last_window</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<a id="__codelineno-111-17" name="__codelineno-111-17"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Predicting on: </span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">last_window</span><span class="si">}</span><span class="s2"> -&gt; Prediction: </span><span class="si">{</span><span class="n">tf</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">future_pred</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-111-18" name="__codelineno-111-18"></a>
<a id="__codelineno-111-19" name="__codelineno-111-19"></a>    <span class="c1"># Append predictions to future_forecast</span>
<a id="__codelineno-111-20" name="__codelineno-111-20"></a>    <span class="n">future_forecast</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">future_pred</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
<a id="__codelineno-111-21" name="__codelineno-111-21"></a>    <span class="c1"># print(future_forecast)</span>
<a id="__codelineno-111-22" name="__codelineno-111-22"></a>
<a id="__codelineno-111-23" name="__codelineno-111-23"></a>    <span class="c1"># Update last window with new pred and get WINDOW_SIZE most recent preds (model was trained on WINDOW_SIZE windows)</span>
<a id="__codelineno-111-24" name="__codelineno-111-24"></a>    <span class="n">last_window</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">last_window</span><span class="p">,</span> <span class="n">future_pred</span><span class="p">)[</span><span class="o">-</span><span class="n">WINDOW_SIZE</span><span class="p">:]</span>
<a id="__codelineno-111-25" name="__codelineno-111-25"></a>
<a id="__codelineno-111-26" name="__codelineno-111-26"></a>  <span class="k">return</span> <span class="n">future_forecast</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-112-1">1</a></span>
<span class="normal"><a href="#__codelineno-112-2">2</a></span>
<span class="normal"><a href="#__codelineno-112-3">3</a></span>
<span class="normal"><a href="#__codelineno-112-4">4</a></span>
<span class="normal"><a href="#__codelineno-112-5">5</a></span>
<span class="normal"><a href="#__codelineno-112-6">6</a></span>
<span class="normal"><a href="#__codelineno-112-7">7</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-112-1" name="__codelineno-112-1"></a><span class="c1"># Make forecasts into future of the price of Bitcoin</span>
<a id="__codelineno-112-2" name="__codelineno-112-2"></a><span class="c1"># Note: if you&#39;re reading this at a later date, you may already be in the future, so the forecasts </span>
<a id="__codelineno-112-3" name="__codelineno-112-3"></a><span class="c1"># we&#39;re making may not actually be forecasts, if that&#39;s the case, readjust the training data.</span>
<a id="__codelineno-112-4" name="__codelineno-112-4"></a><span class="n">future_forecast</span> <span class="o">=</span> <span class="n">make_future_forecast</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="n">y_all</span><span class="p">,</span>
<a id="__codelineno-112-5" name="__codelineno-112-5"></a>                                       <span class="n">model</span><span class="o">=</span><span class="n">model_9</span><span class="p">,</span>
<a id="__codelineno-112-6" name="__codelineno-112-6"></a>                                       <span class="n">into_future</span><span class="o">=</span><span class="n">INTO_FUTURE</span><span class="p">,</span>
<a id="__codelineno-112-7" name="__codelineno-112-7"></a>                                       <span class="n">window_size</span><span class="o">=</span><span class="n">WINDOW_SIZE</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
Predicting on: 
     [56573.5554719  52147.82118698 49764.1320816  50032.69313676
     47885.62525472 45604.61575361 43144.47129086] -> Prediction: 55764.46484375

    Predicting on: 
     [52147.82118698 49764.1320816  50032.69313676 47885.62525472
     45604.61575361 43144.47129086 55764.46484375] -> Prediction: 50985.9453125

    Predicting on: 
     [49764.1320816  50032.69313676 47885.62525472 45604.61575361
     43144.47129086 55764.46484375 50985.9453125 ] -> Prediction: 48522.96484375

    Predicting on: 
     [50032.69313676 47885.62525472 45604.61575361 43144.47129086
     55764.46484375 50985.9453125  48522.96484375] -> Prediction: 48137.203125

    Predicting on: 
     [47885.62525472 45604.61575361 43144.47129086 55764.46484375
     50985.9453125  48522.96484375 48137.203125  ] -> Prediction: 47880.63671875

    Predicting on: 
     [45604.61575361 43144.47129086 55764.46484375 50985.9453125
     48522.96484375 48137.203125   47880.63671875] -> Prediction: 46879.71875

    Predicting on: 
     [43144.47129086 55764.46484375 50985.9453125  48522.96484375
     48137.203125   47880.63671875 46879.71875   ] -> Prediction: 48227.6015625

    Predicting on: 
     [55764.46484375 50985.9453125  48522.96484375 48137.203125
     47880.63671875 46879.71875    48227.6015625 ] -> Prediction: 53963.69140625

    Predicting on: 
     [50985.9453125  48522.96484375 48137.203125   47880.63671875
     46879.71875    48227.6015625  53963.69140625] -> Prediction: 49685.55859375

    Predicting on: 
     [48522.96484375 48137.203125   47880.63671875 46879.71875
     48227.6015625  53963.69140625 49685.55859375] -> Prediction: 47596.17578125

    Predicting on: 
     [48137.203125   47880.63671875 46879.71875    48227.6015625
     53963.69140625 49685.55859375 47596.17578125] -> Prediction: 48114.4296875

    Predicting on: 
     [47880.63671875 46879.71875    48227.6015625  53963.69140625
     49685.55859375 47596.17578125 48114.4296875 ] -> Prediction: 48808.0078125

    Predicting on: 
     [46879.71875    48227.6015625  53963.69140625 49685.55859375
     47596.17578125 48114.4296875  48808.0078125 ] -> Prediction: 48623.85546875

    Predicting on: 
     [48227.6015625  53963.69140625 49685.55859375 47596.17578125
     48114.4296875  48808.0078125  48623.85546875] -> Prediction: 50178.72265625
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-113-1">1</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-113-1" name="__codelineno-113-1"></a><span class="n">future_forecast</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    [55764.465,
     50985.945,
     48522.965,
     48137.203,
     47880.637,
     46879.72,
     48227.6,
     53963.69,
     49685.56,
     47596.176]
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-114-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-114-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-114-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-114-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-114-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-114-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-114-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-114-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-114-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-114-10">10</a></span>
<span class="normal"><a href="#__codelineno-114-11">11</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-114-1" name="__codelineno-114-1"></a><span class="k">def</span> <span class="nf">get_future_dates</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">into_future</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-114-2" name="__codelineno-114-2"></a>  <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-114-3" name="__codelineno-114-3"></a><span class="sd">  Returns array of datetime values from ranging from start_date to start_date+horizon.</span>
<a id="__codelineno-114-4" name="__codelineno-114-4"></a>
<a id="__codelineno-114-5" name="__codelineno-114-5"></a><span class="sd">  start_date: date to start range (np.datetime64)</span>
<a id="__codelineno-114-6" name="__codelineno-114-6"></a><span class="sd">  into_future: number of days to add onto start date for range (int)</span>
<a id="__codelineno-114-7" name="__codelineno-114-7"></a><span class="sd">  offset: number of days to offset start_date by (default 1)</span>
<a id="__codelineno-114-8" name="__codelineno-114-8"></a><span class="sd">  &quot;&quot;&quot;</span>
<a id="__codelineno-114-9" name="__codelineno-114-9"></a>  <span class="n">start_date</span> <span class="o">=</span> <span class="n">start_date</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">)</span> <span class="c1"># specify start date, &quot;D&quot; stands for day</span>
<a id="__codelineno-114-10" name="__codelineno-114-10"></a>  <span class="n">end_date</span> <span class="o">=</span> <span class="n">start_date</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="n">into_future</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">)</span> <span class="c1"># specify end date</span>
<a id="__codelineno-114-11" name="__codelineno-114-11"></a>  <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;datetime64[D]&quot;</span><span class="p">)</span> <span class="c1"># return a date range between start date and end date</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-115-1">1</a></span>
<span class="normal"><a href="#__codelineno-115-2">2</a></span>
<span class="normal"><a href="#__codelineno-115-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-115-1" name="__codelineno-115-1"></a><span class="c1"># Last timestep of timesteps (currently in np.datetime64 format)</span>
<a id="__codelineno-115-2" name="__codelineno-115-2"></a><span class="n">last_timestep</span> <span class="o">=</span> <span class="n">bitcoin_prices</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-115-3" name="__codelineno-115-3"></a><span class="n">last_timestep</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Timestamp('2021-05-18 00:00:00')
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-116-1">1</a></span>
<span class="normal"><a href="#__codelineno-116-2">2</a></span>
<span class="normal"><a href="#__codelineno-116-3">3</a></span>
<span class="normal"><a href="#__codelineno-116-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-116-1" name="__codelineno-116-1"></a><span class="c1"># Get next two weeks of timesteps</span>
<a id="__codelineno-116-2" name="__codelineno-116-2"></a><span class="n">next_time_steps</span> <span class="o">=</span> <span class="n">get_future_dates</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="n">last_timestep</span><span class="p">,</span> 
<a id="__codelineno-116-3" name="__codelineno-116-3"></a>                                   <span class="n">into_future</span><span class="o">=</span><span class="n">INTO_FUTURE</span><span class="p">)</span>
<a id="__codelineno-116-4" name="__codelineno-116-4"></a><span class="n">next_time_steps</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    array(['2021-05-19', '2021-05-20', '2021-05-21', '2021-05-22',
           '2021-05-23', '2021-05-24', '2021-05-25', '2021-05-26',
           '2021-05-27', '2021-05-28', '2021-05-29', '2021-05-30',
           '2021-05-31', '2021-06-01'], dtype='datetime64[D]')
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-117-1">1</a></span>
<span class="normal"><a href="#__codelineno-117-2">2</a></span>
<span class="normal"><a href="#__codelineno-117-3">3</a></span>
<span class="normal"><a href="#__codelineno-117-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-117-1" name="__codelineno-117-1"></a><span class="c1"># Insert last timestep/final price so the graph doesn&#39;t look messed</span>
<a id="__codelineno-117-2" name="__codelineno-117-2"></a><span class="n">next_time_steps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">next_time_steps</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">last_timestep</span><span class="p">)</span>
<a id="__codelineno-117-3" name="__codelineno-117-3"></a><span class="n">future_forecast</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">future_forecast</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">btc_price</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-117-4" name="__codelineno-117-4"></a><span class="n">next_time_steps</span><span class="p">,</span> <span class="n">future_forecast</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (array(['2021-05-18', '2021-05-19', '2021-05-20', '2021-05-21',
            '2021-05-22', '2021-05-23', '2021-05-24', '2021-05-25',
            '2021-05-26', '2021-05-27', '2021-05-28', '2021-05-29',
            '2021-05-30', '2021-05-31', '2021-06-01'], dtype='datetime64[D]'),
     array([43144.473, 55764.465, 50985.945, 48522.965, 48137.203, 47880.637,
            46879.72 , 48227.6  , 53963.69 , 49685.56 , 47596.176, 48114.43 ,
            48808.008, 48623.855, 50178.723], dtype=float32))
</pre>
</div>

<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-118-1">1</a></span>
<span class="normal"><a href="#__codelineno-118-2">2</a></span>
<span class="normal"><a href="#__codelineno-118-3">3</a></span>
<span class="normal"><a href="#__codelineno-118-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-118-1" name="__codelineno-118-1"></a><span class="c1"># Plot future price predictions of Bitcoin</span>
<a id="__codelineno-118-2" name="__codelineno-118-2"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<a id="__codelineno-118-3" name="__codelineno-118-3"></a><span class="n">plot_time_series</span><span class="p">(</span><span class="n">bitcoin_prices</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">btc_price</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">2500</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Actual BTC Price&quot;</span><span class="p">)</span>
<a id="__codelineno-118-4" name="__codelineno-118-4"></a><span class="n">plot_time_series</span><span class="p">(</span><span class="n">next_time_steps</span><span class="p">,</span> <span class="n">future_forecast</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Predicted BTC Price&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<img alt="bitcoin-15" src="../../../images/bitcoin-15.png" /></p>
<p><a name="model-10"></a></p>
<h2 id="model-10-turkey-problem"><strong>Model 10: Turkey Problem</strong></h2>
<p><a name=""></a></p>
<h3 id="prepare-data_7">Prepare Data</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-119-1">1</a></span>
<span class="normal"><a href="#__codelineno-119-2">2</a></span>
<span class="normal"><a href="#__codelineno-119-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-119-1" name="__codelineno-119-1"></a><span class="c1"># Let&#39;s introduce a Turkey problem to our BTC data (price BTC falls 100x in one day)</span>
<a id="__codelineno-119-2" name="__codelineno-119-2"></a><span class="n">btc_price_turkey</span> <span class="o">=</span> <span class="n">btc_price</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-119-3" name="__codelineno-119-3"></a><span class="n">btc_price_turkey</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">btc_price_turkey</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">100</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-120-1">1</a></span>
<span class="normal"><a href="#__codelineno-120-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-120-1" name="__codelineno-120-1"></a><span class="c1"># Manufacture an extra price on the end (to showcase the Turkey problem)</span>
<a id="__codelineno-120-2" name="__codelineno-120-2"></a><span class="n">btc_price_turkey</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">:]</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    [58788.2096789273,
     58102.1914262342,
     55715.5466512869,
     56573.5554719043,
     52147.8211869823,
     49764.1320815975,
     50032.6931367648,
     47885.6252547166,
     45604.6157536131,
     431.44471290860304]
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-121-1">1</a></span>
<span class="normal"><a href="#__codelineno-121-2">2</a></span>
<span class="normal"><a href="#__codelineno-121-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-121-1" name="__codelineno-121-1"></a><span class="c1"># Get the timesteps for the turkey problem </span>
<a id="__codelineno-121-2" name="__codelineno-121-2"></a><span class="n">btc_timesteps_turkey</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bitcoin_prices</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<a id="__codelineno-121-3" name="__codelineno-121-3"></a><span class="n">btc_timesteps_turkey</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">:]</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    array(['2021-05-09T00:00:00.000000000', '2021-05-10T00:00:00.000000000',
           '2021-05-11T00:00:00.000000000', '2021-05-12T00:00:00.000000000',
           '2021-05-13T00:00:00.000000000', '2021-05-14T00:00:00.000000000',
           '2021-05-15T00:00:00.000000000', '2021-05-16T00:00:00.000000000',
           '2021-05-17T00:00:00.000000000', '2021-05-18T00:00:00.000000000'],
          dtype='datetime64[ns]')
</pre>
</div>

<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-122-1">1</a></span>
<span class="normal"><a href="#__codelineno-122-2">2</a></span>
<span class="normal"><a href="#__codelineno-122-3">3</a></span>
<span class="normal"><a href="#__codelineno-122-4">4</a></span>
<span class="normal"><a href="#__codelineno-122-5">5</a></span>
<span class="normal"><a href="#__codelineno-122-6">6</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-122-1" name="__codelineno-122-1"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<a id="__codelineno-122-2" name="__codelineno-122-2"></a><span class="n">plot_time_series</span><span class="p">(</span><span class="n">timesteps</span><span class="o">=</span><span class="n">btc_timesteps_turkey</span><span class="p">,</span> 
<a id="__codelineno-122-3" name="__codelineno-122-3"></a>                 <span class="n">values</span><span class="o">=</span><span class="n">btc_price_turkey</span><span class="p">,</span> 
<a id="__codelineno-122-4" name="__codelineno-122-4"></a>                 <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> 
<a id="__codelineno-122-5" name="__codelineno-122-5"></a>                 <span class="n">label</span><span class="o">=</span><span class="s2">&quot;BTC Price + Turkey Problem&quot;</span><span class="p">,</span> 
<a id="__codelineno-122-6" name="__codelineno-122-6"></a>                 <span class="n">start</span><span class="o">=</span><span class="mi">2500</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<img alt="bitcoin-16" src="../../../images/bitcoin-16.png" /></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-123-1">1</a></span>
<span class="normal"><a href="#__codelineno-123-2">2</a></span>
<span class="normal"><a href="#__codelineno-123-3">3</a></span>
<span class="normal"><a href="#__codelineno-123-4">4</a></span>
<span class="normal"><a href="#__codelineno-123-5">5</a></span>
<span class="normal"><a href="#__codelineno-123-6">6</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-123-1" name="__codelineno-123-1"></a><span class="c1"># Create train and test sets for turkey problem data</span>
<a id="__codelineno-123-2" name="__codelineno-123-2"></a><span class="n">full_windows</span><span class="p">,</span> <span class="n">full_labels</span> <span class="o">=</span> <span class="n">make_windows</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">btc_price_turkey</span><span class="p">),</span> <span class="n">window_size</span><span class="o">=</span><span class="n">WINDOW_SIZE</span><span class="p">,</span> <span class="n">horizon</span><span class="o">=</span><span class="n">HORIZON</span><span class="p">)</span>
<a id="__codelineno-123-3" name="__codelineno-123-3"></a><span class="nb">len</span><span class="p">(</span><span class="n">full_windows</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">full_labels</span><span class="p">)</span>
<a id="__codelineno-123-4" name="__codelineno-123-4"></a>
<a id="__codelineno-123-5" name="__codelineno-123-5"></a><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">make_train_test_splits</span><span class="p">(</span><span class="n">full_windows</span><span class="p">,</span> <span class="n">full_labels</span><span class="p">)</span>
<a id="__codelineno-123-6" name="__codelineno-123-6"></a><span class="nb">len</span><span class="p">(</span><span class="n">X_train</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_test</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_train</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (2224, 556, 2224, 556)
</pre>
</div>

<p><a name=""></a></p>
<h3 id="create-compile-and-fit-model_10">Create, Compile, and Fit Model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-124-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-124-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-124-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-124-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-124-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-124-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-124-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-124-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-124-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-124-10">10</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-124-1" name="__codelineno-124-1"></a><span class="c1"># Clone model 1 architecture for turkey model and fit the turkey model on the turkey data</span>
<a id="__codelineno-124-2" name="__codelineno-124-2"></a><span class="n">turkey_model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">clone_model</span><span class="p">(</span><span class="n">model_1</span><span class="p">)</span>
<a id="__codelineno-124-3" name="__codelineno-124-3"></a><span class="n">turkey_model</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="s2">&quot;Turkey_Model&quot;</span>
<a id="__codelineno-124-4" name="__codelineno-124-4"></a><span class="n">turkey_model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s2">&quot;mae&quot;</span><span class="p">,</span>
<a id="__codelineno-124-5" name="__codelineno-124-5"></a>                     <span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">())</span>
<a id="__codelineno-124-6" name="__codelineno-124-6"></a><span class="n">turkey_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span>
<a id="__codelineno-124-7" name="__codelineno-124-7"></a>                 <span class="n">epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-124-8" name="__codelineno-124-8"></a>                 <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-124-9" name="__codelineno-124-9"></a>                 <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">),</span>
<a id="__codelineno-124-10" name="__codelineno-124-10"></a>                 <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">create_model_checkpoint</span><span class="p">(</span><span class="n">turkey_model</span><span class="o">.</span><span class="n">name</span><span class="p">)])</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    INFO:tensorflow:Assets written to: model_experiments/Turkey_Model/assets
    INFO:tensorflow:Assets written to: model_experiments/Turkey_Model/assets
    INFO:tensorflow:Assets written to: model_experiments/Turkey_Model/assets
    INFO:tensorflow:Assets written to: model_experiments/Turkey_Model/assets
    INFO:tensorflow:Assets written to: model_experiments/Turkey_Model/assets
    INFO:tensorflow:Assets written to: model_experiments/Turkey_Model/assets
    INFO:tensorflow:Assets written to: model_experiments/Turkey_Model/assets
    INFO:tensorflow:Assets written to: model_experiments/Turkey_Model/assets
    INFO:tensorflow:Assets written to: model_experiments/Turkey_Model/assets
    INFO:tensorflow:Assets written to: model_experiments/Turkey_Model/assets
    (keras.callbacks.History at 0x7f12ece84910)
</pre>
</div>

<p><a name=""></a></p>
<h3 id="evaluate-model_10">Evaluate Model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-125-1">1</a></span>
<span class="normal"><a href="#__codelineno-125-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-125-1" name="__codelineno-125-1"></a><span class="c1"># Evaluate turkey model on test data</span>
<a id="__codelineno-125-2" name="__codelineno-125-2"></a><span class="n">turkey_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    18/18 [==============================] - 0s 2ms/step - loss: 696.1285
    696.1284790039062
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-126-1">1</a></span>
<span class="normal"><a href="#__codelineno-126-2">2</a></span>
<span class="normal"><a href="#__codelineno-126-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-126-1" name="__codelineno-126-1"></a><span class="c1"># Load best model and evaluate on test data</span>
<a id="__codelineno-126-2" name="__codelineno-126-2"></a><span class="n">turkey_model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="s2">&quot;model_experiments/Turkey_Model/&quot;</span><span class="p">)</span>
<a id="__codelineno-126-3" name="__codelineno-126-3"></a><span class="n">turkey_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    18/18 [==============================] - 0s 3ms/step - loss: 638.3047
    638.3046875
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-127-1">1</a></span>
<span class="normal"><a href="#__codelineno-127-2">2</a></span>
<span class="normal"><a href="#__codelineno-127-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-127-1" name="__codelineno-127-1"></a><span class="c1"># Make predictions with Turkey model</span>
<a id="__codelineno-127-2" name="__codelineno-127-2"></a><span class="n">turkey_preds</span> <span class="o">=</span> <span class="n">make_preds</span><span class="p">(</span><span class="n">turkey_model</span><span class="p">,</span> <span class="n">X_test</span><span class="p">)</span>
<a id="__codelineno-127-3" name="__codelineno-127-3"></a><span class="n">turkey_preds</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (tf.Tensor: shape=(10,), dtype=float32, numpy=
    array([8858.391, 8803.98 , 9039.575, 8785.937, 8778.044, 8735.638,
           8684.118, 8558.659, 8461.373, 8542.206], dtype=float32))
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-128-1">1</a></span>
<span class="normal"><a href="#__codelineno-128-2">2</a></span>
<span class="normal"><a href="#__codelineno-128-3">3</a></span>
<span class="normal"><a href="#__codelineno-128-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-128-1" name="__codelineno-128-1"></a><span class="c1"># Evaluate turkey preds</span>
<a id="__codelineno-128-2" name="__codelineno-128-2"></a><span class="n">turkey_results</span> <span class="o">=</span> <span class="n">evaluate_preds</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">y_test</span><span class="p">,</span>
<a id="__codelineno-128-3" name="__codelineno-128-3"></a>                                <span class="n">y_pred</span><span class="o">=</span><span class="n">turkey_preds</span><span class="p">)</span>
<a id="__codelineno-128-4" name="__codelineno-128-4"></a><span class="n">turkey_results</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    {'mae': 17144.766,
     'mape': 121.58286,
     'mase': 26.53158,
     'mse': 615487800.0,
     'rmse': 23743.305}
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-129-1">1</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-129-1" name="__codelineno-129-1"></a><span class="n">model_1_results</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    {'mae': 568.95123,
     'mape': 2.5448983,
     'mase': 0.9994897,
     'mse': 1171744.0,
     'rmse': 1082.4713}
</pre>
</div>

<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-130-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-130-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-130-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-130-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-130-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-130-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-130-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-130-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-130-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-130-10">10</a></span>
<span class="normal"><a href="#__codelineno-130-11">11</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-130-1" name="__codelineno-130-1"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<a id="__codelineno-130-2" name="__codelineno-130-2"></a><span class="c1"># plot_time_series(timesteps=btc_timesteps_turkey[:split_size], values=btc_price_turkey[:split_size], label=&quot;Train Data&quot;)</span>
<a id="__codelineno-130-3" name="__codelineno-130-3"></a><span class="n">offset</span><span class="o">=</span><span class="mi">300</span>
<a id="__codelineno-130-4" name="__codelineno-130-4"></a><span class="n">plot_time_series</span><span class="p">(</span><span class="n">timesteps</span><span class="o">=</span><span class="n">btc_timesteps_turkey</span><span class="p">[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">X_test</span><span class="p">):],</span> 
<a id="__codelineno-130-5" name="__codelineno-130-5"></a>                 <span class="n">values</span><span class="o">=</span><span class="n">btc_price_turkey</span><span class="p">[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">y_test</span><span class="p">):],</span> 
<a id="__codelineno-130-6" name="__codelineno-130-6"></a>                 <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> 
<a id="__codelineno-130-7" name="__codelineno-130-7"></a>                 <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Turkey Test Data&quot;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">offset</span><span class="p">)</span>
<a id="__codelineno-130-8" name="__codelineno-130-8"></a><span class="n">plot_time_series</span><span class="p">(</span><span class="n">timesteps</span><span class="o">=</span><span class="n">btc_timesteps_turkey</span><span class="p">[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">X_test</span><span class="p">):],</span>
<a id="__codelineno-130-9" name="__codelineno-130-9"></a>                 <span class="n">values</span><span class="o">=</span><span class="n">turkey_preds</span><span class="p">,</span> 
<a id="__codelineno-130-10" name="__codelineno-130-10"></a>                 <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Turkey Preds&quot;</span><span class="p">,</span> 
<a id="__codelineno-130-11" name="__codelineno-130-11"></a>                 <span class="n">start</span><span class="o">=</span><span class="n">offset</span><span class="p">);</span>
</code></pre></div>
</td></tr></table>
<img alt="bitcoin-17" src="../../../images/bitcoin-17.png" /></p>
<p><a name=""></a></p>
<h2 id="compare-models"><strong>Compare Models</strong></h2>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-131-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-131-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-131-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-131-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-131-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-131-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-131-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-131-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-131-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-131-10">10</a></span>
<span class="normal"><a href="#__codelineno-131-11">11</a></span>
<span class="normal"><a href="#__codelineno-131-12">12</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-131-1" name="__codelineno-131-1"></a><span class="c1"># Compare different model results (w = window, h = horizon, e.g. w=7 means a window size of 7)</span>
<a id="__codelineno-131-2" name="__codelineno-131-2"></a><span class="n">model_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;naive_model&quot;</span><span class="p">:</span> <span class="n">naive_results</span><span class="p">,</span>
<a id="__codelineno-131-3" name="__codelineno-131-3"></a>                              <span class="s2">&quot;model_1_dense_w7_h1&quot;</span><span class="p">:</span> <span class="n">model_1_results</span><span class="p">,</span>
<a id="__codelineno-131-4" name="__codelineno-131-4"></a>                              <span class="s2">&quot;model_2_dense_w30_h1&quot;</span><span class="p">:</span> <span class="n">model_2_results</span><span class="p">,</span>
<a id="__codelineno-131-5" name="__codelineno-131-5"></a>                              <span class="s2">&quot;model_3_dense_w30_h7&quot;</span><span class="p">:</span> <span class="n">model_3_results</span><span class="p">,</span>
<a id="__codelineno-131-6" name="__codelineno-131-6"></a>                              <span class="s2">&quot;model_4_CONV1D&quot;</span><span class="p">:</span> <span class="n">model_4_results</span><span class="p">,</span>
<a id="__codelineno-131-7" name="__codelineno-131-7"></a>                              <span class="s2">&quot;model_5_LSTM&quot;</span><span class="p">:</span> <span class="n">model_5_results</span><span class="p">,</span>
<a id="__codelineno-131-8" name="__codelineno-131-8"></a>                              <span class="s2">&quot;model_6_multivariate&quot;</span><span class="p">:</span> <span class="n">model_6_results</span><span class="p">,</span>
<a id="__codelineno-131-9" name="__codelineno-131-9"></a>                              <span class="s2">&quot;model_8_NBEATs&quot;</span><span class="p">:</span> <span class="n">model_7_results</span><span class="p">,</span>
<a id="__codelineno-131-10" name="__codelineno-131-10"></a>                              <span class="s2">&quot;model_9_ensemble&quot;</span><span class="p">:</span> <span class="n">ensemble_results</span><span class="p">,</span>
<a id="__codelineno-131-11" name="__codelineno-131-11"></a>                              <span class="s2">&quot;model_10_turkey&quot;</span><span class="p">:</span> <span class="n">turkey_results</span><span class="p">})</span><span class="o">.</span><span class="n">T</span>
<a id="__codelineno-131-12" name="__codelineno-131-12"></a><span class="n">model_results</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
                            mae             mse             rmse            mape        mase
    naive_model             567.980225      1.147547e+06    1071.236206     2.516525    0.999570
    model_1_dense_w7_h1     568.951233      1.171744e+06    1082.471313     2.544898    0.999490
    model_2_dense_w30_h1    608.961487      1.281439e+06    1132.006592     2.769339    1.064471
    model_3_dense_w30_h7    1237.506348     5.405198e+06    1425.747681     5.558878    2.202074
    model_4_CONV1D          570.828430      1.176672e+06    1084.744873     2.559336    1.002787
    model_5_LSTM            598.674866      1.279866e+06    1131.311768     2.690208    1.051706
    model_6_multivariate    567.587402      1.161688e+06    1077.816528     2.541387    0.997094
    model_8_NBEATs          581.564819      1.182842e+06    1087.585205     2.696409    1.021648
    model_9_ensemble        566.217102      1.137210e+06    1066.400513     2.576120    0.994687
    model_10_turkey         17144.765625    6.154878e+08    23743.304688    121.582863  26.531580
</pre>
</div>

<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-132-1">1</a></span>
<span class="normal"><a href="#__codelineno-132-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-132-1" name="__codelineno-132-1"></a><span class="c1"># Sort model results by MAE and plot them</span>
<a id="__codelineno-132-2" name="__codelineno-132-2"></a><span class="n">model_results</span><span class="p">[[</span><span class="s2">&quot;mae&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;mae&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">);</span>
</code></pre></div>
</td></tr></table>
<img alt="bitcoin-18" src="../../../images/bitcoin-18.png" /></p>

              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../nlp-3-sentiment/" class="md-footer__link md-footer__link--prev" aria-label="Previous: NLP - Multi-Class Sentiment Analysis" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              NLP - Multi-Class Sentiment Analysis
            </div>
          </div>
        </a>
      
      
        
        <a href="../ts-weather/" class="md-footer__link md-footer__link--next" aria-label="Next: Time Series - Weather Forecast" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Time Series - Weather Forecast
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2020 - 2022 Mark Schwarz
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["search.suggest", "search.highlight", "search.tabs.link", "content.tabs.link", "navigation.indexes", "navigation.tabs", "navigation.top"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../../../assets/javascripts/workers/search.cefbb252.min.js"}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.a5f8ea78.min.js"></script>
      
    
  </body>
</html>