
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../../../assets/dl-logo-big-512x512-color.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.0.5">
    
    
      
        <title>NLP - Multi-Class PedMed - DrLiptons</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.a617204b.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.9204c3b2.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  <link rel="stylesheet" href="../../../../overrides/assets/stylesheets/main.d9227bb8.min.css">

  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="indigo" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#multi-class-natural-language-processing-with-pedmed-200k-dataset" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="DrLiptons" class="md-header__button md-logo" aria-label="DrLiptons" data-md-component="logo">
      
  <img src="../../../../assets/dl-logo-big-512x512-color.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DrLiptons
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              NLP - Multi-Class PedMed
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="" data-md-color-primary="indigo" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../../about/" class="md-tabs__link">
      About
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../../wip/" class="md-tabs__link">
      In Progress
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../reference/" class="md-tabs__link">
        Reference
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../resource/" class="md-tabs__link md-tabs__link--active">
        Resource
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="DrLiptons" class="md-nav__button md-logo" aria-label="DrLiptons" data-md-component="logo">
      
  <img src="../../../../assets/dl-logo-big-512x512-color.png" alt="logo">

    </a>
    DrLiptons
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../about/" class="md-nav__link">
        About
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../wip/" class="md-nav__link">
        In Progress
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4">
          Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../reference/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2" type="checkbox" id="__nav_4_2" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_2">
          Python
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Python" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          Python
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/get-live-financial-data/" class="md-nav__link">
        Get Live Financial Data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/flight-deals/" class="md-nav__link">
        Flight Deals
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/alien-invaders/" class="md-nav__link">
        Alien Invaders
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/auto-job-app/" class="md-nav__link">
        Automated Job Application
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/price-tracker/" class="md-nav__link">
        Price Tracker
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/password-manager/" class="md-nav__link">
        Password Manager
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/text-2-morse-code/" class="md-nav__link">
        Text2MorseCode
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/stock-news-alerts/" class="md-nav__link">
        Stock News Alert
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/tetris/" class="md-nav__link">
        Tetris Clone
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3" type="checkbox" id="__nav_4_3" >
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_3">
          TensorFlow
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="TensorFlow" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_3">
          <span class="md-nav__icon md-icon"></span>
          TensorFlow
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3_1" type="checkbox" id="__nav_4_3_1" >
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_3_1">
          Plant Disease Detection
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Plant Disease Detection" data-md-level="3">
        <label class="md-nav__title" for="__nav_4_3_1">
          <span class="md-nav__icon md-icon"></span>
          Plant Disease Detection
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/pdd/plant-disease-detection/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/pdd/part-1-create-ml-model/" class="md-nav__link">
        Part 1 - Create ML Model
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/pdd/part-2-create-app/" class="md-nav__link">
        Part 2 - Desktop App
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/pdd/part-3-make-exe/" class="md-nav__link">
        Part 3 - Make Executable
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/object-detection/" class="md-nav__link">
        Object Detection
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" checked>
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5">
          Resource
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Resource" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Resource
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../resource/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_2" type="checkbox" id="__nav_5_2" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5_2">
          Python
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Python" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_2">
          <span class="md-nav__icon md-icon"></span>
          Python
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../python/scikit-learn/" class="md-nav__link">
        Scikit-Learn
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../python/matplotlib/" class="md-nav__link">
        Matplotlib
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../python/numpy/" class="md-nav__link">
        Numpy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../python/pandas/" class="md-nav__link">
        Pandas
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../python/mplfinance/" class="md-nav__link">
        mplfinance
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_3" type="checkbox" id="__nav_5_3" checked>
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5_3">
          TensorFlow
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="TensorFlow" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_3">
          <span class="md-nav__icon md-icon"></span>
          TensorFlow
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_3_1" type="checkbox" id="__nav_5_3_1" >
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5_3_1">
          TensorFlow Exam
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="TensorFlow Exam" data-md-level="3">
        <label class="md-nav__title" for="__nav_5_3_1">
          <span class="md-nav__icon md-icon"></span>
          TensorFlow Exam
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tf-exam/tf-exam-overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_3_1_2" type="checkbox" id="__nav_5_3_1_2" >
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5_3_1_2">
          Coursera - DeepLearning.AI TensorFlow Developer
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Coursera - DeepLearning.AI TensorFlow Developer" data-md-level="4">
        <label class="md-nav__title" for="__nav_5_3_1_2">
          <span class="md-nav__icon md-icon"></span>
          Coursera - DeepLearning.AI TensorFlow Developer
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tf-exam/cs-part-1/" class="md-nav__link">
        Part 1 - Introduction to TF
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tf-exam/cs-part-2/" class="md-nav__link">
        Part 2 - CNN in TF
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tf-exam/cs-part-3/" class="md-nav__link">
        Part 3 -  NLP in TF
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tf-exam/cs-part-4/" class="md-nav__link">
        Part 4 - Time Series
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tf-exam/pass-tensorflow-cert/" class="md-nav__link">
        How I past TensorFlow Exam
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tf-model-bp/" class="md-nav__link">
        TensorFlow Blueprint
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_3_3" type="checkbox" id="__nav_5_3_3" checked>
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5_3_3">
          TensorFlow Models
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="TensorFlow Models" data-md-level="3">
        <label class="md-nav__title" for="__nav_5_3_3">
          <span class="md-nav__icon md-icon"></span>
          TensorFlow Models
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../model-list/" class="md-nav__link">
        List of Models
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_3_3_2" type="checkbox" id="__nav_5_3_3_2" >
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5_3_3_2">
          Neural Network Regressions
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Neural Network Regressions" data-md-level="4">
        <label class="md-nav__title" for="__nav_5_3_3_2">
          <span class="md-nav__icon md-icon"></span>
          Neural Network Regressions
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../simple-regression/" class="md-nav__link">
        NNR - House Prices
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../regression-boston-housing/" class="md-nav__link">
        NNR - Boston Housing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../titanic/" class="md-nav__link">
        NNR - Titanic
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_3_3_3" type="checkbox" id="__nav_5_3_3_3" >
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5_3_3_3">
          Image Classification
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Image Classification" data-md-level="4">
        <label class="md-nav__title" for="__nav_5_3_3_3">
          <span class="md-nav__icon md-icon"></span>
          Image Classification
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../basic-fmnist/" class="md-nav__link">
        Basic Image Classification - FMNIST
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../image-classification-dogs-cats/" class="md-nav__link">
        Image Classification - Dogs & Cats
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cnn-fmnist/" class="md-nav__link">
        CNN - FMNIST
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_3_3_4" type="checkbox" id="__nav_5_3_3_4" checked>
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5_3_3_4">
          Natural Language Processing
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Natural Language Processing" data-md-level="4">
        <label class="md-nav__title" for="__nav_5_3_3_4">
          <span class="md-nav__icon md-icon"></span>
          Natural Language Processing
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../imdb/" class="md-nav__link">
        NLP - Binary-Class IMDB
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../nlp-1-binary/" class="md-nav__link">
        NLP - Binary-Class Disaster Tweets
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          NLP - Multi-Class PedMed
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        NLP - Multi-Class PedMed
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#at-a-glance" class="md-nav__link">
    At a Glance
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#import-dependencies" class="md-nav__link">
    Import Dependencies
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utility-functions" class="md-nav__link">
    Utility Functions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-data" class="md-nav__link">
    The Data
  </a>
  
    <nav class="md-nav" aria-label="The Data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#download-data" class="md-nav__link">
    Download Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inspect-data" class="md-nav__link">
    Inspect Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prepare-data" class="md-nav__link">
    Prepare Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prepare-data-for-deep-sequence-model" class="md-nav__link">
    Prepare Data for Deep Sequence Model
  </a>
  
    <nav class="md-nav" aria-label="Prepare Data for Deep Sequence Model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-custom-text-embedding" class="md-nav__link">
    Create Custom Text Embedding
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-dataset-as-fast-as-possible" class="md-nav__link">
    Create Dataset (as fast as possible)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prepare-data-for-character-embedding" class="md-nav__link">
    Prepare Data for Character Embedding
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prepare-data-for-hybrid-model-token-and-character" class="md-nav__link">
    Prepare Data for Hybrid Model (token and character)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prepare-data-for-positional-embedding" class="md-nav__link">
    Prepare Data for Positional Embedding
  </a>
  
    <nav class="md-nav" aria-label="Prepare Data for Positional Embedding">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prepare-data_1" class="md-nav__link">
    Prepare Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-training-and-validation-set" class="md-nav__link">
    Create Training and Validation Set
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-0-base-model" class="md-nav__link">
    Model 0: Base Model
  </a>
  
    <nav class="md-nav" aria-label="Model 0: Base Model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-compile-and-fit-model" class="md-nav__link">
    Create, Compile, and Fit model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate-model" class="md-nav__link">
    Evaluate Model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-1-conv1d-with-token-embedding" class="md-nav__link">
    Model 1: Conv1D with Token Embedding
  </a>
  
    <nav class="md-nav" aria-label="Model 1: Conv1D with Token Embedding">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-compile-and-fit-model_1" class="md-nav__link">
    Create, Compile, and Fit model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inspect-model" class="md-nav__link">
    Inspect Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate-model_1" class="md-nav__link">
    Evaluate Model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-2-feature-extraction-with-token-embedding" class="md-nav__link">
    Model 2: Feature Extraction with Token Embedding
  </a>
  
    <nav class="md-nav" aria-label="Model 2: Feature Extraction with Token Embedding">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#download-pretrained-tensorflow-hub-use" class="md-nav__link">
    Download Pretrained TensorFlow Hub USE
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-compile-and-fit-model_2" class="md-nav__link">
    Create, Compile, and Fit model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inspect-model_1" class="md-nav__link">
    Inspect Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate-model_2" class="md-nav__link">
    Evaluate Model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-3-conv1d-with-character-embedding" class="md-nav__link">
    Model 3: Conv1D with Character Embedding
  </a>
  
    <nav class="md-nav" aria-label="Model 3: Conv1D with Character Embedding">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-compile-and-fit-model_3" class="md-nav__link">
    Create, Compile, and Fit model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inspect-model_2" class="md-nav__link">
    Inspect Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate-model_3" class="md-nav__link">
    Evaluate Model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-4-hybrid-embedding-combine-token-and-character-embedding" class="md-nav__link">
    Model 4: Hybrid Embedding (combine token and character embedding)
  </a>
  
    <nav class="md-nav" aria-label="Model 4: Hybrid Embedding (combine token and character embedding)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-compile-and-fit-model_4" class="md-nav__link">
    Create, Compile, and Fit model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inspect-model_3" class="md-nav__link">
    Inspect Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate-model_4" class="md-nav__link">
    Evaluate Model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-5-transfer-learning-with-pretrained-token-character-and-position-embedding" class="md-nav__link">
    Model 5: Transfer Learning (with pretrained token, character, and position embedding)
  </a>
  
    <nav class="md-nav" aria-label="Model 5: Transfer Learning (with pretrained token, character, and position embedding)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-compile-and-fit-model_5" class="md-nav__link">
    Create, Compile, and Fit model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inspect-model_4" class="md-nav__link">
    Inspect Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate-model_5" class="md-nav__link">
    Evaluate Model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compare-model-results" class="md-nav__link">
    Compare model results
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#save-and-load-best-preforming-model" class="md-nav__link">
    Save and Load best preforming model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#make-predictions-and-evaluate-against-truth-labels" class="md-nav__link">
    Make Predictions and Evaluate against truth labels
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#evaluate-and-inspect-model-on-test-dataset" class="md-nav__link">
    Evaluate and Inspect model on test dataset
  </a>
  
    <nav class="md-nav" aria-label="Evaluate and Inspect model on test dataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#evaluate-model_6" class="md-nav__link">
    Evaluate model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#find-most-wrong" class="md-nav__link">
    Find most wrong
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../nlp-3-sentiment/" class="md-nav__link">
        NLP - Multi-Class Sentiment Analysis
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_3_3_5" type="checkbox" id="__nav_5_3_3_5" >
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5_3_3_5">
          Time Series
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Time Series" data-md-level="4">
        <label class="md-nav__title" for="__nav_5_3_3_5">
          <span class="md-nav__icon md-icon"></span>
          Time Series
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ts-bitcoin/" class="md-nav__link">
        Time Series - Bitcoin Price Forecast
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ts-weather/" class="md-nav__link">
        Time Series - Weather Forecast
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_3_3_6" type="checkbox" id="__nav_5_3_3_6" >
      
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5_3_3_6">
          Miscellaneous
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Miscellaneous" data-md-level="4">
        <label class="md-nav__title" for="__nav_5_3_3_6">
          <span class="md-nav__icon md-icon"></span>
          Miscellaneous
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utilities/" class="md-nav__link">
        Utility Functions
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_4" type="checkbox" id="__nav_5_4" >
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5_4">
          Microsoft Certification
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Microsoft Certification" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_4">
          <span class="md-nav__icon md-icon"></span>
          Microsoft Certification
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ms/ms-overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ms/az-900/" class="md-nav__link">
        Azure Fundamentals
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ms/ai-900/" class="md-nav__link">
        Azure AI Fundamentals
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ms/dp-900/" class="md-nav__link">
        Azure Data Fundamentals
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#at-a-glance" class="md-nav__link">
    At a Glance
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#import-dependencies" class="md-nav__link">
    Import Dependencies
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utility-functions" class="md-nav__link">
    Utility Functions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-data" class="md-nav__link">
    The Data
  </a>
  
    <nav class="md-nav" aria-label="The Data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#download-data" class="md-nav__link">
    Download Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inspect-data" class="md-nav__link">
    Inspect Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prepare-data" class="md-nav__link">
    Prepare Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prepare-data-for-deep-sequence-model" class="md-nav__link">
    Prepare Data for Deep Sequence Model
  </a>
  
    <nav class="md-nav" aria-label="Prepare Data for Deep Sequence Model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-custom-text-embedding" class="md-nav__link">
    Create Custom Text Embedding
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-dataset-as-fast-as-possible" class="md-nav__link">
    Create Dataset (as fast as possible)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prepare-data-for-character-embedding" class="md-nav__link">
    Prepare Data for Character Embedding
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prepare-data-for-hybrid-model-token-and-character" class="md-nav__link">
    Prepare Data for Hybrid Model (token and character)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prepare-data-for-positional-embedding" class="md-nav__link">
    Prepare Data for Positional Embedding
  </a>
  
    <nav class="md-nav" aria-label="Prepare Data for Positional Embedding">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prepare-data_1" class="md-nav__link">
    Prepare Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-training-and-validation-set" class="md-nav__link">
    Create Training and Validation Set
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-0-base-model" class="md-nav__link">
    Model 0: Base Model
  </a>
  
    <nav class="md-nav" aria-label="Model 0: Base Model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-compile-and-fit-model" class="md-nav__link">
    Create, Compile, and Fit model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate-model" class="md-nav__link">
    Evaluate Model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-1-conv1d-with-token-embedding" class="md-nav__link">
    Model 1: Conv1D with Token Embedding
  </a>
  
    <nav class="md-nav" aria-label="Model 1: Conv1D with Token Embedding">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-compile-and-fit-model_1" class="md-nav__link">
    Create, Compile, and Fit model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inspect-model" class="md-nav__link">
    Inspect Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate-model_1" class="md-nav__link">
    Evaluate Model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-2-feature-extraction-with-token-embedding" class="md-nav__link">
    Model 2: Feature Extraction with Token Embedding
  </a>
  
    <nav class="md-nav" aria-label="Model 2: Feature Extraction with Token Embedding">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#download-pretrained-tensorflow-hub-use" class="md-nav__link">
    Download Pretrained TensorFlow Hub USE
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-compile-and-fit-model_2" class="md-nav__link">
    Create, Compile, and Fit model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inspect-model_1" class="md-nav__link">
    Inspect Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate-model_2" class="md-nav__link">
    Evaluate Model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-3-conv1d-with-character-embedding" class="md-nav__link">
    Model 3: Conv1D with Character Embedding
  </a>
  
    <nav class="md-nav" aria-label="Model 3: Conv1D with Character Embedding">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-compile-and-fit-model_3" class="md-nav__link">
    Create, Compile, and Fit model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inspect-model_2" class="md-nav__link">
    Inspect Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate-model_3" class="md-nav__link">
    Evaluate Model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-4-hybrid-embedding-combine-token-and-character-embedding" class="md-nav__link">
    Model 4: Hybrid Embedding (combine token and character embedding)
  </a>
  
    <nav class="md-nav" aria-label="Model 4: Hybrid Embedding (combine token and character embedding)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-compile-and-fit-model_4" class="md-nav__link">
    Create, Compile, and Fit model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inspect-model_3" class="md-nav__link">
    Inspect Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate-model_4" class="md-nav__link">
    Evaluate Model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-5-transfer-learning-with-pretrained-token-character-and-position-embedding" class="md-nav__link">
    Model 5: Transfer Learning (with pretrained token, character, and position embedding)
  </a>
  
    <nav class="md-nav" aria-label="Model 5: Transfer Learning (with pretrained token, character, and position embedding)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-compile-and-fit-model_5" class="md-nav__link">
    Create, Compile, and Fit model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inspect-model_4" class="md-nav__link">
    Inspect Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate-model_5" class="md-nav__link">
    Evaluate Model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compare-model-results" class="md-nav__link">
    Compare model results
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#save-and-load-best-preforming-model" class="md-nav__link">
    Save and Load best preforming model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#make-predictions-and-evaluate-against-truth-labels" class="md-nav__link">
    Make Predictions and Evaluate against truth labels
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#evaluate-and-inspect-model-on-test-dataset" class="md-nav__link">
    Evaluate and Inspect model on test dataset
  </a>
  
    <nav class="md-nav" aria-label="Evaluate and Inspect model on test dataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#evaluate-model_6" class="md-nav__link">
    Evaluate model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#find-most-wrong" class="md-nav__link">
    Find most wrong
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

<h1 id="multi-class-natural-language-processing-with-pedmed-200k-dataset">Multi-Class Natural Language Processing with PedMed 200k dataset</h1>
<h2 id="at-a-glance"><b>At a Glance</b></h2>
<details class="example" open="open">
<summary>What to expect</summary>
<ul>
<li><a href="#model-0">Model 0: Base Model</a></li>
<li><a href="#model-1">Model 1: Conv1D with Token Embeddings</a></li>
<li><a href="#model-2">Model 2: Feature Extraction with Token Embedding</a></li>
<li><a href="#model-3">Model 3: Conv1D with Character Embedding</a></li>
<li><a href="#model-4">Model 4: Hybrid Embedding (combine token and character embedding)</a></li>
<li><a href="#model-5">Model 5: Transfer Learning (with pretrained token, character, and postition embedding</a></li>
</ul>
</details>
<p><a name=""></a></p>
<h2 id="import-dependencies"><strong>Import Dependencies</strong></h2>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-0-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-0-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-0-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-0-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="kn">import</span> <span class="nn">random</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="kn">import</span> <span class="nn">os</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="kn">import</span> <span class="nn">matplotlib.image</span> <span class="k">as</span> <span class="nn">mpimg</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="c1"># tensorflow dataset</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="kn">import</span> <span class="nn">tensorflow_datasets</span> <span class="k">as</span> <span class="nn">tfds</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="c1"># import wget as wget # only for PyCharm</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="kn">import</span> <span class="nn">zipfile</span> <span class="k">as</span> <span class="nn">zf</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="kn">import</span> <span class="nn">pathlib</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="kn">import</span> <span class="nn">random</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="c1"># Used in Prepare the data</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.layers.experimental.preprocessing</span> <span class="kn">import</span> <span class="n">TextVectorization</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">LabelEncoder</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.preprocessing.image</span> <span class="kn">import</span> <span class="n">ImageDataGenerator</span> <span class="c1"># Use for preprocessing the data</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="c1"># Use in the model</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.models</span> <span class="kn">import</span> <span class="n">Sequential</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">Conv2D</span><span class="p">,</span> <span class="n">MaxPool2D</span><span class="p">,</span> <span class="n">Flatten</span><span class="p">,</span> <span class="n">Dense</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="kn">import</span> <span class="nn">tensorflow_hub</span> <span class="k">as</span> <span class="nn">hub</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="kn">import</span> <span class="nn">datetime</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.layers.experimental</span> <span class="kn">import</span> <span class="n">preprocessing</span> <span class="c1"># for data augmentation</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">TfidfVectorizer</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="kn">from</span> <span class="nn">sklearn.naive_bayes</span> <span class="kn">import</span> <span class="n">MultinomialNB</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="c1"># Evaluate model</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span><span class="p">,</span> <span class="n">classification_report</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">precision_recall_fscore_support</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.utils</span> <span class="kn">import</span> <span class="n">plot_model</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="c1"># Utility scripts (confusion matrix)</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="kn">import</span> <span class="nn">itertools</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">confusion_matrix</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="c1"># mixed_precision</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="kn">from</span> <span class="nn">tensorflow.keras</span> <span class="kn">import</span> <span class="n">mixed_precision</span>
</code></pre></div>
</td></tr></table>
<p><a name=""></a></p>
<h2 id="utility-functions"><strong>Utility Functions</strong></h2>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-1-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-1-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-1-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-1-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-1-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-1-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-1-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-1-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-1-10">10</a></span>
<span class="normal"><a href="#__codelineno-1-11">11</a></span>
<span class="normal"><a href="#__codelineno-1-12">12</a></span>
<span class="normal"><a href="#__codelineno-1-13">13</a></span>
<span class="normal"><a href="#__codelineno-1-14">14</a></span>
<span class="normal"><a href="#__codelineno-1-15">15</a></span>
<span class="normal"><a href="#__codelineno-1-16">16</a></span>
<span class="normal"><a href="#__codelineno-1-17">17</a></span>
<span class="normal"><a href="#__codelineno-1-18">18</a></span>
<span class="normal"><a href="#__codelineno-1-19">19</a></span>
<span class="normal"><a href="#__codelineno-1-20">20</a></span>
<span class="normal"><a href="#__codelineno-1-21">21</a></span>
<span class="normal"><a href="#__codelineno-1-22">22</a></span>
<span class="normal"><a href="#__codelineno-1-23">23</a></span>
<span class="normal"><a href="#__codelineno-1-24">24</a></span>
<span class="normal"><a href="#__codelineno-1-25">25</a></span>
<span class="normal"><a href="#__codelineno-1-26">26</a></span>
<span class="normal"><a href="#__codelineno-1-27">27</a></span>
<span class="normal"><a href="#__codelineno-1-28">28</a></span>
<span class="normal"><a href="#__codelineno-1-29">29</a></span>
<span class="normal"><a href="#__codelineno-1-30">30</a></span>
<span class="normal"><a href="#__codelineno-1-31">31</a></span>
<span class="normal"><a href="#__codelineno-1-32">32</a></span>
<span class="normal"><a href="#__codelineno-1-33">33</a></span>
<span class="normal"><a href="#__codelineno-1-34">34</a></span>
<span class="normal"><a href="#__codelineno-1-35">35</a></span>
<span class="normal"><a href="#__codelineno-1-36">36</a></span>
<span class="normal"><a href="#__codelineno-1-37">37</a></span>
<span class="normal"><a href="#__codelineno-1-38">38</a></span>
<span class="normal"><a href="#__codelineno-1-39">39</a></span>
<span class="normal"><a href="#__codelineno-1-40">40</a></span>
<span class="normal"><a href="#__codelineno-1-41">41</a></span>
<span class="normal"><a href="#__codelineno-1-42">42</a></span>
<span class="normal"><a href="#__codelineno-1-43">43</a></span>
<span class="normal"><a href="#__codelineno-1-44">44</a></span>
<span class="normal"><a href="#__codelineno-1-45">45</a></span>
<span class="normal"><a href="#__codelineno-1-46">46</a></span>
<span class="normal"><a href="#__codelineno-1-47">47</a></span>
<span class="normal"><a href="#__codelineno-1-48">48</a></span>
<span class="normal"><a href="#__codelineno-1-49">49</a></span>
<span class="normal"><a href="#__codelineno-1-50">50</a></span>
<span class="normal"><a href="#__codelineno-1-51">51</a></span>
<span class="normal"><a href="#__codelineno-1-52">52</a></span>
<span class="normal"><a href="#__codelineno-1-53">53</a></span>
<span class="normal"><a href="#__codelineno-1-54">54</a></span>
<span class="normal"><a href="#__codelineno-1-55">55</a></span>
<span class="normal"><a href="#__codelineno-1-56">56</a></span>
<span class="normal"><a href="#__codelineno-1-57">57</a></span>
<span class="normal"><a href="#__codelineno-1-58">58</a></span>
<span class="normal"><a href="#__codelineno-1-59">59</a></span>
<span class="normal"><a href="#__codelineno-1-60">60</a></span>
<span class="normal"><a href="#__codelineno-1-61">61</a></span>
<span class="normal"><a href="#__codelineno-1-62">62</a></span>
<span class="normal"><a href="#__codelineno-1-63">63</a></span>
<span class="normal"><a href="#__codelineno-1-64">64</a></span>
<span class="normal"><a href="#__codelineno-1-65">65</a></span>
<span class="normal"><a href="#__codelineno-1-66">66</a></span>
<span class="normal"><a href="#__codelineno-1-67">67</a></span>
<span class="normal"><a href="#__codelineno-1-68">68</a></span>
<span class="normal"><a href="#__codelineno-1-69">69</a></span>
<span class="normal"><a href="#__codelineno-1-70">70</a></span>
<span class="normal"><a href="#__codelineno-1-71">71</a></span>
<span class="normal"><a href="#__codelineno-1-72">72</a></span>
<span class="normal"><a href="#__codelineno-1-73">73</a></span>
<span class="normal"><a href="#__codelineno-1-74">74</a></span>
<span class="normal"><a href="#__codelineno-1-75">75</a></span>
<span class="normal"><a href="#__codelineno-1-76">76</a></span>
<span class="normal"><a href="#__codelineno-1-77">77</a></span>
<span class="normal"><a href="#__codelineno-1-78">78</a></span>
<span class="normal"><a href="#__codelineno-1-79">79</a></span>
<span class="normal"><a href="#__codelineno-1-80">80</a></span>
<span class="normal"><a href="#__codelineno-1-81">81</a></span>
<span class="normal"><a href="#__codelineno-1-82">82</a></span>
<span class="normal"><a href="#__codelineno-1-83">83</a></span>
<span class="normal"><a href="#__codelineno-1-84">84</a></span>
<span class="normal"><a href="#__codelineno-1-85">85</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="c1">##### GET LINES #####</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="c1"># Create function to read the lines of a document</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="k">def</span> <span class="nf">get_lines</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a>  <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="sd">  Reads filename (a text file) and returns the lines of text as a list.</span>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="sd">  Args:</span>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="sd">      filename: a string containing the target filepath to read.</span>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a>
<a id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="sd">  Returns:</span>
<a id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="sd">      A list of strings with one string per line from the target filename.</span>
<a id="__codelineno-1-12" name="__codelineno-1-12"></a><span class="sd">      For example:</span>
<a id="__codelineno-1-13" name="__codelineno-1-13"></a><span class="sd">      [&quot;this is the first line of filename&quot;,</span>
<a id="__codelineno-1-14" name="__codelineno-1-14"></a><span class="sd">       &quot;this is the second line of filename&quot;,</span>
<a id="__codelineno-1-15" name="__codelineno-1-15"></a><span class="sd">       &quot;...&quot;]</span>
<a id="__codelineno-1-16" name="__codelineno-1-16"></a><span class="sd">  &quot;&quot;&quot;</span>
<a id="__codelineno-1-17" name="__codelineno-1-17"></a>  <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-1-18" name="__codelineno-1-18"></a>    <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
<a id="__codelineno-1-19" name="__codelineno-1-19"></a>
<a id="__codelineno-1-20" name="__codelineno-1-20"></a><span class="c1">##### PREPROCESS TEXT WITH LINE NUMBERS #####</span>
<a id="__codelineno-1-21" name="__codelineno-1-21"></a><span class="k">def</span> <span class="nf">preprocess_text_with_line_numbers</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
<a id="__codelineno-1-22" name="__codelineno-1-22"></a>  <span class="sd">&quot;&quot;&quot;Returns a list of dictionaries of abstract line data.</span>
<a id="__codelineno-1-23" name="__codelineno-1-23"></a>
<a id="__codelineno-1-24" name="__codelineno-1-24"></a><span class="sd">  Takes in filename, reads its contents and sorts through each line,</span>
<a id="__codelineno-1-25" name="__codelineno-1-25"></a><span class="sd">  extracting things like the target label, the text of the sentence,</span>
<a id="__codelineno-1-26" name="__codelineno-1-26"></a><span class="sd">  how many sentences are in the current abstract and what sentence number</span>
<a id="__codelineno-1-27" name="__codelineno-1-27"></a><span class="sd">  the target line is.</span>
<a id="__codelineno-1-28" name="__codelineno-1-28"></a>
<a id="__codelineno-1-29" name="__codelineno-1-29"></a><span class="sd">  Args:</span>
<a id="__codelineno-1-30" name="__codelineno-1-30"></a><span class="sd">      filename: a string of the target text file to read and extract line data</span>
<a id="__codelineno-1-31" name="__codelineno-1-31"></a><span class="sd">      from.</span>
<a id="__codelineno-1-32" name="__codelineno-1-32"></a>
<a id="__codelineno-1-33" name="__codelineno-1-33"></a><span class="sd">  Returns:</span>
<a id="__codelineno-1-34" name="__codelineno-1-34"></a><span class="sd">      A list of dictionaries each containing a line from an abstract,</span>
<a id="__codelineno-1-35" name="__codelineno-1-35"></a><span class="sd">      the lines label, the lines position in the abstract and the total number</span>
<a id="__codelineno-1-36" name="__codelineno-1-36"></a><span class="sd">      of lines in the abstract where the line is from. For example:</span>
<a id="__codelineno-1-37" name="__codelineno-1-37"></a>
<a id="__codelineno-1-38" name="__codelineno-1-38"></a><span class="sd">      [{&quot;target&quot;: &#39;CONCLUSION&#39;,</span>
<a id="__codelineno-1-39" name="__codelineno-1-39"></a><span class="sd">        &quot;text&quot;: The study couldn&#39;t have gone better, turns out people are kinder than you think&quot;,</span>
<a id="__codelineno-1-40" name="__codelineno-1-40"></a><span class="sd">        &quot;line_number&quot;: 8,</span>
<a id="__codelineno-1-41" name="__codelineno-1-41"></a><span class="sd">        &quot;total_lines&quot;: 8}]</span>
<a id="__codelineno-1-42" name="__codelineno-1-42"></a><span class="sd">  &quot;&quot;&quot;</span>
<a id="__codelineno-1-43" name="__codelineno-1-43"></a>  <span class="n">input_lines</span> <span class="o">=</span> <span class="n">get_lines</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="c1"># get all lines from filename</span>
<a id="__codelineno-1-44" name="__codelineno-1-44"></a>  <span class="n">abstract_lines</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="c1"># create an empty abstract</span>
<a id="__codelineno-1-45" name="__codelineno-1-45"></a>  <span class="n">abstract_samples</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># create an empty list of abstracts</span>
<a id="__codelineno-1-46" name="__codelineno-1-46"></a>
<a id="__codelineno-1-47" name="__codelineno-1-47"></a>  <span class="c1"># Loop through each line in target file</span>
<a id="__codelineno-1-48" name="__codelineno-1-48"></a>  <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">input_lines</span><span class="p">:</span>
<a id="__codelineno-1-49" name="__codelineno-1-49"></a>    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;###&quot;</span><span class="p">):</span> <span class="c1"># check to see if line is an ID line</span>
<a id="__codelineno-1-50" name="__codelineno-1-50"></a>      <span class="n">abstract_id</span> <span class="o">=</span> <span class="n">line</span>
<a id="__codelineno-1-51" name="__codelineno-1-51"></a>      <span class="n">abstract_lines</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="c1"># reset abstract string</span>
<a id="__codelineno-1-52" name="__codelineno-1-52"></a>    <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">isspace</span><span class="p">():</span> <span class="c1"># check to see if line is a new line</span>
<a id="__codelineno-1-53" name="__codelineno-1-53"></a>      <span class="n">abstract_line_split</span> <span class="o">=</span> <span class="n">abstract_lines</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span> <span class="c1"># split abstract into separate lines</span>
<a id="__codelineno-1-54" name="__codelineno-1-54"></a>
<a id="__codelineno-1-55" name="__codelineno-1-55"></a>      <span class="c1"># Iterate through each line in abstract and count them at the same time</span>
<a id="__codelineno-1-56" name="__codelineno-1-56"></a>      <span class="k">for</span> <span class="n">abstract_line_number</span><span class="p">,</span> <span class="n">abstract_line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">abstract_line_split</span><span class="p">):</span>
<a id="__codelineno-1-57" name="__codelineno-1-57"></a>        <span class="n">line_data</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># create empty dict to store data from line</span>
<a id="__codelineno-1-58" name="__codelineno-1-58"></a>        <span class="n">target_text_split</span> <span class="o">=</span> <span class="n">abstract_line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># split target label from text</span>
<a id="__codelineno-1-59" name="__codelineno-1-59"></a>        <span class="n">line_data</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target_text_split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># get target label</span>
<a id="__codelineno-1-60" name="__codelineno-1-60"></a>        <span class="n">line_data</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target_text_split</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="c1"># get target text and lower it</span>
<a id="__codelineno-1-61" name="__codelineno-1-61"></a>        <span class="n">line_data</span><span class="p">[</span><span class="s2">&quot;line_number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">abstract_line_number</span> <span class="c1"># what number line does the line appear in the abstract?</span>
<a id="__codelineno-1-62" name="__codelineno-1-62"></a>        <span class="n">line_data</span><span class="p">[</span><span class="s2">&quot;total_lines&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">abstract_line_split</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="c1"># how many total lines are in the abstract? (start from 0)</span>
<a id="__codelineno-1-63" name="__codelineno-1-63"></a>        <span class="n">abstract_samples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line_data</span><span class="p">)</span> <span class="c1"># add line data to abstract samples list</span>
<a id="__codelineno-1-64" name="__codelineno-1-64"></a>
<a id="__codelineno-1-65" name="__codelineno-1-65"></a>    <span class="k">else</span><span class="p">:</span> <span class="c1"># if the above conditions aren&#39;t fulfilled, the line contains a labelled sentence</span>
<a id="__codelineno-1-66" name="__codelineno-1-66"></a>      <span class="n">abstract_lines</span> <span class="o">+=</span> <span class="n">line</span>
<a id="__codelineno-1-67" name="__codelineno-1-67"></a>
<a id="__codelineno-1-68" name="__codelineno-1-68"></a>  <span class="k">return</span> <span class="n">abstract_samples</span>
<a id="__codelineno-1-69" name="__codelineno-1-69"></a>
<a id="__codelineno-1-70" name="__codelineno-1-70"></a><span class="c1">##### CALCULATE RESULTS FUNCTION #####</span>
<a id="__codelineno-1-71" name="__codelineno-1-71"></a><span class="k">def</span> <span class="nf">calculate_results</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
<a id="__codelineno-1-72" name="__codelineno-1-72"></a>  <span class="c1"># Calculate model accuracy</span>
<a id="__codelineno-1-73" name="__codelineno-1-73"></a>  <span class="n">model_accuracy</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<a id="__codelineno-1-74" name="__codelineno-1-74"></a>  <span class="c1"># Calculate precision, recall, and f1-score using &quot;weightd average&quot;</span>
<a id="__codelineno-1-75" name="__codelineno-1-75"></a>  <span class="n">model_precision</span><span class="p">,</span> <span class="n">model_recall</span><span class="p">,</span> <span class="n">model_f1</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">precision_recall_fscore_support</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;weighted&quot;</span><span class="p">)</span>
<a id="__codelineno-1-76" name="__codelineno-1-76"></a>  <span class="n">model_results</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;accuracy&quot;</span><span class="p">:</span> <span class="n">model_accuracy</span><span class="p">,</span>
<a id="__codelineno-1-77" name="__codelineno-1-77"></a>                   <span class="s2">&quot;precision&quot;</span><span class="p">:</span> <span class="n">model_precision</span><span class="p">,</span>
<a id="__codelineno-1-78" name="__codelineno-1-78"></a>                   <span class="s2">&quot;recall&quot;</span><span class="p">:</span> <span class="n">model_recall</span><span class="p">,</span>
<a id="__codelineno-1-79" name="__codelineno-1-79"></a>                   <span class="s2">&quot;f1&quot;</span><span class="p">:</span> <span class="n">model_f1</span><span class="p">}</span>
<a id="__codelineno-1-80" name="__codelineno-1-80"></a>  <span class="k">return</span> <span class="n">model_results</span>
<a id="__codelineno-1-81" name="__codelineno-1-81"></a>
<a id="__codelineno-1-82" name="__codelineno-1-82"></a><span class="c1">##### SPLIT CHARS #####</span>
<a id="__codelineno-1-83" name="__codelineno-1-83"></a><span class="c1"># Make function to split sentences in1to characters</span>
<a id="__codelineno-1-84" name="__codelineno-1-84"></a><span class="k">def</span> <span class="nf">split_chars</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
<a id="__codelineno-1-85" name="__codelineno-1-85"></a>  <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
</code></pre></div>
</td></tr></table>
<p><a name=""></a></p>
<h2 id="the-data"><strong>The Data</strong></h2>
<p><a name=""></a></p>
<h3 id="download-data">Download Data</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="err">!</span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">Franck</span><span class="o">-</span><span class="n">Dernoncourt</span><span class="o">/</span><span class="n">pubmed</span><span class="o">-</span><span class="n">rct</span><span class="o">.</span><span class="n">git</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="err">!</span><span class="n">ls</span> <span class="n">pubmed</span><span class="o">-</span><span class="n">rct</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    fatal: destination path 'pubmed-rct' already exists and is not an empty directory.
    PubMed_200k_RCT
    PubMed_200k_RCT_numbers_replaced_with_at_sign
    PubMed_20k_RCT
    PubMed_20k_RCT_numbers_replaced_with_at_sign
    README.md
</pre>
</div>

<p><a name=""></a></p>
<h3 id="inspect-data">Inspect Data</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span>
<span class="normal"><a href="#__codelineno-3-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="c1"># Check what files are in the PubMed_20K dataset </span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="err">!</span><span class="n">ls</span> <span class="n">pubmed</span><span class="o">-</span><span class="n">rct</span><span class="o">/</span><span class="n">PubMed_20k_RCT_numbers_replaced_with_at_sign</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    dev.txt  test.txt  train.txt
</pre>
</div>

<p><a name=""></a></p>
<h3 id="prepare-data">Prepare Data</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span>
<span class="normal"><a href="#__codelineno-4-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="c1"># Start by using the 20k dataset</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="n">data_dir</span> <span class="o">=</span> <span class="s2">&quot;pubmed-rct/PubMed_20k_RCT_numbers_replaced_with_at_sign/&quot;</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">1</a></span>
<span class="normal"><a href="#__codelineno-5-2">2</a></span>
<span class="normal"><a href="#__codelineno-5-3">3</a></span>
<span class="normal"><a href="#__codelineno-5-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="c1"># Check all of the filenames in the target directory</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="kn">import</span> <span class="nn">os</span>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="n">filenames</span> <span class="o">=</span> <span class="p">[</span><span class="n">data_dir</span> <span class="o">+</span> <span class="n">filename</span> <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">data_dir</span><span class="p">)]</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="n">filenames</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    ['pubmed-rct/PubMed_20k_RCT_numbers_replaced_with_at_sign/dev.txt',
     'pubmed-rct/PubMed_20k_RCT_numbers_replaced_with_at_sign/train.txt',
     'pubmed-rct/PubMed_20k_RCT_numbers_replaced_with_at_sign/test.txt']
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1">1</a></span>
<span class="normal"><a href="#__codelineno-6-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="n">train_lines</span> <span class="o">=</span> <span class="n">get_lines</span><span class="p">(</span><span class="n">data_dir</span><span class="o">+</span><span class="s2">&quot;train.txt&quot;</span><span class="p">)</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="n">train_lines</span><span class="p">[:</span><span class="mi">20</span><span class="p">]</span> <span class="c1"># the whole first example of an abstract + a little more of the next one</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    ['###24293578\n',
     'OBJECTIVE\tTo investigate the efficacy of @ weeks of daily low-dose oral prednisolone in improving pain , mobility , and systemic low-grade inflammation in the short term and whether the effect would be sustained at @ weeks in older adults with moderate to severe knee osteoarthritis ( OA ) .\n',
     'METHODS\tA total of @ patients with primary knee OA were randomized @:@ ; @ received @ mg/day of prednisolone and @ received placebo for @ weeks .\n',
     'METHODS\tOutcome measures included pain reduction and improvement in function scores and systemic inflammation markers .\n',
     'METHODS\tPain was assessed using the visual analog pain scale ( @-@ mm ) .\n',
     'METHODS\tSecondary outcome measures included the Western Ontario and McMaster Universities Osteoarthritis Index scores , patient global assessment ( PGA ) of the severity of knee OA , and @-min walk distance ( @MWD ) .\n',
     'METHODS\tSerum levels of interleukin @ ( IL-@ ) , IL-@ , tumor necrosis factor ( TNF ) - , and high-sensitivity C-reactive protein ( hsCRP ) were measured .\n',
     'RESULTS\tThere was a clinically relevant reduction in the intervention group compared to the placebo group for knee pain , physical function , PGA , and @MWD at @ weeks .\n',
     'RESULTS\tThe mean difference between treatment arms ( @ % CI ) was @ ( @-@ @ ) , p < @ ; @ ( @-@ @ ) , p < @ ; @ ( @-@ @ ) , p < @ ; and @ ( @-@ @ ) , p < @ , respectively .\n',
     'RESULTS\tFurther , there was a clinically relevant reduction in the serum levels of IL-@ , IL-@ , TNF - , and hsCRP at @ weeks in the intervention group when compared to the placebo group .\n',
     'RESULTS\tThese differences remained significant at @ weeks .\n',
     'RESULTS\tThe Outcome Measures in Rheumatology Clinical Trials-Osteoarthritis Research Society International responder rate was @ % in the intervention group and @ % in the placebo group ( p < @ ) .\n',
     'CONCLUSIONS\tLow-dose oral prednisolone had both a short-term and a longer sustained effect resulting in less knee pain , better physical function , and attenuation of systemic inflammation in older patients with knee OA ( ClinicalTrials.gov identifier NCT@ ) .\n',
     '\n',
     '###24854809\n',
     'BACKGROUND\tEmotional eating is associated with overeating and the development of obesity .\n',
     'BACKGROUND\tYet , empirical evidence for individual ( trait ) differences in emotional eating and cognitive mechanisms that contribute to eating during sad mood remain equivocal .\n',
     'OBJECTIVE\tThe aim of this study was to test if attention bias for food moderates the effect of self-reported emotional eating during sad mood ( vs neutral mood ) on actual food intake .\n',
     'OBJECTIVE\tIt was expected that emotional eating is predictive of elevated attention for food and higher food intake after an experimentally induced sad mood and that attentional maintenance on food predicts food intake during a sad versus a neutral mood .\n',
     'METHODS\tParticipants ( N = @ ) were randomly assigned to one of the two experimental mood induction conditions ( sad/neutral ) .\n']
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1">1</a></span>
<span class="normal"><a href="#__codelineno-7-2">2</a></span>
<span class="normal"><a href="#__codelineno-7-3">3</a></span>
<span class="normal"><a href="#__codelineno-7-4">4</a></span>
<span class="normal"><a href="#__codelineno-7-5">5</a></span>
<span class="normal"><a href="#__codelineno-7-6">6</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="c1"># Get data from file and preprocess it</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="o">%%</span><span class="n">time</span>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="n">train_samples</span> <span class="o">=</span> <span class="n">preprocess_text_with_line_numbers</span><span class="p">(</span><span class="n">data_dir</span> <span class="o">+</span> <span class="s2">&quot;train.txt&quot;</span><span class="p">)</span>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="n">val_samples</span> <span class="o">=</span> <span class="n">preprocess_text_with_line_numbers</span><span class="p">(</span><span class="n">data_dir</span> <span class="o">+</span> <span class="s2">&quot;dev.txt&quot;</span><span class="p">)</span> <span class="c1"># dev is another name for validation set</span>
<a id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="n">test_samples</span> <span class="o">=</span> <span class="n">preprocess_text_with_line_numbers</span><span class="p">(</span><span class="n">data_dir</span> <span class="o">+</span> <span class="s2">&quot;test.txt&quot;</span><span class="p">)</span>
<a id="__codelineno-7-6" name="__codelineno-7-6"></a><span class="nb">len</span><span class="p">(</span><span class="n">train_samples</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">val_samples</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_samples</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    CPU times: user 575 ms, sys: 99.6 ms, total: 675 ms
    Wall time: 679 ms
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">1</a></span>
<span class="normal"><a href="#__codelineno-8-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="c1"># (Optional) Check the first abstract of our training data</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="n">train_samples</span><span class="p">[:</span><span class="mi">14</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    [{'line_number': 0,
      'target': 'OBJECTIVE',
      'text': 'to investigate the efficacy of @ weeks of daily low-dose oral prednisolone in improving pain , mobility , and systemic low-grade inflammation in the short term and whether the effect would be sustained at @ weeks in older adults with moderate to severe knee osteoarthritis ( oa ) .',
      'total_lines': 11},
     {'line_number': 1,
      'target': 'METHODS',
      'text': 'a total of @ patients with primary knee oa were randomized @:@ ; @ received @ mg/day of prednisolone and @ received placebo for @ weeks .',
      'total_lines': 11},
     {'line_number': 2,
      'target': 'METHODS',
      'text': 'outcome measures included pain reduction and improvement in function scores and systemic inflammation markers .',
      'total_lines': 11},
     {'line_number': 3,
      'target': 'METHODS',
      'text': 'pain was assessed using the visual analog pain scale ( @-@ mm ) .',
      'total_lines': 11},
     {'line_number': 4,
      'target': 'METHODS',
      'text': 'secondary outcome measures included the western ontario and mcmaster universities osteoarthritis index scores , patient global assessment ( pga ) of the severity of knee oa , and @-min walk distance ( @mwd ) .',
      'total_lines': 11},
     {'line_number': 5,
      'target': 'METHODS',
      'text': 'serum levels of interleukin @ ( il-@ ) , il-@ , tumor necrosis factor ( tnf ) - , and high-sensitivity c-reactive protein ( hscrp ) were measured .',
      'total_lines': 11},
     {'line_number': 6,
      'target': 'RESULTS',
      'text': 'there was a clinically relevant reduction in the intervention group compared to the placebo group for knee pain , physical function , pga , and @mwd at @ weeks .',
      'total_lines': 11},
     {'line_number': 7,
      'target': 'RESULTS',
      'text': 'the mean difference between treatment arms ( @ % ci ) was @ ( @-@ @ ) , p < @ ; @ ( @-@ @ ) , p < @ ; @ ( @-@ @ ) , p < @ ; and @ ( @-@ @ ) , p < @ , respectively .',
      'total_lines': 11},
     {'line_number': 8,
      'target': 'RESULTS',
      'text': 'further , there was a clinically relevant reduction in the serum levels of il-@ , il-@ , tnf - , and hscrp at @ weeks in the intervention group when compared to the placebo group .',
      'total_lines': 11},
     {'line_number': 9,
      'target': 'RESULTS',
      'text': 'these differences remained significant at @ weeks .',
      'total_lines': 11},
     {'line_number': 10,
      'target': 'RESULTS',
      'text': 'the outcome measures in rheumatology clinical trials-osteoarthritis research society international responder rate was @ % in the intervention group and @ % in the placebo group ( p < @ ) .',
      'total_lines': 11},
     {'line_number': 11,
      'target': 'CONCLUSIONS',
      'text': 'low-dose oral prednisolone had both a short-term and a longer sustained effect resulting in less knee pain , better physical function , and attenuation of systemic inflammation in older patients with knee oa ( clinicaltrials.gov identifier nct@ ) .',
      'total_lines': 11},
     {'line_number': 0,
      'target': 'BACKGROUND',
      'text': 'emotional eating is associated with overeating and the development of obesity .',
      'total_lines': 10},
     {'line_number': 1,
      'target': 'BACKGROUND',
      'text': 'yet , empirical evidence for individual ( trait ) differences in emotional eating and cognitive mechanisms that contribute to eating during sad mood remain equivocal .',
      'total_lines': 10}]
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1">1</a></span>
<span class="normal"><a href="#__codelineno-9-2">2</a></span>
<span class="normal"><a href="#__codelineno-9-3">3</a></span>
<span class="normal"><a href="#__codelineno-9-4">4</a></span>
<span class="normal"><a href="#__codelineno-9-5">5</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="c1"># (Optional) Turn data into DataFrame for better visualization</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="n">train_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">train_samples</span><span class="p">)</span>
<a id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="n">val_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">val_samples</span><span class="p">)</span>
<a id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="n">test_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">test_samples</span><span class="p">)</span>
<a id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="n">train_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
        target      text                                                line_number     total_lines
    0   OBJECTIVE   to investigate the efficacy of @ weeks of dail...   0               11
    1   METHODS     a total of @ patients with primary knee oa wer...   1               11
    2   METHODS     outcome measures included pain reduction and i...   2               11
    3   METHODS     pain was assessed using the visual analog pain...   3               11
    4   METHODS     secondary outcome measures included the wester...   4               11
    5   METHODS     serum levels of interleukin @ ( il-@ ) , il-@ ...   5               11
    6   RESULTS     there was a clinically relevant reduction in t...   6               11
    7   RESULTS     the mean difference between treatment arms ( @...   7               11
    8   RESULTS     further , there was a clinically relevant redu...   8               11
    9   RESULTS     these differences remained significant at @ we...   9               11
    10  RESULTS     the outcome measures in rheumatology clinical ...   10              11
    11  CONCLUSIONS low-dose oral prednisolone had both a short-te...   11              11
    12  BACKGROUND  emotional eating is associated with overeating...   0               10
    13  BACKGROUND  yet , empirical evidence for individual ( trai...   1               10
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1">1</a></span>
<span class="normal"><a href="#__codelineno-10-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="c1"># (Optional) Distribution of labels in training data</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="n">train_df</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    METHODS        59353
    RESULTS        57953
    CONCLUSIONS    27168
    BACKGROUND     21727
    OBJECTIVE      13839
    Name: target, dtype: int64
</pre>
</div>

<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1">1</a></span>
<span class="normal"><a href="#__codelineno-11-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="c1"># (Optional) Check data distribution</span>
<a id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="n">train_df</span><span class="o">.</span><span class="n">total_lines</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">();</span>
</code></pre></div>
</td></tr></table>
<img alt="nlp-2-1" src="../../../images/nlp-2-1.png" /></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1">1</a></span>
<span class="normal"><a href="#__codelineno-12-2">2</a></span>
<span class="normal"><a href="#__codelineno-12-3">3</a></span>
<span class="normal"><a href="#__codelineno-12-4">4</a></span>
<span class="normal"><a href="#__codelineno-12-5">5</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="c1"># Convert abstract text lines into lists </span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="n">train_sentences</span> <span class="o">=</span> <span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<a id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="n">val_sentences</span> <span class="o">=</span> <span class="n">val_df</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<a id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="n">test_sentences</span> <span class="o">=</span> <span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<a id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="nb">len</span><span class="p">(</span><span class="n">train_sentences</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">val_sentences</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_sentences</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (180040, 30212, 30135)
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1">1</a></span>
<span class="normal"><a href="#__codelineno-13-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="c1"># (Optional) View first 10 lines of training sentences</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="n">train_sentences</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    ['to investigate the efficacy of @ weeks of daily low-dose oral prednisolone in improving pain , mobility , and systemic low-grade inflammation in the short term and whether the effect would be sustained at @ weeks in older adults with moderate to severe knee osteoarthritis ( oa ) .',
     'a total of @ patients with primary knee oa were randomized @:@ ; @ received @ mg/day of prednisolone and @ received placebo for @ weeks .',
     'outcome measures included pain reduction and improvement in function scores and systemic inflammation markers .',
     'pain was assessed using the visual analog pain scale ( @-@ mm ) .',
     'secondary outcome measures included the western ontario and mcmaster universities osteoarthritis index scores , patient global assessment ( pga ) of the severity of knee oa , and @-min walk distance ( @mwd ) .',
     'serum levels of interleukin @ ( il-@ ) , il-@ , tumor necrosis factor ( tnf ) - , and high-sensitivity c-reactive protein ( hscrp ) were measured .',
     'there was a clinically relevant reduction in the intervention group compared to the placebo group for knee pain , physical function , pga , and @mwd at @ weeks .',
     'the mean difference between treatment arms ( @ % ci ) was @ ( @-@ @ ) , p < @ ; @ ( @-@ @ ) , p < @ ; @ ( @-@ @ ) , p < @ ; and @ ( @-@ @ ) , p < @ , respectively .',
     'further , there was a clinically relevant reduction in the serum levels of il-@ , il-@ , tnf - , and hscrp at @ weeks in the intervention group when compared to the placebo group .',
     'these differences remained significant at @ weeks .']
</pre>
</div>

<p><strong>NOTE</strong> One-Hot is a group (or arrays) of bit data. Each data will have a value either 1 or 0.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1">1</a></span>
<span class="normal"><a href="#__codelineno-14-2">2</a></span>
<span class="normal"><a href="#__codelineno-14-3">3</a></span>
<span class="normal"><a href="#__codelineno-14-4">4</a></span>
<span class="normal"><a href="#__codelineno-14-5">5</a></span>
<span class="normal"><a href="#__codelineno-14-6">6</a></span>
<span class="normal"><a href="#__codelineno-14-7">7</a></span>
<span class="normal"><a href="#__codelineno-14-8">8</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="c1"># One hot encode labels</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="n">one_hot_encoder</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">sparse</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="n">train_labels_one_hot</span> <span class="o">=</span> <span class="n">one_hot_encoder</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="n">val_labels_one_hot</span> <span class="o">=</span> <span class="n">one_hot_encoder</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">val_df</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="n">test_labels_one_hot</span> <span class="o">=</span> <span class="n">one_hot_encoder</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-14-6" name="__codelineno-14-6"></a>
<a id="__codelineno-14-7" name="__codelineno-14-7"></a><span class="c1"># Check what training labels look like</span>
<a id="__codelineno-14-8" name="__codelineno-14-8"></a><span class="n">train_labels_one_hot</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    array([[0., 0., 0., 1., 0.],
           [0., 0., 1., 0., 0.],
           [0., 0., 1., 0., 0.],
           ...,
           [0., 0., 0., 0., 1.],
           [0., 1., 0., 0., 0.],
           [0., 1., 0., 0., 0.]])
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1">1</a></span>
<span class="normal"><a href="#__codelineno-15-2">2</a></span>
<span class="normal"><a href="#__codelineno-15-3">3</a></span>
<span class="normal"><a href="#__codelineno-15-4">4</a></span>
<span class="normal"><a href="#__codelineno-15-5">5</a></span>
<span class="normal"><a href="#__codelineno-15-6">6</a></span>
<span class="normal"><a href="#__codelineno-15-7">7</a></span>
<span class="normal"><a href="#__codelineno-15-8">8</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="c1"># Extract labels (&quot;target&quot; columns) and encode them into integers </span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="n">label_encoder</span> <span class="o">=</span> <span class="n">LabelEncoder</span><span class="p">()</span>
<a id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="n">train_labels_encoded</span> <span class="o">=</span> <span class="n">label_encoder</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
<a id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="n">val_labels_encoded</span> <span class="o">=</span> <span class="n">label_encoder</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">val_df</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
<a id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="n">test_labels_encoded</span> <span class="o">=</span> <span class="n">label_encoder</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
<a id="__codelineno-15-6" name="__codelineno-15-6"></a>
<a id="__codelineno-15-7" name="__codelineno-15-7"></a><span class="c1"># Check what training labels look like</span>
<a id="__codelineno-15-8" name="__codelineno-15-8"></a><span class="n">train_labels_encoded</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    array([3, 2, 2, ..., 4, 1, 1])
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1">1</a></span>
<span class="normal"><a href="#__codelineno-16-2">2</a></span>
<span class="normal"><a href="#__codelineno-16-3">3</a></span>
<span class="normal"><a href="#__codelineno-16-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="c1"># Get class names and number of classes from LabelEncoder instance </span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="n">num_classes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">label_encoder</span><span class="o">.</span><span class="n">classes_</span><span class="p">)</span>
<a id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="n">class_names</span> <span class="o">=</span> <span class="n">label_encoder</span><span class="o">.</span><span class="n">classes_</span>
<a id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="n">num_classes</span><span class="p">,</span> <span class="n">class_names</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (5, array(['BACKGROUND', 'CONCLUSIONS', 'METHODS', 'OBJECTIVE', 'RESULTS'],
           dtype=object))
</pre>
</div>

<h3 id="prepare-data-for-deep-sequence-model">Prepare Data for Deep Sequence Model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1">1</a></span>
<span class="normal"><a href="#__codelineno-17-2">2</a></span>
<span class="normal"><a href="#__codelineno-17-3">3</a></span>
<span class="normal"><a href="#__codelineno-17-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="c1"># How long is each sentence on average?</span>
<a id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="n">sent_lens</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">sentence</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">train_sentences</span><span class="p">]</span>
<a id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="n">avg_sent_len</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sent_lens</span><span class="p">)</span>
<a id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="n">avg_sent_len</span> <span class="c1"># return average sentence length (in tokens)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    26.338269273494777
</pre>
</div>

<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1">1</a></span>
<span class="normal"><a href="#__codelineno-18-2">2</a></span>
<span class="normal"><a href="#__codelineno-18-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="c1"># What&#39;s the distribution look like?</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<a id="__codelineno-18-3" name="__codelineno-18-3"></a><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">sent_lens</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">7</span><span class="p">);</span>
</code></pre></div>
</td></tr></table>
<img alt="nlp-2-2" src="../../../images/nlp-2-2.png" /></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1">1</a></span>
<span class="normal"><a href="#__codelineno-19-2">2</a></span>
<span class="normal"><a href="#__codelineno-19-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="c1"># How long of a sentence covers 95% of the lengths?</span>
<a id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="n">output_seq_len</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">sent_lens</span><span class="p">,</span> <span class="mi">95</span><span class="p">))</span>
<a id="__codelineno-19-3" name="__codelineno-19-3"></a><span class="n">output_seq_len</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    55
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1">1</a></span>
<span class="normal"><a href="#__codelineno-20-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="c1"># Maximum sentence length in the training set</span>
<a id="__codelineno-20-2" name="__codelineno-20-2"></a><span class="nb">max</span><span class="p">(</span><span class="n">sent_lens</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    296
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1">1</a></span>
<span class="normal"><a href="#__codelineno-21-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="c1"># How many words are in our vocabulary? (taken from 3.2 in https://arxiv.org/pdf/1710.06071.pdf)</span>
<a id="__codelineno-21-2" name="__codelineno-21-2"></a><span class="n">max_tokens</span> <span class="o">=</span> <span class="mi">68000</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1">1</a></span>
<span class="normal"><a href="#__codelineno-22-2">2</a></span>
<span class="normal"><a href="#__codelineno-22-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="c1"># Create text vectorizer</span>
<a id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="n">text_vectorizer</span> <span class="o">=</span> <span class="n">TextVectorization</span><span class="p">(</span><span class="n">max_tokens</span><span class="o">=</span><span class="n">max_tokens</span><span class="p">,</span> <span class="c1"># number of words in vocabulary</span>
<a id="__codelineno-22-3" name="__codelineno-22-3"></a>                                    <span class="n">output_sequence_length</span><span class="o">=</span><span class="mi">55</span><span class="p">)</span> <span class="c1"># desired output length of vectorized sequences</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1">1</a></span>
<span class="normal"><a href="#__codelineno-23-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="c1"># Adapt text vectorizer to training sentences</span>
<a id="__codelineno-23-2" name="__codelineno-23-2"></a><span class="n">text_vectorizer</span><span class="o">.</span><span class="n">adapt</span><span class="p">(</span><span class="n">train_sentences</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1">1</a></span>
<span class="normal"><a href="#__codelineno-24-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="c1"># Adapt text vectorizer to training sentences</span>
<a id="__codelineno-24-2" name="__codelineno-24-2"></a><span class="n">text_vectorizer</span><span class="o">.</span><span class="n">adapt</span><span class="p">(</span><span class="n">train_sentences</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1">1</a></span>
<span class="normal"><a href="#__codelineno-25-2">2</a></span>
<span class="normal"><a href="#__codelineno-25-3">3</a></span>
<span class="normal"><a href="#__codelineno-25-4">4</a></span>
<span class="normal"><a href="#__codelineno-25-5">5</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="c1"># (Optional) Test out text vectorizer</span>
<a id="__codelineno-25-2" name="__codelineno-25-2"></a><span class="n">target_sentence</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">train_sentences</span><span class="p">)</span>
<a id="__codelineno-25-3" name="__codelineno-25-3"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Text:</span><span class="se">\n</span><span class="si">{</span><span class="n">target_sentence</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-25-4" name="__codelineno-25-4"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Length of text: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">target_sentence</span><span class="o">.</span><span class="n">split</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-25-5" name="__codelineno-25-5"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Vectorized text:</span><span class="se">\n</span><span class="si">{</span><span class="n">text_vectorizer</span><span class="p">([</span><span class="n">target_sentence</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Text:
    prospective multicentric randomized trial of @ patients , undergoing loop excision for cin @ + either under video exoscopy ( group a ) or colposcope ( group b ) guidance .

    Length of text: 31

    Vectorized text:
    [[  241 10666    29    32     4    12   295  5498  3158    11  2330   132
        353  1373 23181    13     8    16 20933    13   186  1879     0     0
          0     0     0     0     0     0     0     0     0     0     0     0
          0     0     0     0     0     0     0     0     0     0     0     0
          0     0     0     0     0     0     0]]
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-26-1">1</a></span>
<span class="normal"><a href="#__codelineno-26-2">2</a></span>
<span class="normal"><a href="#__codelineno-26-3">3</a></span>
<span class="normal"><a href="#__codelineno-26-4">4</a></span>
<span class="normal"><a href="#__codelineno-26-5">5</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="c1"># (Optional) How many words in our training vocabulary?</span>
<a id="__codelineno-26-2" name="__codelineno-26-2"></a><span class="n">rct_20k_text_vocab</span> <span class="o">=</span> <span class="n">text_vectorizer</span><span class="o">.</span><span class="n">get_vocabulary</span><span class="p">()</span>
<a id="__codelineno-26-3" name="__codelineno-26-3"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of words in vocabulary: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">rct_20k_text_vocab</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span> 
<a id="__codelineno-26-4" name="__codelineno-26-4"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Most common words in the vocabulary: </span><span class="si">{</span><span class="n">rct_20k_text_vocab</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-26-5" name="__codelineno-26-5"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Least common words in the vocabulary: </span><span class="si">{</span><span class="n">rct_20k_text_vocab</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Number of words in vocabulary: 64841
    Most common words in the vocabulary: ['', '[UNK]', 'the', 'and', 'of']
    Least common words in the vocabulary: ['aainduced', 'aaigroup', 'aachener', 'aachen', 'aaacp']
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-27-1">1</a></span>
<span class="normal"><a href="#__codelineno-27-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="c1"># (Optional) Get the config of our text vectorizer</span>
<a id="__codelineno-27-2" name="__codelineno-27-2"></a><span class="n">text_vectorizer</span><span class="o">.</span><span class="n">get_config</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    {'batch_input_shape': (None,),
     'dtype': 'string',
     'idf_weights': None,
     'max_tokens': 68000,
     'name': 'text_vectorization_2',
     'ngrams': None,
     'output_mode': 'int',
     'output_sequence_length': 55,
     'pad_to_max_tokens': False,
     'ragged': False,
     'sparse': False,
     'split': 'whitespace',
     'standardize': 'lower_and_strip_punctuation',
     'trainable': True,
     'vocabulary': None}
</pre>
</div>

<p><a name=""></a></p>
<h4 id="create-custom-text-embedding">Create Custom Text Embedding</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-28-1">1</a></span>
<span class="normal"><a href="#__codelineno-28-2">2</a></span>
<span class="normal"><a href="#__codelineno-28-3">3</a></span>
<span class="normal"><a href="#__codelineno-28-4">4</a></span>
<span class="normal"><a href="#__codelineno-28-5">5</a></span>
<span class="normal"><a href="#__codelineno-28-6">6</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="c1"># Create token embedding layer</span>
<a id="__codelineno-28-2" name="__codelineno-28-2"></a><span class="n">token_embed</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">input_dim</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">rct_20k_text_vocab</span><span class="p">),</span> <span class="c1"># length of vocabulary</span>
<a id="__codelineno-28-3" name="__codelineno-28-3"></a>                               <span class="n">output_dim</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="c1"># Note: different embedding sizes result in drastically different numbers of parameters to train</span>
<a id="__codelineno-28-4" name="__codelineno-28-4"></a>                               <span class="c1"># Use masking to handle variable sequence lengths (save space)</span>
<a id="__codelineno-28-5" name="__codelineno-28-5"></a>                               <span class="n">mask_zero</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-28-6" name="__codelineno-28-6"></a>                               <span class="n">name</span><span class="o">=</span><span class="s2">&quot;token_embedding&quot;</span><span class="p">)</span> 
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-29-1">1</a></span>
<span class="normal"><a href="#__codelineno-29-2">2</a></span>
<span class="normal"><a href="#__codelineno-29-3">3</a></span>
<span class="normal"><a href="#__codelineno-29-4">4</a></span>
<span class="normal"><a href="#__codelineno-29-5">5</a></span>
<span class="normal"><a href="#__codelineno-29-6">6</a></span>
<span class="normal"><a href="#__codelineno-29-7">7</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="c1"># (Optional) Show example embedding</span>
<a id="__codelineno-29-2" name="__codelineno-29-2"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sentence before vectorization:</span><span class="se">\n</span><span class="si">{</span><span class="n">target_sentence</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-29-3" name="__codelineno-29-3"></a><span class="n">vectorized_sentence</span> <span class="o">=</span> <span class="n">text_vectorizer</span><span class="p">([</span><span class="n">target_sentence</span><span class="p">])</span>
<a id="__codelineno-29-4" name="__codelineno-29-4"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sentence after vectorization (before embedding):</span><span class="se">\n</span><span class="si">{</span><span class="n">vectorized_sentence</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-29-5" name="__codelineno-29-5"></a><span class="n">embedded_sentence</span> <span class="o">=</span> <span class="n">token_embed</span><span class="p">(</span><span class="n">vectorized_sentence</span><span class="p">)</span>
<a id="__codelineno-29-6" name="__codelineno-29-6"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sentence after embedding:</span><span class="se">\n</span><span class="si">{</span><span class="n">embedded_sentence</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-29-7" name="__codelineno-29-7"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Embedded sentence shape: </span><span class="si">{</span><span class="n">embedded_sentence</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Sentence before vectorization:
    prospective multicentric randomized trial of @ patients , undergoing loop excision for cin @ + either under video exoscopy ( group a ) or colposcope ( group b ) guidance .

    Sentence after vectorization (before embedding):
    [[  241 10666    29    32     4    12   295  5498  3158    11  2330   132
        353  1373 23181    13     8    16 20933    13   186  1879     0     0
          0     0     0     0     0     0     0     0     0     0     0     0
          0     0     0     0     0     0     0     0     0     0     0     0
          0     0     0     0     0     0     0]]

    Sentence after embedding:
    [[[-0.03596031 -0.03662044  0.02917344 ...  0.03128146 -0.01113122
       -0.04365841]
      [-0.03456243 -0.02600585  0.00274545 ...  0.02926621  0.03903497
       -0.03427477]
      [ 0.01512977  0.03899566  0.02687288 ...  0.01343158  0.02693008
        0.00513365]
      ...
      [ 0.0143904   0.0455994   0.03651534 ... -0.0350372  -0.03307237
        0.02498827]
      [ 0.0143904   0.0455994   0.03651534 ... -0.0350372  -0.03307237
        0.02498827]
      [ 0.0143904   0.0455994   0.03651534 ... -0.0350372  -0.03307237
        0.02498827]]]

    Embedded sentence shape: (1, 55, 128)
</pre>
</div>

<p><a name=""></a></p>
<h4 id="create-dataset-as-fast-as-possible">Create Dataset (as fast as possible)</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-30-1">1</a></span>
<span class="normal"><a href="#__codelineno-30-2">2</a></span>
<span class="normal"><a href="#__codelineno-30-3">3</a></span>
<span class="normal"><a href="#__codelineno-30-4">4</a></span>
<span class="normal"><a href="#__codelineno-30-5">5</a></span>
<span class="normal"><a href="#__codelineno-30-6">6</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1"></a><span class="c1"># Turn our data into TensorFlow Datasets</span>
<a id="__codelineno-30-2" name="__codelineno-30-2"></a><span class="n">train_dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_tensor_slices</span><span class="p">((</span><span class="n">train_sentences</span><span class="p">,</span> <span class="n">train_labels_one_hot</span><span class="p">))</span>
<a id="__codelineno-30-3" name="__codelineno-30-3"></a><span class="n">valid_dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_tensor_slices</span><span class="p">((</span><span class="n">val_sentences</span><span class="p">,</span> <span class="n">val_labels_one_hot</span><span class="p">))</span>
<a id="__codelineno-30-4" name="__codelineno-30-4"></a><span class="n">test_dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_tensor_slices</span><span class="p">((</span><span class="n">test_sentences</span><span class="p">,</span> <span class="n">test_labels_one_hot</span><span class="p">))</span>
<a id="__codelineno-30-5" name="__codelineno-30-5"></a>
<a id="__codelineno-30-6" name="__codelineno-30-6"></a><span class="n">train_dataset</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    TensorSliceDataset shapes: ((), (5,)), types: (tf.string, tf.float64)
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-31-1">1</a></span>
<span class="normal"><a href="#__codelineno-31-2">2</a></span>
<span class="normal"><a href="#__codelineno-31-3">3</a></span>
<span class="normal"><a href="#__codelineno-31-4">4</a></span>
<span class="normal"><a href="#__codelineno-31-5">5</a></span>
<span class="normal"><a href="#__codelineno-31-6">6</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1"></a><span class="c1"># Take the TensorSliceDataset&#39;s and turn them into prefetched batches</span>
<a id="__codelineno-31-2" name="__codelineno-31-2"></a><span class="n">train_dataset</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span><span class="o">.</span><span class="n">prefetch</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">AUTOTUNE</span><span class="p">)</span>
<a id="__codelineno-31-3" name="__codelineno-31-3"></a><span class="n">valid_dataset</span> <span class="o">=</span> <span class="n">valid_dataset</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span><span class="o">.</span><span class="n">prefetch</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">AUTOTUNE</span><span class="p">)</span>
<a id="__codelineno-31-4" name="__codelineno-31-4"></a><span class="n">test_dataset</span> <span class="o">=</span> <span class="n">test_dataset</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span><span class="o">.</span><span class="n">prefetch</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">AUTOTUNE</span><span class="p">)</span>
<a id="__codelineno-31-5" name="__codelineno-31-5"></a>
<a id="__codelineno-31-6" name="__codelineno-31-6"></a><span class="n">train_dataset</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    PrefetchDataset shapes: ((None,), (None, 5)), types: (tf.string, tf.float64)
</pre>
</div>

<p><a name=""></a></p>
<h3 id="prepare-data-for-character-embedding">Prepare Data for Character Embedding</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-32-1">1</a></span>
<span class="normal"><a href="#__codelineno-32-2">2</a></span>
<span class="normal"><a href="#__codelineno-32-3">3</a></span>
<span class="normal"><a href="#__codelineno-32-4">4</a></span>
<span class="normal"><a href="#__codelineno-32-5">5</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1"></a><span class="c1"># Split sequence-level data splits into character-level data splits</span>
<a id="__codelineno-32-2" name="__codelineno-32-2"></a><span class="n">train_chars</span> <span class="o">=</span> <span class="p">[</span><span class="n">split_chars</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span> <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">train_sentences</span><span class="p">]</span>
<a id="__codelineno-32-3" name="__codelineno-32-3"></a><span class="n">val_chars</span> <span class="o">=</span> <span class="p">[</span><span class="n">split_chars</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span> <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">val_sentences</span><span class="p">]</span>
<a id="__codelineno-32-4" name="__codelineno-32-4"></a><span class="n">test_chars</span> <span class="o">=</span> <span class="p">[</span><span class="n">split_chars</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span> <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">test_sentences</span><span class="p">]</span>
<a id="__codelineno-32-5" name="__codelineno-32-5"></a><span class="nb">print</span><span class="p">(</span><span class="n">train_chars</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    t o   i n v e s t i g a t e   t h e   e f f i c a c y   o f   @   w e e k s   o f   d a i l y   l o w - d o s e   o r a l   p r e d n i s o l o n e   i n   i m p r o v i n g   p a i n   ,   m o b i l i t y   ,   a n d   s y s t e m i c   l o w - g r a d e   i n f l a m m a t i o n   i n   t h e   s h o r t   t e r m   a n d   w h e t h e r   t h e   e f f e c t   w o u l d   b e   s u s t a i n e d   a t   @   w e e k s   i n   o l d e r   a d u l t s   w i t h   m o d e r a t e   t o   s e v e r e   k n e e   o s t e o a r t h r i t i s   (   o a   )   .
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-33-1">1</a></span>
<span class="normal"><a href="#__codelineno-33-2">2</a></span>
<span class="normal"><a href="#__codelineno-33-3">3</a></span>
<span class="normal"><a href="#__codelineno-33-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="c1"># What&#39;s the average character length?</span>
<a id="__codelineno-33-2" name="__codelineno-33-2"></a><span class="n">char_lens</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span> <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">train_sentences</span><span class="p">]</span>
<a id="__codelineno-33-3" name="__codelineno-33-3"></a><span class="n">mean_char_len</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">char_lens</span><span class="p">)</span>
<a id="__codelineno-33-4" name="__codelineno-33-4"></a><span class="n">mean_char_len</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    149.3662574983337
</pre>
</div>

<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-34-1">1</a></span>
<span class="normal"><a href="#__codelineno-34-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1"></a><span class="c1"># Check the distribution of our sequences at character-level</span>
<a id="__codelineno-34-2" name="__codelineno-34-2"></a><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">char_lens</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">7</span><span class="p">);</span>
</code></pre></div>
</td></tr></table>
<img alt="nlp-2-3" src="../../../images/nlp-2-3.png" /></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-35-1">1</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1"></a><span class="c1"># Find what character length covers 95% of sequencesoutput_seq_char_len = int(np.percentile(char_lens, 95))output_seq_char_len</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    290
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-36-1">1</a></span>
<span class="normal"><a href="#__codelineno-36-2">2</a></span>
<span class="normal"><a href="#__codelineno-36-3">3</a></span>
<span class="normal"><a href="#__codelineno-36-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1"></a><span class="c1"># Get all keyboard characters for char-level embedding</span>
<a id="__codelineno-36-2" name="__codelineno-36-2"></a><span class="kn">import</span> <span class="nn">string</span>
<a id="__codelineno-36-3" name="__codelineno-36-3"></a><span class="n">alphabet</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">punctuation</span>
<a id="__codelineno-36-4" name="__codelineno-36-4"></a><span class="n">alphabet</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    'abcdefghijklmnopqrstuvwxyz0123456789!"#$%&\'()*+,-./:;<=>?@[\\]^_`{|}~'
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-37-1">1</a></span>
<span class="normal"><a href="#__codelineno-37-2">2</a></span>
<span class="normal"><a href="#__codelineno-37-3">3</a></span>
<span class="normal"><a href="#__codelineno-37-4">4</a></span>
<span class="normal"><a href="#__codelineno-37-5">5</a></span>
<span class="normal"><a href="#__codelineno-37-6">6</a></span>
<span class="normal"><a href="#__codelineno-37-7">7</a></span>
<span class="normal"><a href="#__codelineno-37-8">8</a></span>
<span class="normal"><a href="#__codelineno-37-9">9</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1"></a><span class="c1"># Create char-level token vectorizer instance</span>
<a id="__codelineno-37-2" name="__codelineno-37-2"></a><span class="n">NUM_CHAR_TOKENS</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">alphabet</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="c1"># num characters in alphabet + space + OOV token</span>
<a id="__codelineno-37-3" name="__codelineno-37-3"></a><span class="n">char_vectorizer</span> <span class="o">=</span> <span class="n">TextVectorization</span><span class="p">(</span><span class="n">max_tokens</span><span class="o">=</span><span class="n">NUM_CHAR_TOKENS</span><span class="p">,</span>  
<a id="__codelineno-37-4" name="__codelineno-37-4"></a>                                    <span class="n">output_sequence_length</span><span class="o">=</span><span class="n">output_seq_char_len</span><span class="p">,</span>
<a id="__codelineno-37-5" name="__codelineno-37-5"></a>                                    <span class="n">standardize</span><span class="o">=</span><span class="s2">&quot;lower_and_strip_punctuation&quot;</span><span class="p">,</span>
<a id="__codelineno-37-6" name="__codelineno-37-6"></a>                                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;char_vectorizer&quot;</span><span class="p">)</span>
<a id="__codelineno-37-7" name="__codelineno-37-7"></a>
<a id="__codelineno-37-8" name="__codelineno-37-8"></a><span class="c1"># Adapt character vectorizer to training characters</span>
<a id="__codelineno-37-9" name="__codelineno-37-9"></a><span class="n">char_vectorizer</span><span class="o">.</span><span class="n">adapt</span><span class="p">(</span><span class="n">train_chars</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-38-1">1</a></span>
<span class="normal"><a href="#__codelineno-38-2">2</a></span>
<span class="normal"><a href="#__codelineno-38-3">3</a></span>
<span class="normal"><a href="#__codelineno-38-4">4</a></span>
<span class="normal"><a href="#__codelineno-38-5">5</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1"></a><span class="c1"># (Optional) Check character vocabulary characteristics</span>
<a id="__codelineno-38-2" name="__codelineno-38-2"></a><span class="n">char_vocab</span> <span class="o">=</span> <span class="n">char_vectorizer</span><span class="o">.</span><span class="n">get_vocabulary</span><span class="p">()</span>
<a id="__codelineno-38-3" name="__codelineno-38-3"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of different characters in character vocab: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">char_vocab</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-38-4" name="__codelineno-38-4"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;5 most common characters: </span><span class="si">{</span><span class="n">char_vocab</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-38-5" name="__codelineno-38-5"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;5 least common characters: </span><span class="si">{</span><span class="n">char_vocab</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Number of different characters in character vocab: 28
    5 most common characters: ['', '[UNK]', 'e', 't', 'i']
    5 least common characters: ['k', 'x', 'z', 'q', 'j']
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-39-1">1</a></span>
<span class="normal"><a href="#__codelineno-39-2">2</a></span>
<span class="normal"><a href="#__codelineno-39-3">3</a></span>
<span class="normal"><a href="#__codelineno-39-4">4</a></span>
<span class="normal"><a href="#__codelineno-39-5">5</a></span>
<span class="normal"><a href="#__codelineno-39-6">6</a></span>
<span class="normal"><a href="#__codelineno-39-7">7</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1"></a><span class="c1"># (Optional) Test out character vectorizer</span>
<a id="__codelineno-39-2" name="__codelineno-39-2"></a><span class="n">random_train_chars</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">train_chars</span><span class="p">)</span>
<a id="__codelineno-39-3" name="__codelineno-39-3"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Charified text:</span><span class="se">\n</span><span class="si">{</span><span class="n">random_train_chars</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-39-4" name="__codelineno-39-4"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Length of chars: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">random_train_chars</span><span class="o">.</span><span class="n">split</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-39-5" name="__codelineno-39-5"></a><span class="n">vectorized_chars</span> <span class="o">=</span> <span class="n">char_vectorizer</span><span class="p">([</span><span class="n">random_train_chars</span><span class="p">])</span>
<a id="__codelineno-39-6" name="__codelineno-39-6"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Vectorized chars:</span><span class="se">\n</span><span class="si">{</span><span class="n">vectorized_chars</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-39-7" name="__codelineno-39-7"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Length of vectorized chars: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">vectorized_chars</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Charified text:
    t o   d e t e r m i n e   w h e t h e r   a   h o m e   e x e r c i s e   p r o g r a m   w i t h   m i n i m a l   c o n t a c t   w i t h   a   p h y s i c a l   t h e r a p i s t   i m p r o v e d   f u n c t i o n   a f t e r   f o r m a l   h i p   f r a c t u r e   r e h a b i l i t a t i o n   e n d e d   .

    Length of chars: 136

    Vectorized chars:
    [[ 3  7 10  2  3  2  8 15  4  6  2 20 13  2  3 13  2  8  5 13  7 15  2  2
      24  2  8 11  4  9  2 14  8  7 18  8  5 15 20  4  3 13 15  4  6  4 15  5
      12 11  7  6  3  5 11  3 20  4  3 13  5 14 13 19  9  4 11  5 12  3 13  2
       8  5 14  4  9  3  4 15 14  8  7 21  2 10 17 16  6 11  3  4  7  6  5 17
       3  2  8 17  7  8 15  5 12 13  4 14 17  8  5 11  3 16  8  2  8  2 13  5
      22  4 12  4  3  5  3  4  7  6  2  6 10  2 10  0  0  0  0  0  0  0  0  0
       0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
       0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
       0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
       0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
       0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
       0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
       0  0]]

    Length of vectorized chars: 290
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-40-1">1</a></span>
<span class="normal"><a href="#__codelineno-40-2">2</a></span>
<span class="normal"><a href="#__codelineno-40-3">3</a></span>
<span class="normal"><a href="#__codelineno-40-4">4</a></span>
<span class="normal"><a href="#__codelineno-40-5">5</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1"></a><span class="c1"># Create char datasets</span>
<a id="__codelineno-40-2" name="__codelineno-40-2"></a><span class="n">train_char_dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_tensor_slices</span><span class="p">((</span><span class="n">train_chars</span><span class="p">,</span> <span class="n">train_labels_one_hot</span><span class="p">))</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span><span class="o">.</span><span class="n">prefetch</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">AUTOTUNE</span><span class="p">)</span>
<a id="__codelineno-40-3" name="__codelineno-40-3"></a><span class="n">val_char_dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_tensor_slices</span><span class="p">((</span><span class="n">val_chars</span><span class="p">,</span> <span class="n">val_labels_one_hot</span><span class="p">))</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span><span class="o">.</span><span class="n">prefetch</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">AUTOTUNE</span><span class="p">)</span>
<a id="__codelineno-40-4" name="__codelineno-40-4"></a>
<a id="__codelineno-40-5" name="__codelineno-40-5"></a><span class="n">train_char_dataset</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    PrefetchDataset shapes: ((None,), (None, 5)), types: (tf.string, tf.float64)
</pre>
</div>

<p><a name=""></a></p>
<h3 id="prepare-data-for-hybrid-model-token-and-character">Prepare Data for Hybrid Model (token and character)</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-41-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-41-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-41-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-41-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-41-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-41-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-41-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-41-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-41-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-41-10">10</a></span>
<span class="normal"><a href="#__codelineno-41-11">11</a></span>
<span class="normal"><a href="#__codelineno-41-12">12</a></span>
<span class="normal"><a href="#__codelineno-41-13">13</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1"></a><span class="c1"># Combine chars and tokens into a dataset</span>
<a id="__codelineno-41-2" name="__codelineno-41-2"></a><span class="n">train_char_token_data</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_tensor_slices</span><span class="p">((</span><span class="n">train_sentences</span><span class="p">,</span> <span class="n">train_chars</span><span class="p">))</span> <span class="c1"># make data</span>
<a id="__codelineno-41-3" name="__codelineno-41-3"></a><span class="n">train_char_token_labels</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_tensor_slices</span><span class="p">(</span><span class="n">train_labels_one_hot</span><span class="p">)</span> <span class="c1"># make labels</span>
<a id="__codelineno-41-4" name="__codelineno-41-4"></a><span class="n">train_char_token_dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">zip</span><span class="p">((</span><span class="n">train_char_token_data</span><span class="p">,</span> <span class="n">train_char_token_labels</span><span class="p">))</span> <span class="c1"># combine data and labels</span>
<a id="__codelineno-41-5" name="__codelineno-41-5"></a>
<a id="__codelineno-41-6" name="__codelineno-41-6"></a><span class="c1"># Prefetch and batch train data</span>
<a id="__codelineno-41-7" name="__codelineno-41-7"></a><span class="n">train_char_token_dataset</span> <span class="o">=</span> <span class="n">train_char_token_dataset</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span><span class="o">.</span><span class="n">prefetch</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">AUTOTUNE</span><span class="p">)</span> 
<a id="__codelineno-41-8" name="__codelineno-41-8"></a>
<a id="__codelineno-41-9" name="__codelineno-41-9"></a><span class="c1"># Repeat same steps validation data</span>
<a id="__codelineno-41-10" name="__codelineno-41-10"></a><span class="n">val_char_token_data</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_tensor_slices</span><span class="p">((</span><span class="n">val_sentences</span><span class="p">,</span> <span class="n">val_chars</span><span class="p">))</span>
<a id="__codelineno-41-11" name="__codelineno-41-11"></a><span class="n">val_char_token_labels</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_tensor_slices</span><span class="p">(</span><span class="n">val_labels_one_hot</span><span class="p">)</span>
<a id="__codelineno-41-12" name="__codelineno-41-12"></a><span class="n">val_char_token_dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">zip</span><span class="p">((</span><span class="n">val_char_token_data</span><span class="p">,</span> <span class="n">val_char_token_labels</span><span class="p">))</span>
<a id="__codelineno-41-13" name="__codelineno-41-13"></a><span class="n">val_char_token_dataset</span> <span class="o">=</span> <span class="n">val_char_token_dataset</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span><span class="o">.</span><span class="n">prefetch</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">AUTOTUNE</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-42-1">1</a></span>
<span class="normal"><a href="#__codelineno-42-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1"></a><span class="c1"># Check out training char and token embedding dataset</span>
<a id="__codelineno-42-2" name="__codelineno-42-2"></a><span class="n">train_char_token_dataset</span><span class="p">,</span> <span class="n">val_char_token_dataset</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (PrefetchDataset shapes: (((None,), (None,)), (None, 5)), types: ((tf.string, tf.string), tf.float64),
     PrefetchDataset shapes: (((None,), (None,)), (None, 5)), types: ((tf.string, tf.string), tf.float64))
</pre>
</div>

<p><a name=""></a></p>
<h3 id="prepare-data-for-positional-embedding">Prepare Data for Positional Embedding</h3>
<p><a name=""></a></p>
<h4 id="prepare-data_1">Prepare Data</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-43-1">1</a></span>
<span class="normal"><a href="#__codelineno-43-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1"></a><span class="c1"># (Optional) How many different line numbers are there?</span>
<a id="__codelineno-43-2" name="__codelineno-43-2"></a><span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;line_number&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    0     15000
    1     15000
    2     15000
    3     15000
    4     14992
    5     14949
    6     14758
    7     14279
    8     13346
    9     11981
    10    10041
    11     7892
    12     5853
    13     4152
    14     2835
    15     1861
    16     1188
    17      751
    18      462
    19      286
    20      162
    21      101
    22       66
    23       33
    24       22
    25       14
    26        7
    27        4
    28        3
    29        1
    30        1
    Name: line_number, dtype: int64
</pre>
</div>

<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-44-1">1</a></span>
<span class="normal"><a href="#__codelineno-44-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1"></a><span class="c1"># (Optional) Check the distribution of &quot;line_number&quot; column</span>
<a id="__codelineno-44-2" name="__codelineno-44-2"></a><span class="n">train_df</span><span class="o">.</span><span class="n">line_number</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<img alt="nlp-2-4" src="../../../images/nlp-2-4.png" /></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-45-1">1</a></span>
<span class="normal"><a href="#__codelineno-45-2">2</a></span>
<span class="normal"><a href="#__codelineno-45-3">3</a></span>
<span class="normal"><a href="#__codelineno-45-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1"></a><span class="c1"># Use TensorFlow to create one-hot-encoded tensors of our &quot;line_number&quot; column </span>
<a id="__codelineno-45-2" name="__codelineno-45-2"></a><span class="n">train_line_numbers_one_hot</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">one_hot</span><span class="p">(</span><span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;line_number&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span> <span class="n">depth</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<a id="__codelineno-45-3" name="__codelineno-45-3"></a><span class="n">val_line_numbers_one_hot</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">one_hot</span><span class="p">(</span><span class="n">val_df</span><span class="p">[</span><span class="s2">&quot;line_number&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span> <span class="n">depth</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<a id="__codelineno-45-4" name="__codelineno-45-4"></a><span class="n">test_line_numbers_one_hot</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">one_hot</span><span class="p">(</span><span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;line_number&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span> <span class="n">depth</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-46-1">1</a></span>
<span class="normal"><a href="#__codelineno-46-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1"></a><span class="c1"># (Optional) Check one-hot encoded &quot;line_number&quot; feature samples</span>
<a id="__codelineno-46-2" name="__codelineno-46-2"></a><span class="n">train_line_numbers_one_hot</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">train_line_numbers_one_hot</span><span class="p">[:</span><span class="mi">20</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (TensorShape([180040, 15]), tf.Tensor: shape=(20, 15), dtype=float32, numpy=
     array([[1., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
            [0., 1., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
            [0., 0., 1., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
            [0., 0., 0., 1., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
            [0., 0., 0., 0., 1., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
            [0., 0., 0., 0., 0., 1., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
            [0., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0., 0., 0., 0., 0.],
            [0., 0., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0., 0., 0., 0.],
            [0., 0., 0., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0., 0., 0.],
            [0., 0., 0., 0., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0., 0.],
            [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0.],
            [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 1., 0., 0., 0.],
            [1., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
            [0., 1., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
            [0., 0., 1., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
            [0., 0., 0., 1., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
            [0., 0., 0., 0., 1., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
            [0., 0., 0., 0., 0., 1., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
            [0., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0., 0., 0., 0., 0.],
            [0., 0., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0., 0., 0., 0.]],
           dtype=float32))
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-47-1">1</a></span>
<span class="normal"><a href="#__codelineno-47-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1"></a><span class="c1"># How many different numbers of lines are there?</span>
<a id="__codelineno-47-2" name="__codelineno-47-2"></a><span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;total_lines&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    11    24468
    10    23639
    12    22113
    9     19400
    13    18438
    14    14610
    8     12285
    15    10768
    7      7464
    16     7429
    17     5202
    6      3353
    18     3344
    19     2480
    20     1281
    5      1146
    21      770
    22      759
    23      264
    4       215
    24      200
    25      182
    26       81
    28       58
    3        32
    30       31
    27       28
    Name: total_lines, dtype: int64
</pre>
</div>

<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-48-1">1</a></span>
<span class="normal"><a href="#__codelineno-48-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1"></a><span class="c1"># Check the distribution of total lines</span>
<a id="__codelineno-48-2" name="__codelineno-48-2"></a><span class="n">train_df</span><span class="o">.</span><span class="n">total_lines</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">();</span>
</code></pre></div>
</td></tr></table>
<img alt="nlp-2-5" src="../../../images/nlp-2-5.png" /></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-49-1">1</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1"></a><span class="c1"># Check the coverage of a &quot;total_lines&quot; value of 20np.percentile(train_df.total_lines, 98) # a value of 20 covers 98% of samples</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    20.0
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-50-1">1</a></span>
<span class="normal"><a href="#__codelineno-50-2">2</a></span>
<span class="normal"><a href="#__codelineno-50-3">3</a></span>
<span class="normal"><a href="#__codelineno-50-4">4</a></span>
<span class="normal"><a href="#__codelineno-50-5">5</a></span>
<span class="normal"><a href="#__codelineno-50-6">6</a></span>
<span class="normal"><a href="#__codelineno-50-7">7</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1"></a><span class="c1"># Use TensorFlow to create one-hot-encoded tensors of our &quot;total_lines&quot; column </span>
<a id="__codelineno-50-2" name="__codelineno-50-2"></a><span class="n">train_total_lines_one_hot</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">one_hot</span><span class="p">(</span><span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;total_lines&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span> <span class="n">depth</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<a id="__codelineno-50-3" name="__codelineno-50-3"></a><span class="n">val_total_lines_one_hot</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">one_hot</span><span class="p">(</span><span class="n">val_df</span><span class="p">[</span><span class="s2">&quot;total_lines&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span> <span class="n">depth</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<a id="__codelineno-50-4" name="__codelineno-50-4"></a><span class="n">test_total_lines_one_hot</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">one_hot</span><span class="p">(</span><span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;total_lines&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span> <span class="n">depth</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<a id="__codelineno-50-5" name="__codelineno-50-5"></a>
<a id="__codelineno-50-6" name="__codelineno-50-6"></a><span class="c1"># Check shape and samples of total lines one-hot tensor</span>
<a id="__codelineno-50-7" name="__codelineno-50-7"></a><span class="n">train_total_lines_one_hot</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">train_total_lines_one_hot</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (TensorShape([180040, 20]), (tf.Tensor: shape=(10, 20), dtype=float32, numpy=
     array([[0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0.,
             0., 0., 0., 0.],
            [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0.,
             0., 0., 0., 0.],
            [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0.,
             0., 0., 0., 0.],
            [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0.,
             0., 0., 0., 0.],
            [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0.,
             0., 0., 0., 0.],
            [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0.,
             0., 0., 0., 0.],
            [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0.,
             0., 0., 0., 0.],
            [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0.,
             0., 0., 0., 0.],
            [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0.,
             0., 0., 0., 0.],
            [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0.,
             0., 0., 0., 0.]], dtype=float32)))
</pre>
</div>

<p><a name=""></a></p>
<h4 id="create-training-and-validation-set">Create Training and Validation Set</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-51-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-51-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-51-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-51-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-51-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-51-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-51-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-51-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-51-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-51-10">10</a></span>
<span class="normal"><a href="#__codelineno-51-11">11</a></span>
<span class="normal"><a href="#__codelineno-51-12">12</a></span>
<span class="normal"><a href="#__codelineno-51-13">13</a></span>
<span class="normal"><a href="#__codelineno-51-14">14</a></span>
<span class="normal"><a href="#__codelineno-51-15">15</a></span>
<span class="normal"><a href="#__codelineno-51-16">16</a></span>
<span class="normal"><a href="#__codelineno-51-17">17</a></span>
<span class="normal"><a href="#__codelineno-51-18">18</a></span>
<span class="normal"><a href="#__codelineno-51-19">19</a></span>
<span class="normal"><a href="#__codelineno-51-20">20</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1"></a><span class="c1"># Create training and validation datasets (all four kinds of inputs)</span>
<a id="__codelineno-51-2" name="__codelineno-51-2"></a><span class="n">train_pos_char_token_data</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_tensor_slices</span><span class="p">((</span><span class="n">train_line_numbers_one_hot</span><span class="p">,</span> <span class="c1"># line numbers</span>
<a id="__codelineno-51-3" name="__codelineno-51-3"></a>                                                                <span class="n">train_total_lines_one_hot</span><span class="p">,</span> <span class="c1"># total lines</span>
<a id="__codelineno-51-4" name="__codelineno-51-4"></a>                                                                <span class="n">train_sentences</span><span class="p">,</span> <span class="c1"># train tokens</span>
<a id="__codelineno-51-5" name="__codelineno-51-5"></a>                                                                <span class="n">train_chars</span><span class="p">))</span> <span class="c1"># train chars</span>
<a id="__codelineno-51-6" name="__codelineno-51-6"></a><span class="n">train_pos_char_token_labels</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_tensor_slices</span><span class="p">(</span><span class="n">train_labels_one_hot</span><span class="p">)</span> <span class="c1"># train labels</span>
<a id="__codelineno-51-7" name="__codelineno-51-7"></a><span class="n">train_pos_char_token_dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">zip</span><span class="p">((</span><span class="n">train_pos_char_token_data</span><span class="p">,</span> <span class="n">train_pos_char_token_labels</span><span class="p">))</span> <span class="c1"># combine data and labels</span>
<a id="__codelineno-51-8" name="__codelineno-51-8"></a><span class="n">train_pos_char_token_dataset</span> <span class="o">=</span> <span class="n">train_pos_char_token_dataset</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span><span class="o">.</span><span class="n">prefetch</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">AUTOTUNE</span><span class="p">)</span> <span class="c1"># turn into batches and prefetch appropriately</span>
<a id="__codelineno-51-9" name="__codelineno-51-9"></a>
<a id="__codelineno-51-10" name="__codelineno-51-10"></a><span class="c1"># Validation dataset</span>
<a id="__codelineno-51-11" name="__codelineno-51-11"></a><span class="n">val_pos_char_token_data</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_tensor_slices</span><span class="p">((</span><span class="n">val_line_numbers_one_hot</span><span class="p">,</span>
<a id="__codelineno-51-12" name="__codelineno-51-12"></a>                                                              <span class="n">val_total_lines_one_hot</span><span class="p">,</span>
<a id="__codelineno-51-13" name="__codelineno-51-13"></a>                                                              <span class="n">val_sentences</span><span class="p">,</span>
<a id="__codelineno-51-14" name="__codelineno-51-14"></a>                                                              <span class="n">val_chars</span><span class="p">))</span>
<a id="__codelineno-51-15" name="__codelineno-51-15"></a><span class="n">val_pos_char_token_labels</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_tensor_slices</span><span class="p">(</span><span class="n">val_labels_one_hot</span><span class="p">)</span>
<a id="__codelineno-51-16" name="__codelineno-51-16"></a><span class="n">val_pos_char_token_dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">zip</span><span class="p">((</span><span class="n">val_pos_char_token_data</span><span class="p">,</span> <span class="n">val_pos_char_token_labels</span><span class="p">))</span>
<a id="__codelineno-51-17" name="__codelineno-51-17"></a><span class="n">val_pos_char_token_dataset</span> <span class="o">=</span> <span class="n">val_pos_char_token_dataset</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span><span class="o">.</span><span class="n">prefetch</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">AUTOTUNE</span><span class="p">)</span> <span class="c1"># turn into batches and prefetch appropriately</span>
<a id="__codelineno-51-18" name="__codelineno-51-18"></a>
<a id="__codelineno-51-19" name="__codelineno-51-19"></a><span class="c1"># Check input shapes</span>
<a id="__codelineno-51-20" name="__codelineno-51-20"></a><span class="n">train_pos_char_token_dataset</span><span class="p">,</span> <span class="n">val_pos_char_token_dataset</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    ((PrefetchDataset shapes: (((None, 15), (None, 20), (None,), (None,)), (None, 5)), types: ((tf.float32, tf.float32, tf.string, tf.string), tf.float64)),
     (PrefetchDataset shapes: (((None, 15), (None, 20), (None,), (None,)), (None, 5)), types: ((tf.float32, tf.float32, tf.string, tf.string), tf.float64)))
</pre>
</div>

<p><a name="model-0"></a></p>
<h2 id="model-0-base-model">Model 0: Base Model</h2>
<p>A TF-IDF Multinomial Naive Bayes as recommended by Scikit-Learn's machine learning map.</p>
<p><a name=""></a></p>
<h3 id="create-compile-and-fit-model">Create, Compile, and Fit model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-52-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-52-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-52-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-52-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-52-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-52-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-52-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-52-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-52-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-52-10">10</a></span>
<span class="normal"><a href="#__codelineno-52-11">11</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1"></a><span class="c1"># CREATE MODEL</span>
<a id="__codelineno-52-2" name="__codelineno-52-2"></a><span class="c1"># Create pipeline</span>
<a id="__codelineno-52-3" name="__codelineno-52-3"></a><span class="n">model_0</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
<a id="__codelineno-52-4" name="__codelineno-52-4"></a>                    <span class="p">(</span><span class="s2">&quot;tf-idf&quot;</span><span class="p">,</span> <span class="n">TfidfVectorizer</span><span class="p">()),</span>
<a id="__codelineno-52-5" name="__codelineno-52-5"></a>                     <span class="p">(</span><span class="s2">&quot;clf&quot;</span><span class="p">,</span> <span class="n">MultinomialNB</span><span class="p">())</span>
<a id="__codelineno-52-6" name="__codelineno-52-6"></a><span class="p">])</span>
<a id="__codelineno-52-7" name="__codelineno-52-7"></a>
<a id="__codelineno-52-8" name="__codelineno-52-8"></a><span class="c1"># FIT MODEL</span>
<a id="__codelineno-52-9" name="__codelineno-52-9"></a><span class="c1"># Fit pipeline</span>
<a id="__codelineno-52-10" name="__codelineno-52-10"></a><span class="n">model_0</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">train_sentences</span><span class="p">,</span>
<a id="__codelineno-52-11" name="__codelineno-52-11"></a>            <span class="n">y</span><span class="o">=</span><span class="n">train_labels_encoded</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Pipeline(steps=[('tf-idf', TfidfVectorizer()), ('clf', MultinomialNB())])
</pre>
</div>

<p><a name=""></a></p>
<h3 id="evaluate-model">Evaluate Model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-53-1">1</a></span>
<span class="normal"><a href="#__codelineno-53-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1"></a><span class="n">baseline_preds</span> <span class="o">=</span> <span class="n">model_0</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">val_sentences</span><span class="p">)</span>
<a id="__codelineno-53-2" name="__codelineno-53-2"></a><span class="n">baseline_preds</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    array([4, 1, 3, ..., 4, 4, 1])
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-54-1">1</a></span>
<span class="normal"><a href="#__codelineno-54-2">2</a></span>
<span class="normal"><a href="#__codelineno-54-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1"></a><span class="c1"># Calculate baseline results</span>
<a id="__codelineno-54-2" name="__codelineno-54-2"></a><span class="n">baseline_results</span> <span class="o">=</span> <span class="n">calculate_results</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">val_labels_encoded</span><span class="p">,</span>
<a id="__codelineno-54-3" name="__codelineno-54-3"></a>                                     <span class="n">y_pred</span><span class="o">=</span><span class="n">baseline_preds</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<p><a name="model-1"></a></p>
<h2 id="model-1-conv1d-with-token-embedding"><strong>Model 1: Conv1D with Token Embedding</strong></h2>
<p><a name=""></a></p>
<h3 id="create-compile-and-fit-model_1">Create, Compile, and Fit model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-55-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-55-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-55-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-55-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-55-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-55-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-55-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-55-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-55-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-55-10">10</a></span>
<span class="normal"><a href="#__codelineno-55-11">11</a></span>
<span class="normal"><a href="#__codelineno-55-12">12</a></span>
<span class="normal"><a href="#__codelineno-55-13">13</a></span>
<span class="normal"><a href="#__codelineno-55-14">14</a></span>
<span class="normal"><a href="#__codelineno-55-15">15</a></span>
<span class="normal"><a href="#__codelineno-55-16">16</a></span>
<span class="normal"><a href="#__codelineno-55-17">17</a></span>
<span class="normal"><a href="#__codelineno-55-18">18</a></span>
<span class="normal"><a href="#__codelineno-55-19">19</a></span>
<span class="normal"><a href="#__codelineno-55-20">20</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1"></a><span class="c1"># CREATE MODEL (Create 1D convolutional model to process squences)</span>
<a id="__codelineno-55-2" name="__codelineno-55-2"></a><span class="n">inputs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">string</span><span class="p">)</span>
<a id="__codelineno-55-3" name="__codelineno-55-3"></a><span class="n">text_vectors</span> <span class="o">=</span> <span class="n">text_vectorizer</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span> <span class="c1"># vectorize text inputs</span>
<a id="__codelineno-55-4" name="__codelineno-55-4"></a><span class="n">token_embeddings</span> <span class="o">=</span> <span class="n">token_embed</span><span class="p">(</span><span class="n">text_vectors</span><span class="p">)</span> <span class="c1"># create embedding</span>
<a id="__codelineno-55-5" name="__codelineno-55-5"></a><span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Conv1D</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s2">&quot;same&quot;</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;relu&quot;</span><span class="p">)(</span><span class="n">token_embeddings</span><span class="p">)</span>
<a id="__codelineno-55-6" name="__codelineno-55-6"></a><span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">GlobalAveragePooling1D</span><span class="p">()(</span><span class="n">x</span><span class="p">)</span> <span class="c1"># condense the output of our feature vector</span>
<a id="__codelineno-55-7" name="__codelineno-55-7"></a><span class="n">outputs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">num_classes</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;softmax&quot;</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-55-8" name="__codelineno-55-8"></a><span class="n">model_1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="p">)</span>
<a id="__codelineno-55-9" name="__codelineno-55-9"></a>
<a id="__codelineno-55-10" name="__codelineno-55-10"></a><span class="c1"># COMPILE MODEL</span>
<a id="__codelineno-55-11" name="__codelineno-55-11"></a><span class="n">model_1</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s2">&quot;categorical_crossentropy&quot;</span><span class="p">,</span> <span class="c1"># if your labels are interger from (not one hot) use sparse_categorical_crossentropy</span>
<a id="__codelineno-55-12" name="__codelineno-55-12"></a>                <span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(),</span>
<a id="__codelineno-55-13" name="__codelineno-55-13"></a>                <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;accuracy&quot;</span><span class="p">])</span>
<a id="__codelineno-55-14" name="__codelineno-55-14"></a>
<a id="__codelineno-55-15" name="__codelineno-55-15"></a><span class="c1"># FIT MODEL</span>
<a id="__codelineno-55-16" name="__codelineno-55-16"></a><span class="n">model_1_history</span> <span class="o">=</span> <span class="n">model_1</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">,</span>
<a id="__codelineno-55-17" name="__codelineno-55-17"></a>                              <span class="n">steps_per_epoch</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mf">0.1</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">)),</span> <span class="c1"># only fit on 10% of batches for faster training time</span>
<a id="__codelineno-55-18" name="__codelineno-55-18"></a>                              <span class="n">epochs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
<a id="__codelineno-55-19" name="__codelineno-55-19"></a>                              <span class="n">validation_data</span><span class="o">=</span><span class="n">valid_dataset</span><span class="p">,</span>
<a id="__codelineno-55-20" name="__codelineno-55-20"></a>                              <span class="n">validation_steps</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mf">0.1</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">valid_dataset</span><span class="p">)))</span> <span class="c1"># only validate on 10% of batches</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Epoch 1/3
    562/562 [==============================] - 60s 106ms/step - loss: 0.9171 - accuracy: 0.6361 - val_loss: 0.6825 - val_accuracy: 0.7387
    Epoch 2/3
    562/562 [==============================] - 59s 105ms/step - loss: 0.6535 - accuracy: 0.7584 - val_loss: 0.6315 - val_accuracy: 0.7713
    Epoch 3/3
    562/562 [==============================] - 59s 106ms/step - loss: 0.6152 - accuracy: 0.7749 - val_loss: 0.5970 - val_accuracy: 0.7869
</pre>
</div>

<p><a name=""></a></p>
<h3 id="inspect-model">Inspect Model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-56-1">1</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1"></a><span class="n">model_1</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Model: "model_1"
    _________________________________________________________________
     Layer (type)                Output Shape              Param #   
    =================================================================
     input_2 (InputLayer)        [(None, 1)]               0         

     text_vectorization_2 (TextV  (None, 55)               0         
     ectorization)                                                   

     token_embedding (Embedding)  (None, 55, 128)          8299648   

     conv1d_1 (Conv1D)           (None, 55, 64)            41024     

     global_average_pooling1d_1   (None, 64)               0         
     (GlobalAveragePooling1D)                                        

     dense_1 (Dense)             (None, 5)                 325       

    =================================================================
    Total params: 8,340,997
    Trainable params: 8,340,997
    Non-trainable params: 0
</pre>
</div>

<p><a name=""></a></p>
<h3 id="evaluate-model_1">Evaluate Model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-57-1">1</a></span>
<span class="normal"><a href="#__codelineno-57-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1"></a><span class="c1"># Evaluate on whole validation dataset</span>
<a id="__codelineno-57-2" name="__codelineno-57-2"></a><span class="n">model_1</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">valid_dataset</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    945/945 [==============================] - 6s 6ms/step - loss: 0.5974 - accuracy: 0.7864
    [0.5973575115203857, 0.7864093780517578]
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-58-1">1</a></span>
<span class="normal"><a href="#__codelineno-58-2">2</a></span>
<span class="normal"><a href="#__codelineno-58-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1"></a><span class="c1"># Make prediction (output as probability)</span>
<a id="__codelineno-58-2" name="__codelineno-58-2"></a><span class="n">model_1_pred_probs</span> <span class="o">=</span> <span class="n">model_1</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">valid_dataset</span><span class="p">)</span>
<a id="__codelineno-58-3" name="__codelineno-58-3"></a><span class="n">model_1_pred_probs</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    array([[4.7344393e-01, 1.3219194e-01, 6.2659368e-02, 3.1317192e-01,
            1.8532796e-02],
           [4.6417162e-01, 2.5178128e-01, 1.8335080e-02, 2.5585756e-01,
            9.8545076e-03],
           [1.4467520e-01, 5.2684029e-03, 1.4306200e-03, 8.4858453e-01,
            4.1158437e-05],
           ...,
           [4.8045504e-06, 6.2110822e-04, 4.1122339e-04, 4.8558059e-06,
            9.9895799e-01],
           [5.1589254e-02, 4.5279500e-01, 1.1439627e-01, 5.7264853e-02,
            3.2395461e-01],
           [1.3614655e-01, 7.3865509e-01, 3.8759667e-02, 3.3948187e-02,
            5.2490529e-02]], dtype=float32)
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-59-1">1</a></span>
<span class="normal"><a href="#__codelineno-59-2">2</a></span>
<span class="normal"><a href="#__codelineno-59-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1"></a><span class="c1"># Convert pred probs to classes</span>
<a id="__codelineno-59-2" name="__codelineno-59-2"></a><span class="n">model_1_preds</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">model_1_pred_probs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-59-3" name="__codelineno-59-3"></a><span class="n">model_1_preds</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (tf.Tensor: shape=(30212,), dtype=int64, numpy=array([0, 0, 3, ..., 4, 1, 1]))
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-60-1">1</a></span>
<span class="normal"><a href="#__codelineno-60-2">2</a></span>
<span class="normal"><a href="#__codelineno-60-3">3</a></span>
<span class="normal"><a href="#__codelineno-60-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1"></a><span class="c1"># Calculate model_1 results</span>
<a id="__codelineno-60-2" name="__codelineno-60-2"></a><span class="n">model_1_results</span> <span class="o">=</span> <span class="n">calculate_results</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">val_labels_encoded</span><span class="p">,</span>
<a id="__codelineno-60-3" name="__codelineno-60-3"></a>                                    <span class="n">y_pred</span><span class="o">=</span><span class="n">model_1_preds</span><span class="p">)</span>
<a id="__codelineno-60-4" name="__codelineno-60-4"></a><span class="n">model_1_results</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    {'accuracy': 0.7864093737587714,
     'f1': 0.784190398172713,
     'precision': 0.7835171135086606,
     'recall': 0.7864093737587714}
</pre>
</div>

<p><a name="model-2"></a></p>
<h2 id="model-2-feature-extraction-with-token-embedding"><strong>Model 2: Feature Extraction with Token Embedding</strong></h2>
<p><a name=""></a></p>
<h3 id="download-pretrained-tensorflow-hub-use">Download Pretrained TensorFlow Hub USE</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-61-1">1</a></span>
<span class="normal"><a href="#__codelineno-61-2">2</a></span>
<span class="normal"><a href="#__codelineno-61-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1"></a><span class="n">tf_hub_embedding_layer</span> <span class="o">=</span> <span class="n">hub</span><span class="o">.</span><span class="n">KerasLayer</span><span class="p">(</span><span class="s2">&quot;https://tfhub.dev/google/universal-sentence-encoder/4&quot;</span><span class="p">,</span>
<a id="__codelineno-61-2" name="__codelineno-61-2"></a>                                        <span class="n">trainable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-61-3" name="__codelineno-61-3"></a>                                        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;universal_sentence_encoder&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-62-1">1</a></span>
<span class="normal"><a href="#__codelineno-62-2">2</a></span>
<span class="normal"><a href="#__codelineno-62-3">3</a></span>
<span class="normal"><a href="#__codelineno-62-4">4</a></span>
<span class="normal"><a href="#__codelineno-62-5">5</a></span>
<span class="normal"><a href="#__codelineno-62-6">6</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1"></a><span class="c1"># (Optional) Test out the embedding on a random sentence</span>
<a id="__codelineno-62-2" name="__codelineno-62-2"></a><span class="n">random_training_sentence</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">train_sentences</span><span class="p">)</span>
<a id="__codelineno-62-3" name="__codelineno-62-3"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Random training sentence:</span><span class="se">\n</span><span class="si">{</span><span class="n">random_training_sentence</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-62-4" name="__codelineno-62-4"></a><span class="n">use_embedded_sentence</span> <span class="o">=</span> <span class="n">tf_hub_embedding_layer</span><span class="p">([</span><span class="n">random_training_sentence</span><span class="p">])</span>
<a id="__codelineno-62-5" name="__codelineno-62-5"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sentence after embedding:</span><span class="se">\n</span><span class="si">{</span><span class="n">use_embedded_sentence</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="mi">30</span><span class="p">]</span><span class="si">}</span><span class="s2"> (truncated output)...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-62-6" name="__codelineno-62-6"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Length of sentence embedding:</span><span class="se">\n</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">use_embedded_sentence</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
Random training sentence:
insufficient power and imbalanced comorbidity limit conclusions regarding comparative efficacy so further studies of mct and cbt are required .

Sentence after embedding:
    | 0.01442834 -0.06016251 -0.05494282 -0.04987475  0.02794627 -0.03077917
      0.05843876 -0.04771357  0.04681923  0.01553754  0.06389414 -0.01675898
      0.06908582  0.04094563 -0.03855417 -0.0298963  -0.03146455  0.04698273
      0.03773773 -0.08416415  0.05347028  0.0791413  -0.08648332 -0.02014151
      0.00919559 -0.02669583 -0.02845007 -0.0230844  -0.06616208  0.03155513| (truncated output)...

    Length of sentence embedding:
    512
</pre>
</div>

<p><a name=""></a></p>
<h3 id="create-compile-and-fit-model_2">Create, Compile, and Fit model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-63-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-63-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-63-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-63-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-63-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-63-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-63-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-63-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-63-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-63-10">10</a></span>
<span class="normal"><a href="#__codelineno-63-11">11</a></span>
<span class="normal"><a href="#__codelineno-63-12">12</a></span>
<span class="normal"><a href="#__codelineno-63-13">13</a></span>
<span class="normal"><a href="#__codelineno-63-14">14</a></span>
<span class="normal"><a href="#__codelineno-63-15">15</a></span>
<span class="normal"><a href="#__codelineno-63-16">16</a></span>
<span class="normal"><a href="#__codelineno-63-17">17</a></span>
<span class="normal"><a href="#__codelineno-63-18">18</a></span>
<span class="normal"><a href="#__codelineno-63-19">19</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1"></a><span class="c1"># CREATE MODEL (Define feature extraction model using TF hub layer)</span>
<a id="__codelineno-63-2" name="__codelineno-63-2"></a><span class="n">inputs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">[],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">string</span><span class="p">)</span>
<a id="__codelineno-63-3" name="__codelineno-63-3"></a><span class="n">pretrained_embedding</span> <span class="o">=</span> <span class="n">tf_hub_embedding_layer</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span> <span class="c1"># tokenize text and create embedding</span>
<a id="__codelineno-63-4" name="__codelineno-63-4"></a><span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;relu&quot;</span><span class="p">)(</span><span class="n">pretrained_embedding</span><span class="p">)</span> <span class="c1"># add a fully connected layer on top of the embedding</span>
<a id="__codelineno-63-5" name="__codelineno-63-5"></a><span class="c1"># Add more layers here if needed</span>
<a id="__codelineno-63-6" name="__codelineno-63-6"></a><span class="n">outputs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;softmax&quot;</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span> <span class="c1"># create the output layer</span>
<a id="__codelineno-63-7" name="__codelineno-63-7"></a><span class="n">model_2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">outputs</span><span class="p">)</span>
<a id="__codelineno-63-8" name="__codelineno-63-8"></a>
<a id="__codelineno-63-9" name="__codelineno-63-9"></a><span class="c1"># COMPILE MODEL</span>
<a id="__codelineno-63-10" name="__codelineno-63-10"></a><span class="n">model_2</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s2">&quot;categorical_crossentropy&quot;</span><span class="p">,</span>
<a id="__codelineno-63-11" name="__codelineno-63-11"></a>                <span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(),</span>
<a id="__codelineno-63-12" name="__codelineno-63-12"></a>                <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;accuracy&quot;</span><span class="p">])</span>
<a id="__codelineno-63-13" name="__codelineno-63-13"></a>
<a id="__codelineno-63-14" name="__codelineno-63-14"></a><span class="c1"># FIT MODEL</span>
<a id="__codelineno-63-15" name="__codelineno-63-15"></a><span class="n">model_2</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">,</span>
<a id="__codelineno-63-16" name="__codelineno-63-16"></a>            <span class="n">steps_per_epoch</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mf">0.1</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">)),</span>
<a id="__codelineno-63-17" name="__codelineno-63-17"></a>            <span class="n">epochs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
<a id="__codelineno-63-18" name="__codelineno-63-18"></a>            <span class="n">validation_data</span><span class="o">=</span><span class="n">valid_dataset</span><span class="p">,</span>
<a id="__codelineno-63-19" name="__codelineno-63-19"></a>            <span class="n">validation_steps</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mf">0.1</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">valid_dataset</span><span class="p">)))</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Epoch 1/3
    562/562 [==============================] - 16s 23ms/step - loss: 0.9138 - accuracy: 0.6499 - val_loss: 0.7986 - val_accuracy: 0.6865
    Epoch 2/3
    562/562 [==============================] - 13s 24ms/step - loss: 0.7699 - accuracy: 0.7014 - val_loss: 0.7562 - val_accuracy: 0.7045
    Epoch 3/3
    562/562 [==============================] - 13s 23ms/step - loss: 0.7535 - accuracy: 0.7124 - val_loss: 0.7404 - val_accuracy: 0.7131
    (keras.callbacks.History at 0x7fe74de4f9d0)
</pre>
</div>

<p><a name=""></a></p>
<h3 id="inspect-model_1">Inspect Model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-64-1">1</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1"></a><span class="n">model_2</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Model: "model_2"
    _________________________________________________________________
     Layer (type)                Output Shape              Param #   
    =================================================================
     input_3 (InputLayer)        [(None,)]                 0         

     universal_sentence_encoder   (None, 512)              256797824 
     (KerasLayer)                                                    

     dense_2 (Dense)             (None, 128)               65664     

     dense_3 (Dense)             (None, 5)                 645       

    =================================================================
    Total params: 256,864,133
    Trainable params: 66,309
    Non-trainable params: 256,797,824
    _________________________________________________________________
</pre>
</div>

<p><a name=""></a></p>
<h3 id="evaluate-model_2">Evaluate Model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-65-1">1</a></span>
<span class="normal"><a href="#__codelineno-65-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1"></a><span class="c1"># Evaluate on whole validation dataset</span>
<a id="__codelineno-65-2" name="__codelineno-65-2"></a><span class="n">model_2</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">valid_dataset</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    945/945 [==============================] - 19s 20ms/step - loss: 0.7419 - accuracy: 0.7125
    [0.7418532371520996, 0.712465226650238]
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-66-1">1</a></span>
<span class="normal"><a href="#__codelineno-66-2">2</a></span>
<span class="normal"><a href="#__codelineno-66-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1"></a><span class="c1"># Make predictions with feature extraction model</span>
<a id="__codelineno-66-2" name="__codelineno-66-2"></a><span class="n">model_2_pred_probs</span> <span class="o">=</span> <span class="n">model_2</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">valid_dataset</span><span class="p">)</span>
<a id="__codelineno-66-3" name="__codelineno-66-3"></a><span class="n">model_2_pred_probs</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    array([[4.2218491e-01, 3.5854951e-01, 2.7078143e-03, 2.0847811e-01,
            8.0795856e-03],
           [3.5699704e-01, 5.0260919e-01, 3.6871736e-03, 1.3332850e-01,
            3.3780290e-03],
           [2.3375827e-01, 1.9347098e-01, 1.9510577e-02, 5.0889683e-01,
            4.4363368e-02],
           ...,
           [2.2667546e-03, 8.0775814e-03, 6.0233645e-02, 8.3485804e-04,
            9.2858708e-01],
           [4.2901249e-03, 4.2861868e-02, 1.9637899e-01, 1.2943269e-03,
            7.5517476e-01],
           [1.7503680e-01, 2.1215978e-01, 5.4434538e-01, 5.7303016e-03,
            6.2727712e-02]], dtype=float32)
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-67-1">1</a></span>
<span class="normal"><a href="#__codelineno-67-2">2</a></span>
<span class="normal"><a href="#__codelineno-67-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1"></a><span class="c1"># Convert the predictions with feature extraction model to classes</span>
<a id="__codelineno-67-2" name="__codelineno-67-2"></a><span class="n">model_2_preds</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">model_2_pred_probs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-67-3" name="__codelineno-67-3"></a><span class="n">model_2_preds</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (tf.Tensor: shape=(30212,), dtype=int64, numpy=array([0, 1, 3, ..., 4, 4, 2]))
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-68-1">1</a></span>
<span class="normal"><a href="#__codelineno-68-2">2</a></span>
<span class="normal"><a href="#__codelineno-68-3">3</a></span>
<span class="normal"><a href="#__codelineno-68-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1"></a><span class="c1"># Calculate results from TF Hub pretrained embeddings results on validation set</span>
<a id="__codelineno-68-2" name="__codelineno-68-2"></a><span class="n">model_2_results</span> <span class="o">=</span> <span class="n">calculate_results</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">val_labels_encoded</span><span class="p">,</span>
<a id="__codelineno-68-3" name="__codelineno-68-3"></a>                                    <span class="n">y_pred</span><span class="o">=</span><span class="n">model_2_preds</span><span class="p">)</span>
<a id="__codelineno-68-4" name="__codelineno-68-4"></a><span class="n">model_2_results</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    {'accuracy': 0.7124652455977757,
     'f1': 0.7093508789731043,
     'precision': 0.7127981560003356,
     'recall': 0.7124652455977757}
</pre>
</div>

<p><a name="model-3"></a></p>
<h2 id="model-3-conv1d-with-character-embedding"><strong>Model 3: Conv1D with Character Embedding</strong></h2>
<p><a name=""></a></p>
<h3 id="create-compile-and-fit-model_3">Create, Compile, and Fit model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-69-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-69-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-69-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-69-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-69-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-69-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-69-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-69-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-69-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-69-10">10</a></span>
<span class="normal"><a href="#__codelineno-69-11">11</a></span>
<span class="normal"><a href="#__codelineno-69-12">12</a></span>
<span class="normal"><a href="#__codelineno-69-13">13</a></span>
<span class="normal"><a href="#__codelineno-69-14">14</a></span>
<span class="normal"><a href="#__codelineno-69-15">15</a></span>
<span class="normal"><a href="#__codelineno-69-16">16</a></span>
<span class="normal"><a href="#__codelineno-69-17">17</a></span>
<span class="normal"><a href="#__codelineno-69-18">18</a></span>
<span class="normal"><a href="#__codelineno-69-19">19</a></span>
<span class="normal"><a href="#__codelineno-69-20">20</a></span>
<span class="normal"><a href="#__codelineno-69-21">21</a></span>
<span class="normal"><a href="#__codelineno-69-22">22</a></span>
<span class="normal"><a href="#__codelineno-69-23">23</a></span>
<span class="normal"><a href="#__codelineno-69-24">24</a></span>
<span class="normal"><a href="#__codelineno-69-25">25</a></span>
<span class="normal"><a href="#__codelineno-69-26">26</a></span>
<span class="normal"><a href="#__codelineno-69-27">27</a></span>
<span class="normal"><a href="#__codelineno-69-28">28</a></span>
<span class="normal"><a href="#__codelineno-69-29">29</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1"></a><span class="c1"># CREATE MODEL</span>
<a id="__codelineno-69-2" name="__codelineno-69-2"></a><span class="c1"># Create char embedding layer</span>
<a id="__codelineno-69-3" name="__codelineno-69-3"></a><span class="n">char_embed</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">input_dim</span><span class="o">=</span><span class="n">NUM_CHAR_TOKENS</span><span class="p">,</span> <span class="c1"># number of different characters</span>
<a id="__codelineno-69-4" name="__codelineno-69-4"></a>                              <span class="n">output_dim</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="c1"># embedding dimension of each character (same as Figure 1 in https://arxiv.org/pdf/1612.05251.pdf)</span>
<a id="__codelineno-69-5" name="__codelineno-69-5"></a>                              <span class="n">mask_zero</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="c1"># don&#39;t use masks (this messes up model_5 if set to True)</span>
<a id="__codelineno-69-6" name="__codelineno-69-6"></a>                              <span class="n">name</span><span class="o">=</span><span class="s2">&quot;char_embed&quot;</span><span class="p">)</span>
<a id="__codelineno-69-7" name="__codelineno-69-7"></a>
<a id="__codelineno-69-8" name="__codelineno-69-8"></a><span class="c1"># Make Conv1D on chars only</span>
<a id="__codelineno-69-9" name="__codelineno-69-9"></a><span class="n">inputs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;string&quot;</span><span class="p">)</span>
<a id="__codelineno-69-10" name="__codelineno-69-10"></a><span class="n">char_vectors</span> <span class="o">=</span> <span class="n">char_vectorizer</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
<a id="__codelineno-69-11" name="__codelineno-69-11"></a><span class="n">char_embeddings</span> <span class="o">=</span> <span class="n">char_embed</span><span class="p">(</span><span class="n">char_vectors</span><span class="p">)</span>
<a id="__codelineno-69-12" name="__codelineno-69-12"></a><span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Conv1D</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s2">&quot;same&quot;</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;relu&quot;</span><span class="p">)(</span><span class="n">char_embeddings</span><span class="p">)</span>
<a id="__codelineno-69-13" name="__codelineno-69-13"></a><span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">GlobalMaxPool1D</span><span class="p">()(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-69-14" name="__codelineno-69-14"></a><span class="n">outputs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">num_classes</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;softmax&quot;</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-69-15" name="__codelineno-69-15"></a><span class="n">model_3</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span>
<a id="__codelineno-69-16" name="__codelineno-69-16"></a>                         <span class="n">outputs</span><span class="o">=</span><span class="n">outputs</span><span class="p">,</span>
<a id="__codelineno-69-17" name="__codelineno-69-17"></a>                         <span class="n">name</span><span class="o">=</span><span class="s2">&quot;model_3_conv1D_char_embedding&quot;</span><span class="p">)</span>
<a id="__codelineno-69-18" name="__codelineno-69-18"></a>
<a id="__codelineno-69-19" name="__codelineno-69-19"></a><span class="c1"># COMPILE MODEL</span>
<a id="__codelineno-69-20" name="__codelineno-69-20"></a><span class="n">model_3</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s2">&quot;categorical_crossentropy&quot;</span><span class="p">,</span>
<a id="__codelineno-69-21" name="__codelineno-69-21"></a>                <span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(),</span>
<a id="__codelineno-69-22" name="__codelineno-69-22"></a>                <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;accuracy&quot;</span><span class="p">])</span>
<a id="__codelineno-69-23" name="__codelineno-69-23"></a>
<a id="__codelineno-69-24" name="__codelineno-69-24"></a><span class="c1"># FIT MODEL</span>
<a id="__codelineno-69-25" name="__codelineno-69-25"></a><span class="n">model_3_history</span> <span class="o">=</span> <span class="n">model_3</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_char_dataset</span><span class="p">,</span>
<a id="__codelineno-69-26" name="__codelineno-69-26"></a>                              <span class="n">steps_per_epoch</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mf">0.1</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_char_dataset</span><span class="p">)),</span>
<a id="__codelineno-69-27" name="__codelineno-69-27"></a>                              <span class="n">epochs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
<a id="__codelineno-69-28" name="__codelineno-69-28"></a>                              <span class="n">validation_data</span><span class="o">=</span><span class="n">val_char_dataset</span><span class="p">,</span>
<a id="__codelineno-69-29" name="__codelineno-69-29"></a>                              <span class="n">validation_steps</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mf">0.1</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">val_char_dataset</span><span class="p">)))</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Epoch 1/3
    562/562 [==============================] - 22s 38ms/step - loss: 1.2572 - accuracy: 0.4922 - val_loss: 1.0463 - val_accuracy: 0.5841
    Epoch 2/3
    562/562 [==============================] - 21s 38ms/step - loss: 1.0136 - accuracy: 0.5914 - val_loss: 0.9559 - val_accuracy: 0.6177
    Epoch 3/3
    562/562 [==============================] - 20s 36ms/step - loss: 0.9327 - accuracy: 0.6348 - val_loss: 0.8728 - val_accuracy: 0.6715
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-70-1">1</a></span>
<span class="normal"><a href="#__codelineno-70-2">2</a></span>
<span class="normal"><a href="#__codelineno-70-3">3</a></span>
<span class="normal"><a href="#__codelineno-70-4">4</a></span>
<span class="normal"><a href="#__codelineno-70-5">5</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1"></a><span class="c1"># (Optional) Test out character embedding layer</span>
<a id="__codelineno-70-2" name="__codelineno-70-2"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Charified text (before vectorization and embedding):</span><span class="se">\n</span><span class="si">{</span><span class="n">random_train_chars</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-70-3" name="__codelineno-70-3"></a><span class="n">char_embed_example</span> <span class="o">=</span> <span class="n">char_embed</span><span class="p">(</span><span class="n">char_vectorizer</span><span class="p">([</span><span class="n">random_train_chars</span><span class="p">]))</span>
<a id="__codelineno-70-4" name="__codelineno-70-4"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Embedded chars (after vectorization and embedding):</span><span class="se">\n</span><span class="si">{</span><span class="n">char_embed_example</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-70-5" name="__codelineno-70-5"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Character embedding shape: </span><span class="si">{</span><span class="n">char_embed_example</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
Charified text (before vectorization and embedding):
t o   d e t e r m i n e   w h e t h e r   a   h o m e   e x e r c i s e   p r o g r a m   w i t h   m i n i m a l   c o n t a c t   w i t h   a   p h y s i c a l   t h e r a p i s t   i m p r o v e d   f u n c t i o n   a f t e r   f o r m a l   h i p   f r a c t u r e   r e h a b i l i t a t i o n   e n d e d   .

Embedded chars (after vectorization and embedding):
    ||| 0.09846397 -0.21208726 -0.02794975 ... -0.02458666  0.17425212
       -0.04507774|
      | 0.06990667 -0.14982542  0.24224545 ... -0.32985318  0.16367382
        0.1108723 |
      |-0.29341838  0.09082987 -0.1949143  ...  0.08315977 -0.24123086
        0.22322291|
      ...
      | 0.11524842 -0.17992936 -0.04437312 ... -0.10036065  0.08699302
        0.071565  |
      | 0.11524842 -0.17992936 -0.04437312 ... -0.10036065  0.08699302
        0.071565  |
      | 0.11524842 -0.17992936 -0.04437312 ... -0.10036065  0.08699302
        0.071565  |||

    Character embedding shape: (1, 290, 25)
</pre>
</div>

<p><a name=""></a></p>
<h3 id="inspect-model_2">Inspect Model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-71-1">1</a></span>
<span class="normal"><a href="#__codelineno-71-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1"></a><span class="c1"># Check the summary of conv1d_char_model</span>
<a id="__codelineno-71-2" name="__codelineno-71-2"></a><span class="n">model_3</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Model: "model_3_conv1D_char_embedding"
    _________________________________________________________________
     Layer (type)                Output Shape              Param #   
    =================================================================
     input_4 (InputLayer)        [(None, 1)]               0         

     char_vectorizer (TextVector  (None, 290)              0         
     ization)                                                        

     char_embed (Embedding)      (None, 290, 25)           1750      

     conv1d_2 (Conv1D)           (None, 290, 64)           8064      

     global_max_pooling1d (Globa  (None, 64)               0         
     lMaxPooling1D)                                                  

     dense_4 (Dense)             (None, 5)                 325       

    =================================================================
    Total params: 10,139
    Trainable params: 10,139
    Non-trainable params: 0
    _________________________________________________________________
</pre>
</div>

<p><a name=""></a></p>
<h3 id="evaluate-model_3">Evaluate Model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-72-1">1</a></span>
<span class="normal"><a href="#__codelineno-72-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1"></a><span class="c1"># Evaluate model_3 on whole validation char dataset</span>
<a id="__codelineno-72-2" name="__codelineno-72-2"></a><span class="n">model_3</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">val_char_dataset</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    945/945 [==============================] - 11s 11ms/step - loss: 0.8935 - accuracy: 0.6533
    [0.8935464024543762, 0.6532834768295288]
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-73-1">1</a></span>
<span class="normal"><a href="#__codelineno-73-2">2</a></span>
<span class="normal"><a href="#__codelineno-73-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1"></a><span class="c1"># Make predictions with character model only</span>
<a id="__codelineno-73-2" name="__codelineno-73-2"></a><span class="n">model_3_pred_probs</span> <span class="o">=</span> <span class="n">model_3</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">val_char_dataset</span><span class="p">)</span>
<a id="__codelineno-73-3" name="__codelineno-73-3"></a><span class="n">model_3_pred_probs</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    array([[0.14130391, 0.4910064 , 0.03276005, 0.2858197 , 0.04910995],
           [0.18885542, 0.457601  , 0.06297027, 0.16594613, 0.12462725],
           [0.10005757, 0.21659729, 0.32846665, 0.27427655, 0.08060195],
           ...,
           [0.06618362, 0.05239256, 0.25178632, 0.02895681, 0.6006806 ],
           [0.06750365, 0.16314219, 0.32856295, 0.04862845, 0.39216277],
           [0.30614772, 0.5282732 , 0.04043599, 0.1074129 , 0.0177301 ]],
          dtype=float32)
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-74-1">1</a></span>
<span class="normal"><a href="#__codelineno-74-2">2</a></span>
<span class="normal"><a href="#__codelineno-74-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1"></a><span class="c1"># Convert predictions to classes</span>
<a id="__codelineno-74-2" name="__codelineno-74-2"></a><span class="n">model_3_preds</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">model_3_pred_probs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-74-3" name="__codelineno-74-3"></a><span class="n">model_3_preds</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    ((tf.Tensor: shape=(30212,), dtype=int64, numpy=array([1, 1, 2, ..., 4, 4, 1]))
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-75-1">1</a></span>
<span class="normal"><a href="#__codelineno-75-2">2</a></span>
<span class="normal"><a href="#__codelineno-75-3">3</a></span>
<span class="normal"><a href="#__codelineno-75-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1"></a><span class="c1"># Calculate Conv1D char only model results</span>
<a id="__codelineno-75-2" name="__codelineno-75-2"></a><span class="n">model_3_results</span> <span class="o">=</span> <span class="n">calculate_results</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">val_labels_encoded</span><span class="p">,</span>
<a id="__codelineno-75-3" name="__codelineno-75-3"></a>                                        <span class="n">y_pred</span><span class="o">=</span><span class="n">model_3_preds</span><span class="p">)</span>
<a id="__codelineno-75-4" name="__codelineno-75-4"></a><span class="n">model_3_results</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    {'accuracy': 0.6532834635244273,
     'f1': 0.6433809179332222,
     'precision': 0.6501759107177353,
     'recall': 0.6532834635244273}
</pre>
</div>

<p><a name="model-4"></a></p>
<h2 id="model-4-hybrid-embedding-combine-token-and-character-embedding"><strong>Model 4: Hybrid Embedding (combine token and character embedding)</strong></h2>
<p>A hybrid token embedding layer is a combination of token embeddings and character embeddings. They create a stacked 
embedding to represent sequences before passing to the sequence label prediction layer.</p>
<p>The following are the steps to create a hybrid embedded model</p>
<ol>
<li>Create a token-level model</li>
<li>Create a character-level model</li>
<li>Combine (using layers.Concatenate) the outputs of 1 and 2</li>
<li>Build a series of output layers on top of 3</li>
<li>Construct a model which takes token and character-level sequences as input and produces sequence label 
probabilities as output</li>
</ol>
<p><a name=""></a></p>
<h3 id="create-compile-and-fit-model_4">Create, Compile, and Fit model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-76-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-76-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-76-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-76-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-76-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-76-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-76-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-76-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-76-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-76-10">10</a></span>
<span class="normal"><a href="#__codelineno-76-11">11</a></span>
<span class="normal"><a href="#__codelineno-76-12">12</a></span>
<span class="normal"><a href="#__codelineno-76-13">13</a></span>
<span class="normal"><a href="#__codelineno-76-14">14</a></span>
<span class="normal"><a href="#__codelineno-76-15">15</a></span>
<span class="normal"><a href="#__codelineno-76-16">16</a></span>
<span class="normal"><a href="#__codelineno-76-17">17</a></span>
<span class="normal"><a href="#__codelineno-76-18">18</a></span>
<span class="normal"><a href="#__codelineno-76-19">19</a></span>
<span class="normal"><a href="#__codelineno-76-20">20</a></span>
<span class="normal"><a href="#__codelineno-76-21">21</a></span>
<span class="normal"><a href="#__codelineno-76-22">22</a></span>
<span class="normal"><a href="#__codelineno-76-23">23</a></span>
<span class="normal"><a href="#__codelineno-76-24">24</a></span>
<span class="normal"><a href="#__codelineno-76-25">25</a></span>
<span class="normal"><a href="#__codelineno-76-26">26</a></span>
<span class="normal"><a href="#__codelineno-76-27">27</a></span>
<span class="normal"><a href="#__codelineno-76-28">28</a></span>
<span class="normal"><a href="#__codelineno-76-29">29</a></span>
<span class="normal"><a href="#__codelineno-76-30">30</a></span>
<span class="normal"><a href="#__codelineno-76-31">31</a></span>
<span class="normal"><a href="#__codelineno-76-32">32</a></span>
<span class="normal"><a href="#__codelineno-76-33">33</a></span>
<span class="normal"><a href="#__codelineno-76-34">34</a></span>
<span class="normal"><a href="#__codelineno-76-35">35</a></span>
<span class="normal"><a href="#__codelineno-76-36">36</a></span>
<span class="normal"><a href="#__codelineno-76-37">37</a></span>
<span class="normal"><a href="#__codelineno-76-38">38</a></span>
<span class="normal"><a href="#__codelineno-76-39">39</a></span>
<span class="normal"><a href="#__codelineno-76-40">40</a></span>
<span class="normal"><a href="#__codelineno-76-41">41</a></span>
<span class="normal"><a href="#__codelineno-76-42">42</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-76-1" name="__codelineno-76-1"></a><span class="c1"># CREATE MODEL</span>
<a id="__codelineno-76-2" name="__codelineno-76-2"></a><span class="c1"># 1. Setup token inputs/model</span>
<a id="__codelineno-76-3" name="__codelineno-76-3"></a><span class="n">token_inputs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">[],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">string</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;token_input&quot;</span><span class="p">)</span>
<a id="__codelineno-76-4" name="__codelineno-76-4"></a><span class="n">token_embeddings</span> <span class="o">=</span> <span class="n">tf_hub_embedding_layer</span><span class="p">(</span><span class="n">token_inputs</span><span class="p">)</span>
<a id="__codelineno-76-5" name="__codelineno-76-5"></a><span class="n">token_output</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;relu&quot;</span><span class="p">)(</span><span class="n">token_embeddings</span><span class="p">)</span>
<a id="__codelineno-76-6" name="__codelineno-76-6"></a><span class="n">token_model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">token_inputs</span><span class="p">,</span>
<a id="__codelineno-76-7" name="__codelineno-76-7"></a>                             <span class="n">outputs</span><span class="o">=</span><span class="n">token_output</span><span class="p">)</span>
<a id="__codelineno-76-8" name="__codelineno-76-8"></a>
<a id="__codelineno-76-9" name="__codelineno-76-9"></a><span class="c1"># 2. Setup char inputs/model</span>
<a id="__codelineno-76-10" name="__codelineno-76-10"></a><span class="n">char_inputs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">string</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;char_input&quot;</span><span class="p">)</span>
<a id="__codelineno-76-11" name="__codelineno-76-11"></a><span class="n">char_vectors</span> <span class="o">=</span> <span class="n">char_vectorizer</span><span class="p">(</span><span class="n">char_inputs</span><span class="p">)</span>
<a id="__codelineno-76-12" name="__codelineno-76-12"></a><span class="n">char_embeddings</span> <span class="o">=</span> <span class="n">char_embed</span><span class="p">(</span><span class="n">char_vectors</span><span class="p">)</span>
<a id="__codelineno-76-13" name="__codelineno-76-13"></a><span class="n">char_bi_lstm</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Bidirectional</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">25</span><span class="p">))(</span><span class="n">char_embeddings</span><span class="p">)</span> <span class="c1"># bi-LSTM shown in Figure 1 of https://arxiv.org/pdf/1612.05251.pdf</span>
<a id="__codelineno-76-14" name="__codelineno-76-14"></a><span class="n">char_model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">char_inputs</span><span class="p">,</span>
<a id="__codelineno-76-15" name="__codelineno-76-15"></a>                            <span class="n">outputs</span><span class="o">=</span><span class="n">char_bi_lstm</span><span class="p">)</span>
<a id="__codelineno-76-16" name="__codelineno-76-16"></a>
<a id="__codelineno-76-17" name="__codelineno-76-17"></a><span class="c1"># 3. Concatenate token and char inputs (create hybrid token embedding)</span>
<a id="__codelineno-76-18" name="__codelineno-76-18"></a><span class="n">token_char_concat</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Concatenate</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;token_char_hybrid&quot;</span><span class="p">)([</span><span class="n">token_model</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> 
<a id="__codelineno-76-19" name="__codelineno-76-19"></a>                                                                  <span class="n">char_model</span><span class="o">.</span><span class="n">output</span><span class="p">])</span>
<a id="__codelineno-76-20" name="__codelineno-76-20"></a>
<a id="__codelineno-76-21" name="__codelineno-76-21"></a><span class="c1"># 4. Create output layers - addition of dropout discussed in 4.2 of https://arxiv.org/pdf/1612.05251.pdf</span>
<a id="__codelineno-76-22" name="__codelineno-76-22"></a><span class="n">combined_dropout</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)(</span><span class="n">token_char_concat</span><span class="p">)</span>
<a id="__codelineno-76-23" name="__codelineno-76-23"></a><span class="n">combined_dense</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;relu&quot;</span><span class="p">)(</span><span class="n">combined_dropout</span><span class="p">)</span> <span class="c1"># slightly different to Figure 1 due to different shapes of token/char embedding layers</span>
<a id="__codelineno-76-24" name="__codelineno-76-24"></a><span class="n">final_dropout</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)(</span><span class="n">combined_dense</span><span class="p">)</span>
<a id="__codelineno-76-25" name="__codelineno-76-25"></a><span class="n">output_layer</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">num_classes</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;softmax&quot;</span><span class="p">)(</span><span class="n">final_dropout</span><span class="p">)</span>
<a id="__codelineno-76-26" name="__codelineno-76-26"></a>
<a id="__codelineno-76-27" name="__codelineno-76-27"></a><span class="c1"># 5. Construct model with char and token inputs</span>
<a id="__codelineno-76-28" name="__codelineno-76-28"></a><span class="n">model_4</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="n">token_model</span><span class="o">.</span><span class="n">input</span><span class="p">,</span> <span class="n">char_model</span><span class="o">.</span><span class="n">input</span><span class="p">],</span>
<a id="__codelineno-76-29" name="__codelineno-76-29"></a>                         <span class="n">outputs</span><span class="o">=</span><span class="n">output_layer</span><span class="p">,</span>
<a id="__codelineno-76-30" name="__codelineno-76-30"></a>                         <span class="n">name</span><span class="o">=</span><span class="s2">&quot;model_4_token_and_char_embeddings&quot;</span><span class="p">)</span>
<a id="__codelineno-76-31" name="__codelineno-76-31"></a>
<a id="__codelineno-76-32" name="__codelineno-76-32"></a><span class="c1"># COMPILE MODEL</span>
<a id="__codelineno-76-33" name="__codelineno-76-33"></a><span class="n">model_4</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s2">&quot;categorical_crossentropy&quot;</span><span class="p">,</span>
<a id="__codelineno-76-34" name="__codelineno-76-34"></a>                <span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(),</span> <span class="c1"># section 4.2 of https://arxiv.org/pdf/1612.05251.pdf mentions using SGD but we&#39;ll stick with Adam</span>
<a id="__codelineno-76-35" name="__codelineno-76-35"></a>                <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;accuracy&quot;</span><span class="p">])</span>
<a id="__codelineno-76-36" name="__codelineno-76-36"></a>
<a id="__codelineno-76-37" name="__codelineno-76-37"></a><span class="c1"># FIT MODEL</span>
<a id="__codelineno-76-38" name="__codelineno-76-38"></a><span class="n">model_4_history</span> <span class="o">=</span> <span class="n">model_4</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_char_token_dataset</span><span class="p">,</span> <span class="c1"># train on dataset of token and characters</span>
<a id="__codelineno-76-39" name="__codelineno-76-39"></a>                              <span class="n">steps_per_epoch</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mf">0.1</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_char_token_dataset</span><span class="p">)),</span>
<a id="__codelineno-76-40" name="__codelineno-76-40"></a>                              <span class="n">epochs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
<a id="__codelineno-76-41" name="__codelineno-76-41"></a>                              <span class="n">validation_data</span><span class="o">=</span><span class="n">val_char_token_dataset</span><span class="p">,</span>
<a id="__codelineno-76-42" name="__codelineno-76-42"></a>                              <span class="n">validation_steps</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mf">0.1</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">val_char_token_dataset</span><span class="p">)))</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Epoch 1/3
    562/562 [==============================] - 130s 223ms/step - loss: 0.9708 - accuracy: 0.6122 - val_loss: 0.7656 - val_accuracy: 0.7108
    Epoch 2/3
    562/562 [==============================] - 122s 216ms/step - loss: 0.7924 - accuracy: 0.6923 - val_loss: 0.7228 - val_accuracy: 0.7304
    Epoch 3/3
    562/562 [==============================] - 125s 222ms/step - loss: 0.7648 - accuracy: 0.7048 - val_loss: 0.6932 - val_accuracy: 0.7390
</pre>
</div>

<p><a name=""></a></p>
<h3 id="inspect-model_3">Inspect Model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-77-1">1</a></span>
<span class="normal"><a href="#__codelineno-77-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-77-1" name="__codelineno-77-1"></a><span class="c1"># Get summary of token and character model</span>
<a id="__codelineno-77-2" name="__codelineno-77-2"></a><span class="n">model_4</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Model: "model_4_token_and_char_embeddings"
    __________________________________________________________________________________________________
     Layer (type)                   Output Shape         Param #     Connected to                     
    ==================================================================================================
     char_input (InputLayer)        [(None, 1)]          0           []                               

     token_input (InputLayer)       [(None,)]            0           []                               

     char_vectorizer (TextVectoriza  (None, 290)         0           ['char_input[0][0]']             
     tion)                                                                                            

     universal_sentence_encoder (Ke  (None, 512)         256797824   ['token_input[0][0]']            
     rasLayer)                                                                                        

     char_embed (Embedding)         (None, 290, 25)      1750        ['char_vectorizer[1][0]']        

     dense_5 (Dense)                (None, 128)          65664       ['universal_sentence_encoder[1][0
                                                                     ]']                              

     bidirectional (Bidirectional)  (None, 50)           10200       ['char_embed[1][0]']             

     token_char_hybrid (Concatenate  (None, 178)         0           ['dense_5[0][0]',                
     )                                                                'bidirectional[0][0]']          

     dropout (Dropout)              (None, 178)          0           ['token_char_hybrid[0][0]']      

     dense_6 (Dense)                (None, 200)          35800       ['dropout[0][0]']                

     dropout_1 (Dropout)            (None, 200)          0           ['dense_6[0][0]']                

     dense_7 (Dense)                (None, 5)            1005        ['dropout_1[0][0]']              

    ==================================================================================================
    Total params: 256,912,243
    Trainable params: 114,419
    Non-trainable params: 256,797,824
    __________________________________________________________________________________________________
</pre>
</div>

<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-78-1">1</a></span>
<span class="normal"><a href="#__codelineno-78-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-78-1" name="__codelineno-78-1"></a><span class="c1"># Plot hybrid token and character model</span>
<a id="__codelineno-78-2" name="__codelineno-78-2"></a><span class="n">plot_model</span><span class="p">(</span><span class="n">model_4</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<img alt="nlp-2-9" src="../../../images/nlp-2-9.png" /></p>
<p><a name=""></a></p>
<h3 id="evaluate-model_4">Evaluate Model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-79-1">1</a></span>
<span class="normal"><a href="#__codelineno-79-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-79-1" name="__codelineno-79-1"></a><span class="c1"># Evaluate on the whole validation dataset</span>
<a id="__codelineno-79-2" name="__codelineno-79-2"></a><span class="n">model_4</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">val_char_token_dataset</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    945/945 [==============================] - 44s 46ms/step - loss: 0.6954 - accuracy: 0.7356
    [0.6953509449958801, 0.735568642616272]
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-80-1">1</a></span>
<span class="normal"><a href="#__codelineno-80-2">2</a></span>
<span class="normal"><a href="#__codelineno-80-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-80-1" name="__codelineno-80-1"></a><span class="c1"># Make predictions using the token-character model hybrid</span>
<a id="__codelineno-80-2" name="__codelineno-80-2"></a><span class="n">model_4_pred_probs</span> <span class="o">=</span> <span class="n">model_4</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">val_char_token_dataset</span><span class="p">)</span>
<a id="__codelineno-80-3" name="__codelineno-80-3"></a><span class="n">model_4_pred_probs</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    array([[3.7033656e-01, 4.1986328e-01, 2.9086976e-03, 1.9972523e-01,
            7.1661822e-03],
           [3.7284255e-01, 3.9790377e-01, 1.9073560e-03, 2.2596566e-01,
            1.3805856e-03],
           [2.9006416e-01, 1.9791964e-01, 4.4401448e-02, 4.2577630e-01,
            4.1838448e-02],
           ...,
           [3.4381083e-04, 6.8300883e-03, 5.4799065e-02, 1.2757097e-04,
            9.3789941e-01],
           [9.3412986e-03, 6.1639812e-02, 2.7399907e-01, 4.0955865e-03,
            6.5092421e-01],
           [2.7802393e-01, 4.6596897e-01, 1.6988058e-01, 2.9069964e-02,
            5.7056468e-02]], dtype=float32)
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-81-1">1</a></span>
<span class="normal"><a href="#__codelineno-81-2">2</a></span>
<span class="normal"><a href="#__codelineno-81-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-81-1" name="__codelineno-81-1"></a><span class="c1"># Turn prediction probabilities into prediction classes</span>
<a id="__codelineno-81-2" name="__codelineno-81-2"></a><span class="n">model_4_preds</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">model_4_pred_probs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-81-3" name="__codelineno-81-3"></a><span class="n">model_4_preds</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (tf.Tensor: shape=(30212,), dtype=int64, numpy=array([1, 1, 3, ..., 4, 4, 1]))
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-82-1">1</a></span>
<span class="normal"><a href="#__codelineno-82-2">2</a></span>
<span class="normal"><a href="#__codelineno-82-3">3</a></span>
<span class="normal"><a href="#__codelineno-82-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-82-1" name="__codelineno-82-1"></a><span class="c1"># Get results of token-char-hybrid model</span>
<a id="__codelineno-82-2" name="__codelineno-82-2"></a><span class="n">model_4_results</span> <span class="o">=</span> <span class="n">calculate_results</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">val_labels_encoded</span><span class="p">,</span>
<a id="__codelineno-82-3" name="__codelineno-82-3"></a>                                    <span class="n">y_pred</span><span class="o">=</span><span class="n">model_4_preds</span><span class="p">)</span>
<a id="__codelineno-82-4" name="__codelineno-82-4"></a><span class="n">model_4_results</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    {'accuracy': 0.7355686482192506,
     'f1': 0.7334139166483081,
     'precision': 0.7363567070597282,
     'recall': 0.7355686482192506}
</pre>
</div>

<p><a name="model-5"></a></p>
<h2 id="model-5-transfer-learning-with-pretrained-token-character-and-position-embedding"><strong>Model 5: Transfer Learning (with pretrained token, character, and position embedding)</strong></h2>
<p>The following are the steps to create a tribrid embedding model</p>
<ol>
<li>Create a token-level model (similar to <code>model_1</code>)</li>
<li>Create a character-level model (similar to <code>model_3</code> with modification)</li>
<li>Create a <code>"line_number"</code> model (takes in one-hot-encoded <code>"line_number"</code> tensor and passes it through a 
non-linear layer)</li>
<li>Create a <code>"total_lines"</code> model (takes in one-hot-encoded <code>"total_lines"</code> tensor and passes it through a non-linear 
layer)</li>
<li>Combine (using <code>layers.Concatenate</code>) the outputs of 1 and 2 into a token-character-hybrid embedding and pass it 
series of output)</li>
<li>Combine (using <code>layers.Concatenate</code>) the outputs of 3, 4 and 5 into a token-character-positional tribrid embedding</li>
<li>Create an output layer to accept the tribrid embedding and output predicted label probabilities</li>
<li>Combine the inputs of 1, 2, 3, 4 and outputs of 7 into a tf.keras.Model`</li>
</ol>
<p><a name=""></a></p>
<h3 id="create-compile-and-fit-model_5">Create, Compile, and Fit model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-83-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-83-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-83-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-83-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-83-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-83-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-83-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-83-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-83-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-83-10">10</a></span>
<span class="normal"><a href="#__codelineno-83-11">11</a></span>
<span class="normal"><a href="#__codelineno-83-12">12</a></span>
<span class="normal"><a href="#__codelineno-83-13">13</a></span>
<span class="normal"><a href="#__codelineno-83-14">14</a></span>
<span class="normal"><a href="#__codelineno-83-15">15</a></span>
<span class="normal"><a href="#__codelineno-83-16">16</a></span>
<span class="normal"><a href="#__codelineno-83-17">17</a></span>
<span class="normal"><a href="#__codelineno-83-18">18</a></span>
<span class="normal"><a href="#__codelineno-83-19">19</a></span>
<span class="normal"><a href="#__codelineno-83-20">20</a></span>
<span class="normal"><a href="#__codelineno-83-21">21</a></span>
<span class="normal"><a href="#__codelineno-83-22">22</a></span>
<span class="normal"><a href="#__codelineno-83-23">23</a></span>
<span class="normal"><a href="#__codelineno-83-24">24</a></span>
<span class="normal"><a href="#__codelineno-83-25">25</a></span>
<span class="normal"><a href="#__codelineno-83-26">26</a></span>
<span class="normal"><a href="#__codelineno-83-27">27</a></span>
<span class="normal"><a href="#__codelineno-83-28">28</a></span>
<span class="normal"><a href="#__codelineno-83-29">29</a></span>
<span class="normal"><a href="#__codelineno-83-30">30</a></span>
<span class="normal"><a href="#__codelineno-83-31">31</a></span>
<span class="normal"><a href="#__codelineno-83-32">32</a></span>
<span class="normal"><a href="#__codelineno-83-33">33</a></span>
<span class="normal"><a href="#__codelineno-83-34">34</a></span>
<span class="normal"><a href="#__codelineno-83-35">35</a></span>
<span class="normal"><a href="#__codelineno-83-36">36</a></span>
<span class="normal"><a href="#__codelineno-83-37">37</a></span>
<span class="normal"><a href="#__codelineno-83-38">38</a></span>
<span class="normal"><a href="#__codelineno-83-39">39</a></span>
<span class="normal"><a href="#__codelineno-83-40">40</a></span>
<span class="normal"><a href="#__codelineno-83-41">41</a></span>
<span class="normal"><a href="#__codelineno-83-42">42</a></span>
<span class="normal"><a href="#__codelineno-83-43">43</a></span>
<span class="normal"><a href="#__codelineno-83-44">44</a></span>
<span class="normal"><a href="#__codelineno-83-45">45</a></span>
<span class="normal"><a href="#__codelineno-83-46">46</a></span>
<span class="normal"><a href="#__codelineno-83-47">47</a></span>
<span class="normal"><a href="#__codelineno-83-48">48</a></span>
<span class="normal"><a href="#__codelineno-83-49">49</a></span>
<span class="normal"><a href="#__codelineno-83-50">50</a></span>
<span class="normal"><a href="#__codelineno-83-51">51</a></span>
<span class="normal"><a href="#__codelineno-83-52">52</a></span>
<span class="normal"><a href="#__codelineno-83-53">53</a></span>
<span class="normal"><a href="#__codelineno-83-54">54</a></span>
<span class="normal"><a href="#__codelineno-83-55">55</a></span>
<span class="normal"><a href="#__codelineno-83-56">56</a></span>
<span class="normal"><a href="#__codelineno-83-57">57</a></span>
<span class="normal"><a href="#__codelineno-83-58">58</a></span>
<span class="normal"><a href="#__codelineno-83-59">59</a></span>
<span class="normal"><a href="#__codelineno-83-60">60</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-83-1" name="__codelineno-83-1"></a><span class="c1"># CREATE MODEL</span>
<a id="__codelineno-83-2" name="__codelineno-83-2"></a><span class="c1"># 1. Token inputs</span>
<a id="__codelineno-83-3" name="__codelineno-83-3"></a><span class="n">token_inputs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">[],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;token_inputs&quot;</span><span class="p">)</span>
<a id="__codelineno-83-4" name="__codelineno-83-4"></a><span class="n">token_embeddings</span> <span class="o">=</span> <span class="n">tf_hub_embedding_layer</span><span class="p">(</span><span class="n">token_inputs</span><span class="p">)</span>
<a id="__codelineno-83-5" name="__codelineno-83-5"></a><span class="n">token_outputs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;relu&quot;</span><span class="p">)(</span><span class="n">token_embeddings</span><span class="p">)</span>
<a id="__codelineno-83-6" name="__codelineno-83-6"></a><span class="n">token_model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">token_inputs</span><span class="p">,</span>
<a id="__codelineno-83-7" name="__codelineno-83-7"></a>                             <span class="n">outputs</span><span class="o">=</span><span class="n">token_embeddings</span><span class="p">)</span>
<a id="__codelineno-83-8" name="__codelineno-83-8"></a>
<a id="__codelineno-83-9" name="__codelineno-83-9"></a><span class="c1"># 2. Char inputs</span>
<a id="__codelineno-83-10" name="__codelineno-83-10"></a><span class="n">char_inputs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;char_inputs&quot;</span><span class="p">)</span>
<a id="__codelineno-83-11" name="__codelineno-83-11"></a><span class="n">char_vectors</span> <span class="o">=</span> <span class="n">char_vectorizer</span><span class="p">(</span><span class="n">char_inputs</span><span class="p">)</span>
<a id="__codelineno-83-12" name="__codelineno-83-12"></a><span class="n">char_embeddings</span> <span class="o">=</span> <span class="n">char_embed</span><span class="p">(</span><span class="n">char_vectors</span><span class="p">)</span>
<a id="__codelineno-83-13" name="__codelineno-83-13"></a><span class="n">char_bi_lstm</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Bidirectional</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">32</span><span class="p">))(</span><span class="n">char_embeddings</span><span class="p">)</span>
<a id="__codelineno-83-14" name="__codelineno-83-14"></a><span class="n">char_model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">char_inputs</span><span class="p">,</span>
<a id="__codelineno-83-15" name="__codelineno-83-15"></a>                            <span class="n">outputs</span><span class="o">=</span><span class="n">char_bi_lstm</span><span class="p">)</span>
<a id="__codelineno-83-16" name="__codelineno-83-16"></a>
<a id="__codelineno-83-17" name="__codelineno-83-17"></a><span class="c1"># 3. Line numbers inputs</span>
<a id="__codelineno-83-18" name="__codelineno-83-18"></a><span class="n">line_number_inputs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;line_number_input&quot;</span><span class="p">)</span>
<a id="__codelineno-83-19" name="__codelineno-83-19"></a><span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;relu&quot;</span><span class="p">)(</span><span class="n">line_number_inputs</span><span class="p">)</span>
<a id="__codelineno-83-20" name="__codelineno-83-20"></a><span class="n">line_number_model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">line_number_inputs</span><span class="p">,</span>
<a id="__codelineno-83-21" name="__codelineno-83-21"></a>                                   <span class="n">outputs</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-83-22" name="__codelineno-83-22"></a>
<a id="__codelineno-83-23" name="__codelineno-83-23"></a><span class="c1"># 4. Total lines inputs</span>
<a id="__codelineno-83-24" name="__codelineno-83-24"></a><span class="n">total_lines_inputs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;total_lines_input&quot;</span><span class="p">)</span>
<a id="__codelineno-83-25" name="__codelineno-83-25"></a><span class="n">y</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;relu&quot;</span><span class="p">)(</span><span class="n">total_lines_inputs</span><span class="p">)</span>
<a id="__codelineno-83-26" name="__codelineno-83-26"></a><span class="n">total_line_model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">total_lines_inputs</span><span class="p">,</span>
<a id="__codelineno-83-27" name="__codelineno-83-27"></a>                                  <span class="n">outputs</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
<a id="__codelineno-83-28" name="__codelineno-83-28"></a>
<a id="__codelineno-83-29" name="__codelineno-83-29"></a><span class="c1"># 5. Combine token and char embeddings into a hybrid embedding</span>
<a id="__codelineno-83-30" name="__codelineno-83-30"></a><span class="n">combined_embeddings</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Concatenate</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;token_char_hybrid_embedding&quot;</span><span class="p">)([</span><span class="n">token_model</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> 
<a id="__codelineno-83-31" name="__codelineno-83-31"></a>                                                                              <span class="n">char_model</span><span class="o">.</span><span class="n">output</span><span class="p">])</span>
<a id="__codelineno-83-32" name="__codelineno-83-32"></a><span class="n">z</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;relu&quot;</span><span class="p">)(</span><span class="n">combined_embeddings</span><span class="p">)</span>
<a id="__codelineno-83-33" name="__codelineno-83-33"></a><span class="n">z</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)(</span><span class="n">z</span><span class="p">)</span>
<a id="__codelineno-83-34" name="__codelineno-83-34"></a>
<a id="__codelineno-83-35" name="__codelineno-83-35"></a><span class="c1"># 6. Combine positional embeddings with combined token and char embeddings into a tribrid embedding</span>
<a id="__codelineno-83-36" name="__codelineno-83-36"></a><span class="n">z</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Concatenate</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;token_char_positional_embedding&quot;</span><span class="p">)([</span><span class="n">line_number_model</span><span class="o">.</span><span class="n">output</span><span class="p">,</span>
<a id="__codelineno-83-37" name="__codelineno-83-37"></a>                                                                <span class="n">total_line_model</span><span class="o">.</span><span class="n">output</span><span class="p">,</span>
<a id="__codelineno-83-38" name="__codelineno-83-38"></a>                                                                <span class="n">z</span><span class="p">])</span>
<a id="__codelineno-83-39" name="__codelineno-83-39"></a>
<a id="__codelineno-83-40" name="__codelineno-83-40"></a><span class="c1"># 7. Create output layer</span>
<a id="__codelineno-83-41" name="__codelineno-83-41"></a><span class="n">output_layer</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;softmax&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;output_layer&quot;</span><span class="p">)(</span><span class="n">z</span><span class="p">)</span>
<a id="__codelineno-83-42" name="__codelineno-83-42"></a>
<a id="__codelineno-83-43" name="__codelineno-83-43"></a><span class="c1"># 8. Put together model</span>
<a id="__codelineno-83-44" name="__codelineno-83-44"></a><span class="n">model_5</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="n">line_number_model</span><span class="o">.</span><span class="n">input</span><span class="p">,</span>
<a id="__codelineno-83-45" name="__codelineno-83-45"></a>                                 <span class="n">total_line_model</span><span class="o">.</span><span class="n">input</span><span class="p">,</span>
<a id="__codelineno-83-46" name="__codelineno-83-46"></a>                                 <span class="n">token_model</span><span class="o">.</span><span class="n">input</span><span class="p">,</span> 
<a id="__codelineno-83-47" name="__codelineno-83-47"></a>                                 <span class="n">char_model</span><span class="o">.</span><span class="n">input</span><span class="p">],</span>
<a id="__codelineno-83-48" name="__codelineno-83-48"></a>                         <span class="n">outputs</span><span class="o">=</span><span class="n">output_layer</span><span class="p">)</span>
<a id="__codelineno-83-49" name="__codelineno-83-49"></a>
<a id="__codelineno-83-50" name="__codelineno-83-50"></a><span class="c1"># COMPILE MODEL (Compile token, char, positional embedding model)</span>
<a id="__codelineno-83-51" name="__codelineno-83-51"></a><span class="n">model_5</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">CategoricalCrossentropy</span><span class="p">(</span><span class="n">label_smoothing</span><span class="o">=</span><span class="mf">0.2</span><span class="p">),</span> <span class="c1"># add label smoothing (examples which are really confident get smoothed a little)</span>
<a id="__codelineno-83-52" name="__codelineno-83-52"></a>                <span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(),</span>
<a id="__codelineno-83-53" name="__codelineno-83-53"></a>                <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;accuracy&quot;</span><span class="p">])</span>
<a id="__codelineno-83-54" name="__codelineno-83-54"></a>
<a id="__codelineno-83-55" name="__codelineno-83-55"></a><span class="c1"># FIT MODEL (Fit the token, char and positional embedding model)</span>
<a id="__codelineno-83-56" name="__codelineno-83-56"></a><span class="n">history_model_5</span> <span class="o">=</span> <span class="n">model_5</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_pos_char_token_dataset</span><span class="p">,</span>
<a id="__codelineno-83-57" name="__codelineno-83-57"></a>                              <span class="n">steps_per_epoch</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mf">0.1</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_pos_char_token_dataset</span><span class="p">)),</span>
<a id="__codelineno-83-58" name="__codelineno-83-58"></a>                              <span class="n">epochs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
<a id="__codelineno-83-59" name="__codelineno-83-59"></a>                              <span class="n">validation_data</span><span class="o">=</span><span class="n">val_pos_char_token_dataset</span><span class="p">,</span>
<a id="__codelineno-83-60" name="__codelineno-83-60"></a>                              <span class="n">validation_steps</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mf">0.1</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">val_pos_char_token_dataset</span><span class="p">)))</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Epoch 1/3
    562/562 [==============================] - 130s 222ms/step - loss: 1.0988 - accuracy: 0.7273 - val_loss: 0.9905 - val_accuracy: 0.8019
    Epoch 2/3
    562/562 [==============================] - 124s 221ms/step - loss: 0.9782 - accuracy: 0.8098 - val_loss: 0.9590 - val_accuracy: 0.8238
    Epoch 3/3
    562/562 [==============================] - 128s 227ms/step - loss: 0.9632 - accuracy: 0.8162 - val_loss: 0.9484 - val_accuracy: 0.8275
</pre>
</div>

<p><a name=""></a></p>
<h3 id="inspect-model_4">Inspect Model</h3>
<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-84-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-84-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-84-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-84-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-84-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-84-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-84-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-84-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-84-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-84-10">10</a></span>
<span class="normal"><a href="#__codelineno-84-11">11</a></span>
<span class="normal"><a href="#__codelineno-84-12">12</a></span>
<span class="normal"><a href="#__codelineno-84-13">13</a></span>
<span class="normal"><a href="#__codelineno-84-14">14</a></span>
<span class="normal"><a href="#__codelineno-84-15">15</a></span>
<span class="normal"><a href="#__codelineno-84-16">16</a></span>
<span class="normal"><a href="#__codelineno-84-17">17</a></span>
<span class="normal"><a href="#__codelineno-84-18">18</a></span>
<span class="normal"><a href="#__codelineno-84-19">19</a></span>
<span class="normal"><a href="#__codelineno-84-20">20</a></span>
<span class="normal"><a href="#__codelineno-84-21">21</a></span>
<span class="normal"><a href="#__codelineno-84-22">22</a></span>
<span class="normal"><a href="#__codelineno-84-23">23</a></span>
<span class="normal"><a href="#__codelineno-84-24">24</a></span>
<span class="normal"><a href="#__codelineno-84-25">25</a></span>
<span class="normal"><a href="#__codelineno-84-26">26</a></span>
<span class="normal"><a href="#__codelineno-84-27">27</a></span>
<span class="normal"><a href="#__codelineno-84-28">28</a></span>
<span class="normal"><a href="#__codelineno-84-29">29</a></span>
<span class="normal"><a href="#__codelineno-84-30">30</a></span>
<span class="normal"><a href="#__codelineno-84-31">31</a></span>
<span class="normal"><a href="#__codelineno-84-32">32</a></span>
<span class="normal"><a href="#__codelineno-84-33">33</a></span>
<span class="normal"><a href="#__codelineno-84-34">34</a></span>
<span class="normal"><a href="#__codelineno-84-35">35</a></span>
<span class="normal"><a href="#__codelineno-84-36">36</a></span>
<span class="normal"><a href="#__codelineno-84-37">37</a></span>
<span class="normal"><a href="#__codelineno-84-38">38</a></span>
<span class="normal"><a href="#__codelineno-84-39">39</a></span>
<span class="normal"><a href="#__codelineno-84-40">40</a></span>
<span class="normal"><a href="#__codelineno-84-41">41</a></span>
<span class="normal"><a href="#__codelineno-84-42">42</a></span>
<span class="normal"><a href="#__codelineno-84-43">43</a></span>
<span class="normal"><a href="#__codelineno-84-44">44</a></span>
<span class="normal"><a href="#__codelineno-84-45">45</a></span>
<span class="normal"><a href="#__codelineno-84-46">46</a></span>
<span class="normal"><a href="#__codelineno-84-47">47</a></span>
<span class="normal"><a href="#__codelineno-84-48">48</a></span>
<span class="normal"><a href="#__codelineno-84-49">49</a></span>
<span class="normal"><a href="#__codelineno-84-50">50</a></span>
<span class="normal"><a href="#__codelineno-84-51">51</a></span>
<span class="normal"><a href="#__codelineno-84-52">52</a></span>
<span class="normal"><a href="#__codelineno-84-53">53</a></span>
<span class="normal"><a href="#__codelineno-84-54">54</a></span>
<span class="normal"><a href="#__codelineno-84-55">55</a></span>
<span class="normal"><a href="#__codelineno-84-56">56</a></span>
<span class="normal"><a href="#__codelineno-84-57">57</a></span>
<span class="normal"><a href="#__codelineno-84-58">58</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-84-1" name="__codelineno-84-1"></a>    <span class="c1"># Get a summary of our token, char and positional embedding model</span>
<a id="__codelineno-84-2" name="__codelineno-84-2"></a>    <span class="n">model_5</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
<a id="__codelineno-84-3" name="__codelineno-84-3"></a>
<a id="__codelineno-84-4" name="__codelineno-84-4"></a>    <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-84-5" name="__codelineno-84-5"></a>    <span class="o">&lt;</span><span class="n">pre</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;__code_7&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-84-6" name="__codelineno-84-6"></a>    <span class="n">Model</span><span class="p">:</span> <span class="s2">&quot;model_9&quot;</span>
<a id="__codelineno-84-7" name="__codelineno-84-7"></a>    <span class="n">__________________________________________________________________________________________________</span>
<a id="__codelineno-84-8" name="__codelineno-84-8"></a>     <span class="n">Layer</span> <span class="p">(</span><span class="nb">type</span><span class="p">)</span>                   <span class="n">Output</span> <span class="n">Shape</span>         <span class="n">Param</span> <span class="c1">#     Connected to                     </span>
<a id="__codelineno-84-9" name="__codelineno-84-9"></a>    <span class="o">==================================================================================================</span>
<a id="__codelineno-84-10" name="__codelineno-84-10"></a>     <span class="n">char_inputs</span> <span class="p">(</span><span class="n">InputLayer</span><span class="p">)</span>       <span class="p">[(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>          <span class="mi">0</span>           <span class="p">[]</span>                               
<a id="__codelineno-84-11" name="__codelineno-84-11"></a>
<a id="__codelineno-84-12" name="__codelineno-84-12"></a>     <span class="n">char_vectorizer</span> <span class="p">(</span><span class="n">TextVectoriza</span>  <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">290</span><span class="p">)</span>         <span class="mi">0</span>           <span class="p">[</span><span class="s1">&#39;char_inputs[0][0]&#39;</span><span class="p">]</span>            
<a id="__codelineno-84-13" name="__codelineno-84-13"></a>     <span class="n">tion</span><span class="p">)</span>                                                                                            
<a id="__codelineno-84-14" name="__codelineno-84-14"></a>
<a id="__codelineno-84-15" name="__codelineno-84-15"></a>     <span class="n">token_inputs</span> <span class="p">(</span><span class="n">InputLayer</span><span class="p">)</span>      <span class="p">[(</span><span class="kc">None</span><span class="p">,)]</span>            <span class="mi">0</span>           <span class="p">[]</span>                               
<a id="__codelineno-84-16" name="__codelineno-84-16"></a>
<a id="__codelineno-84-17" name="__codelineno-84-17"></a>     <span class="n">char_embed</span> <span class="p">(</span><span class="n">Embedding</span><span class="p">)</span>         <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">290</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>      <span class="mi">1750</span>        <span class="p">[</span><span class="s1">&#39;char_vectorizer[2][0]&#39;</span><span class="p">]</span>        
<a id="__codelineno-84-18" name="__codelineno-84-18"></a>
<a id="__codelineno-84-19" name="__codelineno-84-19"></a>     <span class="n">universal_sentence_encoder</span> <span class="p">(</span><span class="n">Ke</span>  <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">512</span><span class="p">)</span>         <span class="mi">256797824</span>   <span class="p">[</span><span class="s1">&#39;token_inputs[0][0]&#39;</span><span class="p">]</span>           
<a id="__codelineno-84-20" name="__codelineno-84-20"></a>     <span class="n">rasLayer</span><span class="p">)</span>                                                                                        
<a id="__codelineno-84-21" name="__codelineno-84-21"></a>
<a id="__codelineno-84-22" name="__codelineno-84-22"></a>     <span class="n">bidirectional_1</span> <span class="p">(</span><span class="n">Bidirectional</span>  <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span>          <span class="mi">14848</span>       <span class="p">[</span><span class="s1">&#39;char_embed[2][0]&#39;</span><span class="p">]</span>             
<a id="__codelineno-84-23" name="__codelineno-84-23"></a>     <span class="p">)</span>                                                                                                
<a id="__codelineno-84-24" name="__codelineno-84-24"></a>
<a id="__codelineno-84-25" name="__codelineno-84-25"></a>     <span class="n">token_char_hybrid_embedding</span> <span class="p">(</span><span class="n">C</span>  <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">576</span><span class="p">)</span>         <span class="mi">0</span>           <span class="p">[</span><span class="s1">&#39;universal_sentence_encoder[2][0</span>
<a id="__codelineno-84-26" name="__codelineno-84-26"></a>     <span class="n">oncatenate</span><span class="p">)</span>                                                     <span class="p">]</span><span class="s1">&#39;,                              </span>
<a id="__codelineno-84-27" name="__codelineno-84-27"></a>                                                                      <span class="s1">&#39;bidirectional_1[0][0]&#39;</span><span class="p">]</span>        
<a id="__codelineno-84-28" name="__codelineno-84-28"></a>
<a id="__codelineno-84-29" name="__codelineno-84-29"></a>     <span class="n">line_number_input</span> <span class="p">(</span><span class="n">InputLayer</span><span class="p">)</span>  <span class="p">[(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">15</span><span class="p">)]</span>        <span class="mi">0</span>           <span class="p">[]</span>                               
<a id="__codelineno-84-30" name="__codelineno-84-30"></a>
<a id="__codelineno-84-31" name="__codelineno-84-31"></a>     <span class="n">total_lines_input</span> <span class="p">(</span><span class="n">InputLayer</span><span class="p">)</span>  <span class="p">[(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">20</span><span class="p">)]</span>        <span class="mi">0</span>           <span class="p">[]</span>                               
<a id="__codelineno-84-32" name="__codelineno-84-32"></a>
<a id="__codelineno-84-33" name="__codelineno-84-33"></a>     <span class="n">dense_11</span> <span class="p">(</span><span class="n">Dense</span><span class="p">)</span>               <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">256</span><span class="p">)</span>          <span class="mi">147712</span>      <span class="p">[</span><span class="s1">&#39;token_char_hybrid_embedding[0][</span>
<a id="__codelineno-84-34" name="__codelineno-84-34"></a>                                                                     <span class="mi">0</span><span class="p">]</span><span class="s1">&#39;]                             </span>
<a id="__codelineno-84-35" name="__codelineno-84-35"></a>
<a id="__codelineno-84-36" name="__codelineno-84-36"></a>     <span class="n">dense_9</span> <span class="p">(</span><span class="n">Dense</span><span class="p">)</span>                <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>           <span class="mi">512</span>         <span class="p">[</span><span class="s1">&#39;line_number_input[0][0]&#39;</span><span class="p">]</span>      
<a id="__codelineno-84-37" name="__codelineno-84-37"></a>
<a id="__codelineno-84-38" name="__codelineno-84-38"></a>     <span class="n">dense_10</span> <span class="p">(</span><span class="n">Dense</span><span class="p">)</span>               <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>           <span class="mi">672</span>         <span class="p">[</span><span class="s1">&#39;total_lines_input[0][0]&#39;</span><span class="p">]</span>      
<a id="__codelineno-84-39" name="__codelineno-84-39"></a>
<a id="__codelineno-84-40" name="__codelineno-84-40"></a>     <span class="n">dropout_2</span> <span class="p">(</span><span class="n">Dropout</span><span class="p">)</span>            <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">256</span><span class="p">)</span>          <span class="mi">0</span>           <span class="p">[</span><span class="s1">&#39;dense_11[0][0]&#39;</span><span class="p">]</span>               
<a id="__codelineno-84-41" name="__codelineno-84-41"></a>
<a id="__codelineno-84-42" name="__codelineno-84-42"></a>     <span class="n">token_char_positional_embeddin</span>  <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">320</span><span class="p">)</span>         <span class="mi">0</span>           <span class="p">[</span><span class="s1">&#39;dense_9[0][0]&#39;</span><span class="p">,</span>                
<a id="__codelineno-84-43" name="__codelineno-84-43"></a>     <span class="n">g</span> <span class="p">(</span><span class="n">Concatenate</span><span class="p">)</span>                                                  <span class="s1">&#39;dense_10[0][0]&#39;</span><span class="p">,</span>               
<a id="__codelineno-84-44" name="__codelineno-84-44"></a>                                                                      <span class="s1">&#39;dropout_2[0][0]&#39;</span><span class="p">]</span>              
<a id="__codelineno-84-45" name="__codelineno-84-45"></a>
<a id="__codelineno-84-46" name="__codelineno-84-46"></a>     <span class="n">output_layer</span> <span class="p">(</span><span class="n">Dense</span><span class="p">)</span>           <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>            <span class="mi">1605</span>        <span class="p">[</span><span class="s1">&#39;token_char_positional_embedding</span>
<a id="__codelineno-84-47" name="__codelineno-84-47"></a>                                                                     <span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="s1">&#39;]                         </span>
<a id="__codelineno-84-48" name="__codelineno-84-48"></a>
<a id="__codelineno-84-49" name="__codelineno-84-49"></a>    <span class="o">==================================================================================================</span>
<a id="__codelineno-84-50" name="__codelineno-84-50"></a>    <span class="n">Total</span> <span class="n">params</span><span class="p">:</span> <span class="mi">256</span><span class="p">,</span><span class="mi">964</span><span class="p">,</span><span class="mi">923</span>
<a id="__codelineno-84-51" name="__codelineno-84-51"></a>    <span class="n">Trainable</span> <span class="n">params</span><span class="p">:</span> <span class="mi">167</span><span class="p">,</span><span class="mi">099</span>
<a id="__codelineno-84-52" name="__codelineno-84-52"></a>    <span class="n">Non</span><span class="o">-</span><span class="n">trainable</span> <span class="n">params</span><span class="p">:</span> <span class="mi">256</span><span class="p">,</span><span class="mi">797</span><span class="p">,</span><span class="mi">824</span>
<a id="__codelineno-84-53" name="__codelineno-84-53"></a><span class="o">&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
<a id="__codelineno-84-54" name="__codelineno-84-54"></a><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-84-55" name="__codelineno-84-55"></a>
<a id="__codelineno-84-56" name="__codelineno-84-56"></a><span class="err">```</span> <span class="n">python</span> <span class="n">linenums</span><span class="o">=</span><span class="s2">&quot;1&quot;</span>
<a id="__codelineno-84-57" name="__codelineno-84-57"></a><span class="c1"># Plot the token, char, positional embedding model</span>
<a id="__codelineno-84-58" name="__codelineno-84-58"></a><span class="n">plot_model</span><span class="p">(</span><span class="n">model_5</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<img alt="nlp-2-6" src="../../../images/nlp-2-6.png" /></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-85-1">1</a></span>
<span class="normal"><a href="#__codelineno-85-2">2</a></span>
<span class="normal"><a href="#__codelineno-85-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-85-1" name="__codelineno-85-1"></a><span class="c1"># Check which layers of our model are trainable or not</span>
<a id="__codelineno-85-2" name="__codelineno-85-2"></a><span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">model_5</span><span class="o">.</span><span class="n">layers</span><span class="p">:</span>
<a id="__codelineno-85-3" name="__codelineno-85-3"></a>  <span class="nb">print</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">layer</span><span class="o">.</span><span class="n">trainable</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (keras.engine.input_layer.InputLayer object at 0x7fe7588d0890) True
    (keras.layers.preprocessing.text_vectorization.TextVectorization object at 0x7fe75e267050) True
    (keras.engine.input_layer.InputLayer object at 0x7fe752a2e990) True
    (keras.layers.embeddings.Embedding object at 0x7fe758a51250) True
    (tensorflow_hub.keras_layer.KerasLayer object at 0x7fe7624ff650) False
    (keras.layers.wrappers.Bidirectional object at 0x7fe74d60f910) True
    (keras.layers.merge.Concatenate object at 0x7fe752c44490) True
    (keras.engine.input_layer.InputLayer object at 0x7fe752b67810) True
    (keras.engine.input_layer.InputLayer object at 0x7fe752c44c50) True
    (keras.layers.core.dense.Dense object at 0x7fe74d4f2e90) True
    (keras.layers.core.dense.Dense object at 0x7fe752c1e990) True
    (keras.layers.core.dense.Dense object at 0x7fe74d4ecbd0) True
    (keras.layers.core.dropout.Dropout object at 0x7fe752c261d0) True
    (keras.layers.merge.Concatenate object at 0x7fe74d55cad0) True
    (keras.layers.core.dense.Dense object at 0x7fe752bc7290) True
</pre>
</div>

<p><a name=""></a></p>
<h3 id="evaluate-model_5">Evaluate Model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-86-1">1</a></span>
<span class="normal"><a href="#__codelineno-86-2">2</a></span>
<span class="normal"><a href="#__codelineno-86-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-86-1" name="__codelineno-86-1"></a><span class="c1"># Make predictions with token-char-positional hybrid model</span>
<a id="__codelineno-86-2" name="__codelineno-86-2"></a><span class="n">model_5_pred_probs</span> <span class="o">=</span> <span class="n">model_5</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">val_pos_char_token_dataset</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-86-3" name="__codelineno-86-3"></a><span class="n">model_5_pred_probs</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    945/945 [==============================] - 56s 58ms/step
    array([[0.50061023, 0.1051404 , 0.01255045, 0.36013868, 0.02156013],
           [0.56995964, 0.08728199, 0.03643149, 0.29613864, 0.01018834],
           [0.25158617, 0.12605534, 0.14952871, 0.40267858, 0.07015124],
           ...,
           [0.04008723, 0.11227744, 0.04988493, 0.03459859, 0.7631519 ],
           [0.03017212, 0.30078143, 0.08866134, 0.02397038, 0.5564148 ],
           [0.1532317 , 0.5462612 , 0.16128086, 0.04201949, 0.0972067 ]],
          dtype=float32)
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-87-1">1</a></span>
<span class="normal"><a href="#__codelineno-87-2">2</a></span>
<span class="normal"><a href="#__codelineno-87-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-87-1" name="__codelineno-87-1"></a><span class="c1"># Turn prediction probabilities into prediction classes</span>
<a id="__codelineno-87-2" name="__codelineno-87-2"></a><span class="n">model_5_preds</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">model_5_pred_probs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-87-3" name="__codelineno-87-3"></a><span class="n">model_5_preds</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (tf.Tensor: shape=(30212,), dtype=int64, numpy=array([0, 0, 3, ..., 4, 4, 1]))
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-88-1">1</a></span>
<span class="normal"><a href="#__codelineno-88-2">2</a></span>
<span class="normal"><a href="#__codelineno-88-3">3</a></span>
<span class="normal"><a href="#__codelineno-88-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-88-1" name="__codelineno-88-1"></a><span class="c1"># Calculate results of token-char-positional hybrid model</span>
<a id="__codelineno-88-2" name="__codelineno-88-2"></a><span class="n">model_5_results</span> <span class="o">=</span> <span class="n">calculate_results</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">val_labels_encoded</span><span class="p">,</span>
<a id="__codelineno-88-3" name="__codelineno-88-3"></a>                                    <span class="n">y_pred</span><span class="o">=</span><span class="n">model_5_preds</span><span class="p">)</span>
<a id="__codelineno-88-4" name="__codelineno-88-4"></a><span class="n">model_5_results</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    {'accuracy': 0.8268237786310075,
     'f1': 0.8256500945301574,
     'precision': 0.8249970802850624,
     'recall': 0.8268237786310075}
</pre>
</div>

<p><a name="compare"></a></p>
<h2 id="compare-model-results"><strong>Compare model results</strong></h2>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-89-1">1</a></span>
<span class="normal"><a href="#__codelineno-89-2">2</a></span>
<span class="normal"><a href="#__codelineno-89-3">3</a></span>
<span class="normal"><a href="#__codelineno-89-4">4</a></span>
<span class="normal"><a href="#__codelineno-89-5">5</a></span>
<span class="normal"><a href="#__codelineno-89-6">6</a></span>
<span class="normal"><a href="#__codelineno-89-7">7</a></span>
<span class="normal"><a href="#__codelineno-89-8">8</a></span>
<span class="normal"><a href="#__codelineno-89-9">9</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-89-1" name="__codelineno-89-1"></a><span class="c1"># Combine model results into a DataFrame</span>
<a id="__codelineno-89-2" name="__codelineno-89-2"></a><span class="n">all_model_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Model 0: baseline&quot;</span><span class="p">:</span> <span class="n">baseline_results</span><span class="p">,</span>
<a id="__codelineno-89-3" name="__codelineno-89-3"></a>                                  <span class="s2">&quot;Model 1: custom_token_embed_conv1d&quot;</span><span class="p">:</span> <span class="n">model_1_results</span><span class="p">,</span>
<a id="__codelineno-89-4" name="__codelineno-89-4"></a>                                  <span class="s2">&quot;Model 2: pretrained_token_embed&quot;</span><span class="p">:</span> <span class="n">model_2_results</span><span class="p">,</span>
<a id="__codelineno-89-5" name="__codelineno-89-5"></a>                                  <span class="s2">&quot;Model 3: custom_char_embed_conv1d&quot;</span><span class="p">:</span> <span class="n">model_3_results</span><span class="p">,</span>
<a id="__codelineno-89-6" name="__codelineno-89-6"></a>                                  <span class="s2">&quot;Model 4: hybrid_char_token_embed&quot;</span><span class="p">:</span> <span class="n">model_4_results</span><span class="p">,</span>
<a id="__codelineno-89-7" name="__codelineno-89-7"></a>                                  <span class="s2">&quot;Model 5: tribrid_pos_char_token_embed&quot;</span><span class="p">:</span> <span class="n">model_5_results</span><span class="p">})</span>
<a id="__codelineno-89-8" name="__codelineno-89-8"></a><span class="n">all_model_results</span> <span class="o">=</span> <span class="n">all_model_results</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
<a id="__codelineno-89-9" name="__codelineno-89-9"></a><span class="n">all_model_results</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
                                            accuracy    precision   recall      f1
    Model 0: baseline                       0.721832    0.718647    0.721832    0.698925
    Model 1: custom_token_embed_conv1d      0.786409    0.783517    0.786409    0.784190
    Model 2: pretrained_token_embed         0.712465    0.712798    0.712465    0.709351
    Model 3: custom_char_embed_conv1d       0.653283    0.650176    0.653283    0.643381
    Model 4: hybrid_char_token_embed        0.735569    0.736357    0.735569    0.733414
    Model 5: tribrid_pos_char_token_embed   0.826824    0.824997    0.826824    0.825650
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-90-1">1</a></span>
<span class="normal"><a href="#__codelineno-90-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-90-1" name="__codelineno-90-1"></a><span class="c1"># Reduce the accuracy to same scale as other metrics</span>
<a id="__codelineno-90-2" name="__codelineno-90-2"></a><span class="n">all_model_results</span><span class="p">[</span><span class="s2">&quot;accuracy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_model_results</span><span class="p">[</span><span class="s2">&quot;accuracy&quot;</span><span class="p">]</span><span class="o">/</span><span class="mi">100</span>
</code></pre></div>
</td></tr></table>
<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-91-1">1</a></span>
<span class="normal"><a href="#__codelineno-91-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-91-1" name="__codelineno-91-1"></a><span class="c1"># Plot and compare all of the model results</span>
<a id="__codelineno-91-2" name="__codelineno-91-2"></a><span class="n">all_model_results</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
</code></pre></div>
</td></tr></table>
<img alt="nlp-2-7" src="../../../images/nlp-2-7.png" /></p>
<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-92-1">1</a></span>
<span class="normal"><a href="#__codelineno-92-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-92-1" name="__codelineno-92-1"></a><span class="c1"># Sort model results by f1-score</span>
<a id="__codelineno-92-2" name="__codelineno-92-2"></a><span class="n">all_model_results</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;f1&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s2">&quot;f1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
</code></pre></div>
</td></tr></table>
<img alt="nlp-2-8" src="../../../images/nlp-2-8.png" /></p>
<p><a name="save-and-load"></a></p>
<h2 id="save-and-load-best-preforming-model"><strong>Save and Load best preforming model</strong></h2>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-93-1">1</a></span>
<span class="normal"><a href="#__codelineno-93-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-93-1" name="__codelineno-93-1"></a><span class="c1"># Save best performing model to SavedModel format (default)</span>
<a id="__codelineno-93-2" name="__codelineno-93-2"></a><span class="n">model_5</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;skimlit_tribrid_model&quot;</span><span class="p">)</span> <span class="c1"># model will be saved to path specified by string</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    WARNING:absl:Found untraced functions such as lstm_cell_4_layer_call_fn, lstm_cell_4_layer_call_and_return_conditional_losses, lstm_cell_5_layer_call_fn, lstm_cell_5_layer_call_and_return_conditional_losses, lstm_cell_4_layer_call_fn while saving (showing 5 of 10). These functions will not be directly callable after loading.
    INFO:tensorflow:Assets written to: skimlit_tribrid_model/assets
    INFO:tensorflow:Assets written to: skimlit_tribrid_model/assets
    WARNING:absl:(keras.layers.recurrent.LSTMCell object at 0x7fe74d60fbd0) has the same name 'LSTMCell' as a built-in Keras object. Consider renaming (class 'keras.layers.recurrent.LSTMCell') to avoid naming conflicts when loading with `tf.keras.models.load_model`. If renaming is not possible, pass the object in the `custom_objects` parameter of the load function.
    WARNING:absl:(keras.layers.recurrent.LSTMCell object at 0x7fe74d617450) has the same name 'LSTMCell' as a built-in Keras object. Consider renaming (class 'keras.layers.recurrent.LSTMCell') to avoid naming conflicts when loading with `tf.keras.models.load_model`. If renaming is not possible, pass the object in the `custom_objects` parameter of the load function.
</pre>
</div>

<p>Optional: If using Google Colab, it would be a good idea to save the model to Google Drive (or download it) for more 
permanent storage, since Google Colab files disappear after you disconnect.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-94-1">1</a></span>
<span class="normal"><a href="#__codelineno-94-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-94-1" name="__codelineno-94-1"></a><span class="c1"># Example of copying saved model from Google Colab to Drive (requires Google Drive to be mounted)</span>
<a id="__codelineno-94-2" name="__codelineno-94-2"></a><span class="c1"># !cp skim_lit_best_model -r /content/drive/MyDrive/tensorflow_course/skim_lit</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    cp: cannot stat 'skim_lit_best_model': No such file or directory
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-95-1">1</a></span>
<span class="normal"><a href="#__codelineno-95-2">2</a></span>
<span class="normal"><a href="#__codelineno-95-3">3</a></span>
<span class="normal"><a href="#__codelineno-95-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-95-1" name="__codelineno-95-1"></a><span class="c1"># Download pretrained model from Google Storage</span>
<a id="__codelineno-95-2" name="__codelineno-95-2"></a><span class="err">!</span><span class="n">wget</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">storage</span><span class="o">.</span><span class="n">googleapis</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">ztm_tf_course</span><span class="o">/</span><span class="n">skimlit</span><span class="o">/</span><span class="n">skimlit_tribrid_model</span><span class="o">.</span><span class="n">zip</span>
<a id="__codelineno-95-3" name="__codelineno-95-3"></a><span class="err">!</span><span class="n">mkdir</span> <span class="n">skimlit_gs_model</span>
<a id="__codelineno-95-4" name="__codelineno-95-4"></a><span class="err">!</span><span class="n">unzip</span> <span class="n">skimlit_tribrid_model</span><span class="o">.</span><span class="n">zip</span> <span class="o">-</span><span class="n">d</span> <span class="n">skimlit_gs_model</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    --2021-12-03 18:31:24--  https://storage.googleapis.com/ztm_tf_course/skimlit/skimlit_tribrid_model.zip
    Resolving storage.googleapis.com (storage.googleapis.com)... 74.125.197.128, 74.125.135.128, 74.125.195.128, ...
    Connecting to storage.googleapis.com (storage.googleapis.com)|74.125.197.128|:443... connected.
    HTTP request sent, awaiting response... 200 OK
    Length: 962561955 (918M) [application/zip]
    Saving to: ‘skimlit_tribrid_model.zip’

    skimlit_tribrid_mod 100%[===================>] 917.97M  40.1MB/s    in 12s     

    2021-12-03 18:31:37 (73.8 MB/s) - ‘skimlit_tribrid_model.zip’ saved [962561955/962561955]

    Archive:  skimlit_tribrid_model.zip
       creating: skimlit_gs_model/skimlit_tribrid_model/
       creating: skimlit_gs_model/skimlit_tribrid_model/variables/
      inflating: skimlit_gs_model/skimlit_tribrid_model/variables/variables.index  
      inflating: skimlit_gs_model/skimlit_tribrid_model/variables/variables.data-00000-of-00001  
      inflating: skimlit_gs_model/skimlit_tribrid_model/keras_metadata.pb  
      inflating: skimlit_gs_model/skimlit_tribrid_model/saved_model.pb  
       creating: skimlit_gs_model/skimlit_tribrid_model/assets/
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-96-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-96-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-96-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-96-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-96-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-96-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-96-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-96-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-96-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-96-10">10</a></span>
<span class="normal"><a href="#__codelineno-96-11">11</a></span>
<span class="normal"><a href="#__codelineno-96-12">12</a></span>
<span class="normal"><a href="#__codelineno-96-13">13</a></span>
<span class="normal"><a href="#__codelineno-96-14">14</a></span>
<span class="normal"><a href="#__codelineno-96-15">15</a></span>
<span class="normal"><a href="#__codelineno-96-16">16</a></span>
<span class="normal"><a href="#__codelineno-96-17">17</a></span>
<span class="normal"><a href="#__codelineno-96-18">18</a></span>
<span class="normal"><a href="#__codelineno-96-19">19</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-96-1" name="__codelineno-96-1"></a><span class="kn">import</span> <span class="nn">tensorflow_hub</span> <span class="k">as</span> <span class="nn">hub</span>
<a id="__codelineno-96-2" name="__codelineno-96-2"></a><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<a id="__codelineno-96-3" name="__codelineno-96-3"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">TextVectorization</span>
<a id="__codelineno-96-4" name="__codelineno-96-4"></a>
<a id="__codelineno-96-5" name="__codelineno-96-5"></a><span class="c1"># Import TensorFlow model dependencies (if needed) - https://github.com/tensorflow/tensorflow/issues/38250 </span>
<a id="__codelineno-96-6" name="__codelineno-96-6"></a><span class="c1"># model_path = &quot;skimlit_gs_model/skimlit_tribrid_model&quot; # This is error, need to fix</span>
<a id="__codelineno-96-7" name="__codelineno-96-7"></a><span class="n">model_path</span> <span class="o">=</span> <span class="s2">&quot;skimlit_tribrid_model&quot;</span>
<a id="__codelineno-96-8" name="__codelineno-96-8"></a>
<a id="__codelineno-96-9" name="__codelineno-96-9"></a><span class="c1"># Load downloaded model from Google Storage</span>
<a id="__codelineno-96-10" name="__codelineno-96-10"></a><span class="c1"># loaded_model = tf.keras.models.load_model(model_path)#,</span>
<a id="__codelineno-96-11" name="__codelineno-96-11"></a>                                          <span class="c1"># Note: with TensorFlow 2.5+ if your SavedModel has a keras_metadata.pb file </span>
<a id="__codelineno-96-12" name="__codelineno-96-12"></a>                                          <span class="c1"># (created when using model.save()), you shouldn&#39;t need the custom_objects</span>
<a id="__codelineno-96-13" name="__codelineno-96-13"></a>                                          <span class="c1"># parameter. I&#39;m leaving the code below here in case you do.</span>
<a id="__codelineno-96-14" name="__codelineno-96-14"></a>                                          <span class="c1"># custom_objects={&quot;TextVectorization&quot;: TextVectorization, # required for char vectorization</span>
<a id="__codelineno-96-15" name="__codelineno-96-15"></a>                                                          <span class="c1"># &quot;KerasLayer&quot;: hub.KerasLayer}) # required for token embedding</span>
<a id="__codelineno-96-16" name="__codelineno-96-16"></a>
<a id="__codelineno-96-17" name="__codelineno-96-17"></a><span class="n">loaded_model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="n">model_path</span><span class="p">,</span>
<a id="__codelineno-96-18" name="__codelineno-96-18"></a>                                          <span class="n">custom_objects</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;TextVectorization&quot;</span><span class="p">:</span> <span class="n">TextVectorization</span><span class="p">,</span>
<a id="__codelineno-96-19" name="__codelineno-96-19"></a>                                                          <span class="s2">&quot;KerasLayer&quot;</span><span class="p">:</span> <span class="n">hub</span><span class="o">.</span><span class="n">KerasLayer</span><span class="p">})</span>
</code></pre></div>
</td></tr></table>
<p><a name=""></a></p>
<h2 id="make-predictions-and-evaluate-against-truth-labels"><strong>Make Predictions and Evaluate against truth labels</strong></h2>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-97-1">1</a></span>
<span class="normal"><a href="#__codelineno-97-2">2</a></span>
<span class="normal"><a href="#__codelineno-97-3">3</a></span>
<span class="normal"><a href="#__codelineno-97-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-97-1" name="__codelineno-97-1"></a><span class="c1"># Make predictions with the loaded model on the validation set</span>
<a id="__codelineno-97-2" name="__codelineno-97-2"></a><span class="n">loaded_pred_probs</span> <span class="o">=</span> <span class="n">loaded_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">val_pos_char_token_dataset</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-97-3" name="__codelineno-97-3"></a><span class="n">loaded_preds</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">loaded_pred_probs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-97-4" name="__codelineno-97-4"></a><span class="n">loaded_preds</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    945/945 [==============================] - 58s 59ms/step
    (tf.Tensor: shape=(10,), dtype=int64, numpy=array([0, 0, 3, 2, 2, 4, 4, 4, 4, 1]))
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-98-1">1</a></span>
<span class="normal"><a href="#__codelineno-98-2">2</a></span>
<span class="normal"><a href="#__codelineno-98-3">3</a></span>
<span class="normal"><a href="#__codelineno-98-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-98-1" name="__codelineno-98-1"></a><span class="c1"># Evaluate loaded model&#39;s predictions</span>
<a id="__codelineno-98-2" name="__codelineno-98-2"></a><span class="n">loaded_model_results</span> <span class="o">=</span> <span class="n">calculate_results</span><span class="p">(</span><span class="n">val_labels_encoded</span><span class="p">,</span>
<a id="__codelineno-98-3" name="__codelineno-98-3"></a>                                         <span class="n">loaded_preds</span><span class="p">)</span>
<a id="__codelineno-98-4" name="__codelineno-98-4"></a><span class="n">loaded_model_results</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    {'accuracy': 0.8269561763537667,
     'f1': 0.8257092044095665,
     'precision': 0.8250073229213583,
     'recall': 0.8269561763537667}
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-99-1">1</a></span>
<span class="normal"><a href="#__codelineno-99-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-99-1" name="__codelineno-99-1"></a><span class="c1"># Compare loaded model results with original trained model results (should be quite close)</span>
<a id="__codelineno-99-2" name="__codelineno-99-2"></a><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">model_5_results</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="nb">list</span><span class="p">(</span><span class="n">loaded_model_results</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">1e-02</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    array([ True,  True,  True,  True])
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-100-1">1</a></span>
<span class="normal"><a href="#__codelineno-100-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-100-1" name="__codelineno-100-1"></a><span class="c1"># Check loaded model summary (note the number of trainable parameters)</span>
<a id="__codelineno-100-2" name="__codelineno-100-2"></a><span class="n">loaded_model</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Model: "model_9"
    __________________________________________________________________________________________________
     Layer (type)                   Output Shape         Param #     Connected to                     
    ==================================================================================================
     char_inputs (InputLayer)       [(None, 1)]          0           []                               

     char_vectorizer (TextVectoriza  (None, None)        0           ['char_inputs[0][0]']            
     tion)                                                                                            

     token_inputs (InputLayer)      [(None,)]            0           []                               

     char_embed (Embedding)         (None, None, 25)     1750        ['char_vectorizer[0][0]']        

     universal_sentence_encoder (Ke  (None, 512)         256797824   ['token_inputs[0][0]']           
     rasLayer)                                                                                        

     bidirectional_1 (Bidirectional  (None, 64)          14848       ['char_embed[0][0]']             
     )                                                                                                

     token_char_hybrid_embedding (C  (None, 576)         0           ['universal_sentence_encoder[0][0
     oncatenate)                                                     ]',                              
                                                                      'bidirectional_1[0][0]']        

     line_number_input (InputLayer)  [(None, 15)]        0           []                               

     total_lines_input (InputLayer)  [(None, 20)]        0           []                               

     dense_11 (Dense)               (None, 256)          147712      ['token_char_hybrid_embedding[0][
                                                                     0]']                             

     dense_9 (Dense)                (None, 32)           512         ['line_number_input[0][0]']      

     dense_10 (Dense)               (None, 32)           672         ['total_lines_input[0][0]']      

     dropout_2 (Dropout)            (None, 256)          0           ['dense_11[0][0]']               

     token_char_positional_embeddin  (None, 320)         0           ['dense_9[0][0]',                
     g (Concatenate)                                                  'dense_10[0][0]',               
                                                                      'dropout_2[0][0]']              

     output_layer (Dense)           (None, 5)            1605        ['token_char_positional_embedding
                                                                     [0][0]']                         

    ==================================================================================================
    Total params: 256,964,923
    Trainable params: 167,099
    Non-trainable params: 256,797,824
    __________________________________________________________________________________________________
</pre>
</div>

<p><a name=""></a></p>
<h2 id="evaluate-and-inspect-model-on-test-dataset"><strong>Evaluate and Inspect model on test dataset</strong></h2>
<p><a name=""></a></p>
<h3 id="evaluate-model_6"><strong>Evaluate model</strong></h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-101-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-101-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-101-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-101-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-101-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-101-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-101-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-101-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-101-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-101-10">10</a></span>
<span class="normal"><a href="#__codelineno-101-11">11</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-101-1" name="__codelineno-101-1"></a><span class="c1"># Create test dataset batch and prefetched</span>
<a id="__codelineno-101-2" name="__codelineno-101-2"></a><span class="n">test_pos_char_token_data</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_tensor_slices</span><span class="p">((</span><span class="n">test_line_numbers_one_hot</span><span class="p">,</span>
<a id="__codelineno-101-3" name="__codelineno-101-3"></a>                                                               <span class="n">test_total_lines_one_hot</span><span class="p">,</span>
<a id="__codelineno-101-4" name="__codelineno-101-4"></a>                                                               <span class="n">test_sentences</span><span class="p">,</span>
<a id="__codelineno-101-5" name="__codelineno-101-5"></a>                                                               <span class="n">test_chars</span><span class="p">))</span>
<a id="__codelineno-101-6" name="__codelineno-101-6"></a><span class="n">test_pos_char_token_labels</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_tensor_slices</span><span class="p">(</span><span class="n">test_labels_one_hot</span><span class="p">)</span>
<a id="__codelineno-101-7" name="__codelineno-101-7"></a><span class="n">test_pos_char_token_dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">zip</span><span class="p">((</span><span class="n">test_pos_char_token_data</span><span class="p">,</span> <span class="n">test_pos_char_token_labels</span><span class="p">))</span>
<a id="__codelineno-101-8" name="__codelineno-101-8"></a><span class="n">test_pos_char_token_dataset</span> <span class="o">=</span> <span class="n">test_pos_char_token_dataset</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span><span class="o">.</span><span class="n">prefetch</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">AUTOTUNE</span><span class="p">)</span>
<a id="__codelineno-101-9" name="__codelineno-101-9"></a>
<a id="__codelineno-101-10" name="__codelineno-101-10"></a><span class="c1"># Check shapes</span>
<a id="__codelineno-101-11" name="__codelineno-101-11"></a><span class="n">test_pos_char_token_dataset</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    PrefetchDataset shapes: (((None, 15), (None, 20), (None,), (None,)), (None, 5)), types: ((tf.float32, tf.float32, tf.string, tf.string), tf.float64)
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-102-1">1</a></span>
<span class="normal"><a href="#__codelineno-102-2">2</a></span>
<span class="normal"><a href="#__codelineno-102-3">3</a></span>
<span class="normal"><a href="#__codelineno-102-4">4</a></span>
<span class="normal"><a href="#__codelineno-102-5">5</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-102-1" name="__codelineno-102-1"></a><span class="c1"># Make predictions on the test dataset</span>
<a id="__codelineno-102-2" name="__codelineno-102-2"></a><span class="n">test_pred_probs</span> <span class="o">=</span> <span class="n">loaded_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_pos_char_token_dataset</span><span class="p">,</span>
<a id="__codelineno-102-3" name="__codelineno-102-3"></a>                                       <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-102-4" name="__codelineno-102-4"></a><span class="n">test_preds</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">test_pred_probs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-102-5" name="__codelineno-102-5"></a><span class="n">test_preds</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    942/942 [==============================] - 55s 58ms/step
    (tf.Tensor: shape=(10,), dtype=int64, numpy=array([3, 3, 2, 2, 4, 4, 4, 1, 4, 0]))
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-103-1">1</a></span>
<span class="normal"><a href="#__codelineno-103-2">2</a></span>
<span class="normal"><a href="#__codelineno-103-3">3</a></span>
<span class="normal"><a href="#__codelineno-103-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-103-1" name="__codelineno-103-1"></a><span class="c1"># Evaluate loaded model test predictions</span>
<a id="__codelineno-103-2" name="__codelineno-103-2"></a><span class="n">loaded_model_test_results</span> <span class="o">=</span> <span class="n">calculate_results</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">test_labels_encoded</span><span class="p">,</span>
<a id="__codelineno-103-3" name="__codelineno-103-3"></a>                                              <span class="n">y_pred</span><span class="o">=</span><span class="n">test_preds</span><span class="p">)</span>
<a id="__codelineno-103-4" name="__codelineno-103-4"></a><span class="n">loaded_model_test_results</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    {'accuracy': 0.8225319396051103,
     'f1': 0.8212410576042635,
     'precision': 0.8206432273411579,
     'recall': 0.8225319396051103}
</pre>
</div>

<p><a name=""></a></p>
<h3 id="find-most-wrong"><strong>Find most wrong</strong></h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-104-1">1</a></span>
<span class="normal"><a href="#__codelineno-104-2">2</a></span>
<span class="normal"><a href="#__codelineno-104-3">3</a></span>
<span class="normal"><a href="#__codelineno-104-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-104-1" name="__codelineno-104-1"></a><span class="o">%%</span><span class="n">time</span>
<a id="__codelineno-104-2" name="__codelineno-104-2"></a><span class="c1"># Get list of class names of test predictions</span>
<a id="__codelineno-104-3" name="__codelineno-104-3"></a><span class="n">test_pred_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">label_encoder</span><span class="o">.</span><span class="n">classes_</span><span class="p">[</span><span class="n">pred</span><span class="p">]</span> <span class="k">for</span> <span class="n">pred</span> <span class="ow">in</span> <span class="n">test_preds</span><span class="p">]</span>
<a id="__codelineno-104-4" name="__codelineno-104-4"></a><span class="n">test_pred_classes</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    CPU times: user 5.38 s, sys: 43.5 ms, total: 5.42 s
    Wall time: 5.4 s
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-105-1">1</a></span>
<span class="normal"><a href="#__codelineno-105-2">2</a></span>
<span class="normal"><a href="#__codelineno-105-3">3</a></span>
<span class="normal"><a href="#__codelineno-105-4">4</a></span>
<span class="normal"><a href="#__codelineno-105-5">5</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-105-1" name="__codelineno-105-1"></a><span class="c1"># Create prediction-enriched test dataframe</span>
<a id="__codelineno-105-2" name="__codelineno-105-2"></a><span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;prediction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">test_pred_classes</span> <span class="c1"># create column with test prediction class names</span>
<a id="__codelineno-105-3" name="__codelineno-105-3"></a><span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;pred_prob&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_max</span><span class="p">(</span><span class="n">test_pred_probs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span> <span class="c1"># get the maximum prediction probability</span>
<a id="__codelineno-105-4" name="__codelineno-105-4"></a><span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;correct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;prediction&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span> <span class="c1"># create binary column for whether the prediction is right or not</span>
<a id="__codelineno-105-5" name="__codelineno-105-5"></a><span class="n">test_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
        target      text                                            line_number total_lines     prediction  pred_prob   correct
    0   BACKGROUND  this study analyzed liver function abnormaliti...   0       8               OBJECTIVE   0.543327    False
    1   RESULTS     a post hoc analysis was conducted with the use...   1       8               OBJECTIVE   0.349346    False
    2   RESULTS     liver function tests ( lfts ) were measured at...   2       8               METHODS     0.798851    False
    3   RESULTS     survival analyses were used to assess the asso...   3       8               METHODS     0.641472    False
    4   RESULTS     the percentage of patients with abnormal lfts ...   4       8               RESULTS     0.701347    True
    5   RESULTS     when mean hemodynamic profiles were compared i...   5       8               RESULTS     0.864273    True
    6   RESULTS     multivariable analyses revealed that patients ...   6       8               RESULTS     0.493709    True
    7   CONCLUSIONS abnormal lfts are common in the adhf populatio...   7       8               CONCLUSIONS 0.422046    True
    8   CONCLUSIONS elevated meld-xi scores are associated with po...   8       8               RESULTS     0.501877    False
    9   BACKGROUND  minimally invasive endovascular aneurysm repai...   0       12              BACKGROUND  0.529906    True
    10  BACKGROUND  the aim of this study was to analyse the cost-...   1       12              OBJECTIVE   0.476263    False
    11  METHODS     resource use was determined from the amsterdam...   2       12              METHODS     0.626309    True
    12  METHODS     the analysis was performed from a provider per...   3       12              METHODS     0.874602    True
    13  METHODS     all costs were calculated as if all patients h...   4       12              METHODS     0.586748    True
    14  RESULTS     a total of @ patients were randomized .             5       12              RESULTS     0.716716    True
    15  RESULTS     the @-day mortality rate was @ per cent after ...   6       12              RESULTS     0.662560    True
    16  RESULTS     at @months , the total mortality rate for evar...   7       12              RESULTS     0.893152    True
    17  RESULTS     the mean cost difference between evar and or w...   8       12              RESULTS     0.818383    True
    18  RESULTS     the incremental cost-effectiveness ratio per p...   9       12              RESULTS     0.806015    True
    19  RESULTS     there was no significant difference in quality...   10      12              RESULTS     0.759984    True
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-106-1">1</a></span>
<span class="normal"><a href="#__codelineno-106-2">2</a></span>
<span class="normal"><a href="#__codelineno-106-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-106-1" name="__codelineno-106-1"></a><span class="c1"># Find top 100 most wrong samples (note: 100 is an abitrary number, you could go through all of them if you wanted)</span>
<a id="__codelineno-106-2" name="__codelineno-106-2"></a><span class="n">top_100_wrong</span> <span class="o">=</span> <span class="n">test_df</span><span class="p">[</span><span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;correct&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;pred_prob&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)[:</span><span class="mi">100</span><span class="p">]</span>
<a id="__codelineno-106-3" name="__codelineno-106-3"></a><span class="n">top_100_wrong</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
            target      text                                            line_number total_lines prediction  pred_prob   correct
    16347   BACKGROUND  to evaluate the effects of the lactic acid bac...   0           12      OBJECTIVE   0.950165    False
    13874   CONCLUSIONS symptom outcomes will be assessed and estimate...   4           6       METHODS     0.930301    False
    13598   METHODS     -@ % vs. fish : -@ % vs. fish + s : -@ % ; p <...   6           9       RESULTS     0.929556    False
    1221    RESULTS     data were collected prospectively for @ months...   3           13      METHODS     0.927612    False
    835     BACKGROUND  to assess the temporal patterns of late gastro...   0           11      OBJECTIVE   0.917503    False
    ...     ...         ...                                                 ...         ...     ...         ...         ...
    1827    CONCLUSIONS nct@ ( clinicaltrials.gov ) .                       18          18      BACKGROUND  0.824751    False
    19594   RESULTS     changing the fractionation from conventional t...   11          12      CONCLUSIONS 0.824516    False
    3363    RESULTS     similar preoperative parameters were establish...   3           12      METHODS     0.824234    False
    12159   METHODS     no pain was reported in the saffron group , wh...   10          12      RESULTS     0.823816    False
    16840   RESULTS     the primary endpoint was a composite of cardio...   3           12      METHODS     0.823072    False
    100 rows × 7 columns
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-107-1">1</a></span>
<span class="normal"><a href="#__codelineno-107-2">2</a></span>
<span class="normal"><a href="#__codelineno-107-3">3</a></span>
<span class="normal"><a href="#__codelineno-107-4">4</a></span>
<span class="normal"><a href="#__codelineno-107-5">5</a></span>
<span class="normal"><a href="#__codelineno-107-6">6</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-107-1" name="__codelineno-107-1"></a><span class="c1"># Investigate top wrong preds</span>
<a id="__codelineno-107-2" name="__codelineno-107-2"></a><span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">top_100_wrong</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span> <span class="c1"># adjust indexes to view different samples</span>
<a id="__codelineno-107-3" name="__codelineno-107-3"></a>  <span class="n">_</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">total_lines</span><span class="p">,</span> <span class="n">prediction</span><span class="p">,</span> <span class="n">pred_prob</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">row</span>
<a id="__codelineno-107-4" name="__codelineno-107-4"></a>  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Target: </span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s2">, Pred: </span><span class="si">{</span><span class="n">prediction</span><span class="si">}</span><span class="s2">, Prob: </span><span class="si">{</span><span class="n">pred_prob</span><span class="si">}</span><span class="s2">, Line number: </span><span class="si">{</span><span class="n">line_number</span><span class="si">}</span><span class="s2">, Total lines: </span><span class="si">{</span><span class="n">total_lines</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-107-5" name="__codelineno-107-5"></a>  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Text:</span><span class="se">\n</span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-107-6" name="__codelineno-107-6"></a>  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-----</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Target: BACKGROUND, Pred: OBJECTIVE, Prob: 0.950165331363678, Line number: 0, Total lines: 12

    Text:
    to evaluate the effects of the lactic acid bacterium lactobacillus salivarius on caries risk factors .

    -----

    Target: CONCLUSIONS, Pred: METHODS, Prob: 0.9303005933761597, Line number: 4, Total lines: 6

    Text:
    symptom outcomes will be assessed and estimates of cost-effectiveness made .

    -----

    Target: METHODS, Pred: RESULTS, Prob: 0.9295557141304016, Line number: 6, Total lines: 9

    Text:
    -@ % vs. fish : -@ % vs. fish + s : -@ % ; p < @ ) but there were no significant differences between groups .

    -----

    Target: RESULTS, Pred: METHODS, Prob: 0.9276118278503418, Line number: 3, Total lines: 13

    Text:
    data were collected prospectively for @ months beginning after completion of the first @ group clinic appointments ( @ months post randomization ) .

    -----

    Target: BACKGROUND, Pred: OBJECTIVE, Prob: 0.9175025224685669, Line number: 0, Total lines: 11

    Text:
    to assess the temporal patterns of late gastrointestinal ( gi ) and genitourinary ( gu ) radiotherapy toxicity and resolution rates in a randomised controlled trial ( all-ireland cooperative oncology research group @-@ ) assessing duration of neo-adjuvant ( na ) hormone therapy for localised prostate cancer .

    -----

    Target: BACKGROUND, Pred: OBJECTIVE, Prob: 0.9112550020217896, Line number: 0, Total lines: 10

    Text:
    to validate the association between accommodation and visual asthenopia by measuring objective accommodative amplitude with the optical quality analysis system ( oqas , visiometrics , terrassa , spain ) , and to investigate associations among accommodation , ocular surface instability , and visual asthenopia while viewing @d displays .

    -----

    Target: RESULTS, Pred: METHODS, Prob: 0.9096789360046387, Line number: 4, Total lines: 13

    Text:
    baseline measures included sociodemographics , standardized anthropometrics , asthma control test ( act ) , gerd symptom assessment scale , pittsburgh sleep quality index , and berlin questionnaire for sleep apnea .

    -----

    Target: OBJECTIVE, Pred: METHODS, Prob: 0.9064327478408813, Line number: 3, Total lines: 13

    Text:
    design , settings , participants , and intervention : ten healthy , normal-weight men were studied in randomized , double-blind fashion , each receiving a @-minute intraduodenal infusion of l-trp at @ ( total @ kcal ) or @ ( total @ kcal ) kcal/min or saline ( control ) .

    -----

    Target: RESULTS, Pred: METHODS, Prob: 0.9031506776809692, Line number: 3, Total lines: 16

    Text:
    a cluster randomised trial was implemented with @,@ children in @ government primary schools on the south coast of kenya in @-@ .

    -----

    Target: METHODS, Pred: RESULTS, Prob: 0.9003159999847412, Line number: 5, Total lines: 7

    Text:
    at this time , an as@ response was achieved by @ ( @ % ) and @ ( @ % ) patients in groups @ and @ , respectively ( p < @ for all ) .

    -----
</pre>
</div>

              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../nlp-1-binary/" class="md-footer__link md-footer__link--prev" aria-label="Previous: NLP - Binary-Class Disaster Tweets" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              NLP - Binary-Class Disaster Tweets
            </div>
          </div>
        </a>
      
      
        
        <a href="../nlp-3-sentiment/" class="md-footer__link md-footer__link--next" aria-label="Next: NLP - Multi-Class Sentiment Analysis" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              NLP - Multi-Class Sentiment Analysis
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2020 - 2022 Mark Schwarz
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["search.suggest", "search.highlight", "search.tabs.link", "content.tabs.link", "navigation.indexes", "navigation.tabs", "navigation.top"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../../../assets/javascripts/workers/search.cefbb252.min.js"}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.a5f8ea78.min.js"></script>
      
    
  </body>
</html>