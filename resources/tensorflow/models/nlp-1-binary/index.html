
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../../../assets/dl-logo-big-512x512-color.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.0.5">
    
    
      
        <title>NLP - Binary-Class Disaster Tweets - DrLiptons</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.a617204b.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.9204c3b2.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  <link rel="stylesheet" href="../../../../overrides/assets/stylesheets/main.d9227bb8.min.css">

  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="indigo" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#binary-class-natural-language-processing-with-disaster-tweets-dataset" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="DrLiptons" class="md-header__button md-logo" aria-label="DrLiptons" data-md-component="logo">
      
  <img src="../../../../assets/dl-logo-big-512x512-color.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DrLiptons
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              NLP - Binary-Class Disaster Tweets
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="" data-md-color-primary="indigo" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../../about/" class="md-tabs__link">
      About
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../../wip/" class="md-tabs__link">
      In Progress
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../reference/" class="md-tabs__link">
        Reference
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../resource/" class="md-tabs__link md-tabs__link--active">
        Resource
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="DrLiptons" class="md-nav__button md-logo" aria-label="DrLiptons" data-md-component="logo">
      
  <img src="../../../../assets/dl-logo-big-512x512-color.png" alt="logo">

    </a>
    DrLiptons
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../about/" class="md-nav__link">
        About
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../wip/" class="md-nav__link">
        In Progress
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4">
          Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../reference/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2" type="checkbox" id="__nav_4_2" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_2">
          Python
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Python" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          Python
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/get-live-financial-data/" class="md-nav__link">
        Get Live Financial Data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/flight-deals/" class="md-nav__link">
        Flight Deals
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/alien-invaders/" class="md-nav__link">
        Alien Invaders
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/auto-job-app/" class="md-nav__link">
        Automated Job Application
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/price-tracker/" class="md-nav__link">
        Price Tracker
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/password-manager/" class="md-nav__link">
        Password Manager
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/text-2-morse-code/" class="md-nav__link">
        Text2MorseCode
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/stock-news-alerts/" class="md-nav__link">
        Stock News Alert
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/tetris/" class="md-nav__link">
        Tetris Clone
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3" type="checkbox" id="__nav_4_3" >
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_3">
          TensorFlow
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="TensorFlow" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_3">
          <span class="md-nav__icon md-icon"></span>
          TensorFlow
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3_1" type="checkbox" id="__nav_4_3_1" >
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_3_1">
          Plant Disease Detection
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Plant Disease Detection" data-md-level="3">
        <label class="md-nav__title" for="__nav_4_3_1">
          <span class="md-nav__icon md-icon"></span>
          Plant Disease Detection
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/pdd/plant-disease-detection/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/pdd/part-1-create-ml-model/" class="md-nav__link">
        Part 1 - Create ML Model
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/pdd/part-2-create-app/" class="md-nav__link">
        Part 2 - Desktop App
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/pdd/part-3-make-exe/" class="md-nav__link">
        Part 3 - Make Executable
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/object-detection/" class="md-nav__link">
        Object Detection
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" checked>
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5">
          Resource
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Resource" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Resource
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../resource/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_2" type="checkbox" id="__nav_5_2" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5_2">
          Python
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Python" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_2">
          <span class="md-nav__icon md-icon"></span>
          Python
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../python/scikit-learn/" class="md-nav__link">
        Scikit-Learn
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../python/matplotlib/" class="md-nav__link">
        Matplotlib
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../python/numpy/" class="md-nav__link">
        Numpy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../python/pandas/" class="md-nav__link">
        Pandas
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../python/mplfinance/" class="md-nav__link">
        mplfinance
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_3" type="checkbox" id="__nav_5_3" checked>
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5_3">
          TensorFlow
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="TensorFlow" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_3">
          <span class="md-nav__icon md-icon"></span>
          TensorFlow
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_3_1" type="checkbox" id="__nav_5_3_1" >
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5_3_1">
          TensorFlow Exam
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="TensorFlow Exam" data-md-level="3">
        <label class="md-nav__title" for="__nav_5_3_1">
          <span class="md-nav__icon md-icon"></span>
          TensorFlow Exam
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tf-exam/tf-exam-overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_3_1_2" type="checkbox" id="__nav_5_3_1_2" >
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5_3_1_2">
          Coursera - DeepLearning.AI TensorFlow Developer
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Coursera - DeepLearning.AI TensorFlow Developer" data-md-level="4">
        <label class="md-nav__title" for="__nav_5_3_1_2">
          <span class="md-nav__icon md-icon"></span>
          Coursera - DeepLearning.AI TensorFlow Developer
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tf-exam/cs-part-1/" class="md-nav__link">
        Part 1 - Introduction to TF
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tf-exam/cs-part-2/" class="md-nav__link">
        Part 2 - CNN in TF
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tf-exam/cs-part-3/" class="md-nav__link">
        Part 3 -  NLP in TF
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tf-exam/cs-part-4/" class="md-nav__link">
        Part 4 - Time Series
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tf-exam/pass-tensorflow-cert/" class="md-nav__link">
        How I past TensorFlow Exam
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tf-model-bp/" class="md-nav__link">
        TensorFlow Blueprint
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_3_3" type="checkbox" id="__nav_5_3_3" checked>
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5_3_3">
          TensorFlow Models
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="TensorFlow Models" data-md-level="3">
        <label class="md-nav__title" for="__nav_5_3_3">
          <span class="md-nav__icon md-icon"></span>
          TensorFlow Models
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../model-list/" class="md-nav__link">
        List of Models
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_3_3_2" type="checkbox" id="__nav_5_3_3_2" >
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5_3_3_2">
          Neural Network Regressions
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Neural Network Regressions" data-md-level="4">
        <label class="md-nav__title" for="__nav_5_3_3_2">
          <span class="md-nav__icon md-icon"></span>
          Neural Network Regressions
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../simple-regression/" class="md-nav__link">
        NNR - House Prices
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../regression-boston-housing/" class="md-nav__link">
        NNR - Boston Housing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../titanic/" class="md-nav__link">
        NNR - Titanic
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_3_3_3" type="checkbox" id="__nav_5_3_3_3" >
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5_3_3_3">
          Image Classification
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Image Classification" data-md-level="4">
        <label class="md-nav__title" for="__nav_5_3_3_3">
          <span class="md-nav__icon md-icon"></span>
          Image Classification
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../basic-fmnist/" class="md-nav__link">
        Basic Image Classification - FMNIST
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../image-classification-dogs-cats/" class="md-nav__link">
        Image Classification - Dogs & Cats
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cnn-fmnist/" class="md-nav__link">
        CNN - FMNIST
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_3_3_4" type="checkbox" id="__nav_5_3_3_4" checked>
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5_3_3_4">
          Natural Language Processing
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Natural Language Processing" data-md-level="4">
        <label class="md-nav__title" for="__nav_5_3_3_4">
          <span class="md-nav__icon md-icon"></span>
          Natural Language Processing
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../imdb/" class="md-nav__link">
        NLP - Binary-Class IMDB
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          NLP - Binary-Class Disaster Tweets
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        NLP - Binary-Class Disaster Tweets
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#at-a-glance" class="md-nav__link">
    At a Glance
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#check-the-computing-processor" class="md-nav__link">
    Check the computing processor
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#import-dependencies" class="md-nav__link">
    Import Dependencies
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utility-functions" class="md-nav__link">
    Utility Functions
  </a>
  
    <nav class="md-nav" aria-label="Utility Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#compare-histories" class="md-nav__link">
    Compare histories
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inspect-data" class="md-nav__link">
    Inspect data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unzip-data" class="md-nav__link">
    Unzip data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#predictions-load-pred-plot" class="md-nav__link">
    Predictions (load, pred, plot)
  </a>
  
    <nav class="md-nav" aria-label="Predictions (load, pred, plot)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#load-and-prep-image" class="md-nav__link">
    Load and prep image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pred-and-plot-single" class="md-nav__link">
    Pred and plot single
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pred-and-plot-multi" class="md-nav__link">
    Pred and plot multi
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calculate-results-for-evaluating-accuracy-precision-recall-f1-score" class="md-nav__link">
    Calculate results (for evaluating: accuracy, precision, recall, f1-score)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-tensorboard-callback" class="md-nav__link">
    Create tensorboard callback
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compare-baseline-to-new-results" class="md-nav__link">
    Compare baseline to new results
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-data" class="md-nav__link">
    The data
  </a>
  
    <nav class="md-nav" aria-label="The data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#download-the-data" class="md-nav__link">
    Download the data
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inspect-the-data" class="md-nav__link">
    Inspect the data
  </a>
  
    <nav class="md-nav" aria-label="Inspect the data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#turn-csv-files-into-pandas-dataframe" class="md-nav__link">
    Turn .csv files into pandas DataFrame
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shuffle-the-data" class="md-nav__link">
    Shuffle the data
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prepare-the-data" class="md-nav__link">
    Prepare the data
  </a>
  
    <nav class="md-nav" aria-label="Prepare the data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#split-the-data" class="md-nav__link">
    Split the data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#convert-texts-into-numbers" class="md-nav__link">
    Convert texts into numbers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-an-embedding-using-an-embedding-layer" class="md-nav__link">
    Creating an Embedding using an Embedding Layer
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-0-base-model" class="md-nav__link">
    Model 0: Base Model
  </a>
  
    <nav class="md-nav" aria-label="Model 0: Base Model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-compile-and-run-the-model" class="md-nav__link">
    Create, Compile, and Run the model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../nlp-2-multi/" class="md-nav__link">
        NLP - Multi-Class PedMed
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../nlp-3-sentiment/" class="md-nav__link">
        NLP - Multi-Class Sentiment Analysis
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_3_3_5" type="checkbox" id="__nav_5_3_3_5" >
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5_3_3_5">
          Time Series
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Time Series" data-md-level="4">
        <label class="md-nav__title" for="__nav_5_3_3_5">
          <span class="md-nav__icon md-icon"></span>
          Time Series
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ts-bitcoin/" class="md-nav__link">
        Time Series - Bitcoin Price Forecast
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ts-weather/" class="md-nav__link">
        Time Series - Weather Forecast
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_3_3_6" type="checkbox" id="__nav_5_3_3_6" >
      
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5_3_3_6">
          Miscellaneous
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Miscellaneous" data-md-level="4">
        <label class="md-nav__title" for="__nav_5_3_3_6">
          <span class="md-nav__icon md-icon"></span>
          Miscellaneous
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utilities/" class="md-nav__link">
        Utility Functions
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_4" type="checkbox" id="__nav_5_4" >
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5_4">
          Microsoft Certification
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Microsoft Certification" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_4">
          <span class="md-nav__icon md-icon"></span>
          Microsoft Certification
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ms/ms-overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ms/az-900/" class="md-nav__link">
        Azure Fundamentals
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ms/ai-900/" class="md-nav__link">
        Azure AI Fundamentals
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ms/dp-900/" class="md-nav__link">
        Azure Data Fundamentals
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#at-a-glance" class="md-nav__link">
    At a Glance
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#check-the-computing-processor" class="md-nav__link">
    Check the computing processor
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#import-dependencies" class="md-nav__link">
    Import Dependencies
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utility-functions" class="md-nav__link">
    Utility Functions
  </a>
  
    <nav class="md-nav" aria-label="Utility Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#compare-histories" class="md-nav__link">
    Compare histories
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inspect-data" class="md-nav__link">
    Inspect data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unzip-data" class="md-nav__link">
    Unzip data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#predictions-load-pred-plot" class="md-nav__link">
    Predictions (load, pred, plot)
  </a>
  
    <nav class="md-nav" aria-label="Predictions (load, pred, plot)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#load-and-prep-image" class="md-nav__link">
    Load and prep image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pred-and-plot-single" class="md-nav__link">
    Pred and plot single
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pred-and-plot-multi" class="md-nav__link">
    Pred and plot multi
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calculate-results-for-evaluating-accuracy-precision-recall-f1-score" class="md-nav__link">
    Calculate results (for evaluating: accuracy, precision, recall, f1-score)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-tensorboard-callback" class="md-nav__link">
    Create tensorboard callback
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compare-baseline-to-new-results" class="md-nav__link">
    Compare baseline to new results
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-data" class="md-nav__link">
    The data
  </a>
  
    <nav class="md-nav" aria-label="The data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#download-the-data" class="md-nav__link">
    Download the data
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inspect-the-data" class="md-nav__link">
    Inspect the data
  </a>
  
    <nav class="md-nav" aria-label="Inspect the data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#turn-csv-files-into-pandas-dataframe" class="md-nav__link">
    Turn .csv files into pandas DataFrame
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shuffle-the-data" class="md-nav__link">
    Shuffle the data
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prepare-the-data" class="md-nav__link">
    Prepare the data
  </a>
  
    <nav class="md-nav" aria-label="Prepare the data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#split-the-data" class="md-nav__link">
    Split the data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#convert-texts-into-numbers" class="md-nav__link">
    Convert texts into numbers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-an-embedding-using-an-embedding-layer" class="md-nav__link">
    Creating an Embedding using an Embedding Layer
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-0-base-model" class="md-nav__link">
    Model 0: Base Model
  </a>
  
    <nav class="md-nav" aria-label="Model 0: Base Model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-compile-and-run-the-model" class="md-nav__link">
    Create, Compile, and Run the model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

<h1 id="binary-class-natural-language-processing-with-disaster-tweets-dataset">Binary-Class Natural Language Processing with Disaster Tweets dataset</h1>
<h2 id="at-a-glance"><b>At a Glance</b></h2>
<details class="example" open="open">
<summary>What to expect</summary>
<ul>
<li><a href="#model-0">Model 0: Base Model</a></li>
<li><a href="#model-1">Model 1: A Simple Dense Model</a></li>
<li><a href="#model-2">Model 2: LSTM Model</a></li>
<li><a href="#model-3">Model 3: GRU Model</a></li>
<li><a href="#model-4">Model 4: Bidirectional RNN Model</a></li>
<li><a href="#model-5">Model 5: Conv1D Model</a></li>
<li><a href="#model-6">Model 6: TensorFlow Hub - Pretrained Sentence Encoder</a></li>
<li><a href="#model-7">Model 7: Model 7: TensorFlow Hub - Pretrained Sentence Encoder 10% of training data</a></li>
</ul>
</details>
<p><a name="check"></a></p>
<h2 id="check-the-computing-processor"><strong>Check the computing processor</strong></h2>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span>
<span class="normal"><a href="#__codelineno-0-2">2</a></span>
<span class="normal"><a href="#__codelineno-0-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="c1"># Check for GPU</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="err">!</span><span class="n">nvcc</span> <span class="o">--</span><span class="n">version</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="err">!</span><span class="n">nvidia</span><span class="o">-</span><span class="n">smi</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    nvcc: NVIDIA (R) Cuda compiler driver
    Copyright (c) 2005-2020 NVIDIA Corporation
    Built on Mon_Oct_12_20:09:46_PDT_2020
    Cuda compilation tools, release 11.1, V11.1.105
    Build cuda_11.1.TC455_06.29190527_0
    Fri Dec  3 13:41:55 2021       
    +-----------------------------------------------------------------------------+
    | NVIDIA-SMI 495.44       Driver Version: 460.32.03    CUDA Version: 11.2     |
    |-------------------------------+----------------------+----------------------+
    | GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |
    | Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |
    |                               |                      |               MIG M. |
    |===============================+======================+======================|
    |   0  Tesla K80           Off  | 00000000:00:04.0 Off |                    0 |
    | N/A   37C    P8    27W / 149W |      0MiB / 11441MiB |      0%      Default |
    |                               |                      |                  N/A |
    +-------------------------------+----------------------+----------------------+

    +-----------------------------------------------------------------------------+
    | Processes:                                                                  |
    |  GPU   GI   CI        PID   Type   Process name                  GPU Memory |
    |        ID   ID                                                   Usage      |
    |=============================================================================|
    |  No running processes found                                                 |
    +-----------------------------------------------------------------------------+
</pre>
</div>

<p><a name="import-dependencies"></a></p>
<h2 id="import-dependencies"><strong>Import Dependencies</strong></h2>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-1-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-1-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-1-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-1-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-1-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-1-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-1-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-1-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-1-10">10</a></span>
<span class="normal"><a href="#__codelineno-1-11">11</a></span>
<span class="normal"><a href="#__codelineno-1-12">12</a></span>
<span class="normal"><a href="#__codelineno-1-13">13</a></span>
<span class="normal"><a href="#__codelineno-1-14">14</a></span>
<span class="normal"><a href="#__codelineno-1-15">15</a></span>
<span class="normal"><a href="#__codelineno-1-16">16</a></span>
<span class="normal"><a href="#__codelineno-1-17">17</a></span>
<span class="normal"><a href="#__codelineno-1-18">18</a></span>
<span class="normal"><a href="#__codelineno-1-19">19</a></span>
<span class="normal"><a href="#__codelineno-1-20">20</a></span>
<span class="normal"><a href="#__codelineno-1-21">21</a></span>
<span class="normal"><a href="#__codelineno-1-22">22</a></span>
<span class="normal"><a href="#__codelineno-1-23">23</a></span>
<span class="normal"><a href="#__codelineno-1-24">24</a></span>
<span class="normal"><a href="#__codelineno-1-25">25</a></span>
<span class="normal"><a href="#__codelineno-1-26">26</a></span>
<span class="normal"><a href="#__codelineno-1-27">27</a></span>
<span class="normal"><a href="#__codelineno-1-28">28</a></span>
<span class="normal"><a href="#__codelineno-1-29">29</a></span>
<span class="normal"><a href="#__codelineno-1-30">30</a></span>
<span class="normal"><a href="#__codelineno-1-31">31</a></span>
<span class="normal"><a href="#__codelineno-1-32">32</a></span>
<span class="normal"><a href="#__codelineno-1-33">33</a></span>
<span class="normal"><a href="#__codelineno-1-34">34</a></span>
<span class="normal"><a href="#__codelineno-1-35">35</a></span>
<span class="normal"><a href="#__codelineno-1-36">36</a></span>
<span class="normal"><a href="#__codelineno-1-37">37</a></span>
<span class="normal"><a href="#__codelineno-1-38">38</a></span>
<span class="normal"><a href="#__codelineno-1-39">39</a></span>
<span class="normal"><a href="#__codelineno-1-40">40</a></span>
<span class="normal"><a href="#__codelineno-1-41">41</a></span>
<span class="normal"><a href="#__codelineno-1-42">42</a></span>
<span class="normal"><a href="#__codelineno-1-43">43</a></span>
<span class="normal"><a href="#__codelineno-1-44">44</a></span>
<span class="normal"><a href="#__codelineno-1-45">45</a></span>
<span class="normal"><a href="#__codelineno-1-46">46</a></span>
<span class="normal"><a href="#__codelineno-1-47">47</a></span>
<span class="normal"><a href="#__codelineno-1-48">48</a></span>
<span class="normal"><a href="#__codelineno-1-49">49</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="kn">import</span> <span class="nn">random</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="kn">import</span> <span class="nn">os</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="kn">import</span> <span class="nn">matplotlib.image</span> <span class="k">as</span> <span class="nn">mpimg</span>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="c1"># tensorflow dataset</span>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="kn">import</span> <span class="nn">tensorflow_datasets</span> <span class="k">as</span> <span class="nn">tfds</span>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a>
<a id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="c1"># import wget as wget # only for PyCharm</span>
<a id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="kn">import</span> <span class="nn">zipfile</span> <span class="k">as</span> <span class="nn">zf</span>
<a id="__codelineno-1-12" name="__codelineno-1-12"></a>
<a id="__codelineno-1-13" name="__codelineno-1-13"></a><span class="kn">import</span> <span class="nn">pathlib</span>
<a id="__codelineno-1-14" name="__codelineno-1-14"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a id="__codelineno-1-15" name="__codelineno-1-15"></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<a id="__codelineno-1-16" name="__codelineno-1-16"></a>
<a id="__codelineno-1-17" name="__codelineno-1-17"></a><span class="kn">import</span> <span class="nn">random</span>
<a id="__codelineno-1-18" name="__codelineno-1-18"></a>
<a id="__codelineno-1-19" name="__codelineno-1-19"></a><span class="c1"># Used in Prepare the data</span>
<a id="__codelineno-1-20" name="__codelineno-1-20"></a><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<a id="__codelineno-1-21" name="__codelineno-1-21"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.layers.experimental.preprocessing</span> <span class="kn">import</span> <span class="n">TextVectorization</span>
<a id="__codelineno-1-22" name="__codelineno-1-22"></a>
<a id="__codelineno-1-23" name="__codelineno-1-23"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.preprocessing.image</span> <span class="kn">import</span> <span class="n">ImageDataGenerator</span> <span class="c1"># Use for preprocessing the data</span>
<a id="__codelineno-1-24" name="__codelineno-1-24"></a>
<a id="__codelineno-1-25" name="__codelineno-1-25"></a><span class="c1"># Use in the model</span>
<a id="__codelineno-1-26" name="__codelineno-1-26"></a><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<a id="__codelineno-1-27" name="__codelineno-1-27"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.models</span> <span class="kn">import</span> <span class="n">Sequential</span>
<a id="__codelineno-1-28" name="__codelineno-1-28"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">Conv2D</span><span class="p">,</span> <span class="n">MaxPool2D</span><span class="p">,</span> <span class="n">Flatten</span><span class="p">,</span> <span class="n">Dense</span>
<a id="__codelineno-1-29" name="__codelineno-1-29"></a>
<a id="__codelineno-1-30" name="__codelineno-1-30"></a><span class="kn">import</span> <span class="nn">tensorflow_hub</span> <span class="k">as</span> <span class="nn">hub</span>
<a id="__codelineno-1-31" name="__codelineno-1-31"></a>
<a id="__codelineno-1-32" name="__codelineno-1-32"></a><span class="kn">import</span> <span class="nn">datetime</span>
<a id="__codelineno-1-33" name="__codelineno-1-33"></a>
<a id="__codelineno-1-34" name="__codelineno-1-34"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.layers.experimental</span> <span class="kn">import</span> <span class="n">preprocessing</span> <span class="c1"># for data augmentation</span>
<a id="__codelineno-1-35" name="__codelineno-1-35"></a>
<a id="__codelineno-1-36" name="__codelineno-1-36"></a><span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">TfidfVectorizer</span>
<a id="__codelineno-1-37" name="__codelineno-1-37"></a><span class="kn">from</span> <span class="nn">sklearn.naive_bayes</span> <span class="kn">import</span> <span class="n">MultinomialNB</span>
<a id="__codelineno-1-38" name="__codelineno-1-38"></a><span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<a id="__codelineno-1-39" name="__codelineno-1-39"></a>
<a id="__codelineno-1-40" name="__codelineno-1-40"></a><span class="c1"># Evaluate model</span>
<a id="__codelineno-1-41" name="__codelineno-1-41"></a><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span><span class="p">,</span> <span class="n">classification_report</span>
<a id="__codelineno-1-42" name="__codelineno-1-42"></a><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">precision_recall_fscore_support</span>
<a id="__codelineno-1-43" name="__codelineno-1-43"></a>
<a id="__codelineno-1-44" name="__codelineno-1-44"></a><span class="c1"># Utility scripts (confusion matrix)</span>
<a id="__codelineno-1-45" name="__codelineno-1-45"></a><span class="kn">import</span> <span class="nn">itertools</span>
<a id="__codelineno-1-46" name="__codelineno-1-46"></a><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">confusion_matrix</span>
<a id="__codelineno-1-47" name="__codelineno-1-47"></a>
<a id="__codelineno-1-48" name="__codelineno-1-48"></a><span class="c1"># mixed_precision</span>
<a id="__codelineno-1-49" name="__codelineno-1-49"></a><span class="kn">from</span> <span class="nn">tensorflow.keras</span> <span class="kn">import</span> <span class="n">mixed_precision</span>
</code></pre></div>
</td></tr></table>
<p><a name="utility-functions"></a></p>
<h2 id="utility-functions"><strong>Utility Functions</strong></h2>
<p><a name=""></a></p>
<h3 id="compare-histories">Compare histories</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-2-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-2-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-2-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-2-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-2-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-2-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-2-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-2-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-2-10">10</a></span>
<span class="normal"><a href="#__codelineno-2-11">11</a></span>
<span class="normal"><a href="#__codelineno-2-12">12</a></span>
<span class="normal"><a href="#__codelineno-2-13">13</a></span>
<span class="normal"><a href="#__codelineno-2-14">14</a></span>
<span class="normal"><a href="#__codelineno-2-15">15</a></span>
<span class="normal"><a href="#__codelineno-2-16">16</a></span>
<span class="normal"><a href="#__codelineno-2-17">17</a></span>
<span class="normal"><a href="#__codelineno-2-18">18</a></span>
<span class="normal"><a href="#__codelineno-2-19">19</a></span>
<span class="normal"><a href="#__codelineno-2-20">20</a></span>
<span class="normal"><a href="#__codelineno-2-21">21</a></span>
<span class="normal"><a href="#__codelineno-2-22">22</a></span>
<span class="normal"><a href="#__codelineno-2-23">23</a></span>
<span class="normal"><a href="#__codelineno-2-24">24</a></span>
<span class="normal"><a href="#__codelineno-2-25">25</a></span>
<span class="normal"><a href="#__codelineno-2-26">26</a></span>
<span class="normal"><a href="#__codelineno-2-27">27</a></span>
<span class="normal"><a href="#__codelineno-2-28">28</a></span>
<span class="normal"><a href="#__codelineno-2-29">29</a></span>
<span class="normal"><a href="#__codelineno-2-30">30</a></span>
<span class="normal"><a href="#__codelineno-2-31">31</a></span>
<span class="normal"><a href="#__codelineno-2-32">32</a></span>
<span class="normal"><a href="#__codelineno-2-33">33</a></span>
<span class="normal"><a href="#__codelineno-2-34">34</a></span>
<span class="normal"><a href="#__codelineno-2-35">35</a></span>
<span class="normal"><a href="#__codelineno-2-36">36</a></span>
<span class="normal"><a href="#__codelineno-2-37">37</a></span>
<span class="normal"><a href="#__codelineno-2-38">38</a></span>
<span class="normal"><a href="#__codelineno-2-39">39</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="k">def</span> <span class="nf">compare_histories</span><span class="p">(</span><span class="n">original_history</span><span class="p">,</span> <span class="n">new_history</span><span class="p">,</span> <span class="n">initial_epochs</span><span class="p">):</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a>  <span class="c1"># Get original history measurement</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a>  <span class="n">acc</span> <span class="o">=</span> <span class="n">original_history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s2">&quot;accuracy&quot;</span><span class="p">]</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a>  <span class="n">loss</span> <span class="o">=</span> <span class="n">original_history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s2">&quot;loss&quot;</span><span class="p">]</span>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a>  <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">acc</span><span class="p">))</span>
<a id="__codelineno-2-7" name="__codelineno-2-7"></a>
<a id="__codelineno-2-8" name="__codelineno-2-8"></a>  <span class="n">val_acc</span> <span class="o">=</span> <span class="n">original_history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s2">&quot;val_accuracy&quot;</span><span class="p">]</span>
<a id="__codelineno-2-9" name="__codelineno-2-9"></a>  <span class="n">val_loss</span> <span class="o">=</span> <span class="n">original_history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s2">&quot;val_loss&quot;</span><span class="p">]</span>
<a id="__codelineno-2-10" name="__codelineno-2-10"></a>
<a id="__codelineno-2-11" name="__codelineno-2-11"></a>  <span class="c1"># Combine original history with new history</span>
<a id="__codelineno-2-12" name="__codelineno-2-12"></a>  <span class="n">total_acc</span> <span class="o">=</span> <span class="n">acc</span> <span class="o">+</span> <span class="n">new_history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s2">&quot;accuracy&quot;</span><span class="p">]</span>
<a id="__codelineno-2-13" name="__codelineno-2-13"></a>  <span class="n">total_loss</span> <span class="o">=</span> <span class="n">loss</span> <span class="o">+</span> <span class="n">new_history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s2">&quot;loss&quot;</span><span class="p">]</span>
<a id="__codelineno-2-14" name="__codelineno-2-14"></a>
<a id="__codelineno-2-15" name="__codelineno-2-15"></a>  <span class="n">total_val_acc</span> <span class="o">=</span> <span class="n">val_acc</span> <span class="o">+</span> <span class="n">new_history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s2">&quot;val_accuracy&quot;</span><span class="p">]</span>
<a id="__codelineno-2-16" name="__codelineno-2-16"></a>  <span class="n">total_val_loss</span> <span class="o">=</span> <span class="n">val_loss</span> <span class="o">+</span> <span class="n">new_history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s2">&quot;val_loss&quot;</span><span class="p">]</span>
<a id="__codelineno-2-17" name="__codelineno-2-17"></a>
<a id="__codelineno-2-18" name="__codelineno-2-18"></a>  <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">total_acc</span><span class="p">))</span>
<a id="__codelineno-2-19" name="__codelineno-2-19"></a>  <span class="nb">print</span><span class="p">(</span><span class="n">total_acc</span><span class="p">)</span>
<a id="__codelineno-2-20" name="__codelineno-2-20"></a>
<a id="__codelineno-2-21" name="__codelineno-2-21"></a>  <span class="c1"># Make plots</span>
<a id="__codelineno-2-22" name="__codelineno-2-22"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<a id="__codelineno-2-23" name="__codelineno-2-23"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-2-24" name="__codelineno-2-24"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">total_acc</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Training Accuracy&#39;</span><span class="p">)</span>
<a id="__codelineno-2-25" name="__codelineno-2-25"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">total_val_acc</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Validation Accuracy&#39;</span><span class="p">)</span>
<a id="__codelineno-2-26" name="__codelineno-2-26"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">initial_epochs</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">initial_epochs</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-2-27" name="__codelineno-2-27"></a>            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Start Fine Tuning&#39;</span><span class="p">)</span> <span class="c1"># reshift plot around epochs</span>
<a id="__codelineno-2-28" name="__codelineno-2-28"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>
<a id="__codelineno-2-29" name="__codelineno-2-29"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Training and Validation Accuracy&#39;</span><span class="p">)</span>
<a id="__codelineno-2-30" name="__codelineno-2-30"></a>
<a id="__codelineno-2-31" name="__codelineno-2-31"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-2-32" name="__codelineno-2-32"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">total_loss</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Training Loss&#39;</span><span class="p">)</span>
<a id="__codelineno-2-33" name="__codelineno-2-33"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">total_val_loss</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Validation Loss&#39;</span><span class="p">)</span>
<a id="__codelineno-2-34" name="__codelineno-2-34"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">initial_epochs</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">initial_epochs</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-2-35" name="__codelineno-2-35"></a>            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Start Fine Tuning&#39;</span><span class="p">)</span> <span class="c1"># reshift plot around epochs</span>
<a id="__codelineno-2-36" name="__codelineno-2-36"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
<a id="__codelineno-2-37" name="__codelineno-2-37"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Training and Validation Loss&#39;</span><span class="p">)</span>
<a id="__codelineno-2-38" name="__codelineno-2-38"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;epoch&#39;</span><span class="p">)</span>
<a id="__codelineno-2-39" name="__codelineno-2-39"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<p><a name=""></a></p>
<h3 id="inspect-data">Inspect data</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span>
<span class="normal"><a href="#__codelineno-3-2">2</a></span>
<span class="normal"><a href="#__codelineno-3-3">3</a></span>
<span class="normal"><a href="#__codelineno-3-4">4</a></span>
<span class="normal"><a href="#__codelineno-3-5">5</a></span>
<span class="normal"><a href="#__codelineno-3-6">6</a></span>
<span class="normal"><a href="#__codelineno-3-7">7</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="k">def</span> <span class="nf">inspect_data</span><span class="p">(</span><span class="n">folder_name</span><span class="p">):</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a>  <span class="n">total_files</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a>  <span class="k">for</span> <span class="n">dirpath</span><span class="p">,</span> <span class="n">dirnames</span><span class="p">,</span> <span class="n">filesnames</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">folder_name</span><span class="p">):</span>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a>    <span class="n">total_files</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">filesnames</span><span class="p">)</span>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;There are </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">dirnames</span><span class="p">)</span><span class="si">}</span><span class="s2"> directories and </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">filesnames</span><span class="p">)</span><span class="si">}</span><span class="s2"> images in &#39;</span><span class="si">{</span><span class="n">dirpath</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
<a id="__codelineno-3-6" name="__codelineno-3-6"></a>
<a id="__codelineno-3-7" name="__codelineno-3-7"></a>  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;There are total </span><span class="si">{</span><span class="n">total_files</span><span class="si">}</span><span class="s2"> files.&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<p><a name=""></a></p>
<h3 id="unzip-data">Unzip data</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span>
<span class="normal"><a href="#__codelineno-4-2">2</a></span>
<span class="normal"><a href="#__codelineno-4-3">3</a></span>
<span class="normal"><a href="#__codelineno-4-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="k">def</span> <span class="nf">unzip_data</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a>  <span class="n">zip_ref</span> <span class="o">=</span> <span class="n">zf</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a>  <span class="n">zip_ref</span><span class="o">.</span><span class="n">extractall</span><span class="p">()</span>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a>  <span class="n">zip_ref</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<p><a name=""></a></p>
<h3 id="predictions-load-pred-plot">Predictions (load, pred, plot)</h3>
<p><a name=""></a></p>
<h4 id="load-and-prep-image">Load and prep image</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-5-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-5-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-5-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-5-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-5-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-5-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-5-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-5-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-5-10">10</a></span>
<span class="normal"><a href="#__codelineno-5-11">11</a></span>
<span class="normal"><a href="#__codelineno-5-12">12</a></span>
<span class="normal"><a href="#__codelineno-5-13">13</a></span>
<span class="normal"><a href="#__codelineno-5-14">14</a></span>
<span class="normal"><a href="#__codelineno-5-15">15</a></span>
<span class="normal"><a href="#__codelineno-5-16">16</a></span>
<span class="normal"><a href="#__codelineno-5-17">17</a></span>
<span class="normal"><a href="#__codelineno-5-18">18</a></span>
<span class="normal"><a href="#__codelineno-5-19">19</a></span>
<span class="normal"><a href="#__codelineno-5-20">20</a></span>
<span class="normal"><a href="#__codelineno-5-21">21</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="k">def</span> <span class="nf">load_and_prep_image</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">img_shape</span><span class="o">=</span><span class="mi">224</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a>  <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="sd">  Reads in an image from filename, turns it into a tensor and reshapes into</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="sd">  (224, 224, 3).</span>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="sd">  Parameters</span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="sd">  ----------</span>
<a id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="sd">  filename (str): string filename of target image</span>
<a id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="sd">  img_shape (int): size to resize target image to, default 224</span>
<a id="__codelineno-5-9" name="__codelineno-5-9"></a><span class="sd">  scale (bool): whether to scale pixel values to range(0, 1), default True</span>
<a id="__codelineno-5-10" name="__codelineno-5-10"></a><span class="sd">  &quot;&quot;&quot;</span>
<a id="__codelineno-5-11" name="__codelineno-5-11"></a>  <span class="c1"># Read in the image</span>
<a id="__codelineno-5-12" name="__codelineno-5-12"></a>  <span class="n">img</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<a id="__codelineno-5-13" name="__codelineno-5-13"></a>  <span class="c1"># Decode it into a tensor</span>
<a id="__codelineno-5-14" name="__codelineno-5-14"></a>  <span class="n">img</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">decode_jpeg</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<a id="__codelineno-5-15" name="__codelineno-5-15"></a>  <span class="c1"># Resize the image</span>
<a id="__codelineno-5-16" name="__codelineno-5-16"></a>  <span class="n">img</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">[</span><span class="n">img_shape</span><span class="p">,</span> <span class="n">img_shape</span><span class="p">])</span>
<a id="__codelineno-5-17" name="__codelineno-5-17"></a>  <span class="k">if</span> <span class="n">scale</span><span class="p">:</span>
<a id="__codelineno-5-18" name="__codelineno-5-18"></a>    <span class="c1"># Rescale the image (get all values between 0 and 1)</span>
<a id="__codelineno-5-19" name="__codelineno-5-19"></a>    <span class="k">return</span> <span class="n">img</span><span class="o">/</span><span class="mf">255.</span>
<a id="__codelineno-5-20" name="__codelineno-5-20"></a>  <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-5-21" name="__codelineno-5-21"></a>    <span class="k">return</span> <span class="n">img</span>
</code></pre></div>
</td></tr></table>
<p><a name=""></a></p>
<h4 id="pred-and-plot-single">Pred and plot single</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-6-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-6-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-6-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-6-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-6-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-6-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-6-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-6-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-6-10">10</a></span>
<span class="normal"><a href="#__codelineno-6-11">11</a></span>
<span class="normal"><a href="#__codelineno-6-12">12</a></span>
<span class="normal"><a href="#__codelineno-6-13">13</a></span>
<span class="normal"><a href="#__codelineno-6-14">14</a></span>
<span class="normal"><a href="#__codelineno-6-15">15</a></span>
<span class="normal"><a href="#__codelineno-6-16">16</a></span>
<span class="normal"><a href="#__codelineno-6-17">17</a></span>
<span class="normal"><a href="#__codelineno-6-18">18</a></span>
<span class="normal"><a href="#__codelineno-6-19">19</a></span>
<span class="normal"><a href="#__codelineno-6-20">20</a></span>
<span class="normal"><a href="#__codelineno-6-21">21</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="k">def</span> <span class="nf">pred_and_plot</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">class_names</span><span class="p">):</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a>  <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="sd">  Imports an image located at filename, makes a prediction on it with</span>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="sd">  a trained model and plots the image with the predicted class as the title.</span>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="sd">  &quot;&quot;&quot;</span>
<a id="__codelineno-6-6" name="__codelineno-6-6"></a>  <span class="c1"># Import the target image and preprocess it</span>
<a id="__codelineno-6-7" name="__codelineno-6-7"></a>  <span class="n">img</span> <span class="o">=</span> <span class="n">load_and_prep_image</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<a id="__codelineno-6-8" name="__codelineno-6-8"></a>
<a id="__codelineno-6-9" name="__codelineno-6-9"></a>  <span class="c1"># Make a prediction</span>
<a id="__codelineno-6-10" name="__codelineno-6-10"></a>  <span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<a id="__codelineno-6-11" name="__codelineno-6-11"></a>
<a id="__codelineno-6-12" name="__codelineno-6-12"></a>  <span class="c1"># Get the predicted class</span>
<a id="__codelineno-6-13" name="__codelineno-6-13"></a>  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pred</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># check for multi-class</span>
<a id="__codelineno-6-14" name="__codelineno-6-14"></a>    <span class="n">pred_class</span> <span class="o">=</span> <span class="n">class_names</span><span class="p">[</span><span class="n">pred</span><span class="o">.</span><span class="n">argmax</span><span class="p">()]</span> <span class="c1"># if more than one output, take the max</span>
<a id="__codelineno-6-15" name="__codelineno-6-15"></a>  <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-6-16" name="__codelineno-6-16"></a>    <span class="n">pred_class</span> <span class="o">=</span> <span class="n">class_names</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">pred</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])]</span> <span class="c1"># if only one output, round</span>
<a id="__codelineno-6-17" name="__codelineno-6-17"></a>
<a id="__codelineno-6-18" name="__codelineno-6-18"></a>  <span class="c1"># Plot the image and predicted class</span>
<a id="__codelineno-6-19" name="__codelineno-6-19"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<a id="__codelineno-6-20" name="__codelineno-6-20"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Prediction: </span><span class="si">{</span><span class="n">pred_class</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-6-21" name="__codelineno-6-21"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="kc">False</span><span class="p">);</span>
</code></pre></div>
</td></tr></table>
<p><a name=""></a></p>
<h4 id="pred-and-plot-multi">Pred and plot multi</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-7-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-7-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-7-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-7-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-7-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-7-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-7-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-7-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-7-10">10</a></span>
<span class="normal"><a href="#__codelineno-7-11">11</a></span>
<span class="normal"><a href="#__codelineno-7-12">12</a></span>
<span class="normal"><a href="#__codelineno-7-13">13</a></span>
<span class="normal"><a href="#__codelineno-7-14">14</a></span>
<span class="normal"><a href="#__codelineno-7-15">15</a></span>
<span class="normal"><a href="#__codelineno-7-16">16</a></span>
<span class="normal"><a href="#__codelineno-7-17">17</a></span>
<span class="normal"><a href="#__codelineno-7-18">18</a></span>
<span class="normal"><a href="#__codelineno-7-19">19</a></span>
<span class="normal"><a href="#__codelineno-7-20">20</a></span>
<span class="normal"><a href="#__codelineno-7-21">21</a></span>
<span class="normal"><a href="#__codelineno-7-22">22</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="k">def</span> <span class="nf">predict_and_plot_multiple</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">file_dir</span><span class="p">,</span> <span class="n">class_names</span><span class="p">):</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a>  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a>    <span class="c1"># Choose a random image from a random class </span>
<a id="__codelineno-7-5" name="__codelineno-7-5"></a>    <span class="n">class_name</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">class_names</span><span class="p">)</span>
<a id="__codelineno-7-6" name="__codelineno-7-6"></a>    <span class="n">filename</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">file_dir</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">class_name</span><span class="p">))</span>
<a id="__codelineno-7-7" name="__codelineno-7-7"></a>    <span class="n">filepath</span> <span class="o">=</span> <span class="n">file_dir</span> <span class="o">+</span> <span class="n">class_name</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">filename</span>
<a id="__codelineno-7-8" name="__codelineno-7-8"></a>
<a id="__codelineno-7-9" name="__codelineno-7-9"></a>    <span class="c1"># Load the image and make predictions</span>
<a id="__codelineno-7-10" name="__codelineno-7-10"></a>    <span class="n">img</span> <span class="o">=</span> <span class="n">load_and_prep_image</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># don&#39;t scale images for EfficientNet predictions</span>
<a id="__codelineno-7-11" name="__codelineno-7-11"></a>    <span class="n">pred_prob</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span> <span class="c1"># model accepts tensors of shape [None, 224, 224, 3]</span>
<a id="__codelineno-7-12" name="__codelineno-7-12"></a>    <span class="n">pred_class</span> <span class="o">=</span> <span class="n">class_names</span><span class="p">[</span><span class="n">pred_prob</span><span class="o">.</span><span class="n">argmax</span><span class="p">()]</span> <span class="c1"># find the predicted class </span>
<a id="__codelineno-7-13" name="__codelineno-7-13"></a>
<a id="__codelineno-7-14" name="__codelineno-7-14"></a>    <span class="c1"># Plot the image(s)</span>
<a id="__codelineno-7-15" name="__codelineno-7-15"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-7-16" name="__codelineno-7-16"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="o">/</span><span class="mf">255.</span><span class="p">)</span>
<a id="__codelineno-7-17" name="__codelineno-7-17"></a>    <span class="k">if</span> <span class="n">class_name</span> <span class="o">==</span> <span class="n">pred_class</span><span class="p">:</span> <span class="c1"># Change the color of text based on whether prediction is right or wrong</span>
<a id="__codelineno-7-18" name="__codelineno-7-18"></a>      <span class="n">title_color</span> <span class="o">=</span> <span class="s2">&quot;g&quot;</span>
<a id="__codelineno-7-19" name="__codelineno-7-19"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-7-20" name="__codelineno-7-20"></a>      <span class="n">title_color</span> <span class="o">=</span> <span class="s2">&quot;r&quot;</span>
<a id="__codelineno-7-21" name="__codelineno-7-21"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;actual: </span><span class="si">{</span><span class="n">class_name</span><span class="si">}</span><span class="s2">, pred: </span><span class="si">{</span><span class="n">pred_class</span><span class="si">}</span><span class="s2">, prob: </span><span class="si">{</span><span class="n">pred_prob</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">title_color</span><span class="p">)</span>
<a id="__codelineno-7-22" name="__codelineno-7-22"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="kc">False</span><span class="p">);</span>
</code></pre></div>
</td></tr></table>
<p><a name=""></a></p>
<h3 id="calculate-results-for-evaluating-accuracy-precision-recall-f1-score">Calculate results (for evaluating: accuracy, precision, recall, f1-score)</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-8-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-8-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-8-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-8-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-8-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-8-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-8-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-8-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-8-10">10</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="k">def</span> <span class="nf">calculate_results</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a>  <span class="c1"># Calculate model accuracy</span>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a>  <span class="n">model_accuracy</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a>  <span class="c1"># Calculate precision, recall, and f1-score using &quot;weightd average&quot;</span>
<a id="__codelineno-8-5" name="__codelineno-8-5"></a>  <span class="n">model_precision</span><span class="p">,</span> <span class="n">model_recall</span><span class="p">,</span> <span class="n">model_f1</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">precision_recall_fscore_support</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;weighted&quot;</span><span class="p">)</span>
<a id="__codelineno-8-6" name="__codelineno-8-6"></a>  <span class="n">model_results</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;accuracy&quot;</span><span class="p">:</span> <span class="n">model_accuracy</span><span class="p">,</span>
<a id="__codelineno-8-7" name="__codelineno-8-7"></a>                   <span class="s2">&quot;precision&quot;</span><span class="p">:</span> <span class="n">model_precision</span><span class="p">,</span>
<a id="__codelineno-8-8" name="__codelineno-8-8"></a>                   <span class="s2">&quot;recall&quot;</span><span class="p">:</span> <span class="n">model_recall</span><span class="p">,</span>
<a id="__codelineno-8-9" name="__codelineno-8-9"></a>                   <span class="s2">&quot;f1&quot;</span><span class="p">:</span> <span class="n">model_f1</span><span class="p">}</span>
<a id="__codelineno-8-10" name="__codelineno-8-10"></a>  <span class="k">return</span> <span class="n">model_results</span>
</code></pre></div>
</td></tr></table>
<p><a name=""></a></p>
<h3 id="create-tensorboard-callback">Create tensorboard callback</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-9-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-9-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-9-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-9-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-9-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-9-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-9-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-9-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-9-10">10</a></span>
<span class="normal"><a href="#__codelineno-9-11">11</a></span>
<span class="normal"><a href="#__codelineno-9-12">12</a></span>
<span class="normal"><a href="#__codelineno-9-13">13</a></span>
<span class="normal"><a href="#__codelineno-9-14">14</a></span>
<span class="normal"><a href="#__codelineno-9-15">15</a></span>
<span class="normal"><a href="#__codelineno-9-16">16</a></span>
<span class="normal"><a href="#__codelineno-9-17">17</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="k">def</span> <span class="nf">create_tensorboard_callback</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="n">experiment_name</span><span class="p">):</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a>  <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="sd">  Creates a TensorBoard callback instand to store log files.</span>
<a id="__codelineno-9-4" name="__codelineno-9-4"></a>
<a id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="sd">  Stores log files with the filepath:</span>
<a id="__codelineno-9-6" name="__codelineno-9-6"></a><span class="sd">    &quot;dir_name/experiment_name/current_datetime/&quot;</span>
<a id="__codelineno-9-7" name="__codelineno-9-7"></a>
<a id="__codelineno-9-8" name="__codelineno-9-8"></a><span class="sd">  Args:</span>
<a id="__codelineno-9-9" name="__codelineno-9-9"></a><span class="sd">    dir_name: target directory to store TensorBoard log files</span>
<a id="__codelineno-9-10" name="__codelineno-9-10"></a><span class="sd">    experiment_name: name of experiment directory (e.g. efficientnet_model_1)</span>
<a id="__codelineno-9-11" name="__codelineno-9-11"></a><span class="sd">  &quot;&quot;&quot;</span>
<a id="__codelineno-9-12" name="__codelineno-9-12"></a>  <span class="n">log_dir</span> <span class="o">=</span> <span class="n">dir_name</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">experiment_name</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">-%H%M%S&quot;</span><span class="p">)</span>
<a id="__codelineno-9-13" name="__codelineno-9-13"></a>  <span class="n">tensorboard_callback</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">TensorBoard</span><span class="p">(</span>
<a id="__codelineno-9-14" name="__codelineno-9-14"></a>      <span class="n">log_dir</span><span class="o">=</span><span class="n">log_dir</span>
<a id="__codelineno-9-15" name="__codelineno-9-15"></a>  <span class="p">)</span>
<a id="__codelineno-9-16" name="__codelineno-9-16"></a>  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saving TensorBoard log files to: </span><span class="si">{</span><span class="n">log_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-9-17" name="__codelineno-9-17"></a>  <span class="k">return</span> <span class="n">tensorboard_callback</span>
</code></pre></div>
</td></tr></table>
<p><a name=""></a></p>
<h3 id="compare-baseline-to-new-results">Compare baseline to new results</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1">1</a></span>
<span class="normal"><a href="#__codelineno-10-2">2</a></span>
<span class="normal"><a href="#__codelineno-10-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="k">def</span> <span class="nf">compare_baseline_to_new_results</span><span class="p">(</span><span class="n">baseline_results</span><span class="p">,</span> <span class="n">new_results</span><span class="p">):</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a>  <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">baseline_results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Baseline </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> , New </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">new_results</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, Difference: </span><span class="si">{</span><span class="n">new_results</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">-</span><span class="n">value</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<p><a name="the-data"></a></p>
<h2 id="the-data"><strong>The data</strong></h2>
<p><a name=""></a></p>
<h3 id="download-the-data">Download the data</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1">1</a></span>
<span class="normal"><a href="#__codelineno-11-2">2</a></span>
<span class="normal"><a href="#__codelineno-11-3">3</a></span>
<span class="normal"><a href="#__codelineno-11-4">4</a></span>
<span class="normal"><a href="#__codelineno-11-5">5</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="c1"># Download data (same as from Kaggle)</span>
<a id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="err">!</span><span class="n">wget</span> <span class="s2">&quot;https://storage.googleapis.com/ztm_tf_course/nlp_getting_started.zip&quot;</span>
<a id="__codelineno-11-3" name="__codelineno-11-3"></a>
<a id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="c1"># Unzip data</span>
<a id="__codelineno-11-5" name="__codelineno-11-5"></a><span class="n">unzip_data</span><span class="p">(</span><span class="s2">&quot;nlp_getting_started.zip&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    --2021-12-03 13:43:54--  https://storage.googleapis.com/ztm_tf_course/nlp_getting_started.zip
    Resolving storage.googleapis.com (storage.googleapis.com)... 74.125.133.128, 74.125.140.128, 108.177.15.128, ...
    Connecting to storage.googleapis.com (storage.googleapis.com)|74.125.133.128|:443... connected.
    HTTP request sent, awaiting response... 200 OK
    Length: 607343 (593K) [application/zip]
    Saving to: nlp_getting_started.zip.1

    nlp_getting_started 100%[===================>] 593.11K  --.-KB/s    in 0.009s  

    2021-12-03 13:43:54 (61.5 MB/s) - nlp_getting_started.zip.1 saved [607343/607343]
</pre>
</div>

<p><a name="inspect-the-data"></a></p>
<h2 id="inspect-the-data"><strong>Inspect the data</strong></h2>
<p><a name=""></a></p>
<h3 id="turn-csv-files-into-pandas-dataframe">Turn .csv files into pandas DataFrame</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1">1</a></span>
<span class="normal"><a href="#__codelineno-12-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="n">train_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;train.csv&quot;</span><span class="p">)</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="n">test_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;test.csv&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<p><a name=""></a></p>
<h3 id="shuffle-the-data">Shuffle the data</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1">1</a></span>
<span class="normal"><a href="#__codelineno-13-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="n">train_df_shuffled</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span> <span class="c1"># shuffle with random_state=42 for reproducibility</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="n">train_df_shuffled</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
            id      keyword     location                text                                                target
    2644    3796    destruction NaN                     So you have a new weapon that can cause un-ima...   1
    2227    3185    deluge      NaN                     The f$&amp;@ing things I do for #GISHWHES Just...   0
    5448    7769    police      UK                      DT @georgegalloway: RT @Galloway4Mayor: The...   1
    132     191     aftershock  NaN                     Aftershock back to school kick off was great. ...   0
    6845    9810    trauma      Montgomery County, MD   in response to trauma Children of Addicts deve...   0
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1">1</a></span>
<span class="normal"><a href="#__codelineno-14-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="c1"># Visualize test_df</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="n">test_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
        id  keyword location    text
    0   0   NaN     NaN         Just happened a terrible car crash
    1   2   NaN     NaN         Heard about #earthquake is different cities, s...
    2   3   NaN     NaN         there is a forest fire at spot pond, geese are...
    3   9   NaN     NaN         Apocalypse lighting. #Spokane #wildfires
    4   11  NaN     NaN         Typhoon Soudelor kills 28 in China and Taiwan
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1">1</a></span>
<span class="normal"><a href="#__codelineno-15-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="c1"># How many examples of each class?</span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="n">train_df</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    0    4342
    1    3271
    Name: target, dtype: int64
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1">1</a></span>
<span class="normal"><a href="#__codelineno-16-2">2</a></span>
<span class="normal"><a href="#__codelineno-16-3">3</a></span>
<span class="normal"><a href="#__codelineno-16-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="c1"># How many samples total?</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total training samples: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">train_df</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total test samples: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">test_df</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total samples: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">train_df</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_df</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Total training samples: 7613
    Total test samples: 3263
    Total samples: 10876
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1">1</a></span>
<span class="normal"><a href="#__codelineno-17-2">2</a></span>
<span class="normal"><a href="#__codelineno-17-3">3</a></span>
<span class="normal"><a href="#__codelineno-17-4">4</a></span>
<span class="normal"><a href="#__codelineno-17-5">5</a></span>
<span class="normal"><a href="#__codelineno-17-6">6</a></span>
<span class="normal"><a href="#__codelineno-17-7">7</a></span>
<span class="normal"><a href="#__codelineno-17-8">8</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="c1"># Let&#39;s visualize some random training examples</span>
<a id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="kn">import</span> <span class="nn">random</span>
<a id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="n">random_index</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_df</span><span class="p">)</span><span class="o">-</span><span class="mi">5</span><span class="p">)</span> <span class="c1"># create random indexes not higher than the total number of samples</span>
<a id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">train_df_shuffled</span><span class="p">[[</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;target&quot;</span><span class="p">]][</span><span class="n">random_index</span><span class="p">:</span><span class="n">random_index</span><span class="o">+</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span>
<a id="__codelineno-17-5" name="__codelineno-17-5"></a>  <span class="n">_</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">row</span>
<a id="__codelineno-17-6" name="__codelineno-17-6"></a>  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Target: </span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;(real disaster)&quot;</span> <span class="k">if</span> <span class="n">target</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;(not real disaster)&quot;</span><span class="p">)</span>
<a id="__codelineno-17-7" name="__codelineno-17-7"></a>  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Text:</span><span class="se">\n</span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-17-8" name="__codelineno-17-8"></a>  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;---</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Target: 0 (not real disaster)
    Text:
    'McFadden Reportedly to Test Hamstring Thursday' via @TeamStream http://t.co/jWq4KvJH2j

    ---

    Target: 1 (real disaster)
    Text:
    w--=-=-=-[ NEMA warns Nigerians to prepare for drought http://t.co/5uoOPhSqU3

    ---

    Target: 0 (not real disaster)
    Text:
    When I was cooking earlier I got electrocuted some crucial ?????? now I'm psychic lol

    ---

    Target: 0 (not real disaster)
    Text:
    I'm On Fire.  http://t.co/WATsmxYTVa

    ---

    Target: 1 (real disaster)
    Text:
    More than 40 families affected by the fatal outbreak of Legionnaires' disease in Edinburgh are to sue two comp... http://t.co/vsoXioOy78

    ---
</pre>
</div>

<p><a name="prepare-the-data"></a></p>
<h2 id="prepare-the-data">Prepare the data</h2>
<p><a name=""></a></p>
<h3 id="split-the-data">Split the data</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1">1</a></span>
<span class="normal"><a href="#__codelineno-18-2">2</a></span>
<span class="normal"><a href="#__codelineno-18-3">3</a></span>
<span class="normal"><a href="#__codelineno-18-4">4</a></span>
<span class="normal"><a href="#__codelineno-18-5">5</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="c1"># Use train_test_split to split training data into training and validation sets</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="n">train_sentences</span><span class="p">,</span> <span class="n">val_sentences</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">val_labels</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">train_df_shuffled</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
<a id="__codelineno-18-3" name="__codelineno-18-3"></a>                                                                           <span class="n">train_df_shuffled</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
<a id="__codelineno-18-4" name="__codelineno-18-4"></a>                                                                           <span class="n">test_size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="c1"># dedicate 10% of samples to the validation set</span>
<a id="__codelineno-18-5" name="__codelineno-18-5"></a>                                                                           <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span> <span class="c1"># random state for reproducibility</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1">1</a></span>
<span class="normal"><a href="#__codelineno-19-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="c1"># Check the new splitted dataset</span>
<a id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="nb">len</span><span class="p">(</span><span class="n">train_sentences</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_labels</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">val_sentences</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">val_labels</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (6851, 6851, 762, 762)
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1">1</a></span>
<span class="normal"><a href="#__codelineno-20-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="c1"># Visulize the new splitted dataset</span>
<a id="__codelineno-20-2" name="__codelineno-20-2"></a><span class="n">train_sentences</span><span class="p">[:</span><span class="mi">10</span><span class="p">],</span> <span class="n">train_labels</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (array(['@mogacola @zamtriossu i screamed after hitting tweet',
            'Imagine getting flattened by Kurt Zouma',
            '@Gurmeetramrahim #MSGDoing111WelfareWorks Green S welfare force ke appx 65000 members har time disaster victim ki help ke liye tyar hai....',
            "@shakjn @C7 @Magnums im shaking in fear he's gonna hack the planet",
            'Somehow find you and I collide http://t.co/Ee8RpOahPk',
            '@EvaHanderek @MarleyKnysh great times until the bus driver held us hostage in the mall parking lot lmfao',
            'destroy the free fandom honestly',
            'Weapons stolen from National Guard Armory in New Albany still missing #Gunsense http://t.co/lKNU8902JE',
            '@wfaaweather Pete when will the heat wave pass? Is it really going to be mid month? Frisco Boy Scouts have a canoe trip in Okla.',
            'Patient-reported outcomes in long-term survivors of metastatic colorectal cancer - British Journal of Surgery http://t.co/5Yl4DC1Tqt'],
           dtype=object), array([0, 0, 1, 0, 0, 1, 1, 0, 1, 1]))
</pre>
</div>

<p><a name=""></a></p>
<h3 id="convert-texts-into-numbers">Convert texts into numbers</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1">1</a></span>
<span class="normal"><a href="#__codelineno-21-2">2</a></span>
<span class="normal"><a href="#__codelineno-21-3">3</a></span>
<span class="normal"><a href="#__codelineno-21-4">4</a></span>
<span class="normal"><a href="#__codelineno-21-5">5</a></span>
<span class="normal"><a href="#__codelineno-21-6">6</a></span>
<span class="normal"><a href="#__codelineno-21-7">7</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="n">text_vectorizer</span> <span class="o">=</span> <span class="n">TextVectorization</span><span class="p">(</span><span class="n">max_tokens</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="c1"># how many words in the vocabulary (all the different words)</span>
<a id="__codelineno-21-2" name="__codelineno-21-2"></a>                                    <span class="n">standardize</span><span class="o">=</span><span class="s2">&quot;lower_and_strip_punctuation&quot;</span><span class="p">,</span> <span class="c1"># how to process data</span>
<a id="__codelineno-21-3" name="__codelineno-21-3"></a>                                    <span class="n">split</span><span class="o">=</span><span class="s2">&quot;whitespace&quot;</span><span class="p">,</span> <span class="c1"># how to split tokens</span>
<a id="__codelineno-21-4" name="__codelineno-21-4"></a>                                    <span class="n">ngrams</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="c1"># create groups of n words?</span>
<a id="__codelineno-21-5" name="__codelineno-21-5"></a>                                    <span class="n">output_mode</span><span class="o">=</span><span class="s2">&quot;int&quot;</span><span class="p">,</span> <span class="c1"># how to map tokens to numbers</span>
<a id="__codelineno-21-6" name="__codelineno-21-6"></a>                                    <span class="n">output_sequence_length</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="c1"># how long should the output sequence of tokens be?</span>
<a id="__codelineno-21-7" name="__codelineno-21-7"></a>                                    <span class="c1"># pad_to_max_tokens=True)</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1">1</a></span>
<span class="normal"><a href="#__codelineno-22-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="c1"># Find the average number of tokens (words) in training Tweets</span>
<a id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="nb">round</span><span class="p">(</span><span class="nb">sum</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">())</span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">train_sentences</span><span class="p">])</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_sentences</span><span class="p">))</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    15
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1">1</a></span>
<span class="normal"><a href="#__codelineno-23-2">2</a></span>
<span class="normal"><a href="#__codelineno-23-3">3</a></span>
<span class="normal"><a href="#__codelineno-23-4">4</a></span>
<span class="normal"><a href="#__codelineno-23-5">5</a></span>
<span class="normal"><a href="#__codelineno-23-6">6</a></span>
<span class="normal"><a href="#__codelineno-23-7">7</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="c1"># Setup text vectorization with custom varibles</span>
<a id="__codelineno-23-2" name="__codelineno-23-2"></a><span class="n">max_vocab_length</span> <span class="o">=</span> <span class="mi">10000</span> <span class="c1"># max number of words to have in our vocabulary</span>
<a id="__codelineno-23-3" name="__codelineno-23-3"></a><span class="n">max_length</span> <span class="o">=</span> <span class="mi">15</span> <span class="c1"># max length of our sentences</span>
<a id="__codelineno-23-4" name="__codelineno-23-4"></a>
<a id="__codelineno-23-5" name="__codelineno-23-5"></a><span class="n">text_vectorizer</span> <span class="o">=</span> <span class="n">TextVectorization</span><span class="p">(</span><span class="n">max_tokens</span><span class="o">=</span><span class="n">max_vocab_length</span><span class="p">,</span>
<a id="__codelineno-23-6" name="__codelineno-23-6"></a>                                    <span class="n">output_mode</span><span class="o">=</span><span class="s2">&quot;int&quot;</span><span class="p">,</span>
<a id="__codelineno-23-7" name="__codelineno-23-7"></a>                                    <span class="n">output_sequence_length</span><span class="o">=</span><span class="n">max_length</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1">1</a></span>
<span class="normal"><a href="#__codelineno-24-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="c1"># Fit the text vectorizer to the training set</span>
<a id="__codelineno-24-2" name="__codelineno-24-2"></a><span class="n">text_vectorizer</span><span class="o">.</span><span class="n">adapt</span><span class="p">(</span><span class="n">train_sentences</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1">1</a></span>
<span class="normal"><a href="#__codelineno-25-2">2</a></span>
<span class="normal"><a href="#__codelineno-25-3">3</a></span>
<span class="normal"><a href="#__codelineno-25-4">4</a></span>
<span class="normal"><a href="#__codelineno-25-5">5</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="c1"># [Optional] Display some random sentences</span>
<a id="__codelineno-25-2" name="__codelineno-25-2"></a><span class="n">random_sentence</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">train_sentences</span><span class="p">)</span>
<a id="__codelineno-25-3" name="__codelineno-25-3"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Original text: </span><span class="se">\n</span><span class="si">{</span><span class="n">random_sentence</span><span class="si">}</span><span class="se">\</span>
<a id="__codelineno-25-4" name="__codelineno-25-4"></a><span class="se">\n\n</span><span class="s2">Vectorized text:&quot;</span><span class="p">)</span>
<a id="__codelineno-25-5" name="__codelineno-25-5"></a><span class="n">text_vectorizer</span><span class="p">([</span><span class="n">random_sentence</span><span class="p">])</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Original text: 
    at the lake 
    *sees a dead fish*
    me: poor little guy i wonder what happened
    ashley: idk maybe it drowned
      wtf ????????

    Vectorized text:
    tf.Tensor: shape=(1, 15), dtype=int64, numpy=
    array([[  17,    2, 1126, 1768,    3,  115, 1854,   31,  879,  266,  848,
               8,  914,   55,  893]])
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-26-1">1</a></span>
<span class="normal"><a href="#__codelineno-26-2">2</a></span>
<span class="normal"><a href="#__codelineno-26-3">3</a></span>
<span class="normal"><a href="#__codelineno-26-4">4</a></span>
<span class="normal"><a href="#__codelineno-26-5">5</a></span>
<span class="normal"><a href="#__codelineno-26-6">6</a></span>
<span class="normal"><a href="#__codelineno-26-7">7</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="c1"># [Optional] Display most common words</span>
<a id="__codelineno-26-2" name="__codelineno-26-2"></a><span class="n">words_in_vocab</span> <span class="o">=</span> <span class="n">text_vectorizer</span><span class="o">.</span><span class="n">get_vocabulary</span><span class="p">()</span>
<a id="__codelineno-26-3" name="__codelineno-26-3"></a><span class="n">top_5_words</span> <span class="o">=</span> <span class="n">words_in_vocab</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span> <span class="c1"># most common tokens (notice the [UNK] token for &quot;unknown&quot; words)</span>
<a id="__codelineno-26-4" name="__codelineno-26-4"></a><span class="n">bottom_5_words</span> <span class="o">=</span> <span class="n">words_in_vocab</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:]</span> <span class="c1"># least common tokens</span>
<a id="__codelineno-26-5" name="__codelineno-26-5"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of words in vocab: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">words_in_vocab</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-26-6" name="__codelineno-26-6"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Top 5 most common words: </span><span class="si">{</span><span class="n">top_5_words</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> 
<a id="__codelineno-26-7" name="__codelineno-26-7"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Bottom 5 least common words: </span><span class="si">{</span><span class="n">bottom_5_words</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Number of words in vocab: 10000
    Top 5 most common words: ['', '[UNK]', 'the', 'a', 'in']
    Bottom 5 least common words: ['pages', 'paeds', 'pads', 'padres', 'paddytomlinson1']
</pre>
</div>

<p><a name=""></a></p>
<h3 id="creating-an-embedding-using-an-embedding-layer">Creating an Embedding using an Embedding Layer</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-27-1">1</a></span>
<span class="normal"><a href="#__codelineno-27-2">2</a></span>
<span class="normal"><a href="#__codelineno-27-3">3</a></span>
<span class="normal"><a href="#__codelineno-27-4">4</a></span>
<span class="normal"><a href="#__codelineno-27-5">5</a></span>
<span class="normal"><a href="#__codelineno-27-6">6</a></span>
<span class="normal"><a href="#__codelineno-27-7">7</a></span>
<span class="normal"><a href="#__codelineno-27-8">8</a></span>
<span class="normal"><a href="#__codelineno-27-9">9</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="c1"># Creating an embedding</span>
<a id="__codelineno-27-2" name="__codelineno-27-2"></a><span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">set_seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<a id="__codelineno-27-3" name="__codelineno-27-3"></a>
<a id="__codelineno-27-4" name="__codelineno-27-4"></a><span class="n">embedding</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">input_dim</span><span class="o">=</span><span class="n">max_vocab_length</span><span class="p">,</span> <span class="c1"># set input shape</span>
<a id="__codelineno-27-5" name="__codelineno-27-5"></a>                                      <span class="n">output_dim</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="c1"># set size of embedding vector</span>
<a id="__codelineno-27-6" name="__codelineno-27-6"></a>                                      <span class="n">embeddings_initializer</span><span class="o">=</span><span class="s2">&quot;uniform&quot;</span><span class="p">,</span> <span class="c1"># default, initialize randomly</span>
<a id="__codelineno-27-7" name="__codelineno-27-7"></a>                                      <span class="n">input_length</span><span class="o">=</span><span class="n">max_length</span><span class="p">,</span> <span class="c1"># how long is each input</span>
<a id="__codelineno-27-8" name="__codelineno-27-8"></a>                                      <span class="n">name</span><span class="o">=</span><span class="s2">&quot;embedding_1&quot;</span><span class="p">)</span>
<a id="__codelineno-27-9" name="__codelineno-27-9"></a><span class="n">embedding</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    keras.layers.embeddings.Embedding at 0x7fb959616290
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-28-1">1</a></span>
<span class="normal"><a href="#__codelineno-28-2">2</a></span>
<span class="normal"><a href="#__codelineno-28-3">3</a></span>
<span class="normal"><a href="#__codelineno-28-4">4</a></span>
<span class="normal"><a href="#__codelineno-28-5">5</a></span>
<span class="normal"><a href="#__codelineno-28-6">6</a></span>
<span class="normal"><a href="#__codelineno-28-7">7</a></span>
<span class="normal"><a href="#__codelineno-28-8">8</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="c1"># [Optional] Get a random sentence from training set</span>
<a id="__codelineno-28-2" name="__codelineno-28-2"></a><span class="n">random_sentence</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">train_sentences</span><span class="p">)</span>
<a id="__codelineno-28-3" name="__codelineno-28-3"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Original text:</span><span class="se">\n</span><span class="si">{</span><span class="n">random_sentence</span><span class="si">}</span><span class="se">\</span>
<a id="__codelineno-28-4" name="__codelineno-28-4"></a><span class="s2">      </span><span class="se">\n\n</span><span class="s2">Embedded version:&quot;</span><span class="p">)</span>
<a id="__codelineno-28-5" name="__codelineno-28-5"></a>
<a id="__codelineno-28-6" name="__codelineno-28-6"></a><span class="c1"># [Optional] Embed the random sentence (turn it into numerical representation)</span>
<a id="__codelineno-28-7" name="__codelineno-28-7"></a><span class="n">sample_embed</span> <span class="o">=</span> <span class="n">embedding</span><span class="p">(</span><span class="n">text_vectorizer</span><span class="p">([</span><span class="n">random_sentence</span><span class="p">]))</span>
<a id="__codelineno-28-8" name="__codelineno-28-8"></a><span class="n">sample_embed</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Original text:
    @GailSimone #IWasDisappointedBy TellTale's The Walking Dead. Good characters &amp;story but no real gameplay and too many performance issues.      

    Embedded version:
    tf.Tensor: shape=(1, 15, 128), dtype=float32, numpy=
    array([[[ 0.03977952, -0.03782602, -0.03646283, ...,  0.00236253,
              0.03332629,  0.02803668],
            [ 0.03977952, -0.03782602, -0.03646283, ...,  0.00236253,
              0.03332629,  0.02803668],
            [-0.01498866, -0.01711886, -0.01795023, ...,  0.00425522,
              0.04084368, -0.04459424],
            ...,
            [-0.03001971,  0.00568042,  0.03136439, ...,  0.0466901 ,
              0.00128862, -0.00029041],
            [ 0.02248487, -0.02848336,  0.04786098, ...,  0.03069806,
             -0.04317403, -0.04145076],
            [-0.00452621, -0.00316794,  0.00424971, ..., -0.00910323,
             -0.00566288,  0.00264918]]], dtype=float32)
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-29-1">1</a></span>
<span class="normal"><a href="#__codelineno-29-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="c1"># [Optional] Check out a single token&#39;s embedding</span>
<a id="__codelineno-29-2" name="__codelineno-29-2"></a><span class="n">sample_embed</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    tf.Tensor: shape=(128,), dtype=float32, numpy=
    array([ 0.03977952, -0.03782602, -0.03646283, -0.02449075, -0.00015752,
            0.02220254,  0.00162981,  0.00603487,  0.0085157 , -0.02620113,
            0.04101599,  0.03715892,  0.02397566,  0.00281113, -0.02704906,
           -0.04870148,  0.01457943,  0.0059551 , -0.02334484,  0.03581132,
            0.04377897,  0.04186075,  0.03245703, -0.045092  ,  0.04260418,
            0.03398135, -0.01812425, -0.03539513,  0.02954218,  0.02556742,
           -0.03345481,  0.04272738, -0.00798845, -0.0406163 , -0.00644834,
            0.00232404,  0.01703629,  0.03645121, -0.02622857,  0.03498118,
           -0.03059715,  0.02576998, -0.04221511,  0.02654583, -0.02192564,
           -0.0346157 ,  0.00075326,  0.01427345,  0.01027539, -0.04311384,
           -0.03973336, -0.00966626,  0.01032177, -0.04011822, -0.018892  ,
           -0.01233201,  0.02721632, -0.01232889, -0.02504088, -0.04715574,
            0.00558523, -0.00801403,  0.03058865, -0.01923352, -0.04175536,
           -0.03654208, -0.04277095, -0.0033918 , -0.04226271,  0.0240727 ,
            0.01274442, -0.00268712,  0.03158386,  0.04823284,  0.02940297,
            0.00636031,  0.01719667,  0.03907609, -0.0249153 , -0.00834242,
            0.03881217, -0.04461795,  0.03740455, -0.02412283, -0.01538421,
            0.03984089, -0.04073881,  0.0317078 , -0.04241145, -0.03435747,
            0.03021734,  0.0443267 ,  0.00424304, -0.01204874, -0.00213076,
           -0.02668054,  0.0461436 , -0.04644201,  0.02519932, -0.04503984,
           -0.03163396, -0.02846084,  0.01276297,  0.02938429,  0.03437588,
            0.00973482, -0.01860742,  0.03510927, -0.04996962,  0.01983938,
            0.00642185,  0.00372197,  0.01576127,  0.01591486, -0.04195998,
            0.02777341,  0.00619875, -0.02269079, -0.00224097,  0.0289592 ,
            0.04377018, -0.03377642,  0.00907839, -0.01134553, -0.02910458,
            0.00236253,  0.03332629,  0.02803668], dtype=float32)
</pre>
</div>

<p><a name="model-0"></a></p>
<h2 id="model-0-base-model">Model 0: Base Model</h2>
<p><a name=""></a></p>
<h3 id="create-compile-and-run-the-model">Create, Compile, and Run the model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-30-1">1</a></span>
<span class="normal"><a href="#__codelineno-30-2">2</a></span>
<span class="normal"><a href="#__codelineno-30-3">3</a></span>
<span class="normal"><a href="#__codelineno-30-4">4</a></span>
<span class="normal"><a href="#__codelineno-30-5">5</a></span>
<span class="normal"><a href="#__codelineno-30-6">6</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1"></a><span class="c1"># CREATE MODEL</span>
<a id="__codelineno-30-2" name="__codelineno-30-2"></a><span class="n">model_0</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([(</span><span class="s2">&quot;tfidf&quot;</span><span class="p">,</span> <span class="n">TfidfVectorizer</span><span class="p">()),</span> <span class="c1"># Convert words to numbers usind TF-IDF</span>
<a id="__codelineno-30-3" name="__codelineno-30-3"></a>                    <span class="p">(</span><span class="s2">&quot;clf&quot;</span><span class="p">,</span> <span class="n">MultinomialNB</span><span class="p">())</span> <span class="c1"># model the text</span>
<a id="__codelineno-30-4" name="__codelineno-30-4"></a>                    <span class="p">])</span>
<a id="__codelineno-30-5" name="__codelineno-30-5"></a><span class="c1"># FIT MODEL</span>
<a id="__codelineno-30-6" name="__codelineno-30-6"></a><span class="n">model_0</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_sentences</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Pipeline(steps=[('tfidf', TfidfVectorizer()), ('clf', MultinomialNB())])
</pre>
</div>

<p><a name=""></a></p>
<h1 id="evaluate-the-model">Evaluate the model</h1>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-31-1">1</a></span>
<span class="normal"><a href="#__codelineno-31-2">2</a></span>
<span class="normal"><a href="#__codelineno-31-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1"></a><span class="c1"># Make predictions</span>
<a id="__codelineno-31-2" name="__codelineno-31-2"></a><span class="n">baseline_preds</span> <span class="o">=</span> <span class="n">model_0</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">val_sentences</span><span class="p">)</span>
<a id="__codelineno-31-3" name="__codelineno-31-3"></a><span class="n">baseline_preds</span><span class="p">[:</span><span class="mi">20</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    array([1, 1, 1, 0, 0, 1, 1, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1])
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-32-1">1</a></span>
<span class="normal"><a href="#__codelineno-32-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1"></a><span class="n">baseline_score</span> <span class="o">=</span> <span class="n">model_0</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">val_sentences</span><span class="p">,</span> <span class="n">val_labels</span><span class="p">)</span>
<a id="__codelineno-32-2" name="__codelineno-32-2"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Base model achieves an accuracy of: </span><span class="si">{</span><span class="n">baseline_score</span> <span class="o">*</span> <span class="mi">100</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Base model achieves an accuracy of: 79.27%
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-33-1">1</a></span>
<span class="normal"><a href="#__codelineno-33-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="n">baseline_results</span> <span class="o">=</span> <span class="n">calculate_results</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">val_labels</span><span class="p">,</span> <span class="n">y_pred</span><span class="o">=</span><span class="n">baseline_preds</span><span class="p">)</span>
<a id="__codelineno-33-2" name="__codelineno-33-2"></a><span class="n">baseline_results</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    {'accuracy': 0.7926509186351706,
     'f1': 0.7862189758049549,
     'precision': 0.8111390004213173,
     'recall': 0.7926509186351706}
</pre>
</div>

<p><a name="model-1"></a></p>
<h2 id="model-1-a-simple-dense-model">Model 1: A Simple Dense Model</h2>
<p><a name=""></a></p>
<h3 id="callbacks">Callbacks</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-34-1">1</a></span>
<span class="normal"><a href="#__codelineno-34-2">2</a></span>
<span class="normal"><a href="#__codelineno-34-3">3</a></span>
<span class="normal"><a href="#__codelineno-34-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1"></a><span class="c1"># Create tensorboard callback by first assigning the save directory</span>
<a id="__codelineno-34-2" name="__codelineno-34-2"></a><span class="c1"># USE create_tensorboard_callback() function</span>
<a id="__codelineno-34-3" name="__codelineno-34-3"></a>
<a id="__codelineno-34-4" name="__codelineno-34-4"></a><span class="n">SAVE_DIR</span> <span class="o">=</span> <span class="s2">&quot;model_logs&quot;</span>
</code></pre></div>
</td></tr></table>
<p><a name=""></a></p>
<h3 id="create-compile-and-run-the-model_1">Create, Compile, and Run the model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-35-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-35-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-35-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-35-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-35-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-35-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-35-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-35-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-35-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-35-10">10</a></span>
<span class="normal"><a href="#__codelineno-35-11">11</a></span>
<span class="normal"><a href="#__codelineno-35-12">12</a></span>
<span class="normal"><a href="#__codelineno-35-13">13</a></span>
<span class="normal"><a href="#__codelineno-35-14">14</a></span>
<span class="normal"><a href="#__codelineno-35-15">15</a></span>
<span class="normal"><a href="#__codelineno-35-16">16</a></span>
<span class="normal"><a href="#__codelineno-35-17">17</a></span>
<span class="normal"><a href="#__codelineno-35-18">18</a></span>
<span class="normal"><a href="#__codelineno-35-19">19</a></span>
<span class="normal"><a href="#__codelineno-35-20">20</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1"></a><span class="c1"># CREATE MODEL</span>
<a id="__codelineno-35-2" name="__codelineno-35-2"></a><span class="n">inputs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;string&quot;</span><span class="p">)</span> <span class="c1"># inputs are 1-dimensional</span>
<a id="__codelineno-35-3" name="__codelineno-35-3"></a><span class="n">x</span> <span class="o">=</span> <span class="n">text_vectorizer</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span> <span class="c1"># turn the input text into numbers</span>
<a id="__codelineno-35-4" name="__codelineno-35-4"></a><span class="n">x</span> <span class="o">=</span> <span class="n">embedding</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="c1"># create an embedding of the numerized numbers</span>
<a id="__codelineno-35-5" name="__codelineno-35-5"></a><span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">GlobalAveragePooling1D</span><span class="p">()(</span><span class="n">x</span><span class="p">)</span> <span class="c1"># lower the dimensionality of the embedding</span>
<a id="__codelineno-35-6" name="__codelineno-35-6"></a><span class="n">outputs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;sigmoid&quot;</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span> <span class="c1"># create the output layer, want binary outputs so use sigmoid activation</span>
<a id="__codelineno-35-7" name="__codelineno-35-7"></a><span class="n">model_1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;model_1_dense&quot;</span><span class="p">)</span> <span class="c1"># construct the model</span>
<a id="__codelineno-35-8" name="__codelineno-35-8"></a>
<a id="__codelineno-35-9" name="__codelineno-35-9"></a><span class="c1"># COMPILE MODEL</span>
<a id="__codelineno-35-10" name="__codelineno-35-10"></a><span class="n">model_1</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s2">&quot;binary_crossentropy&quot;</span><span class="p">,</span>
<a id="__codelineno-35-11" name="__codelineno-35-11"></a>                <span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(),</span>
<a id="__codelineno-35-12" name="__codelineno-35-12"></a>                <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;accuracy&quot;</span><span class="p">])</span>
<a id="__codelineno-35-13" name="__codelineno-35-13"></a>
<a id="__codelineno-35-14" name="__codelineno-35-14"></a><span class="c1"># FIT MODEL</span>
<a id="__codelineno-35-15" name="__codelineno-35-15"></a><span class="n">model_1_history</span> <span class="o">=</span> <span class="n">model_1</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_sentences</span><span class="p">,</span> <span class="c1"># input sentences can be a list of strings due to text preprocessing layer built-in model</span>
<a id="__codelineno-35-16" name="__codelineno-35-16"></a>                              <span class="n">train_labels</span><span class="p">,</span>
<a id="__codelineno-35-17" name="__codelineno-35-17"></a>                              <span class="n">epochs</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-35-18" name="__codelineno-35-18"></a>                              <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">val_sentences</span><span class="p">,</span> <span class="n">val_labels</span><span class="p">),</span>
<a id="__codelineno-35-19" name="__codelineno-35-19"></a>                              <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">create_tensorboard_callback</span><span class="p">(</span><span class="n">dir_name</span><span class="o">=</span><span class="n">SAVE_DIR</span><span class="p">,</span>
<a id="__codelineno-35-20" name="__codelineno-35-20"></a>                                                                     <span class="n">experiment_name</span><span class="o">=</span><span class="s2">&quot;model_1_simple_dense_model&quot;</span><span class="p">)])</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Saving TensorBoard log file to: model_logs/model_1_simple_dense_model/20211203-135614
    Epoch 1/5
    215/215 [==============================] - 4s 7ms/step - loss: 0.6108 - accuracy: 0.6904 - val_loss: 0.5370 - val_accuracy: 0.7559
    Epoch 2/5
    215/215 [==============================] - 1s 7ms/step - loss: 0.4420 - accuracy: 0.8186 - val_loss: 0.4693 - val_accuracy: 0.7874
    Epoch 3/5
    215/215 [==============================] - 1s 6ms/step - loss: 0.3470 - accuracy: 0.8612 - val_loss: 0.4590 - val_accuracy: 0.7861
    Epoch 4/5
    215/215 [==============================] - 1s 6ms/step - loss: 0.2855 - accuracy: 0.8917 - val_loss: 0.4639 - val_accuracy: 0.7900
    Epoch 5/5
    215/215 [==============================] - 1s 6ms/step - loss: 0.2386 - accuracy: 0.9117 - val_loss: 0.4762 - val_accuracy: 0.7874
</pre>
</div>

<p><a name=""></a></p>
<h3 id="evaluate-the-model_1">Evaluate the model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-36-1">1</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1"></a><span class="n">model_1</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Model: "model_1_dense"
    _________________________________________________________________
     Layer (type)                Output Shape              Param #   
    =================================================================
     input_3 (InputLayer)        [(None, 1)]               0         

     text_vectorization_3 (TextV  (None, 15)               0         
     ectorization)                                                   

     embedding_1 (Embedding)     (None, 15, 128)           1280000   

     global_average_pooling1d_2   (None, 128)              0         
     (GlobalAveragePooling1D)                                        

     dense_2 (Dense)             (None, 1)                 129       

    =================================================================
    Total params: 1,280,129
    Trainable params: 1,280,129
    Non-trainable params: 0
    _________________________________________________________________
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-37-1">1</a></span>
<span class="normal"><a href="#__codelineno-37-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1"></a><span class="c1"># Check the results</span>
<a id="__codelineno-37-2" name="__codelineno-37-2"></a><span class="n">model_1</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">val_sentences</span><span class="p">,</span> <span class="n">val_labels</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    24/24 [==============================] - 0s 3ms/step - loss: 0.4762 - accuracy: 0.7874
    [0.4761527180671692, 0.787401556968689]
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-38-1">1</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1"></a><span class="n">embedding</span><span class="o">.</span><span class="n">weights</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    [tf.Variable 'embedding_1/embeddings:0' shape=(10000, 128) dtype=float32, numpy=
     array([[ 0.00156871,  0.01060263, -0.03096874, ..., -0.00944094,
              0.02584856,  0.01589816],
            [ 0.03944713, -0.03698261, -0.03629557, ...,  0.00301011,
              0.03454181,  0.028534  ],
            [ 0.01050401,  0.04450413, -0.00271129, ..., -0.03111271,
             -0.01419744,  0.01282232],
            ...,
            [-0.03301444, -0.0052493 , -0.04209725, ...,  0.02028764,
              0.00308807,  0.02215792],
            [ 0.00789597,  0.05640425, -0.02671793, ...,  0.02273379,
              0.06523816,  0.03942469],
            [-0.03689891,  0.06155641, -0.07878707, ...,  0.11292429,
              0.04501107,  0.02017001]], dtype=float32)]
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-39-1">1</a></span>
<span class="normal"><a href="#__codelineno-39-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1"></a><span class="n">embed_weights</span> <span class="o">=</span> <span class="n">model_1</span><span class="o">.</span><span class="n">get_layer</span><span class="p">(</span><span class="s2">&quot;embedding_1&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_weights</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-39-2" name="__codelineno-39-2"></a><span class="nb">print</span><span class="p">(</span><span class="n">embed_weights</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (10000, 128)
</pre>
</div>

<p><a name=""></a></p>
<h3 id="make-prediction">Make prediction</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-40-1">1</a></span>
<span class="normal"><a href="#__codelineno-40-2">2</a></span>
<span class="normal"><a href="#__codelineno-40-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1"></a><span class="c1"># Make predictions (result will come back in the form of probabilities)</span>
<a id="__codelineno-40-2" name="__codelineno-40-2"></a><span class="n">model_1_pred_probs</span> <span class="o">=</span> <span class="n">model_1</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">val_sentences</span><span class="p">)</span>
<a id="__codelineno-40-3" name="__codelineno-40-3"></a><span class="n">model_1_pred_probs</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    array([[0.4172226 ],
           [0.7477729 ],
           [0.9978683 ],
           [0.1099527 ],
           [0.11007269],
           [0.9383711 ],
           [0.91072816],
           [0.9929762 ],
           [0.9681243 ],
           [0.2609357 ]], dtype=float32)
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-41-1">1</a></span>
<span class="normal"><a href="#__codelineno-41-2">2</a></span>
<span class="normal"><a href="#__codelineno-41-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1"></a><span class="c1"># Turn prediction probabilities into single-dimension tensor of floats</span>
<a id="__codelineno-41-2" name="__codelineno-41-2"></a><span class="n">model_1_preds</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">model_1_pred_probs</span><span class="p">))</span> <span class="c1"># squeeze removes single dimensions</span>
<a id="__codelineno-41-3" name="__codelineno-41-3"></a><span class="n">model_1_preds</span><span class="p">[:</span><span class="mi">20</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (tf.Tensor: shape=(20,), dtype=float32, numpy=
    array([0., 1., 1., 0., 0., 1., 1., 1., 1., 0., 0., 1., 0., 0., 0., 0., 0.,
           0., 0., 1.], dtype=float32))
</pre>
</div>

<p><a name=""></a></p>
<h3 id="calculate-results">Calculate results</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-42-1">1</a></span>
<span class="normal"><a href="#__codelineno-42-2">2</a></span>
<span class="normal"><a href="#__codelineno-42-3">3</a></span>
<span class="normal"><a href="#__codelineno-42-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1"></a><span class="c1"># Calculate model_1 metrics</span>
<a id="__codelineno-42-2" name="__codelineno-42-2"></a><span class="n">model_1_results</span> <span class="o">=</span> <span class="n">calculate_results</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">val_labels</span><span class="p">,</span> 
<a id="__codelineno-42-3" name="__codelineno-42-3"></a>                                    <span class="n">y_pred</span><span class="o">=</span><span class="n">model_1_preds</span><span class="p">)</span>
<a id="__codelineno-42-4" name="__codelineno-42-4"></a><span class="n">model_1_results</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    {'accuracy': 0.7874015748031497,
     'f1': 0.7845557264291478,
     'precision': 0.791897156051696,
     'recall': 0.7874015748031497}
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-43-1">1</a></span>
<span class="normal"><a href="#__codelineno-43-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1"></a><span class="c1"># Compare model 1 results with model 0 results</span>
<a id="__codelineno-43-2" name="__codelineno-43-2"></a><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">model_1_results</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">baseline_results</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    array([False, False, False, False])
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-44-1">1</a></span>
<span class="normal"><a href="#__codelineno-44-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1"></a><span class="c1"># Compare baseline model results and new model results</span>
<a id="__codelineno-44-2" name="__codelineno-44-2"></a><span class="n">compare_baseline_to_new_results</span><span class="p">(</span><span class="n">baseline_results</span><span class="o">=</span><span class="n">baseline_results</span><span class="p">,</span> <span class="n">new_results</span><span class="o">=</span><span class="n">model_1_results</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Baseline accuracy: 0.79 , New accuracy: 0.79, Difference: -0.01
    Baseline precision: 0.81 , New precision: 0.79, Difference: -0.02
    Baseline recall: 0.79 , New recall: 0.79, Difference: -0.01
    Baseline f1: 0.79 , New f1: 0.78, Difference: -0.00
</pre>
</div>

<p><a name=""></a></p>
<h3 id="optional-plot-results-to-embedding-projector-tool">(Optional) Plot results to Embedding Projector Tool</h3>
<p>Once downloaded the embedding vectors and metadata, we can visualize them using Embedding Vector tool:</p>
<ol>
<li>Go to http://projector.tensorflow.org/</li>
<li>Click on "Load data"</li>
<li>Upload the two files you downloaded (embedding_vectors.tsv and embedding_metadata.tsv)</li>
<li>Explore
5 .Optional: You can share the data you've created by clicking "Publish"</li>
</ol>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-45-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-45-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-45-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-45-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-45-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-45-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-45-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-45-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-45-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-45-10">10</a></span>
<span class="normal"><a href="#__codelineno-45-11">11</a></span>
<span class="normal"><a href="#__codelineno-45-12">12</a></span>
<span class="normal"><a href="#__codelineno-45-13">13</a></span>
<span class="normal"><a href="#__codelineno-45-14">14</a></span>
<span class="normal"><a href="#__codelineno-45-15">15</a></span>
<span class="normal"><a href="#__codelineno-45-16">16</a></span>
<span class="normal"><a href="#__codelineno-45-17">17</a></span>
<span class="normal"><a href="#__codelineno-45-18">18</a></span>
<span class="normal"><a href="#__codelineno-45-19">19</a></span>
<span class="normal"><a href="#__codelineno-45-20">20</a></span>
<span class="normal"><a href="#__codelineno-45-21">21</a></span>
<span class="normal"><a href="#__codelineno-45-22">22</a></span>
<span class="normal"><a href="#__codelineno-45-23">23</a></span>
<span class="normal"><a href="#__codelineno-45-24">24</a></span>
<span class="normal"><a href="#__codelineno-45-25">25</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1"></a><span class="c1"># # Code below is adapted from: https://www.tensorflow.org/tutorials/text/word_embeddings#retrieve_the_trained_word_embeddings_and_save_them_to_disk</span>
<a id="__codelineno-45-2" name="__codelineno-45-2"></a><span class="c1"># import io</span>
<a id="__codelineno-45-3" name="__codelineno-45-3"></a>
<a id="__codelineno-45-4" name="__codelineno-45-4"></a><span class="c1"># # Create output writers</span>
<a id="__codelineno-45-5" name="__codelineno-45-5"></a><span class="c1"># out_v = io.open(&quot;embedding_vectors.tsv&quot;, &quot;w&quot;, encoding=&quot;utf-8&quot;)</span>
<a id="__codelineno-45-6" name="__codelineno-45-6"></a><span class="c1"># out_m = io.open(&quot;embedding_metadata.tsv&quot;, &quot;w&quot;, encoding=&quot;utf-8&quot;)</span>
<a id="__codelineno-45-7" name="__codelineno-45-7"></a>
<a id="__codelineno-45-8" name="__codelineno-45-8"></a><span class="c1"># # Write embedding vectors and words to file</span>
<a id="__codelineno-45-9" name="__codelineno-45-9"></a><span class="c1"># for num, word in enumerate(words_in_vocab):</span>
<a id="__codelineno-45-10" name="__codelineno-45-10"></a><span class="c1">#   if num == 0: </span>
<a id="__codelineno-45-11" name="__codelineno-45-11"></a><span class="c1">#      continue # skip padding token</span>
<a id="__codelineno-45-12" name="__codelineno-45-12"></a><span class="c1">#   vec = embed_weights[num]</span>
<a id="__codelineno-45-13" name="__codelineno-45-13"></a><span class="c1">#   out_m.write(word + &quot;\n&quot;) # write words to file</span>
<a id="__codelineno-45-14" name="__codelineno-45-14"></a><span class="c1">#   out_v.write(&quot;\t&quot;.join([str(x) for x in vec]) + &quot;\n&quot;) # write corresponding word vector to file</span>
<a id="__codelineno-45-15" name="__codelineno-45-15"></a><span class="c1"># out_v.close()</span>
<a id="__codelineno-45-16" name="__codelineno-45-16"></a><span class="c1"># out_m.close()</span>
<a id="__codelineno-45-17" name="__codelineno-45-17"></a>
<a id="__codelineno-45-18" name="__codelineno-45-18"></a><span class="c1"># # Download files locally to upload to Embedding Projector</span>
<a id="__codelineno-45-19" name="__codelineno-45-19"></a><span class="c1"># try:</span>
<a id="__codelineno-45-20" name="__codelineno-45-20"></a><span class="c1">#   from google.colab import files</span>
<a id="__codelineno-45-21" name="__codelineno-45-21"></a><span class="c1"># except ImportError:</span>
<a id="__codelineno-45-22" name="__codelineno-45-22"></a><span class="c1">#   pass</span>
<a id="__codelineno-45-23" name="__codelineno-45-23"></a><span class="c1"># else:</span>
<a id="__codelineno-45-24" name="__codelineno-45-24"></a><span class="c1">#   files.download(&quot;embedding_vectors.tsv&quot;)</span>
<a id="__codelineno-45-25" name="__codelineno-45-25"></a><span class="c1">#   files.download(&quot;embedding_metadata.tsv&quot;)</span>
</code></pre></div>
</td></tr></table>
<p><a name="model2"></a></p>
<h2 id="model-2-lstm">Model 2: LSTM</h2>
<p><a name=""></a></p>
<h3 id="create-compile-and-run-the-model_2">Create, Compile, and Run the model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-46-1">1</a></span>
<span class="normal"><a href="#__codelineno-46-2">2</a></span>
<span class="normal"><a href="#__codelineno-46-3">3</a></span>
<span class="normal"><a href="#__codelineno-46-4">4</a></span>
<span class="normal"><a href="#__codelineno-46-5">5</a></span>
<span class="normal"><a href="#__codelineno-46-6">6</a></span>
<span class="normal"><a href="#__codelineno-46-7">7</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1"></a><span class="c1"># CREATE EMBEDDING LAYER</span>
<a id="__codelineno-46-2" name="__codelineno-46-2"></a><span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">set_seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<a id="__codelineno-46-3" name="__codelineno-46-3"></a><span class="n">model_2_embedding</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">input_dim</span><span class="o">=</span><span class="n">max_vocab_length</span><span class="p">,</span>
<a id="__codelineno-46-4" name="__codelineno-46-4"></a>                                              <span class="n">output_dim</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
<a id="__codelineno-46-5" name="__codelineno-46-5"></a>                                              <span class="n">embeddings_initializer</span><span class="o">=</span><span class="s2">&quot;uniform&quot;</span><span class="p">,</span>
<a id="__codelineno-46-6" name="__codelineno-46-6"></a>                                              <span class="n">input_length</span><span class="o">=</span><span class="n">max_length</span><span class="p">,</span>
<a id="__codelineno-46-7" name="__codelineno-46-7"></a>                                              <span class="n">name</span><span class="o">=</span><span class="s2">&quot;embedding_2&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-47-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-47-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-47-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-47-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-47-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-47-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-47-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-47-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-47-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-47-10">10</a></span>
<span class="normal"><a href="#__codelineno-47-11">11</a></span>
<span class="normal"><a href="#__codelineno-47-12">12</a></span>
<span class="normal"><a href="#__codelineno-47-13">13</a></span>
<span class="normal"><a href="#__codelineno-47-14">14</a></span>
<span class="normal"><a href="#__codelineno-47-15">15</a></span>
<span class="normal"><a href="#__codelineno-47-16">16</a></span>
<span class="normal"><a href="#__codelineno-47-17">17</a></span>
<span class="normal"><a href="#__codelineno-47-18">18</a></span>
<span class="normal"><a href="#__codelineno-47-19">19</a></span>
<span class="normal"><a href="#__codelineno-47-20">20</a></span>
<span class="normal"><a href="#__codelineno-47-21">21</a></span>
<span class="normal"><a href="#__codelineno-47-22">22</a></span>
<span class="normal"><a href="#__codelineno-47-23">23</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1"></a><span class="c1"># CREATE LSTM MODEL</span>
<a id="__codelineno-47-2" name="__codelineno-47-2"></a><span class="n">inputs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;string&quot;</span><span class="p">)</span>
<a id="__codelineno-47-3" name="__codelineno-47-3"></a><span class="n">x</span> <span class="o">=</span> <span class="n">text_vectorizer</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
<a id="__codelineno-47-4" name="__codelineno-47-4"></a><span class="n">x</span> <span class="o">=</span> <span class="n">model_2_embedding</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-47-5" name="__codelineno-47-5"></a><span class="c1"># print(x.shape)</span>
<a id="__codelineno-47-6" name="__codelineno-47-6"></a><span class="c1"># x = tf.keras.layers.LSTM(64, return_sequences=True)(x) (optional) return vector for each word in the Tweet (every stacking RNN RNN layers need to set the return_sequences=True)</span>
<a id="__codelineno-47-7" name="__codelineno-47-7"></a><span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">64</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span> <span class="c1"># return vactor for the entire sequence</span>
<a id="__codelineno-47-8" name="__codelineno-47-8"></a><span class="c1"># print(x.shape)</span>
<a id="__codelineno-47-9" name="__codelineno-47-9"></a><span class="c1"># x = tf.keras.layers.Dense(64, activation=&quot;relu&quot;)(x) # (optional) dense layer on top of output of LSTM cell</span>
<a id="__codelineno-47-10" name="__codelineno-47-10"></a><span class="n">outputs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;sigmoid&quot;</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-47-11" name="__codelineno-47-11"></a><span class="n">model_2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;model_2_LSTM&quot;</span><span class="p">)</span>
<a id="__codelineno-47-12" name="__codelineno-47-12"></a>
<a id="__codelineno-47-13" name="__codelineno-47-13"></a><span class="c1"># COMPILE MODEL</span>
<a id="__codelineno-47-14" name="__codelineno-47-14"></a><span class="n">model_2</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s2">&quot;binary_crossentropy&quot;</span><span class="p">,</span>
<a id="__codelineno-47-15" name="__codelineno-47-15"></a>                <span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(),</span>
<a id="__codelineno-47-16" name="__codelineno-47-16"></a>                <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;accuracy&quot;</span><span class="p">])</span>
<a id="__codelineno-47-17" name="__codelineno-47-17"></a>
<a id="__codelineno-47-18" name="__codelineno-47-18"></a><span class="c1"># FIT MODEL</span>
<a id="__codelineno-47-19" name="__codelineno-47-19"></a><span class="n">model_2_history</span> <span class="o">=</span> <span class="n">model_2</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_sentences</span><span class="p">,</span>
<a id="__codelineno-47-20" name="__codelineno-47-20"></a>                              <span class="n">train_labels</span><span class="p">,</span>
<a id="__codelineno-47-21" name="__codelineno-47-21"></a>                              <span class="n">epochs</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-47-22" name="__codelineno-47-22"></a>                              <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">val_sentences</span><span class="p">,</span> <span class="n">val_labels</span><span class="p">),</span>
<a id="__codelineno-47-23" name="__codelineno-47-23"></a>                              <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">create_tensorboard_callback</span><span class="p">(</span><span class="n">SAVE_DIR</span><span class="p">,</span> <span class="s2">&quot;model_2_LSTM&quot;</span><span class="p">)])</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Saving TensorBoard log files to: model_logs/model_2_LSTM/20220321-035606
    Epoch 1/5
    215/215 [==============================] - 7s 12ms/step - loss: 0.5100 - accuracy: 0.7416 - val_loss: 0.4566 - val_accuracy: 0.7822
    Epoch 2/5
    215/215 [==============================] - 2s 10ms/step - loss: 0.3176 - accuracy: 0.8717 - val_loss: 0.5138 - val_accuracy: 0.7756
    Epoch 3/5
    215/215 [==============================] - 2s 10ms/step - loss: 0.2201 - accuracy: 0.9152 - val_loss: 0.5858 - val_accuracy: 0.7677
    Epoch 4/5
    215/215 [==============================] - 2s 10ms/step - loss: 0.1556 - accuracy: 0.9428 - val_loss: 0.6041 - val_accuracy: 0.7743
    Epoch 5/5
    215/215 [==============================] - 2s 10ms/step - loss: 0.1076 - accuracy: 0.9594 - val_loss: 0.8746 - val_accuracy: 0.7507
</pre>
</div>

<p><a name=""></a></p>
<h3 id="evaluate-the-model_2">Evaluate the model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-48-1">1</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1"></a><span class="n">model_2</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Model: "model_2_LSTM"
    _________________________________________________________________
     Layer (type)                Output Shape              Param #   
    =================================================================
     input_2 (InputLayer)        [(None, 1)]               0         

     text_vectorization_1 (TextV  (None, 15)               0         
     ectorization)                                                   

     embedding_2 (Embedding)     (None, 15, 128)           1280000   

     lstm (LSTM)                 (None, 64)                49408     

     dense_1 (Dense)             (None, 1)                 65        

    =================================================================
    Total params: 1,329,473
    Trainable params: 1,329,473
    Non-trainable params: 0
    _________________________________________________________________
</pre>
</div>

<p><a name=""></a></p>
<h3 id="make-prediction_1">Make prediction</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-49-1">1</a></span>
<span class="normal"><a href="#__codelineno-49-2">2</a></span>
<span class="normal"><a href="#__codelineno-49-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1"></a><span class="c1"># Make predictions on the validation dataset</span>
<a id="__codelineno-49-2" name="__codelineno-49-2"></a><span class="n">model_2_pred_probs</span> <span class="o">=</span> <span class="n">model_2</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">val_sentences</span><span class="p">)</span>
<a id="__codelineno-49-3" name="__codelineno-49-3"></a><span class="n">model_2_pred_probs</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">model_2_pred_probs</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span> <span class="c1"># view the first 10</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    ((762, 1), array([[0.00712602],
            [0.78736806],
            [0.9996376 ],
            [0.05679192],
            [0.0025822 ],
            [0.9996238 ],
            [0.9217022 ],
            [0.9997993 ],
            [0.9994954 ],
            [0.6645736 ]], dtype=float32))
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-50-1">1</a></span>
<span class="normal"><a href="#__codelineno-50-2">2</a></span>
<span class="normal"><a href="#__codelineno-50-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1"></a><span class="c1"># Round out predictions and reduce to 1-dimensional array</span>
<a id="__codelineno-50-2" name="__codelineno-50-2"></a><span class="n">model_2_preds</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">model_2_pred_probs</span><span class="p">))</span>
<a id="__codelineno-50-3" name="__codelineno-50-3"></a><span class="n">model_2_preds</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    tf.Tensor: shape=(10,), dtype=float32, numpy=array([0., 1., 1., 0., 0., 1., 1., 1., 1., 1.], dtype=float32)
</pre>
</div>

<p><a name=""></a></p>
<h3 id="calculate-results_1">Calculate results</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-51-1">1</a></span>
<span class="normal"><a href="#__codelineno-51-2">2</a></span>
<span class="normal"><a href="#__codelineno-51-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1"></a><span class="c1"># Calculate the results</span>
<a id="__codelineno-51-2" name="__codelineno-51-2"></a><span class="n">model_2_results</span> <span class="o">=</span> <span class="n">calculate_results</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">val_labels</span><span class="p">,</span> <span class="n">y_pred</span><span class="o">=</span><span class="n">model_2_preds</span><span class="p">)</span>
<a id="__codelineno-51-3" name="__codelineno-51-3"></a><span class="n">model_2_results</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    {'accuracy': 0.7506561679790026,
     'f1': 0.7489268622514025,
     'precision': 0.7510077975908164,
     'recall': 0.7506561679790026}
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-52-1">1</a></span>
<span class="normal"><a href="#__codelineno-52-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1"></a><span class="c1"># Compare model 2 results with baseline</span>
<a id="__codelineno-52-2" name="__codelineno-52-2"></a><span class="n">compare_baseline_to_new_results</span><span class="p">(</span><span class="n">baseline_results</span><span class="p">,</span> <span class="n">model_2_results</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Baseline accuracy: 0.79 , New accuracy: 0.75, Difference: -0.04
    Baseline precision: 0.81 , New precision: 0.75, Difference: -0.06
    Baseline recall: 0.79 , New recall: 0.75, Difference: -0.04
    Baseline f1: 0.79 , New f1: 0.75, Difference: -0.04
</pre>
</div>

<p><a name="model-3"></a></p>
<h2 id="model-3-gru">Model 3: GRU</h2>
<p><a name=""></a></p>
<h3 id="create-compile-and-run-the-model_3">Create, Compile, and Run the model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-53-1">1</a></span>
<span class="normal"><a href="#__codelineno-53-2">2</a></span>
<span class="normal"><a href="#__codelineno-53-3">3</a></span>
<span class="normal"><a href="#__codelineno-53-4">4</a></span>
<span class="normal"><a href="#__codelineno-53-5">5</a></span>
<span class="normal"><a href="#__codelineno-53-6">6</a></span>
<span class="normal"><a href="#__codelineno-53-7">7</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1"></a><span class="c1"># CREATE EMBEDDING LAYER</span>
<a id="__codelineno-53-2" name="__codelineno-53-2"></a><span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">set_seed</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
<a id="__codelineno-53-3" name="__codelineno-53-3"></a><span class="n">model_3_embedding</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">input_dim</span><span class="o">=</span><span class="n">max_vocab_length</span><span class="p">,</span>
<a id="__codelineno-53-4" name="__codelineno-53-4"></a>                                              <span class="n">output_dim</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
<a id="__codelineno-53-5" name="__codelineno-53-5"></a>                                              <span class="n">embeddings_initializer</span><span class="o">=</span><span class="s2">&quot;uniform&quot;</span><span class="p">,</span>
<a id="__codelineno-53-6" name="__codelineno-53-6"></a>                                              <span class="n">input_length</span><span class="o">=</span><span class="n">max_length</span><span class="p">,</span>
<a id="__codelineno-53-7" name="__codelineno-53-7"></a>                                              <span class="n">name</span><span class="o">=</span><span class="s2">&quot;embedding_3&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-54-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-54-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-54-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-54-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-54-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-54-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-54-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-54-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-54-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-54-10">10</a></span>
<span class="normal"><a href="#__codelineno-54-11">11</a></span>
<span class="normal"><a href="#__codelineno-54-12">12</a></span>
<span class="normal"><a href="#__codelineno-54-13">13</a></span>
<span class="normal"><a href="#__codelineno-54-14">14</a></span>
<span class="normal"><a href="#__codelineno-54-15">15</a></span>
<span class="normal"><a href="#__codelineno-54-16">16</a></span>
<span class="normal"><a href="#__codelineno-54-17">17</a></span>
<span class="normal"><a href="#__codelineno-54-18">18</a></span>
<span class="normal"><a href="#__codelineno-54-19">19</a></span>
<span class="normal"><a href="#__codelineno-54-20">20</a></span>
<span class="normal"><a href="#__codelineno-54-21">21</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1"></a><span class="c1"># CREATE MODEL</span>
<a id="__codelineno-54-2" name="__codelineno-54-2"></a><span class="n">inputs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;string&quot;</span><span class="p">)</span>
<a id="__codelineno-54-3" name="__codelineno-54-3"></a><span class="n">x</span> <span class="o">=</span> <span class="n">text_vectorizer</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
<a id="__codelineno-54-4" name="__codelineno-54-4"></a><span class="n">x</span> <span class="o">=</span> <span class="n">model_3_embedding</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-54-5" name="__codelineno-54-5"></a><span class="c1"># x = tf.keras.layers.GRU(64, return_sequences=True)(x)</span>
<a id="__codelineno-54-6" name="__codelineno-54-6"></a><span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">GRU</span><span class="p">(</span><span class="mi">64</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-54-7" name="__codelineno-54-7"></a><span class="c1"># x = tf.keras.layers.Dense(64, activation=&quot;relu&quot;)(x) # (optional) dense layer</span>
<a id="__codelineno-54-8" name="__codelineno-54-8"></a><span class="n">outputs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;sigmoid&quot;</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-54-9" name="__codelineno-54-9"></a><span class="n">model_3</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;model_3_GRU&quot;</span><span class="p">)</span>
<a id="__codelineno-54-10" name="__codelineno-54-10"></a>
<a id="__codelineno-54-11" name="__codelineno-54-11"></a><span class="c1"># COMPILE MODEL</span>
<a id="__codelineno-54-12" name="__codelineno-54-12"></a><span class="n">model_3</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s2">&quot;binary_crossentropy&quot;</span><span class="p">,</span>
<a id="__codelineno-54-13" name="__codelineno-54-13"></a>                <span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(),</span>
<a id="__codelineno-54-14" name="__codelineno-54-14"></a>                <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;accuracy&quot;</span><span class="p">])</span>
<a id="__codelineno-54-15" name="__codelineno-54-15"></a>
<a id="__codelineno-54-16" name="__codelineno-54-16"></a><span class="c1"># FIT MODEL</span>
<a id="__codelineno-54-17" name="__codelineno-54-17"></a><span class="n">model_3_history</span> <span class="o">=</span> <span class="n">model_3</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_sentences</span><span class="p">,</span>
<a id="__codelineno-54-18" name="__codelineno-54-18"></a>                              <span class="n">train_labels</span><span class="p">,</span>
<a id="__codelineno-54-19" name="__codelineno-54-19"></a>                              <span class="n">epochs</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-54-20" name="__codelineno-54-20"></a>                              <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">val_sentences</span><span class="p">,</span> <span class="n">val_labels</span><span class="p">),</span>
<a id="__codelineno-54-21" name="__codelineno-54-21"></a>                              <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">create_tensorboard_callback</span><span class="p">(</span><span class="n">SAVE_DIR</span><span class="p">,</span> <span class="s2">&quot;model_3_GRU&quot;</span><span class="p">)])</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Saving TensorBoard log files to: model_logs/model_3_GRU/20220321-035622
    Epoch 1/5
    215/215 [==============================] - 5s 13ms/step - loss: 0.5215 - accuracy: 0.7324 - val_loss: 0.4854 - val_accuracy: 0.7769
    Epoch 2/5
    215/215 [==============================] - 2s 9ms/step - loss: 0.3122 - accuracy: 0.8739 - val_loss: 0.4781 - val_accuracy: 0.7874
    Epoch 3/5
    215/215 [==============================] - 2s 9ms/step - loss: 0.2138 - accuracy: 0.9196 - val_loss: 0.5009 - val_accuracy: 0.7874
    Epoch 4/5
    215/215 [==============================] - 2s 10ms/step - loss: 0.1536 - accuracy: 0.9469 - val_loss: 0.5977 - val_accuracy: 0.7677
    Epoch 5/5
    215/215 [==============================] - 2s 10ms/step - loss: 0.1177 - accuracy: 0.9584 - val_loss: 0.7560 - val_accuracy: 0.7638
</pre>
</div>

<p><a name=""></a></p>
<h3 id="evaluate-the-model_3">Evaluate the model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-55-1">1</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1"></a><span class="n">model_3</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Model: "model_3_GRU"
    _________________________________________________________________
     Layer (type)                Output Shape              Param #   
    =================================================================
     input_3 (InputLayer)        [(None, 1)]               0         

     text_vectorization_1 (TextV  (None, 15)               0         
     ectorization)                                                   

     embedding_3 (Embedding)     (None, 15, 128)           1280000   

     gru (GRU)                   (None, 64)                37248     

     dense_2 (Dense)             (None, 1)                 65        

    =================================================================
    Total params: 1,317,313
    Trainable params: 1,317,313
    Non-trainable params: 0
    _________________________________________________________________
</pre>
</div>

<p><a name=""></a></p>
<h3 id="make-prediction_2">Make prediction</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-56-1">1</a></span>
<span class="normal"><a href="#__codelineno-56-2">2</a></span>
<span class="normal"><a href="#__codelineno-56-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1"></a><span class="c1"># Make predictions on the validation data</span>
<a id="__codelineno-56-2" name="__codelineno-56-2"></a><span class="n">model_3_pred_probs</span> <span class="o">=</span> <span class="n">model_3</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">val_sentences</span><span class="p">)</span>
<a id="__codelineno-56-3" name="__codelineno-56-3"></a><span class="n">model_3_pred_probs</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">model_3_pred_probs</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    ((762, 1), array([[0.27520677],
            [0.51713765],
            [0.9993832 ],
            [0.0628443 ],
            [0.00386795],
            [0.999097  ],
            [0.95616895],
            [0.99883443],
            [0.9989478 ],
            [0.6024441 ]], dtype=float32))
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-57-1">1</a></span>
<span class="normal"><a href="#__codelineno-57-2">2</a></span>
<span class="normal"><a href="#__codelineno-57-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1"></a><span class="c1"># Convert prediction probabilities to prediction classes</span>
<a id="__codelineno-57-2" name="__codelineno-57-2"></a><span class="n">model_3_preds</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">model_3_pred_probs</span><span class="p">))</span>
<a id="__codelineno-57-3" name="__codelineno-57-3"></a><span class="n">model_3_preds</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    tf.Tensor: shape=(10,), dtype=float32, numpy=array([0., 1., 1., 0., 0., 1., 1., 1., 1., 1.], dtype=float32)
</pre>
</div>

<p><a name=""></a></p>
<h3 id="calculate-results_2">Calculate results</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-58-1">1</a></span>
<span class="normal"><a href="#__codelineno-58-2">2</a></span>
<span class="normal"><a href="#__codelineno-58-3">3</a></span>
<span class="normal"><a href="#__codelineno-58-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1"></a><span class="c1"># Calcuate model_3 results</span>
<a id="__codelineno-58-2" name="__codelineno-58-2"></a><span class="n">model_3_results</span> <span class="o">=</span> <span class="n">calculate_results</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">val_labels</span><span class="p">,</span> 
<a id="__codelineno-58-3" name="__codelineno-58-3"></a>                                    <span class="n">y_pred</span><span class="o">=</span><span class="n">model_3_preds</span><span class="p">)</span>
<a id="__codelineno-58-4" name="__codelineno-58-4"></a><span class="n">model_3_results</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    {'accuracy': 0.7637795275590551,
     'f1': 0.7620205519156684,
     'precision': 0.7645678751509686,
     'recall': 0.7637795275590551}
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-59-1">1</a></span>
<span class="normal"><a href="#__codelineno-59-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1"></a><span class="c1"># Compare to baseline</span>
<a id="__codelineno-59-2" name="__codelineno-59-2"></a><span class="n">compare_baseline_to_new_results</span><span class="p">(</span><span class="n">baseline_results</span><span class="p">,</span> <span class="n">model_3_results</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Baseline accuracy: 0.79 , New accuracy: 0.76, Difference: -0.03
    Baseline precision: 0.81 , New precision: 0.76, Difference: -0.05
    Baseline recall: 0.79 , New recall: 0.76, Difference: -0.03
    Baseline f1: 0.79 , New f1: 0.76, Difference: -0.02
</pre>
</div>

<p><a name="model-4"></a></p>
<h2 id="model-4-bidirectional-rnn">Model 4: Bidirectional RNN</h2>
<p><a name=""></a></p>
<h3 id="create-compile-and-run-the-model_4">Create, Compile, and Run the model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-60-1">1</a></span>
<span class="normal"><a href="#__codelineno-60-2">2</a></span>
<span class="normal"><a href="#__codelineno-60-3">3</a></span>
<span class="normal"><a href="#__codelineno-60-4">4</a></span>
<span class="normal"><a href="#__codelineno-60-5">5</a></span>
<span class="normal"><a href="#__codelineno-60-6">6</a></span>
<span class="normal"><a href="#__codelineno-60-7">7</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1"></a><span class="c1"># CREATE EMBEDDING LAYER</span>
<a id="__codelineno-60-2" name="__codelineno-60-2"></a><span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">set_seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<a id="__codelineno-60-3" name="__codelineno-60-3"></a><span class="n">model_4_embedding</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">input_dim</span><span class="o">=</span><span class="n">max_vocab_length</span><span class="p">,</span>
<a id="__codelineno-60-4" name="__codelineno-60-4"></a>                                              <span class="n">output_dim</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
<a id="__codelineno-60-5" name="__codelineno-60-5"></a>                                              <span class="n">embeddings_initializer</span><span class="o">=</span><span class="s2">&quot;uniform&quot;</span><span class="p">,</span>
<a id="__codelineno-60-6" name="__codelineno-60-6"></a>                                              <span class="n">input_length</span><span class="o">=</span><span class="n">max_length</span><span class="p">,</span>
<a id="__codelineno-60-7" name="__codelineno-60-7"></a>                                              <span class="n">name</span><span class="o">=</span><span class="s2">&quot;embedding_4&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-61-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-61-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-61-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-61-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-61-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-61-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-61-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-61-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-61-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-61-10">10</a></span>
<span class="normal"><a href="#__codelineno-61-11">11</a></span>
<span class="normal"><a href="#__codelineno-61-12">12</a></span>
<span class="normal"><a href="#__codelineno-61-13">13</a></span>
<span class="normal"><a href="#__codelineno-61-14">14</a></span>
<span class="normal"><a href="#__codelineno-61-15">15</a></span>
<span class="normal"><a href="#__codelineno-61-16">16</a></span>
<span class="normal"><a href="#__codelineno-61-17">17</a></span>
<span class="normal"><a href="#__codelineno-61-18">18</a></span>
<span class="normal"><a href="#__codelineno-61-19">19</a></span>
<span class="normal"><a href="#__codelineno-61-20">20</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1"></a><span class="c1"># CREATE MODEL</span>
<a id="__codelineno-61-2" name="__codelineno-61-2"></a><span class="n">inputs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;string&quot;</span><span class="p">)</span>
<a id="__codelineno-61-3" name="__codelineno-61-3"></a><span class="n">x</span> <span class="o">=</span> <span class="n">text_vectorizer</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
<a id="__codelineno-61-4" name="__codelineno-61-4"></a><span class="n">x</span> <span class="o">=</span> <span class="n">model_4_embedding</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-61-5" name="__codelineno-61-5"></a><span class="c1"># x = tf.keras.layers.Bidrectional(tf.keras.layers.LSTM(64, return_sequences=True))(x) # optional bidirectional layer</span>
<a id="__codelineno-61-6" name="__codelineno-61-6"></a><span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Bidirectional</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">64</span><span class="p">))(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-61-7" name="__codelineno-61-7"></a><span class="n">outputs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;sigmoid&quot;</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-61-8" name="__codelineno-61-8"></a><span class="n">model_4</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;model_4_bidirectional&quot;</span><span class="p">)</span>
<a id="__codelineno-61-9" name="__codelineno-61-9"></a>
<a id="__codelineno-61-10" name="__codelineno-61-10"></a><span class="c1"># COMPILE MODEL</span>
<a id="__codelineno-61-11" name="__codelineno-61-11"></a><span class="n">model_4</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s2">&quot;binary_crossentropy&quot;</span><span class="p">,</span>
<a id="__codelineno-61-12" name="__codelineno-61-12"></a>                <span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(),</span>
<a id="__codelineno-61-13" name="__codelineno-61-13"></a>                <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;accuracy&quot;</span><span class="p">])</span>
<a id="__codelineno-61-14" name="__codelineno-61-14"></a>
<a id="__codelineno-61-15" name="__codelineno-61-15"></a><span class="c1"># FIT MODEL</span>
<a id="__codelineno-61-16" name="__codelineno-61-16"></a><span class="n">model_4_history</span> <span class="o">=</span> <span class="n">model_4</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_sentences</span><span class="p">,</span>
<a id="__codelineno-61-17" name="__codelineno-61-17"></a>                              <span class="n">train_labels</span><span class="p">,</span>
<a id="__codelineno-61-18" name="__codelineno-61-18"></a>                              <span class="n">epochs</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-61-19" name="__codelineno-61-19"></a>                              <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">val_sentences</span><span class="p">,</span> <span class="n">val_labels</span><span class="p">),</span>
<a id="__codelineno-61-20" name="__codelineno-61-20"></a>                              <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">create_tensorboard_callback</span><span class="p">(</span><span class="n">SAVE_DIR</span><span class="p">,</span> <span class="s2">&quot;model_4_bidirectional_RNN&quot;</span><span class="p">)])</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Saving TensorBoard log files to: model_logs/model_4_bidirectional_RNN/20220321-035646
    Epoch 1/5
    215/215 [==============================] - 8s 20ms/step - loss: 0.5093 - accuracy: 0.7481 - val_loss: 0.4606 - val_accuracy: 0.7795
    Epoch 2/5
    215/215 [==============================] - 3s 14ms/step - loss: 0.3135 - accuracy: 0.8708 - val_loss: 0.5144 - val_accuracy: 0.7690
    Epoch 3/5
    215/215 [==============================] - 3s 14ms/step - loss: 0.2150 - accuracy: 0.9178 - val_loss: 0.5626 - val_accuracy: 0.7677
    Epoch 4/5
    215/215 [==============================] - 3s 14ms/step - loss: 0.1523 - accuracy: 0.9469 - val_loss: 0.6365 - val_accuracy: 0.7769
    Epoch 5/5
    215/215 [==============================] - 3s 14ms/step - loss: 0.1083 - accuracy: 0.9639 - val_loss: 0.6509 - val_accuracy: 0.7664
</pre>
</div>

<p><a name=""></a></p>
<h3 id="evaluate-the-model_4">Evaluate the model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-62-1">1</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1"></a><span class="n">model_4</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Model: "model_4_bidirectional"
    _________________________________________________________________
     Layer (type)                Output Shape              Param #   
    =================================================================
     input_4 (InputLayer)        [(None, 1)]               0         

     text_vectorization_1 (TextV  (None, 15)               0         
     ectorization)                                                   

     embedding_4 (Embedding)     (None, 15, 128)           1280000   

     bidirectional (Bidirectiona  (None, 128)              98816     
     l)                                                              

     dense_3 (Dense)             (None, 1)                 129       

    =================================================================
    Total params: 1,378,945
    Trainable params: 1,378,945
    Non-trainable params: 0
    _________________________________________________________________
</pre>
</div>

<p><a name=""></a></p>
<h3 id="make-prediction_3">Make prediction</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-63-1">1</a></span>
<span class="normal"><a href="#__codelineno-63-2">2</a></span>
<span class="normal"><a href="#__codelineno-63-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1"></a><span class="c1"># Make predictions with bidirectional RNN on the validation data</span>
<a id="__codelineno-63-2" name="__codelineno-63-2"></a><span class="n">model_4_pred_probs</span> <span class="o">=</span> <span class="n">model_4</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">val_sentences</span><span class="p">)</span>
<a id="__codelineno-63-3" name="__codelineno-63-3"></a><span class="n">model_4_pred_probs</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    array([[0.04000051],
           [0.8279291 ],
           [0.99842227],
           [0.13531095],
           [0.00311337],
           [0.99220747],
           [0.95528346],
           [0.99945647],
           [0.99898285],
           [0.28141692]], dtype=float32)
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-64-1">1</a></span>
<span class="normal"><a href="#__codelineno-64-2">2</a></span>
<span class="normal"><a href="#__codelineno-64-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1"></a><span class="c1"># Convert prediction probabilities to labels</span>
<a id="__codelineno-64-2" name="__codelineno-64-2"></a><span class="n">model_4_preds</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">model_4_pred_probs</span><span class="p">))</span>
<a id="__codelineno-64-3" name="__codelineno-64-3"></a><span class="n">model_4_preds</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    tf.Tensor: shape=(10,), dtype=float32, numpy=array([0., 1., 1., 0., 0., 1., 1., 1., 1., 0.], dtype=float32)
</pre>
</div>

<p><a name=""></a></p>
<h3 id="calculate-results_3">Calculate results</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-65-1">1</a></span>
<span class="normal"><a href="#__codelineno-65-2">2</a></span>
<span class="normal"><a href="#__codelineno-65-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1"></a><span class="c1"># Calculate bidirectional RNN model results</span>
<a id="__codelineno-65-2" name="__codelineno-65-2"></a><span class="n">model_4_results</span> <span class="o">=</span> <span class="n">calculate_results</span><span class="p">(</span><span class="n">val_labels</span><span class="p">,</span> <span class="n">model_4_preds</span><span class="p">)</span>
<a id="__codelineno-65-3" name="__codelineno-65-3"></a><span class="n">model_4_results</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    {'accuracy': 0.7664041994750657,
     'f1': 0.7651213533864446,
     'precision': 0.7665895370389821,
     'recall': 0.7664041994750657}
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-66-1">1</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1"></a><span class="n">compare_baseline_to_new_results</span><span class="p">(</span><span class="n">baseline_results</span><span class="p">,</span> <span class="n">model_4_results</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Baseline accuracy: 0.79 , New accuracy: 0.77, Difference: -0.03
    Baseline precision: 0.81 , New precision: 0.77, Difference: -0.04
    Baseline recall: 0.79 , New recall: 0.77, Difference: -0.03
    Baseline f1: 0.79 , New f1: 0.77, Difference: -0.02
</pre>
</div>

<p><a name="model-5"></a></p>
<h2 id="model-5-conv1d">Model 5: Conv1D</h2>
<p><a name=""></a></p>
<h3 id="create-compile-and-run-the-model_5">Create, Compile, and Run the model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-67-1">1</a></span>
<span class="normal"><a href="#__codelineno-67-2">2</a></span>
<span class="normal"><a href="#__codelineno-67-3">3</a></span>
<span class="normal"><a href="#__codelineno-67-4">4</a></span>
<span class="normal"><a href="#__codelineno-67-5">5</a></span>
<span class="normal"><a href="#__codelineno-67-6">6</a></span>
<span class="normal"><a href="#__codelineno-67-7">7</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1"></a><span class="c1"># CREATE EMBEDDING LAYER</span>
<a id="__codelineno-67-2" name="__codelineno-67-2"></a><span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">set_seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<a id="__codelineno-67-3" name="__codelineno-67-3"></a><span class="n">model_5_embedding</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">input_dim</span><span class="o">=</span><span class="n">max_vocab_length</span><span class="p">,</span>
<a id="__codelineno-67-4" name="__codelineno-67-4"></a>                                       <span class="n">output_dim</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
<a id="__codelineno-67-5" name="__codelineno-67-5"></a>                                       <span class="n">embeddings_initializer</span><span class="o">=</span><span class="s2">&quot;uniform&quot;</span><span class="p">,</span>
<a id="__codelineno-67-6" name="__codelineno-67-6"></a>                                       <span class="n">input_length</span><span class="o">=</span><span class="n">max_length</span><span class="p">,</span>
<a id="__codelineno-67-7" name="__codelineno-67-7"></a>                                       <span class="n">name</span><span class="o">=</span><span class="s2">&quot;embedding_5&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-68-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-68-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-68-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-68-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-68-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-68-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-68-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-68-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-68-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-68-10">10</a></span>
<span class="normal"><a href="#__codelineno-68-11">11</a></span>
<span class="normal"><a href="#__codelineno-68-12">12</a></span>
<span class="normal"><a href="#__codelineno-68-13">13</a></span>
<span class="normal"><a href="#__codelineno-68-14">14</a></span>
<span class="normal"><a href="#__codelineno-68-15">15</a></span>
<span class="normal"><a href="#__codelineno-68-16">16</a></span>
<span class="normal"><a href="#__codelineno-68-17">17</a></span>
<span class="normal"><a href="#__codelineno-68-18">18</a></span>
<span class="normal"><a href="#__codelineno-68-19">19</a></span>
<span class="normal"><a href="#__codelineno-68-20">20</a></span>
<span class="normal"><a href="#__codelineno-68-21">21</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1"></a><span class="c1"># CREATE MODEL</span>
<a id="__codelineno-68-2" name="__codelineno-68-2"></a><span class="n">inputs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;string&quot;</span><span class="p">)</span>
<a id="__codelineno-68-3" name="__codelineno-68-3"></a><span class="n">x</span> <span class="o">=</span> <span class="n">text_vectorizer</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
<a id="__codelineno-68-4" name="__codelineno-68-4"></a><span class="n">x</span> <span class="o">=</span> <span class="n">model_5_embedding</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-68-5" name="__codelineno-68-5"></a><span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Conv1D</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;relu&quot;</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-68-6" name="__codelineno-68-6"></a><span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">GlobalMaxPool1D</span><span class="p">()(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-68-7" name="__codelineno-68-7"></a><span class="c1"># x = tf.keras.layers.Dense(64, activation=&quot;rele&quot;)(x) # optional layer</span>
<a id="__codelineno-68-8" name="__codelineno-68-8"></a><span class="n">outputs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;sigmoid&quot;</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-68-9" name="__codelineno-68-9"></a><span class="n">model_5</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;model_5_conv1d&quot;</span><span class="p">)</span>
<a id="__codelineno-68-10" name="__codelineno-68-10"></a>
<a id="__codelineno-68-11" name="__codelineno-68-11"></a><span class="c1">#COMPILE MODEL</span>
<a id="__codelineno-68-12" name="__codelineno-68-12"></a><span class="n">model_5</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s2">&quot;binary_crossentropy&quot;</span><span class="p">,</span>
<a id="__codelineno-68-13" name="__codelineno-68-13"></a>                <span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(),</span>
<a id="__codelineno-68-14" name="__codelineno-68-14"></a>                <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;accuracy&quot;</span><span class="p">])</span>
<a id="__codelineno-68-15" name="__codelineno-68-15"></a>
<a id="__codelineno-68-16" name="__codelineno-68-16"></a><span class="c1"># FIT MODEL</span>
<a id="__codelineno-68-17" name="__codelineno-68-17"></a><span class="n">model_5_history</span> <span class="o">=</span> <span class="n">model_5</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_sentences</span><span class="p">,</span>
<a id="__codelineno-68-18" name="__codelineno-68-18"></a>                              <span class="n">train_labels</span><span class="p">,</span>
<a id="__codelineno-68-19" name="__codelineno-68-19"></a>                              <span class="n">epochs</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-68-20" name="__codelineno-68-20"></a>                              <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">val_sentences</span><span class="p">,</span> <span class="n">val_labels</span><span class="p">),</span>
<a id="__codelineno-68-21" name="__codelineno-68-21"></a>                              <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">create_tensorboard_callback</span><span class="p">(</span><span class="n">SAVE_DIR</span><span class="p">,</span> <span class="s2">&quot;model_5_conv1d&quot;</span><span class="p">)])</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Saving TensorBoard log files to: model_logs/model_5_conv1d/20220321-040854
    Epoch 1/5
    215/215 [==============================] - 9s 9ms/step - loss: 0.5637 - accuracy: 0.7173 - val_loss: 0.4738 - val_accuracy: 0.7730
    Epoch 2/5
    215/215 [==============================] - 2s 7ms/step - loss: 0.3397 - accuracy: 0.8591 - val_loss: 0.4760 - val_accuracy: 0.7782
    Epoch 3/5
    215/215 [==============================] - 2s 7ms/step - loss: 0.2127 - accuracy: 0.9218 - val_loss: 0.5436 - val_accuracy: 0.7677
    Epoch 4/5
    215/215 [==============================] - 2s 8ms/step - loss: 0.1365 - accuracy: 0.9553 - val_loss: 0.6158 - val_accuracy: 0.7664
    Epoch 5/5
    215/215 [==============================] - 2s 7ms/step - loss: 0.0959 - accuracy: 0.9682 - val_loss: 0.6808 - val_accuracy: 0.7822
</pre>
</div>

<p><a name=""></a></p>
<h3 id="evaluate-the-model_5">Evaluate the model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-69-1">1</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1"></a><span class="n">model_5</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Model: "model_5_conv1d"
    _________________________________________________________________
     Layer (type)                Output Shape              Param #   
    =================================================================
     input_6 (InputLayer)        [(None, 1)]               0         

     text_vectorization_1 (TextV  (None, 15)               0         
     ectorization)                                                   

     embedding_5 (Embedding)     (None, 15, 128)           1280000   

     conv1d_1 (Conv1D)           (None, 11, 32)            20512     

     global_max_pooling1d_1 (Glo  (None, 32)               0         
     balMaxPooling1D)                                                

     dense_5 (Dense)             (None, 1)                 33        

    =================================================================
    Total params: 1,300,545
    Trainable params: 1,300,545
    Non-trainable params: 0
    _________________________________________________________________
</pre>
</div>

<p><a name=""></a></p>
<h3 id="make-prediction_4">Make prediction</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-70-1">1</a></span>
<span class="normal"><a href="#__codelineno-70-2">2</a></span>
<span class="normal"><a href="#__codelineno-70-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1"></a><span class="c1"># Make predictions with bidirectional RNN on the validation data</span>
<a id="__codelineno-70-2" name="__codelineno-70-2"></a><span class="n">model_5_pred_probs</span> <span class="o">=</span> <span class="n">model_5</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">val_sentences</span><span class="p">)</span>
<a id="__codelineno-70-3" name="__codelineno-70-3"></a><span class="n">model_5_pred_probs</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    array([[0.4883984 ],
           [0.8255724 ],
           [0.9999063 ],
           [0.06408543],
           [0.00120493],
           [0.99679995],
           [0.88677806],
           [0.99785775],
           [0.995509  ],
           [0.35167277]], dtype=float32)
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-71-1">1</a></span>
<span class="normal"><a href="#__codelineno-71-2">2</a></span>
<span class="normal"><a href="#__codelineno-71-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1"></a><span class="c1"># Convert prediction probabilities to labels</span>
<a id="__codelineno-71-2" name="__codelineno-71-2"></a><span class="n">model_5_preds</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">model_5_pred_probs</span><span class="p">))</span>
<a id="__codelineno-71-3" name="__codelineno-71-3"></a><span class="n">model_5_preds</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    tf.Tensor: shape=(10,), dtype=float32, numpy=array([0., 1., 1., 0., 0., 1., 1., 1., 1., 0.], dtype=float32)
</pre>
</div>

<p><a name=""></a></p>
<h3 id="calculate-results_4">Calculate results</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-72-1">1</a></span>
<span class="normal"><a href="#__codelineno-72-2">2</a></span>
<span class="normal"><a href="#__codelineno-72-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1"></a><span class="c1"># Calculate bidirectional RNN model results</span>
<a id="__codelineno-72-2" name="__codelineno-72-2"></a><span class="n">model_5_results</span> <span class="o">=</span> <span class="n">calculate_results</span><span class="p">(</span><span class="n">val_labels</span><span class="p">,</span> <span class="n">model_5_preds</span><span class="p">)</span>
<a id="__codelineno-72-3" name="__codelineno-72-3"></a><span class="n">model_5_results</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    {'accuracy': 0.7821522309711286,
     'f1': 0.7801766074787211,
     'precision': 0.7840694582051416,
     'recall': 0.7821522309711286}
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-73-1">1</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1"></a><span class="n">compare_baseline_to_new_results</span><span class="p">(</span><span class="n">baseline_results</span><span class="p">,</span> <span class="n">model_5_results</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Baseline accuracy: 0.79 , New accuracy: 0.78, Difference: -0.01
    Baseline precision: 0.81 , New precision: 0.78, Difference: -0.03
    Baseline recall: 0.79 , New recall: 0.78, Difference: -0.01
    Baseline f1: 0.79 , New f1: 0.78, Difference: -0.01
</pre>
</div>

<p><a name="model-6"></a></p>
<h2 id="model-6-tensorflow-hub-pretrained-sentence-encoder-use">Model 6: TensorFlow Hub - Pretrained Sentence Encoder (USE)</h2>
<p><a name=""></a></p>
<h3 id="create-compile-and-run-the-model_6">Create, Compile, and Run the model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-74-1">1</a></span>
<span class="normal"><a href="#__codelineno-74-2">2</a></span>
<span class="normal"><a href="#__codelineno-74-3">3</a></span>
<span class="normal"><a href="#__codelineno-74-4">4</a></span>
<span class="normal"><a href="#__codelineno-74-5">5</a></span>
<span class="normal"><a href="#__codelineno-74-6">6</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1"></a><span class="c1"># CREATE EMBEDDING LAYER</span>
<a id="__codelineno-74-2" name="__codelineno-74-2"></a><span class="n">sentence_encoder_layer</span> <span class="o">=</span> <span class="n">hub</span><span class="o">.</span><span class="n">KerasLayer</span><span class="p">(</span><span class="s2">&quot;https://tfhub.dev/google/universal-sentence-encoder/4&quot;</span><span class="p">,</span>
<a id="__codelineno-74-3" name="__codelineno-74-3"></a>                                        <span class="n">input_shape</span><span class="o">=</span><span class="p">[],</span> <span class="c1"># shape of input layer</span>
<a id="__codelineno-74-4" name="__codelineno-74-4"></a>                                        <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">string</span><span class="p">,</span> <span class="c1"># data type of inputs</span>
<a id="__codelineno-74-5" name="__codelineno-74-5"></a>                                        <span class="n">trainable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="c1"># keep pre-trained weights (for feature extractor)</span>
<a id="__codelineno-74-6" name="__codelineno-74-6"></a>                                        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;use&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-75-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-75-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-75-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-75-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-75-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-75-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-75-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-75-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-75-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-75-10">10</a></span>
<span class="normal"><a href="#__codelineno-75-11">11</a></span>
<span class="normal"><a href="#__codelineno-75-12">12</a></span>
<span class="normal"><a href="#__codelineno-75-13">13</a></span>
<span class="normal"><a href="#__codelineno-75-14">14</a></span>
<span class="normal"><a href="#__codelineno-75-15">15</a></span>
<span class="normal"><a href="#__codelineno-75-16">16</a></span>
<span class="normal"><a href="#__codelineno-75-17">17</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1"></a><span class="c1"># CREATE MODEL</span>
<a id="__codelineno-75-2" name="__codelineno-75-2"></a><span class="n">model_6</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span><span class="n">sentence_encoder_layer</span><span class="p">,</span>
<a id="__codelineno-75-3" name="__codelineno-75-3"></a>                               <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;relu&quot;</span><span class="p">),</span>
<a id="__codelineno-75-4" name="__codelineno-75-4"></a>                               <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;sigmoid&quot;</span><span class="p">)</span>
<a id="__codelineno-75-5" name="__codelineno-75-5"></a><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;model_6_use&quot;</span><span class="p">)</span>
<a id="__codelineno-75-6" name="__codelineno-75-6"></a>
<a id="__codelineno-75-7" name="__codelineno-75-7"></a><span class="c1">#COMPILE MODEL</span>
<a id="__codelineno-75-8" name="__codelineno-75-8"></a><span class="n">model_6</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s2">&quot;binary_crossentropy&quot;</span><span class="p">,</span>
<a id="__codelineno-75-9" name="__codelineno-75-9"></a>                <span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(),</span>
<a id="__codelineno-75-10" name="__codelineno-75-10"></a>                <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;accuracy&quot;</span><span class="p">])</span>
<a id="__codelineno-75-11" name="__codelineno-75-11"></a>
<a id="__codelineno-75-12" name="__codelineno-75-12"></a><span class="c1"># FIT MODEL</span>
<a id="__codelineno-75-13" name="__codelineno-75-13"></a><span class="n">model_6_history</span> <span class="o">=</span> <span class="n">model_6</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_sentences</span><span class="p">,</span>
<a id="__codelineno-75-14" name="__codelineno-75-14"></a>                              <span class="n">train_labels</span><span class="p">,</span>
<a id="__codelineno-75-15" name="__codelineno-75-15"></a>                              <span class="n">epochs</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-75-16" name="__codelineno-75-16"></a>                              <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">val_sentences</span><span class="p">,</span> <span class="n">val_labels</span><span class="p">),</span>
<a id="__codelineno-75-17" name="__codelineno-75-17"></a>                              <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">create_tensorboard_callback</span><span class="p">(</span><span class="n">SAVE_DIR</span><span class="p">,</span> <span class="s2">&quot;model_6_tf_hub_sentence_encoder&quot;</span><span class="p">)])</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Saving TensorBoard log files to: model_logs/model_6_tf_hub_sentence_encoder/20220321-040929
    Epoch 1/5
    215/215 [==============================] - 8s 20ms/step - loss: 0.5042 - accuracy: 0.7846 - val_loss: 0.4493 - val_accuracy: 0.8005
    Epoch 2/5
    215/215 [==============================] - 4s 19ms/step - loss: 0.4148 - accuracy: 0.8143 - val_loss: 0.4379 - val_accuracy: 0.8110
    Epoch 3/5
    215/215 [==============================] - 4s 18ms/step - loss: 0.4003 - accuracy: 0.8209 - val_loss: 0.4336 - val_accuracy: 0.8136
    Epoch 4/5
    215/215 [==============================] - 4s 18ms/step - loss: 0.3931 - accuracy: 0.8267 - val_loss: 0.4290 - val_accuracy: 0.8150
    Epoch 5/5
    215/215 [==============================] - 4s 19ms/step - loss: 0.3868 - accuracy: 0.8292 - val_loss: 0.4310 - val_accuracy: 0.8150
</pre>
</div>

<p><a name=""></a></p>
<h3 id="evaluate-the-model_6">Evaluate the model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-76-1">1</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-76-1" name="__codelineno-76-1"></a><span class="n">model_6</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Model: "model_6_use"
    _________________________________________________________________
     Layer (type)                Output Shape              Param #   
    =================================================================
     use (KerasLayer)            (None, 512)               256797824 

     dense_6 (Dense)             (None, 64)                32832     

     dense_7 (Dense)             (None, 1)                 65        

    =================================================================
    Total params: 256,830,721
    Trainable params: 32,897
    Non-trainable params: 256,797,824
    _________________________________________________________________
</pre>
</div>

<p><a name=""></a></p>
<h3 id="make-prediction_5">Make prediction</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-77-1">1</a></span>
<span class="normal"><a href="#__codelineno-77-2">2</a></span>
<span class="normal"><a href="#__codelineno-77-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-77-1" name="__codelineno-77-1"></a><span class="c1"># Make predictions with bidirectional RNN on the validation data</span>
<a id="__codelineno-77-2" name="__codelineno-77-2"></a><span class="n">model_6_pred_probs</span> <span class="o">=</span> <span class="n">model_6</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">val_sentences</span><span class="p">)</span>
<a id="__codelineno-77-3" name="__codelineno-77-3"></a><span class="n">model_6_pred_probs</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    array([[0.14374806],
           [0.7296013 ],
           [0.9867389 ],
           [0.201676  ],
           [0.74256223],
           [0.67980254],
           [0.98054254],
           [0.97562873],
           [0.92407715],
           [0.08305099]], dtype=float32)
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-78-1">1</a></span>
<span class="normal"><a href="#__codelineno-78-2">2</a></span>
<span class="normal"><a href="#__codelineno-78-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-78-1" name="__codelineno-78-1"></a><span class="c1"># Convert prediction probabilities to labels</span>
<a id="__codelineno-78-2" name="__codelineno-78-2"></a><span class="n">model_6_preds</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">model_6_pred_probs</span><span class="p">))</span>
<a id="__codelineno-78-3" name="__codelineno-78-3"></a><span class="n">model_6_preds</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    tf.Tensor: shape=(10,), dtype=float32, numpy=array([0., 1., 1., 0., 1., 1., 1., 1., 1., 0.], dtype=float32)
</pre>
</div>

<p><a name=""></a></p>
<h3 id="calculate-results_5">Calculate results</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-79-1">1</a></span>
<span class="normal"><a href="#__codelineno-79-2">2</a></span>
<span class="normal"><a href="#__codelineno-79-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-79-1" name="__codelineno-79-1"></a><span class="c1"># Calculate bidirectional RNN model results</span>
<a id="__codelineno-79-2" name="__codelineno-79-2"></a><span class="n">model_6_results</span> <span class="o">=</span> <span class="n">calculate_results</span><span class="p">(</span><span class="n">val_labels</span><span class="p">,</span> <span class="n">model_6_preds</span><span class="p">)</span>
<a id="__codelineno-79-3" name="__codelineno-79-3"></a><span class="n">model_6_results</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    {'accuracy': 0.8149606299212598,
     'f1': 0.8131230163581015,
     'precision': 0.8182618558292442,
     'recall': 0.8149606299212598}
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-80-1">1</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-80-1" name="__codelineno-80-1"></a><span class="n">compare_baseline_to_new_results</span><span class="p">(</span><span class="n">baseline_results</span><span class="p">,</span> <span class="n">model_6_results</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Baseline accuracy: 0.79 , New accuracy: 0.81, Difference: 0.02
    Baseline precision: 0.81 , New precision: 0.82, Difference: 0.01
    Baseline recall: 0.79 , New recall: 0.81, Difference: 0.02
    Baseline f1: 0.79 , New f1: 0.81, Difference: 0.03
</pre>
</div>

<p><a name="model-7"></a></p>
<h2 id="model-7-tensorflow-hub-pretrained-sentence-encoder-10-of-training-data">Model 7: TensorFlow Hub - Pretrained Sentence Encoder 10% of training data</h2>
<p>Since we can't use the already preprocessed data from previously, because of the data leakage which will lead to false 
results. We have to re-prepare the data again</p>
<p><a name=""></a></p>
<h3 id="prepare-the-data_1">Prepare the data</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-81-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-81-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-81-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-81-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-81-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-81-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-81-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-81-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-81-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-81-10">10</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-81-1" name="__codelineno-81-1"></a><span class="c1">### NOTE: Making splits like this will lead to data leakage ###</span>
<a id="__codelineno-81-2" name="__codelineno-81-2"></a><span class="c1">### (some of the training examples in the validation set) ###</span>
<a id="__codelineno-81-3" name="__codelineno-81-3"></a>
<a id="__codelineno-81-4" name="__codelineno-81-4"></a><span class="c1">### WRONG WAY TO MAKE SPLITS (train_df_shuffled has already been split) ### </span>
<a id="__codelineno-81-5" name="__codelineno-81-5"></a>
<a id="__codelineno-81-6" name="__codelineno-81-6"></a><span class="c1"># # Create subsets of 10% of the training data</span>
<a id="__codelineno-81-7" name="__codelineno-81-7"></a><span class="c1"># train_10_percent = train_df_shuffled[[&quot;text&quot;, &quot;target&quot;]].sample(frac=0.1, random_state=42)</span>
<a id="__codelineno-81-8" name="__codelineno-81-8"></a><span class="c1"># train_sentences_10_percent = train_10_percent[&quot;text&quot;].to_list()</span>
<a id="__codelineno-81-9" name="__codelineno-81-9"></a><span class="c1"># train_labels_10_percent = train_10_percent[&quot;target&quot;].to_list()</span>
<a id="__codelineno-81-10" name="__codelineno-81-10"></a><span class="c1"># len(train_sentences_10_percent), len(train_labels_10_percent)</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-82-1">1</a></span>
<span class="normal"><a href="#__codelineno-82-2">2</a></span>
<span class="normal"><a href="#__codelineno-82-3">3</a></span>
<span class="normal"><a href="#__codelineno-82-4">4</a></span>
<span class="normal"><a href="#__codelineno-82-5">5</a></span>
<span class="normal"><a href="#__codelineno-82-6">6</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-82-1" name="__codelineno-82-1"></a><span class="c1"># One kind of correct way (there are more) to make data subset</span>
<a id="__codelineno-82-2" name="__codelineno-82-2"></a><span class="c1"># (split the already split train_sentences/train_labels)</span>
<a id="__codelineno-82-3" name="__codelineno-82-3"></a><span class="n">train_sentences_90_percent</span><span class="p">,</span> <span class="n">train_sentences_10_percent</span><span class="p">,</span> <span class="n">train_labels_90_percent</span><span class="p">,</span> <span class="n">train_labels_10_percent</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">train_sentences</span><span class="p">),</span>
<a id="__codelineno-82-4" name="__codelineno-82-4"></a>                                                                                                                            <span class="n">train_labels</span><span class="p">,</span>
<a id="__codelineno-82-5" name="__codelineno-82-5"></a>                                                                                                                            <span class="n">test_size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
<a id="__codelineno-82-6" name="__codelineno-82-6"></a>                                                                                                                            <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-83-1">1</a></span>
<span class="normal"><a href="#__codelineno-83-2">2</a></span>
<span class="normal"><a href="#__codelineno-83-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-83-1" name="__codelineno-83-1"></a><span class="c1"># Check length of 10 percent datasets</span>
<a id="__codelineno-83-2" name="__codelineno-83-2"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total training examples: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">train_sentences</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-83-3" name="__codelineno-83-3"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Length of 10% training examples: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">train_sentences_10_percent</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Total training examples: 6851
    Length of 10% training examples: 686
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-84-1">1</a></span>
<span class="normal"><a href="#__codelineno-84-2">2</a></span>
<span class="normal"><a href="#__codelineno-84-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-84-1" name="__codelineno-84-1"></a><span class="c1"># Check the number of targets in our subset of data </span>
<a id="__codelineno-84-2" name="__codelineno-84-2"></a><span class="c1"># (this should be close to the distribution of labels in the original train_labels)</span>
<a id="__codelineno-84-3" name="__codelineno-84-3"></a><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">train_labels_10_percent</span><span class="p">)</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    0    415
    1    271
    dtype: int64
</pre>
</div>

<p><a name=""></a></p>
<h3 id="create-compile-and-run-the-model_7">Create, Compile, and Run the model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-85-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-85-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-85-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-85-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-85-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-85-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-85-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-85-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-85-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-85-10">10</a></span>
<span class="normal"><a href="#__codelineno-85-11">11</a></span>
<span class="normal"><a href="#__codelineno-85-12">12</a></span>
<span class="normal"><a href="#__codelineno-85-13">13</a></span>
<span class="normal"><a href="#__codelineno-85-14">14</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-85-1" name="__codelineno-85-1"></a><span class="c1"># CREATE MODEL (IN THIS CASE, CLONE THE MODEL)</span>
<a id="__codelineno-85-2" name="__codelineno-85-2"></a><span class="n">model_7</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">clone_model</span><span class="p">(</span><span class="n">model_6</span><span class="p">)</span>
<a id="__codelineno-85-3" name="__codelineno-85-3"></a>
<a id="__codelineno-85-4" name="__codelineno-85-4"></a><span class="c1">#COMPILE MODEL</span>
<a id="__codelineno-85-5" name="__codelineno-85-5"></a><span class="n">model_7</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s2">&quot;binary_crossentropy&quot;</span><span class="p">,</span>
<a id="__codelineno-85-6" name="__codelineno-85-6"></a>                <span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(),</span>
<a id="__codelineno-85-7" name="__codelineno-85-7"></a>                <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;accuracy&quot;</span><span class="p">])</span>
<a id="__codelineno-85-8" name="__codelineno-85-8"></a>
<a id="__codelineno-85-9" name="__codelineno-85-9"></a><span class="c1"># FIT MODEL</span>
<a id="__codelineno-85-10" name="__codelineno-85-10"></a><span class="n">model_7_history</span> <span class="o">=</span> <span class="n">model_7</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">train_sentences_10_percent</span><span class="p">,</span>
<a id="__codelineno-85-11" name="__codelineno-85-11"></a>                              <span class="n">y</span><span class="o">=</span><span class="n">train_labels_10_percent</span><span class="p">,</span>
<a id="__codelineno-85-12" name="__codelineno-85-12"></a>                              <span class="n">epochs</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-85-13" name="__codelineno-85-13"></a>                              <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">val_sentences</span><span class="p">,</span> <span class="n">val_labels</span><span class="p">),</span>
<a id="__codelineno-85-14" name="__codelineno-85-14"></a>                              <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">create_tensorboard_callback</span><span class="p">(</span><span class="n">SAVE_DIR</span><span class="p">,</span> <span class="s2">&quot;model_7_tf_hub_10_percent&quot;</span><span class="p">)])</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Saving TensorBoard log files to: model_logs/model_7_tf_hub_10_percent/20220321-041018
    Epoch 1/5
    22/22 [==============================] - 5s 69ms/step - loss: 0.6708 - accuracy: 0.6691 - val_loss: 0.6498 - val_accuracy: 0.7218
    Epoch 2/5
    22/22 [==============================] - 1s 46ms/step - loss: 0.5947 - accuracy: 0.8265 - val_loss: 0.5881 - val_accuracy: 0.7493
    Epoch 3/5
    22/22 [==============================] - 1s 33ms/step - loss: 0.5138 - accuracy: 0.8324 - val_loss: 0.5334 - val_accuracy: 0.7717
    Epoch 4/5
    22/22 [==============================] - 1s 33ms/step - loss: 0.4484 - accuracy: 0.8367 - val_loss: 0.5028 - val_accuracy: 0.7730
    Epoch 5/5
    22/22 [==============================] - 1s 33ms/step - loss: 0.4057 - accuracy: 0.8397 - val_loss: 0.4873 - val_accuracy: 0.7717
</pre>
</div>

<p><a name=""></a></p>
<h3 id="evaluate-the-model_7">Evaluate the model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-86-1">1</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-86-1" name="__codelineno-86-1"></a><span class="n">model_7</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Model: "model_6_use"
    _________________________________________________________________
     Layer (type)                Output Shape              Param #   
    =================================================================
     use (KerasLayer)            (None, 512)               256797824 

     dense_6 (Dense)             (None, 64)                32832     

     dense_7 (Dense)             (None, 1)                 65        

    =================================================================
    Total params: 256,830,721
    Trainable params: 32,897
    Non-trainable params: 256,797,824
    _________________________________________________________________
</pre>
</div>

<p><a name=""></a></p>
<h3 id="make-prediction_6">Make prediction</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-87-1">1</a></span>
<span class="normal"><a href="#__codelineno-87-2">2</a></span>
<span class="normal"><a href="#__codelineno-87-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-87-1" name="__codelineno-87-1"></a><span class="c1"># Make predictions with bidirectional RNN on the validation data</span>
<a id="__codelineno-87-2" name="__codelineno-87-2"></a><span class="n">model_7_pred_probs</span> <span class="o">=</span> <span class="n">model_7</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">val_sentences</span><span class="p">)</span>
<a id="__codelineno-87-3" name="__codelineno-87-3"></a><span class="n">model_7_pred_probs</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    array([[0.25504118],
           [0.8166157 ],
           [0.9244271 ],
           [0.34062764],
           [0.56693715],
           [0.85294   ],
           [0.83639187],
           [0.8654027 ],
           [0.84384096],
           [0.1382337 ]], dtype=float32)
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-88-1">1</a></span>
<span class="normal"><a href="#__codelineno-88-2">2</a></span>
<span class="normal"><a href="#__codelineno-88-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-88-1" name="__codelineno-88-1"></a><span class="c1"># Convert prediction probabilities to labels</span>
<a id="__codelineno-88-2" name="__codelineno-88-2"></a><span class="n">model_7_preds</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">model_7_pred_probs</span><span class="p">))</span>
<a id="__codelineno-88-3" name="__codelineno-88-3"></a><span class="n">model_7_preds</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    tf.Tensor: shape=(10,), dtype=float32, numpy=array([0., 1., 1., 0., 1., 1., 1., 1., 1., 0.], dtype=float32)
</pre>
</div>

<p><a name=""></a></p>
<h3 id="calculate-results_6">Calculate results</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-89-1">1</a></span>
<span class="normal"><a href="#__codelineno-89-2">2</a></span>
<span class="normal"><a href="#__codelineno-89-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-89-1" name="__codelineno-89-1"></a><span class="c1"># Calculate bidirectional RNN model results</span>
<a id="__codelineno-89-2" name="__codelineno-89-2"></a><span class="n">model_7_results</span> <span class="o">=</span> <span class="n">calculate_results</span><span class="p">(</span><span class="n">val_labels</span><span class="p">,</span> <span class="n">model_7_preds</span><span class="p">)</span>
<a id="__codelineno-89-3" name="__codelineno-89-3"></a><span class="n">model_7_results</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    {'accuracy': 0.7716535433070866,
     'f1': 0.7685968913498257,
     'precision': 0.7755054154623078,
     'recall': 0.7716535433070866}
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-90-1">1</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-90-1" name="__codelineno-90-1"></a><span class="n">compare_baseline_to_new_results</span><span class="p">(</span><span class="n">baseline_results</span><span class="p">,</span> <span class="n">model_7_results</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Baseline accuracy: 0.79 , New accuracy: 0.77, Difference: -0.02
    Baseline precision: 0.81 , New precision: 0.78, Difference: -0.04
    Baseline recall: 0.79 , New recall: 0.77, Difference: -0.02
    Baseline f1: 0.79 , New f1: 0.77, Difference: -0.02
</pre>
</div>

<p><a name="compare-all-models"></a></p>
<h2 id="compare-all-models">Compare all models</h2>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-91-1">1</a></span>
<span class="normal"><a href="#__codelineno-91-2">2</a></span>
<span class="normal"><a href="#__codelineno-91-3">3</a></span>
<span class="normal"><a href="#__codelineno-91-4">4</a></span>
<span class="normal"><a href="#__codelineno-91-5">5</a></span>
<span class="normal"><a href="#__codelineno-91-6">6</a></span>
<span class="normal"><a href="#__codelineno-91-7">7</a></span>
<span class="normal"><a href="#__codelineno-91-8">8</a></span>
<span class="normal"><a href="#__codelineno-91-9">9</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-91-1" name="__codelineno-91-1"></a><span class="c1"># Combine all results into a DataFrame</span>
<a id="__codelineno-91-2" name="__codelineno-91-2"></a><span class="n">all_model_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Model 0: baseline&quot;</span><span class="p">:</span> <span class="n">baseline_results</span><span class="p">,</span>
<a id="__codelineno-91-3" name="__codelineno-91-3"></a>                                   <span class="s2">&quot;Model 1: simple dense&quot;</span><span class="p">:</span> <span class="n">model_1_results</span><span class="p">,</span>
<a id="__codelineno-91-4" name="__codelineno-91-4"></a>                                   <span class="s2">&quot;Model 2: LSTM&quot;</span><span class="p">:</span> <span class="n">model_2_results</span><span class="p">,</span>
<a id="__codelineno-91-5" name="__codelineno-91-5"></a>                                   <span class="s2">&quot;Model 3: GRU&quot;</span><span class="p">:</span> <span class="n">model_3_results</span><span class="p">,</span>
<a id="__codelineno-91-6" name="__codelineno-91-6"></a>                                   <span class="s2">&quot;Model 4: Bidirectional&quot;</span><span class="p">:</span> <span class="n">model_4_results</span><span class="p">,</span>
<a id="__codelineno-91-7" name="__codelineno-91-7"></a>                                   <span class="s2">&quot;Model 5: Conv1D&quot;</span><span class="p">:</span> <span class="n">model_5_results</span><span class="p">,</span>
<a id="__codelineno-91-8" name="__codelineno-91-8"></a>                                   <span class="s2">&quot;Model 6: TF_Hub Sentence Encoder&quot;</span><span class="p">:</span> <span class="n">model_6_results</span><span class="p">,</span>
<a id="__codelineno-91-9" name="__codelineno-91-9"></a>                                   <span class="s2">&quot;Model 7: TF_Hub Sentence Encoder 10% Data&quot;</span><span class="p">:</span> <span class="n">model_7_results</span><span class="p">})</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-92-1">1</a></span>
<span class="normal"><a href="#__codelineno-92-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-92-1" name="__codelineno-92-1"></a><span class="n">all_model_results</span> <span class="o">=</span> <span class="n">all_model_results</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
<a id="__codelineno-92-2" name="__codelineno-92-2"></a><span class="n">all_model_results</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
                                                    accuracy    precision   recall      f1
    Model 0:    baseline                            0.792651    0.811139    0.792651    0.786219
    Model 1:    simple dense                        0.787402    0.791492    0.787402    0.784697
    Model 2:    LSTM                                0.750656    0.751008    0.750656    0.748927
    Model 3:    GRU                                 0.763780    0.764568    0.763780    0.762021
    Model 4:    Bidirectional                       0.766404    0.766590    0.766404    0.765121
    Model 5:    Conv1D                              0.782152    0.784069    0.782152    0.780177
    Model 6:    TF_Hub Sentence Encoder             0.814961    0.818262    0.814961    0.813123
    Model 7:    TF_Hub Sentence Encoder 10% Data    0.771654    0.775505    0.771654    0.768597

</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-93-1">1</a></span>
<span class="normal"><a href="#__codelineno-93-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-93-1" name="__codelineno-93-1"></a><span class="c1"># Reduce the accuracy to same scale as other metrics</span>
<a id="__codelineno-93-2" name="__codelineno-93-2"></a><span class="n">all_model_results</span><span class="p">[</span><span class="s2">&quot;accuracy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_model_results</span><span class="p">[</span><span class="s2">&quot;accuracy&quot;</span><span class="p">]</span><span class="o">/</span><span class="mi">100</span>
</code></pre></div>
</td></tr></table>
<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-94-1">1</a></span>
<span class="normal"><a href="#__codelineno-94-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-94-1" name="__codelineno-94-1"></a><span class="c1"># Plot and compare all of the model results</span>
<a id="__codelineno-94-2" name="__codelineno-94-2"></a><span class="n">all_model_results</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
</code></pre></div>
</td></tr></table>
<img alt="nlp-1-1" src="../../../images/nlp-1-1.png" /></p>
<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-95-1">1</a></span>
<span class="normal"><a href="#__codelineno-95-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-95-1" name="__codelineno-95-1"></a><span class="c1"># Sort model results by f1-score</span>
<a id="__codelineno-95-2" name="__codelineno-95-2"></a><span class="n">all_model_results</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;f1&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s2">&quot;f1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
</code></pre></div>
</td></tr></table>
<img alt="nlp-1-1" src="../../../images/nlp-1-2.png" /></p>
<p><a name="use-tensorboard"></a></p>
<h2 id="optional-use-tensorboard">(Optional) Use TensorBoard</h2>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-96-1">1</a></span>
<span class="normal"><a href="#__codelineno-96-2">2</a></span>
<span class="normal"><a href="#__codelineno-96-3">3</a></span>
<span class="normal"><a href="#__codelineno-96-4">4</a></span>
<span class="normal"><a href="#__codelineno-96-5">5</a></span>
<span class="normal"><a href="#__codelineno-96-6">6</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-96-1" name="__codelineno-96-1"></a><span class="c1"># # View tensorboard logs of transfer learning modelling experiments (should be 4 models)</span>
<a id="__codelineno-96-2" name="__codelineno-96-2"></a><span class="c1"># # Upload TensorBoard dev records</span>
<a id="__codelineno-96-3" name="__codelineno-96-3"></a><span class="c1"># !tensorboard dev upload --logdir ./model_logs \</span>
<a id="__codelineno-96-4" name="__codelineno-96-4"></a><span class="c1">#   --name &quot;NLP modelling experiments&quot; \</span>
<a id="__codelineno-96-5" name="__codelineno-96-5"></a><span class="c1">#   --description &quot;A series of different NLP modellings experiments with various models&quot; \</span>
<a id="__codelineno-96-6" name="__codelineno-96-6"></a><span class="c1">#   --one_shot # exits the uploader when upload has finished</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-97-1">1</a></span>
<span class="normal"><a href="#__codelineno-97-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-97-1" name="__codelineno-97-1"></a><span class="c1"># If you need to remove previous experiments, you can do so using the following command</span>
<a id="__codelineno-97-2" name="__codelineno-97-2"></a><span class="c1"># !tensorboard dev delete --experiment_id EXPERIMENT_ID_TO_DELETE</span>
</code></pre></div>
</td></tr></table>
<p><a name="combine-models"></a></p>
<h2 id="optional-combining-models">(Optional) Combining models</h2>
<p>Combine our baseline model (model_0), LSTM model (model_2) and our USE model trained on the full training data 
(model_6) by averaging the combined prediction probabilities of each.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-98-1">1</a></span>
<span class="normal"><a href="#__codelineno-98-2">2</a></span>
<span class="normal"><a href="#__codelineno-98-3">3</a></span>
<span class="normal"><a href="#__codelineno-98-4">4</a></span>
<span class="normal"><a href="#__codelineno-98-5">5</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-98-1" name="__codelineno-98-1"></a><span class="c1"># Get mean pred probs for 3 models</span>
<a id="__codelineno-98-2" name="__codelineno-98-2"></a><span class="n">baseline_pred_probs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">model_0</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">val_sentences</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># get the prediction probabilities from baseline model</span>
<a id="__codelineno-98-3" name="__codelineno-98-3"></a><span class="n">combined_pred_probs</span> <span class="o">=</span> <span class="n">baseline_pred_probs</span> <span class="o">+</span> <span class="n">tf</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">model_2_pred_probs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">tf</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">model_6_pred_probs</span><span class="p">)</span>
<a id="__codelineno-98-4" name="__codelineno-98-4"></a><span class="n">combined_preds</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">combined_pred_probs</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="c1"># average and round the prediction probabilities to get prediction classes</span>
<a id="__codelineno-98-5" name="__codelineno-98-5"></a><span class="n">combined_preds</span><span class="p">[:</span><span class="mi">20</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    tf.Tensor: shape=(20,), dtype=float32, numpy=
    array([0., 1., 1., 0., 0., 1., 1., 1., 1., 1., 0., 0., 0., 1., 0., 0., 0.,
           0., 0., 1.], dtype=float32)
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-99-1">1</a></span>
<span class="normal"><a href="#__codelineno-99-2">2</a></span>
<span class="normal"><a href="#__codelineno-99-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-99-1" name="__codelineno-99-1"></a><span class="c1"># Calculate results from averaging the prediction probabilities</span>
<a id="__codelineno-99-2" name="__codelineno-99-2"></a><span class="n">ensemble_results</span> <span class="o">=</span> <span class="n">calculate_results</span><span class="p">(</span><span class="n">val_labels</span><span class="p">,</span> <span class="n">combined_preds</span><span class="p">)</span>
<a id="__codelineno-99-3" name="__codelineno-99-3"></a><span class="n">ensemble_results</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    {'accuracy': 0.7808398950131233,
     'f1': 0.7805169025578647,
     'precision': 0.7805216999297674,
     'recall': 0.7808398950131233}
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-100-1">1</a></span>
<span class="normal"><a href="#__codelineno-100-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-100-1" name="__codelineno-100-1"></a><span class="c1"># Add our combined model&#39;s results to the results DataFrame</span>
<a id="__codelineno-100-2" name="__codelineno-100-2"></a><span class="n">all_model_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;ensemble_results&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ensemble_results</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-101-1">1</a></span>
<span class="normal"><a href="#__codelineno-101-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-101-1" name="__codelineno-101-1"></a><span class="c1"># Convert the accuracy to the same scale as the rest of the results</span>
<a id="__codelineno-101-2" name="__codelineno-101-2"></a><span class="n">all_model_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;ensemble_results&quot;</span><span class="p">][</span><span class="s2">&quot;accuracy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_model_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;ensemble_results&quot;</span><span class="p">][</span><span class="s2">&quot;accuracy&quot;</span><span class="p">]</span><span class="o">/</span><span class="mi">100</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-102-1">1</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-102-1" name="__codelineno-102-1"></a><span class="n">all_model_results</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
                                                accuracy    precision   recall      f1
    Model 0: baseline                           0.007927    0.811139    0.792651    0.786219
    Model 1: simple dense                       0.007874    0.791492    0.787402    0.784697
    Model 2: LSTM                               0.007507    0.751008    0.750656    0.748927
    Model 3: GRU                                0.007638    0.764568    0.763780    0.762021
    Model 4: Bidirectional                      0.007664    0.766590    0.766404    0.765121
    Model 5: Conv1D                             0.007822    0.784069    0.782152    0.780177
    Model 6: TF_Hub Sentence Encoder            0.008150    0.818262    0.814961    0.813123
    Model 7: TF_Hub Sentence Encoder 10% Data   0.007717    0.775505    0.771654    0.768597
    ensemble_results                            0.007808    0.780522    0.780840    0.780517

</pre>
</div>

<p><a name="save-and-load"></a></p>
<h2 id="save-and-load-trained-models">Save and Load trained models</h2>
<p>There are two main ways of saving a model in TensorFlow:</p>
<ol>
<li>The HDF5 format.</li>
<li>The SavedModel format (default).</li>
</ol>
<p><a name=""></a></p>
<h3 id="hdf5-h5-format">HDF5 (.h5) format</h3>
<p>If you save a model as a HDF5, when loading it back in, you need to let TensorFlow know about any custom objects you've 
used (e.g. components which aren't built from pure TensorFlow, such as TensorFlow Hub components).</p>
<p>Saving and loading our model with either format results in the same performance.</p>
<p>For most use cases, the SavedModel format will suffice. However, this is a TensorFlow specific standard. If you need a 
more general-purpose data standard, HDF5 might be better. For more, check out the TensorFlow documentation on saving 
and loading models.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-103-1">1</a></span>
<span class="normal"><a href="#__codelineno-103-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-103-1" name="__codelineno-103-1"></a><span class="c1"># Save TF Hub Sentence Encoder model to HDF5 format</span>
<a id="__codelineno-103-2" name="__codelineno-103-2"></a><span class="n">model_6</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;model_6.h5&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-104-1">1</a></span>
<span class="normal"><a href="#__codelineno-104-2">2</a></span>
<span class="normal"><a href="#__codelineno-104-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-104-1" name="__codelineno-104-1"></a><span class="c1"># Load model with custom Hub Layer (required with HDF5 format)</span>
<a id="__codelineno-104-2" name="__codelineno-104-2"></a><span class="n">loaded_model_6</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="s2">&quot;model_6.h5&quot;</span><span class="p">,</span> 
<a id="__codelineno-104-3" name="__codelineno-104-3"></a>                                            <span class="n">custom_objects</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;KerasLayer&quot;</span><span class="p">:</span> <span class="n">hub</span><span class="o">.</span><span class="n">KerasLayer</span><span class="p">})</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-105-1">1</a></span>
<span class="normal"><a href="#__codelineno-105-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-105-1" name="__codelineno-105-1"></a><span class="c1"># How does our loaded model perform?</span>
<a id="__codelineno-105-2" name="__codelineno-105-2"></a><span class="n">loaded_model_6</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">val_sentences</span><span class="p">,</span> <span class="n">val_labels</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    24/24 [==============================] - 1s 15ms/step - loss: 0.4310 - accuracy: 0.8150
    [0.43097829818725586, 0.8149606585502625]
</pre>
</div>

<p><a name=""></a></p>
<h3 id="savemodel-format">SaveModel format</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-106-1">1</a></span>
<span class="normal"><a href="#__codelineno-106-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-106-1" name="__codelineno-106-1"></a><span class="c1"># Save TF Hub Sentence Encoder model to SavedModel format (default)</span>
<a id="__codelineno-106-2" name="__codelineno-106-2"></a><span class="n">model_6</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;model_6_SavedModel_format&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    INFO:tensorflow:Assets written to: model_6_SavedModel_format/assets
    INFO:tensorflow:Assets written to: model_6_SavedModel_format/assets
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-107-1">1</a></span>
<span class="normal"><a href="#__codelineno-107-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-107-1" name="__codelineno-107-1"></a><span class="c1"># Load TF Hub Sentence Encoder SavedModel</span>
<a id="__codelineno-107-2" name="__codelineno-107-2"></a><span class="n">loaded_model_6_SavedModel</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="s2">&quot;model_6_SavedModel_format&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-108-1">1</a></span>
<span class="normal"><a href="#__codelineno-108-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-108-1" name="__codelineno-108-1"></a><span class="c1"># Evaluate loaded SavedModel format</span>
<a id="__codelineno-108-2" name="__codelineno-108-2"></a><span class="n">loaded_model_6_SavedModel</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">val_sentences</span><span class="p">,</span> <span class="n">val_labels</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    24/24 [==============================] - 1s 15ms/step - loss: 0.4310 - accuracy: 0.8150
    [0.43097832798957825, 0.8149606585502625]
</pre>
</div>

<p><a name=""></a></p>
<h2 id="make-prediction-and-revisit-the-data">Make prediction and revisit the data</h2>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-109-1">1</a></span>
<span class="normal"><a href="#__codelineno-109-2">2</a></span>
<span class="normal"><a href="#__codelineno-109-3">3</a></span>
<span class="normal"><a href="#__codelineno-109-4">4</a></span>
<span class="normal"><a href="#__codelineno-109-5">5</a></span>
<span class="normal"><a href="#__codelineno-109-6">6</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-109-1" name="__codelineno-109-1"></a><span class="c1"># Create dataframe with validation sentences and best performing model predictions</span>
<a id="__codelineno-109-2" name="__codelineno-109-2"></a><span class="n">val_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">val_sentences</span><span class="p">,</span>
<a id="__codelineno-109-3" name="__codelineno-109-3"></a>                       <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="n">val_labels</span><span class="p">,</span>
<a id="__codelineno-109-4" name="__codelineno-109-4"></a>                       <span class="s2">&quot;pred&quot;</span><span class="p">:</span> <span class="n">model_6_preds</span><span class="p">,</span>
<a id="__codelineno-109-5" name="__codelineno-109-5"></a>                       <span class="s2">&quot;pred_prob&quot;</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">model_6_pred_probs</span><span class="p">)})</span>
<a id="__codelineno-109-6" name="__codelineno-109-6"></a><span class="n">val_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
                                                    text    target  pred    pred_prob
    0   DFR EP016 Monthly Meltdown - On Dnbheaven 2015...   0       0.0     0.143748
    1   FedEx no longer to transport bioterror germs i...   0       1.0     0.729601
    2   Gunmen kill four in El Salvador bus attack: Su...   1       1.0     0.986739
    3   @camilacabello97 Internally and externally scr...   1       0.0     0.201676
    4   Radiation emergency #preparedness starts with ...   1       1.0     0.742562

</pre>
</div>

<p><a name=""></a></p>
<h3 id="find-the-most-wrong-prediction">Find the most wrong prediction</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-110-1">1</a></span>
<span class="normal"><a href="#__codelineno-110-2">2</a></span>
<span class="normal"><a href="#__codelineno-110-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-110-1" name="__codelineno-110-1"></a><span class="c1"># Find the wrong predictions and sort by prediction probabilities</span>
<a id="__codelineno-110-2" name="__codelineno-110-2"></a><span class="n">most_wrong</span> <span class="o">=</span> <span class="n">val_df</span><span class="p">[</span><span class="n">val_df</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">val_df</span><span class="p">[</span><span class="s2">&quot;pred&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;pred_prob&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-110-3" name="__codelineno-110-3"></a><span class="n">most_wrong</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
                                                    text    target      pred    pred_prob
    31  ? High Skies - Burning Buildings ? http://t.co...   0           1.0     0.919784
    628 @noah_anyname That's where the concentration c...   0           1.0     0.858833
    759 FedEx will no longer transport bioterror patho...   0           1.0     0.854446
    393 @SonofLiberty357 all illuminated by the bright...   0           1.0     0.836313
    49  @madonnamking RSPCA site multiple 7 story high...   0           1.0     0.834176
    209 Ashes 2015: Australias collapse at Trent Br...   0           1.0     0.814864
    251 @AshGhebranious civil rights continued in the ...   0           1.0     0.809585
    109 [55436] 1950 LIONEL TRAINS SMOKE LOCOMOTIVES W...   0           1.0     0.783607
    698 MGN-AFRICA pin:263789F4  Correction: Ten...   0           1.0     0.776448
    567 @RebeccaforReal accepts Wisconsin Emergency Re...   0           1.0     0.760085

</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-111-1">1</a></span>
<span class="normal"><a href="#__codelineno-111-2">2</a></span>
<span class="normal"><a href="#__codelineno-111-3">3</a></span>
<span class="normal"><a href="#__codelineno-111-4">4</a></span>
<span class="normal"><a href="#__codelineno-111-5">5</a></span>
<span class="normal"><a href="#__codelineno-111-6">6</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-111-1" name="__codelineno-111-1"></a><span class="c1"># Check the false positives (model predicted 1 when should&#39;ve been 0)</span>
<a id="__codelineno-111-2" name="__codelineno-111-2"></a><span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">most_wrong</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span> <span class="c1"># loop through the top 10 rows (change the index to view different rows)</span>
<a id="__codelineno-111-3" name="__codelineno-111-3"></a>  <span class="n">_</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">prob</span> <span class="o">=</span> <span class="n">row</span>
<a id="__codelineno-111-4" name="__codelineno-111-4"></a>  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Target: </span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s2">, Pred: </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span><span class="si">}</span><span class="s2">, Prob: </span><span class="si">{</span><span class="n">prob</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-111-5" name="__codelineno-111-5"></a>  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Text:</span><span class="se">\n</span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-111-6" name="__codelineno-111-6"></a>  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;----</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Target: 0, Pred: 1, Prob: 0.9197836518287659
    Text:
    ? High Skies - Burning Buildings ? http://t.co/uVq41i3Kx2 #nowplaying

    ----

    Target: 0, Pred: 1, Prob: 0.8588333129882812
    Text:
    @noah_anyname That's where the concentration camps and mass murder come in. 

    EVERY. FUCKING. TIME.

    ----

    Target: 0, Pred: 1, Prob: 0.8544463515281677
    Text:
    FedEx will no longer transport bioterror pathogens in wake of anthrax lab mishaps http://t.co/lHpgxc4b8J

    ----

    Target: 0, Pred: 1, Prob: 0.8363129496574402
    Text:
    @SonofLiberty357 all illuminated by the brightly burning buildings all around the town!

    ----

    Target: 0, Pred: 1, Prob: 0.8341763019561768
    Text:
    @madonnamking RSPCA site multiple 7 story high rise buildings next to low density character residential in an area that floods

    ----

    Target: 0, Pred: 1, Prob: 0.8148635625839233
    Text:
    Ashes 2015: Australias collapse at Trent Bridge among worst in history: England bundled out Australia for 60 ... http://t.co/t5TrhjUAU0

    ----

    Target: 0, Pred: 1, Prob: 0.8095847368240356
    Text:
    @AshGhebranious civil rights continued in the 60s. And what about trans-generational trauma? if anything we should listen to the Americans.

    ----

    Target: 0, Pred: 1, Prob: 0.7836073040962219
    Text:
    [55436] 1950 LIONEL TRAINS SMOKE LOCOMOTIVES WITH MAGNE-TRACTION INSTRUCTIONS http://t.co/xEZBs3sq0y http://t.co/C2x0QoKGlY

    ----

    Target: 0, Pred: 1, Prob: 0.7764476537704468
    Text:
    MGN-AFRICA pin:263789F4  Correction: Tent Collapse Story: Correction: Tent Collapse story  http://t.co/fDJUYvZMrv @wizkidayo

    ----

    Target: 0, Pred: 1, Prob: 0.7600845098495483
    Text:
    @RebeccaforReal accepts Wisconsin Emergency Response Plan on behalf of @GovWalker #nbc15 http://t.co/Pis0aiVRbR

    ----
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-112-1">1</a></span>
<span class="normal"><a href="#__codelineno-112-2">2</a></span>
<span class="normal"><a href="#__codelineno-112-3">3</a></span>
<span class="normal"><a href="#__codelineno-112-4">4</a></span>
<span class="normal"><a href="#__codelineno-112-5">5</a></span>
<span class="normal"><a href="#__codelineno-112-6">6</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-112-1" name="__codelineno-112-1"></a><span class="c1"># Check the most wrong false negatives (model predicted 0 when should&#39;ve predict 1)</span>
<a id="__codelineno-112-2" name="__codelineno-112-2"></a><span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">most_wrong</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">:]</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span>
<a id="__codelineno-112-3" name="__codelineno-112-3"></a>  <span class="n">_</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">prob</span> <span class="o">=</span> <span class="n">row</span>
<a id="__codelineno-112-4" name="__codelineno-112-4"></a>  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Target: </span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s2">, Pred: </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span><span class="si">}</span><span class="s2">, Prob: </span><span class="si">{</span><span class="n">prob</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-112-5" name="__codelineno-112-5"></a>  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Text:</span><span class="se">\n</span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-112-6" name="__codelineno-112-6"></a>  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;----</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Target: 1, Pred: 0, Prob: 0.060506671667099
    Text:
    VICTORINOX SWISS ARMY DATE WOMEN'S RUBBER MOP WATCH 241487 http://t.co/yFy3nkkcoH http://t.co/KNEhVvOHVK

    ----

    Target: 1, Pred: 0, Prob: 0.056552689522504807
    Text:
    going to redo my nails and watch behind the scenes of desolation of smaug ayyy

    ----

    Target: 1, Pred: 0, Prob: 0.053439222276210785
    Text:
    Lucas Duda is Ghost Rider. Not the Nic Cage version but an actual 'engulfed in flames' badass. #Mets

    ----

    Target: 1, Pred: 0, Prob: 0.04835923761129379
    Text:
    @willienelson We need help! Horses will die!Please RT &amp; sign petition!Take a stand &amp; be a voice for them! #gilbert23 https://t.co/e8dl1lNCVu

    ----

    Target: 1, Pred: 0, Prob: 0.04749126732349396
    Text:
    You can never escape me. Bullets don't harm me. Nothing harms me. But I know pain. I know pain. Sometimes I share it. With someone like you.

    ----

    Target: 1, Pred: 0, Prob: 0.043487902730703354
    Text:
    I get to smoke my shit in peace

    ----

    Target: 1, Pred: 0, Prob: 0.03967224061489105
    Text:
    @SoonerMagic_ I mean I'm a fan but I don't need a girl sounding off like a damn siren

    ----

    Target: 1, Pred: 0, Prob: 0.03859681636095047
    Text:
    Why are you deluged with low self-image? Take the quiz: http://t.co/XsPqdOrIqj http://t.co/CQYvFR4UCy

    ----

    Target: 1, Pred: 0, Prob: 0.03695990890264511
    Text:
    Reddit Will Now Quarantine_ http://t.co/pkUAMXw6pm #onlinecommunities #reddit #amageddon #freespeech #Business http://t.co/PAWvNJ4sAP

    ----

    Target: 1, Pred: 0, Prob: 0.02946264110505581
    Text:
    Ron &amp; Fez - Dave's High School Crush https://t.co/aN3W16c8F6 via @YouTube

    ----
</pre>
</div>

<p><a name="making-predictions"></a></p>
<h3 id="making-predictions">Making predictions</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-113-1">1</a></span>
<span class="normal"><a href="#__codelineno-113-2">2</a></span>
<span class="normal"><a href="#__codelineno-113-3">3</a></span>
<span class="normal"><a href="#__codelineno-113-4">4</a></span>
<span class="normal"><a href="#__codelineno-113-5">5</a></span>
<span class="normal"><a href="#__codelineno-113-6">6</a></span>
<span class="normal"><a href="#__codelineno-113-7">7</a></span>
<span class="normal"><a href="#__codelineno-113-8">8</a></span>
<span class="normal"><a href="#__codelineno-113-9">9</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-113-1" name="__codelineno-113-1"></a><span class="c1"># Making predictions on the test dataset</span>
<a id="__codelineno-113-2" name="__codelineno-113-2"></a><span class="n">test_sentences</span> <span class="o">=</span> <span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
<a id="__codelineno-113-3" name="__codelineno-113-3"></a><span class="n">test_samples</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">test_sentences</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-113-4" name="__codelineno-113-4"></a><span class="k">for</span> <span class="n">test_sample</span> <span class="ow">in</span> <span class="n">test_samples</span><span class="p">:</span>
<a id="__codelineno-113-5" name="__codelineno-113-5"></a>  <span class="n">pred_prob</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">model_6</span><span class="o">.</span><span class="n">predict</span><span class="p">([</span><span class="n">test_sample</span><span class="p">]))</span> <span class="c1"># has to be list</span>
<a id="__codelineno-113-6" name="__codelineno-113-6"></a>  <span class="n">pred</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">pred_prob</span><span class="p">)</span>
<a id="__codelineno-113-7" name="__codelineno-113-7"></a>  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pred: </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span><span class="si">}</span><span class="s2">, Prob: </span><span class="si">{</span><span class="n">pred_prob</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-113-8" name="__codelineno-113-8"></a>  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Text:</span><span class="se">\n</span><span class="si">{</span><span class="n">test_sample</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-113-9" name="__codelineno-113-9"></a>  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;----</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Pred: 0, Prob: 0.01907377317547798
    Text:
    Do you feel deluged by unhappiness? Take the quiz: http://t.co/XUyfZkZ4k0 http://t.co/YupKvDIh8m

    ----

    Pred: 0, Prob: 0.2400563508272171
    Text:
    Rip to whoevers face that crashed in front of my work. Wish I could have helped

    ----

    Pred: 1, Prob: 0.505020797252655
    Text:
    [News] Saint Louis University lowers tuition for first responders http://t.co/VJRHkmHpu2

    ----

    Pred: 1, Prob: 0.5274521708488464
    Text:
    Stop using the money of tax layers of the country to feed bloody terrorist. Shot them and give a strong msg as other country does...

    ----

    Pred: 1, Prob: 0.9437493681907654
    Text:
    RT @LivingSafely: #NWS issues Severe #Thunderstorm Warnings for parts of #AR #NC #OK. Expect more trauma cases: http://t.co/FWqfCKNCQW

    ----

    Pred: 0, Prob: 0.15400399267673492
    Text:
    By havin an ally lyk @AnnCoulter Republican Party is declaring war on all immigrants..deserves 2 b defeated n destroyed.it's a clarion call.

    ----

    Pred: 0, Prob: 0.2904660701751709
    Text:
    Aug 3 1915KILL 10000 WITH ROCKS.; Italians Make Good Use of Nature's Weapons -- Excel with Bayonet.
    http://t.co/ck1mMvHU0T

    ----

    Pred: 0, Prob: 0.06424696743488312
    Text:
    RT @judithabarrow author CHANGING PATTERNS  #amazon http://t.co/0oCrOtMkHM SILENT TRAUMA http://t.co/2ZGrVnMDW9 #amazon

    ----

    Pred: 1, Prob: 0.9468716979026794
    Text:
    #UPDATE: Picture from the Penn Twp. airplane accident. http://t.co/6JfgDnZRlC

    ----

    Pred: 0, Prob: 0.05262356624007225
    Text:
    @benznibeadel_ hehe like u HAHAHA I'm kidding love u I'm gonna sleep na bc curfew ??

    ----
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-114-1">1</a></span>
<span class="normal"><a href="#__codelineno-114-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-114-1" name="__codelineno-114-1"></a><span class="c1"># Turn Tweet into string</span>
<a id="__codelineno-114-2" name="__codelineno-114-2"></a><span class="n">daniels_tweet</span> <span class="o">=</span> <span class="s2">&quot;Life like an ensemble: take the best choices from others and make your own&quot;</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-115-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-115-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-115-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-115-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-115-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-115-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-115-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-115-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-115-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-115-10">10</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-115-1" name="__codelineno-115-1"></a><span class="k">def</span> <span class="nf">predict_on_sentence</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">sentence</span><span class="p">):</span>
<a id="__codelineno-115-2" name="__codelineno-115-2"></a>  <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-115-3" name="__codelineno-115-3"></a><span class="sd">  Uses model to make a prediction on sentence.</span>
<a id="__codelineno-115-4" name="__codelineno-115-4"></a>
<a id="__codelineno-115-5" name="__codelineno-115-5"></a><span class="sd">  Returns the sentence, the predicted label and the prediction probability.</span>
<a id="__codelineno-115-6" name="__codelineno-115-6"></a><span class="sd">  &quot;&quot;&quot;</span>
<a id="__codelineno-115-7" name="__codelineno-115-7"></a>  <span class="n">pred_prob</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">([</span><span class="n">sentence</span><span class="p">])</span>
<a id="__codelineno-115-8" name="__codelineno-115-8"></a>  <span class="n">pred_label</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">pred_prob</span><span class="p">))</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<a id="__codelineno-115-9" name="__codelineno-115-9"></a>  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pred: </span><span class="si">{</span><span class="n">pred_label</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;(real disaster)&quot;</span> <span class="k">if</span> <span class="n">pred_label</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;(not real disaster)&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Prob: </span><span class="si">{</span><span class="n">pred_prob</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-115-10" name="__codelineno-115-10"></a>  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Text:</span><span class="se">\n</span><span class="si">{</span><span class="n">sentence</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-116-1">1</a></span>
<span class="normal"><a href="#__codelineno-116-2">2</a></span>
<span class="normal"><a href="#__codelineno-116-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-116-1" name="__codelineno-116-1"></a><span class="c1"># Make a prediction on Tweet from the wild</span>
<a id="__codelineno-116-2" name="__codelineno-116-2"></a><span class="n">predict_on_sentence</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model_6</span><span class="p">,</span> <span class="c1"># use the USE model</span>
<a id="__codelineno-116-3" name="__codelineno-116-3"></a>                    <span class="n">sentence</span><span class="o">=</span><span class="n">daniels_tweet</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Pred: 0.0 (not real disaster) Prob: 0.04429866001009941
    Text:
    Life like an ensemble: take the best choices from others and make your own
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-117-1">1</a></span>
<span class="normal"><a href="#__codelineno-117-2">2</a></span>
<span class="normal"><a href="#__codelineno-117-3">3</a></span>
<span class="normal"><a href="#__codelineno-117-4">4</a></span>
<span class="normal"><a href="#__codelineno-117-5">5</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-117-1" name="__codelineno-117-1"></a><span class="c1"># Source - https://twitter.com/BeirutCityGuide/status/1290696551376007168</span>
<a id="__codelineno-117-2" name="__codelineno-117-2"></a><span class="n">beirut_tweet_1</span> <span class="o">=</span> <span class="s2">&quot;Reports that the smoke in Beirut sky contains nitric acid, which is toxic. Please share and refrain from stepping outside unless urgent. #Lebanon&quot;</span>
<a id="__codelineno-117-3" name="__codelineno-117-3"></a>
<a id="__codelineno-117-4" name="__codelineno-117-4"></a><span class="c1"># Source - https://twitter.com/BeirutCityGuide/status/1290773498743476224</span>
<a id="__codelineno-117-5" name="__codelineno-117-5"></a><span class="n">beirut_tweet_2</span> <span class="o">=</span> <span class="s2">&quot;#Beirut declared a devastated city, two-week state of emergency officially declared. #Lebanon&quot;</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-118-1">1</a></span>
<span class="normal"><a href="#__codelineno-118-2">2</a></span>
<span class="normal"><a href="#__codelineno-118-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-118-1" name="__codelineno-118-1"></a><span class="c1"># Predict on diaster Tweet 1</span>
<a id="__codelineno-118-2" name="__codelineno-118-2"></a><span class="n">predict_on_sentence</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model_6</span><span class="p">,</span> 
<a id="__codelineno-118-3" name="__codelineno-118-3"></a>                    <span class="n">sentence</span><span class="o">=</span><span class="n">beirut_tweet_1</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Pred: 1.0 (real disaster) Prob: 0.9618465304374695
    Text:
    Reports that the smoke in Beirut sky contains nitric acid, which is toxic. Please share and refrain from stepping outside unless urgent. #Lebanon
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-119-1">1</a></span>
<span class="normal"><a href="#__codelineno-119-2">2</a></span>
<span class="normal"><a href="#__codelineno-119-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-119-1" name="__codelineno-119-1"></a><span class="c1"># Predict on diaster Tweet 2</span>
<a id="__codelineno-119-2" name="__codelineno-119-2"></a><span class="n">predict_on_sentence</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model_6</span><span class="p">,</span> 
<a id="__codelineno-119-3" name="__codelineno-119-3"></a>                    <span class="n">sentence</span><span class="o">=</span><span class="n">beirut_tweet_2</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Pred: 1.0 (real disaster) Prob: 0.9687607884407043
    Text:
    #Beirut declared a devastated city, two-week state of emergency officially declared. #Lebanon
</pre>
</div>

<p><a name="tradeoff"></a></p>
<h2 id="speedscore-tradeoff">Speed/Score tradeoff</h2>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-120-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-120-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-120-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-120-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-120-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-120-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-120-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-120-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-120-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-120-10">10</a></span>
<span class="normal"><a href="#__codelineno-120-11">11</a></span>
<span class="normal"><a href="#__codelineno-120-12">12</a></span>
<span class="normal"><a href="#__codelineno-120-13">13</a></span>
<span class="normal"><a href="#__codelineno-120-14">14</a></span>
<span class="normal"><a href="#__codelineno-120-15">15</a></span>
<span class="normal"><a href="#__codelineno-120-16">16</a></span>
<span class="normal"><a href="#__codelineno-120-17">17</a></span>
<span class="normal"><a href="#__codelineno-120-18">18</a></span>
<span class="normal"><a href="#__codelineno-120-19">19</a></span>
<span class="normal"><a href="#__codelineno-120-20">20</a></span>
<span class="normal"><a href="#__codelineno-120-21">21</a></span>
<span class="normal"><a href="#__codelineno-120-22">22</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-120-1" name="__codelineno-120-1"></a><span class="c1"># Calculate the time of predictions</span>
<a id="__codelineno-120-2" name="__codelineno-120-2"></a><span class="kn">import</span> <span class="nn">time</span>
<a id="__codelineno-120-3" name="__codelineno-120-3"></a><span class="k">def</span> <span class="nf">pred_timer</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">samples</span><span class="p">):</span>
<a id="__codelineno-120-4" name="__codelineno-120-4"></a>  <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-120-5" name="__codelineno-120-5"></a><span class="sd">  Times how long a model takes to make predictions on samples.</span>
<a id="__codelineno-120-6" name="__codelineno-120-6"></a>
<a id="__codelineno-120-7" name="__codelineno-120-7"></a><span class="sd">  Args:</span>
<a id="__codelineno-120-8" name="__codelineno-120-8"></a><span class="sd">  ----</span>
<a id="__codelineno-120-9" name="__codelineno-120-9"></a><span class="sd">  model = a trained model</span>
<a id="__codelineno-120-10" name="__codelineno-120-10"></a><span class="sd">  sample = a list of samples</span>
<a id="__codelineno-120-11" name="__codelineno-120-11"></a>
<a id="__codelineno-120-12" name="__codelineno-120-12"></a><span class="sd">  Returns:</span>
<a id="__codelineno-120-13" name="__codelineno-120-13"></a><span class="sd">  ----</span>
<a id="__codelineno-120-14" name="__codelineno-120-14"></a><span class="sd">  total_time = total elapsed time for model to make predictions on samples</span>
<a id="__codelineno-120-15" name="__codelineno-120-15"></a><span class="sd">  time_per_pred = time in seconds per single sample</span>
<a id="__codelineno-120-16" name="__codelineno-120-16"></a><span class="sd">  &quot;&quot;&quot;</span>
<a id="__codelineno-120-17" name="__codelineno-120-17"></a>  <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="c1"># get start time</span>
<a id="__codelineno-120-18" name="__codelineno-120-18"></a>  <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span> <span class="c1"># make predictions</span>
<a id="__codelineno-120-19" name="__codelineno-120-19"></a>  <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="c1"># get finish time</span>
<a id="__codelineno-120-20" name="__codelineno-120-20"></a>  <span class="n">total_time</span> <span class="o">=</span> <span class="n">end_time</span><span class="o">-</span><span class="n">start_time</span> <span class="c1"># calculate how long predictions took to make</span>
<a id="__codelineno-120-21" name="__codelineno-120-21"></a>  <span class="n">time_per_pred</span> <span class="o">=</span> <span class="n">total_time</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">val_sentences</span><span class="p">)</span> <span class="c1"># find prediction time per sample</span>
<a id="__codelineno-120-22" name="__codelineno-120-22"></a>  <span class="k">return</span> <span class="n">total_time</span><span class="p">,</span> <span class="n">time_per_pred</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-121-1">1</a></span>
<span class="normal"><a href="#__codelineno-121-2">2</a></span>
<span class="normal"><a href="#__codelineno-121-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-121-1" name="__codelineno-121-1"></a><span class="c1"># Calculate TF Hub Sentence Encoder prediction times</span>
<a id="__codelineno-121-2" name="__codelineno-121-2"></a><span class="n">model_6_total_pred_time</span><span class="p">,</span> <span class="n">model_6_time_per_pred</span> <span class="o">=</span> <span class="n">pred_timer</span><span class="p">(</span><span class="n">model_6</span><span class="p">,</span> <span class="n">val_sentences</span><span class="p">)</span>
<a id="__codelineno-121-3" name="__codelineno-121-3"></a><span class="n">model_6_total_pred_time</span><span class="p">,</span> <span class="n">model_6_time_per_pred</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (0.3410436019998997, 0.0004475637821520993)
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-122-1">1</a></span>
<span class="normal"><a href="#__codelineno-122-2">2</a></span>
<span class="normal"><a href="#__codelineno-122-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-122-1" name="__codelineno-122-1"></a><span class="c1"># Calculate Naive Bayes prediction times</span>
<a id="__codelineno-122-2" name="__codelineno-122-2"></a><span class="n">baseline_total_pred_time</span><span class="p">,</span> <span class="n">baseline_time_per_pred</span> <span class="o">=</span> <span class="n">pred_timer</span><span class="p">(</span><span class="n">model_0</span><span class="p">,</span> <span class="n">val_sentences</span><span class="p">)</span>
<a id="__codelineno-122-3" name="__codelineno-122-3"></a><span class="n">baseline_total_pred_time</span><span class="p">,</span> <span class="n">baseline_time_per_pred</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (0.01810820099990451, 2.37640433069613e-05)
</pre>
</div>

<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-123-1">1</a></span>
<span class="normal"><a href="#__codelineno-123-2">2</a></span>
<span class="normal"><a href="#__codelineno-123-3">3</a></span>
<span class="normal"><a href="#__codelineno-123-4">4</a></span>
<span class="normal"><a href="#__codelineno-123-5">5</a></span>
<span class="normal"><a href="#__codelineno-123-6">6</a></span>
<span class="normal"><a href="#__codelineno-123-7">7</a></span>
<span class="normal"><a href="#__codelineno-123-8">8</a></span>
<span class="normal"><a href="#__codelineno-123-9">9</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-123-1" name="__codelineno-123-1"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<a id="__codelineno-123-2" name="__codelineno-123-2"></a>
<a id="__codelineno-123-3" name="__codelineno-123-3"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<a id="__codelineno-123-4" name="__codelineno-123-4"></a><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">baseline_time_per_pred</span><span class="p">,</span> <span class="n">baseline_results</span><span class="p">[</span><span class="s2">&quot;f1&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;baseline&quot;</span><span class="p">)</span>
<a id="__codelineno-123-5" name="__codelineno-123-5"></a><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">model_6_time_per_pred</span><span class="p">,</span> <span class="n">model_6_results</span><span class="p">[</span><span class="s2">&quot;f1&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;tf_hub_sentence_encoder&quot;</span><span class="p">)</span>
<a id="__codelineno-123-6" name="__codelineno-123-6"></a><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<a id="__codelineno-123-7" name="__codelineno-123-7"></a><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;F1-score versus time per prediction&quot;</span><span class="p">)</span>
<a id="__codelineno-123-8" name="__codelineno-123-8"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time per prediction&quot;</span><span class="p">)</span>
<a id="__codelineno-123-9" name="__codelineno-123-9"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;F1-Score&quot;</span><span class="p">);</span>
</code></pre></div>
</td></tr></table>
<img alt="nlp-1-3" src="../../../images/nlp-1-3.png" /></p>

              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../imdb/" class="md-footer__link md-footer__link--prev" aria-label="Previous: NLP - Binary-Class IMDB" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              NLP - Binary-Class IMDB
            </div>
          </div>
        </a>
      
      
        
        <a href="../nlp-2-multi/" class="md-footer__link md-footer__link--next" aria-label="Next: NLP - Multi-Class PedMed" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              NLP - Multi-Class PedMed
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2020 - 2022 Mark Schwarz
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["search.suggest", "search.highlight", "search.tabs.link", "content.tabs.link", "navigation.indexes", "navigation.tabs", "navigation.top"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../../../assets/javascripts/workers/search.cefbb252.min.js"}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.a5f8ea78.min.js"></script>
      
    
  </body>
</html>