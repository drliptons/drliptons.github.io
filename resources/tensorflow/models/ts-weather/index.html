
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../../../assets/dl-logo-big-512x512-color.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.0.5">
    
    
      
        <title>Time Series - Weather Forecast - DrLiptons</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.a617204b.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.9204c3b2.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  <link rel="stylesheet" href="../../../../overrides/assets/stylesheets/main.d9227bb8.min.css">

  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="indigo" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#time-series-weather-forecast" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="DrLiptons" class="md-header__button md-logo" aria-label="DrLiptons" data-md-component="logo">
      
  <img src="../../../../assets/dl-logo-big-512x512-color.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DrLiptons
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Time Series - Weather Forecast
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="" data-md-color-primary="indigo" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../../about/" class="md-tabs__link">
      About
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../reference/" class="md-tabs__link">
        Reference
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../resource/" class="md-tabs__link md-tabs__link--active">
        Resource
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="DrLiptons" class="md-nav__button md-logo" aria-label="DrLiptons" data-md-component="logo">
      
  <img src="../../../../assets/dl-logo-big-512x512-color.png" alt="logo">

    </a>
    DrLiptons
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../about/" class="md-nav__link">
        About
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3">
          Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../reference/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2" type="checkbox" id="__nav_3_2" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_2">
          Python
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Python" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          Python
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/get-live-financial-data/" class="md-nav__link">
        Get Live Financial Data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/flight-deals/" class="md-nav__link">
        Flight Deals
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/alien-invaders/" class="md-nav__link">
        Alien Invaders
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/auto-job-app/" class="md-nav__link">
        Automated Job Application
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/price-tracker/" class="md-nav__link">
        Price Tracker
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/password-manager/" class="md-nav__link">
        Password Manager
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/text-2-morse-code/" class="md-nav__link">
        Text2MorseCode
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/stock-news-alerts/" class="md-nav__link">
        Stock News Alert
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/tetris/" class="md-nav__link">
        Tetris Clone
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3" type="checkbox" id="__nav_3_3" >
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_3">
          TensorFlow
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="TensorFlow" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          TensorFlow
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3_1" type="checkbox" id="__nav_3_3_1" >
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_3_1">
          Plant Disease Detection
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Plant Disease Detection" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_3_1">
          <span class="md-nav__icon md-icon"></span>
          Plant Disease Detection
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/pdd/plant-disease-detection/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/pdd/part-1-create-ml-model/" class="md-nav__link">
        Part 1 - Create ML Model
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/pdd/part-2-create-app/" class="md-nav__link">
        Part 2 - Desktop App
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/pdd/part-3-make-exe/" class="md-nav__link">
        Part 3 - Make Executable
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/object-detection/" class="md-nav__link">
        Object Detection
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_4" type="checkbox" id="__nav_3_4" >
      
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_4">
          Applications
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Applications" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_4">
          <span class="md-nav__icon md-icon"></span>
          Applications
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/untitled-project-1/pt/" class="md-nav__link">
        Moblie Game 1
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4">
          Resource
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Resource" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Resource
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../resource/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2" type="checkbox" id="__nav_4_2" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_2">
          Python
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Python" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          Python
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../python/scikit-learn/" class="md-nav__link">
        Scikit-Learn
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../python/matplotlib/" class="md-nav__link">
        Matplotlib
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../python/numpy/" class="md-nav__link">
        Numpy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../python/pandas/" class="md-nav__link">
        Pandas
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../python/mplfinance/" class="md-nav__link">
        mplfinance
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3" type="checkbox" id="__nav_4_3" checked>
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_3">
          TensorFlow
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="TensorFlow" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_3">
          <span class="md-nav__icon md-icon"></span>
          TensorFlow
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3_1" type="checkbox" id="__nav_4_3_1" >
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_3_1">
          TensorFlow Exam
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="TensorFlow Exam" data-md-level="3">
        <label class="md-nav__title" for="__nav_4_3_1">
          <span class="md-nav__icon md-icon"></span>
          TensorFlow Exam
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tf-exam/tf-exam-overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3_1_2" type="checkbox" id="__nav_4_3_1_2" >
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_3_1_2">
          Coursera - DeepLearning.AI TensorFlow Developer
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Coursera - DeepLearning.AI TensorFlow Developer" data-md-level="4">
        <label class="md-nav__title" for="__nav_4_3_1_2">
          <span class="md-nav__icon md-icon"></span>
          Coursera - DeepLearning.AI TensorFlow Developer
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tf-exam/cs-part-1/" class="md-nav__link">
        Part 1 - Introduction to TF
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tf-exam/cs-part-2/" class="md-nav__link">
        Part 2 - CNN in TF
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tf-exam/cs-part-3/" class="md-nav__link">
        Part 3 -  NLP in TF
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tf-exam/cs-part-4/" class="md-nav__link">
        Part 4 - Time Series
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tf-exam/pass-tensorflow-cert/" class="md-nav__link">
        How I past TensorFlow Exam
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tf-model-bp/" class="md-nav__link">
        TensorFlow Blueprint
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3_3" type="checkbox" id="__nav_4_3_3" checked>
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_3_3">
          TensorFlow Models
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="TensorFlow Models" data-md-level="3">
        <label class="md-nav__title" for="__nav_4_3_3">
          <span class="md-nav__icon md-icon"></span>
          TensorFlow Models
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../model-list/" class="md-nav__link">
        List of Models
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3_3_2" type="checkbox" id="__nav_4_3_3_2" >
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_3_3_2">
          Neural Network Regressions
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Neural Network Regressions" data-md-level="4">
        <label class="md-nav__title" for="__nav_4_3_3_2">
          <span class="md-nav__icon md-icon"></span>
          Neural Network Regressions
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../simple-regression/" class="md-nav__link">
        NNR - House Prices
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../regression-boston-housing/" class="md-nav__link">
        NNR - Boston Housing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../titanic/" class="md-nav__link">
        NNR - Titanic
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3_3_3" type="checkbox" id="__nav_4_3_3_3" >
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_3_3_3">
          Image Classification
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Image Classification" data-md-level="4">
        <label class="md-nav__title" for="__nav_4_3_3_3">
          <span class="md-nav__icon md-icon"></span>
          Image Classification
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../basic-fmnist/" class="md-nav__link">
        Basic Image Classification - FMNIST
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../image-classification-dogs-cats/" class="md-nav__link">
        Image Classification - Dogs & Cats
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cnn-fmnist/" class="md-nav__link">
        CNN - FMNIST
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3_3_4" type="checkbox" id="__nav_4_3_3_4" >
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_3_3_4">
          Natural Language Processing
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Natural Language Processing" data-md-level="4">
        <label class="md-nav__title" for="__nav_4_3_3_4">
          <span class="md-nav__icon md-icon"></span>
          Natural Language Processing
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../imdb/" class="md-nav__link">
        NLP - Binary-Class IMDB
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../nlp-1-binary/" class="md-nav__link">
        NLP - Binary-Class Disaster Tweets
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../nlp-2-multi/" class="md-nav__link">
        NLP - Multi-Class PedMed
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../nlp-3-sentiment/" class="md-nav__link">
        NLP - Multi-Class Sentiment Analysis
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3_3_5" type="checkbox" id="__nav_4_3_3_5" checked>
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_3_3_5">
          Time Series
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Time Series" data-md-level="4">
        <label class="md-nav__title" for="__nav_4_3_3_5">
          <span class="md-nav__icon md-icon"></span>
          Time Series
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ts-bitcoin/" class="md-nav__link">
        Time Series - Bitcoin Price Forecast
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Time Series - Weather Forecast
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Time Series - Weather Forecast
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#at-a-glance" class="md-nav__link">
    At a Glance
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#import-dependencies" class="md-nav__link">
    Import Dependencies
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utility-functions" class="md-nav__link">
    Utility Functions
  </a>
  
    <nav class="md-nav" aria-label="Utility Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#plot_time_series" class="md-nav__link">
    plot_time_series()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mean_absolute_scaled_error" class="md-nav__link">
    mean_absolute_scaled_error()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate_preds" class="md-nav__link">
    evaluate_preds()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_labelled_windows" class="md-nav__link">
    get_labelled_windows()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#make_windows" class="md-nav__link">
    make_windows()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#windowgenerator" class="md-nav__link">
    WindowGenerator()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#split_window" class="md-nav__link">
    split_window()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#make_dataset" class="md-nav__link">
    make_dataset()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#make_train_test_splits" class="md-nav__link">
    make_train_test_splits()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create_model_checkpoint" class="md-nav__link">
    create_model_checkpoint()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#make_preds" class="md-nav__link">
    make_preds()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate_preds_1" class="md-nav__link">
    evaluate_preds()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#make_ensemble_preds" class="md-nav__link">
    make_ensemble_preds()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_upper_lower" class="md-nav__link">
    get_upper_lower()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#callbacks" class="md-nav__link">
    Callbacks
  </a>
  
    <nav class="md-nav" aria-label="Callbacks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#early_stopping" class="md-nav__link">
    early_stopping
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prepare-data" class="md-nav__link">
    Prepare Data
  </a>
  
    <nav class="md-nav" aria-label="Prepare Data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#download-data" class="md-nav__link">
    Download Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inspect-data" class="md-nav__link">
    Inspect Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prepare-data_1" class="md-nav__link">
    Prepare Data
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-0-naive-forecast" class="md-nav__link">
    Model 0: Naive Forecast
  </a>
  
    <nav class="md-nav" aria-label="Model 0: Naive Forecast">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adjust-data" class="md-nav__link">
    Adjust Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-compile-and-run-model" class="md-nav__link">
    Create, Compile, and Run Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate-model" class="md-nav__link">
    Evaluate Model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-1-dense-window30-horizon7" class="md-nav__link">
    Model 1: Dense (window=30, horizon=7)
  </a>
  
    <nav class="md-nav" aria-label="Model 1: Dense (window=30, horizon=7)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adjust-data_1" class="md-nav__link">
    Adjust Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-compile-and-run-model_1" class="md-nav__link">
    Create, Compile, and Run Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate-model_1" class="md-nav__link">
    Evaluate Model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-2-conv1d" class="md-nav__link">
    Model 2: Conv1D
  </a>
  
    <nav class="md-nav" aria-label="Model 2: Conv1D">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adjust-data_2" class="md-nav__link">
    Adjust Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-compile-and-run-model_2" class="md-nav__link">
    Create, Compile, and Run Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate-model_2" class="md-nav__link">
    Evaluate Model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-3-rnn-lstm" class="md-nav__link">
    Model 3: RNN (LSTM)
  </a>
  
    <nav class="md-nav" aria-label="Model 3: RNN (LSTM)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adjust-data_3" class="md-nav__link">
    Adjust Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-compile-and-run-model_3" class="md-nav__link">
    Create, Compile, and Run Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate-model_3" class="md-nav__link">
    Evaluate Model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-4-multivariate-time-series-model" class="md-nav__link">
    Model 4: Multivariate Time Series Model
  </a>
  
    <nav class="md-nav" aria-label="Model 4: Multivariate Time Series Model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adjust-data_4" class="md-nav__link">
    Adjust Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-compile-and-run-model_4" class="md-nav__link">
    Create, Compile, and Run Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate-model_4" class="md-nav__link">
    Evaluate Model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compare-models" class="md-nav__link">
    Compare Models
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#make-predictions" class="md-nav__link">
    Make Predictions
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3_3_6" type="checkbox" id="__nav_4_3_3_6" >
      
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_3_3_6">
          Miscellaneous
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Miscellaneous" data-md-level="4">
        <label class="md-nav__title" for="__nav_4_3_3_6">
          <span class="md-nav__icon md-icon"></span>
          Miscellaneous
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utilities/" class="md-nav__link">
        Utility Functions
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_4" type="checkbox" id="__nav_4_4" >
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_4">
          Microsoft Certification
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Microsoft Certification" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_4">
          <span class="md-nav__icon md-icon"></span>
          Microsoft Certification
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ms/ms-overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ms/az-900/" class="md-nav__link">
        Azure Fundamentals
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ms/ai-900/" class="md-nav__link">
        Azure AI Fundamentals
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ms/dp-900/" class="md-nav__link">
        Azure Data Fundamentals
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#at-a-glance" class="md-nav__link">
    At a Glance
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#import-dependencies" class="md-nav__link">
    Import Dependencies
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utility-functions" class="md-nav__link">
    Utility Functions
  </a>
  
    <nav class="md-nav" aria-label="Utility Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#plot_time_series" class="md-nav__link">
    plot_time_series()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mean_absolute_scaled_error" class="md-nav__link">
    mean_absolute_scaled_error()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate_preds" class="md-nav__link">
    evaluate_preds()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_labelled_windows" class="md-nav__link">
    get_labelled_windows()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#make_windows" class="md-nav__link">
    make_windows()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#windowgenerator" class="md-nav__link">
    WindowGenerator()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#split_window" class="md-nav__link">
    split_window()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#make_dataset" class="md-nav__link">
    make_dataset()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#make_train_test_splits" class="md-nav__link">
    make_train_test_splits()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create_model_checkpoint" class="md-nav__link">
    create_model_checkpoint()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#make_preds" class="md-nav__link">
    make_preds()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate_preds_1" class="md-nav__link">
    evaluate_preds()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#make_ensemble_preds" class="md-nav__link">
    make_ensemble_preds()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_upper_lower" class="md-nav__link">
    get_upper_lower()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#callbacks" class="md-nav__link">
    Callbacks
  </a>
  
    <nav class="md-nav" aria-label="Callbacks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#early_stopping" class="md-nav__link">
    early_stopping
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prepare-data" class="md-nav__link">
    Prepare Data
  </a>
  
    <nav class="md-nav" aria-label="Prepare Data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#download-data" class="md-nav__link">
    Download Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inspect-data" class="md-nav__link">
    Inspect Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prepare-data_1" class="md-nav__link">
    Prepare Data
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-0-naive-forecast" class="md-nav__link">
    Model 0: Naive Forecast
  </a>
  
    <nav class="md-nav" aria-label="Model 0: Naive Forecast">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adjust-data" class="md-nav__link">
    Adjust Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-compile-and-run-model" class="md-nav__link">
    Create, Compile, and Run Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate-model" class="md-nav__link">
    Evaluate Model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-1-dense-window30-horizon7" class="md-nav__link">
    Model 1: Dense (window=30, horizon=7)
  </a>
  
    <nav class="md-nav" aria-label="Model 1: Dense (window=30, horizon=7)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adjust-data_1" class="md-nav__link">
    Adjust Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-compile-and-run-model_1" class="md-nav__link">
    Create, Compile, and Run Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate-model_1" class="md-nav__link">
    Evaluate Model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-2-conv1d" class="md-nav__link">
    Model 2: Conv1D
  </a>
  
    <nav class="md-nav" aria-label="Model 2: Conv1D">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adjust-data_2" class="md-nav__link">
    Adjust Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-compile-and-run-model_2" class="md-nav__link">
    Create, Compile, and Run Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate-model_2" class="md-nav__link">
    Evaluate Model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-3-rnn-lstm" class="md-nav__link">
    Model 3: RNN (LSTM)
  </a>
  
    <nav class="md-nav" aria-label="Model 3: RNN (LSTM)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adjust-data_3" class="md-nav__link">
    Adjust Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-compile-and-run-model_3" class="md-nav__link">
    Create, Compile, and Run Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate-model_3" class="md-nav__link">
    Evaluate Model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-4-multivariate-time-series-model" class="md-nav__link">
    Model 4: Multivariate Time Series Model
  </a>
  
    <nav class="md-nav" aria-label="Model 4: Multivariate Time Series Model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adjust-data_4" class="md-nav__link">
    Adjust Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-compile-and-run-model_4" class="md-nav__link">
    Create, Compile, and Run Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate-model_4" class="md-nav__link">
    Evaluate Model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compare-models" class="md-nav__link">
    Compare Models
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#make-predictions" class="md-nav__link">
    Make Predictions
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

<h1 id="time-series-weather-forecast">Time Series - Weather Forecast</h1>
<h2 id="at-a-glance"><b>At a Glance</b></h2>
<details class="example" open="open">
<summary>What to expect</summary>
<ul>
<li><a href="#model-0">Model 0: Naive Forecast</a></li>
<li><a href="#model-1">Model 1: Dense (window=7, horizon=1)</a></li>
<li><a href="#model-2">Model 2: Dense (window=30, horizon=1)</a></li>
<li><a href="#model-3">Model 3: Dense (window=30, horizon=7)</a></li>
<li><a href="#model-4">Model 4: Multivariate Model</a></li>
<li><a href="#compare-models">Compare Models</a></li>
<li><a href="#prediction">Make Prediction</a></li>
</ul>
</details>
<p><a name="import"></a></p>
<h2 id="import-dependencies"><strong>Import Dependencies</strong></h2>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-0-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-0-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-0-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-0-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="kn">import</span> <span class="nn">random</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="kn">import</span> <span class="nn">os</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="kn">import</span> <span class="nn">matplotlib.image</span> <span class="k">as</span> <span class="nn">mpimg</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="c1"># tensorflow dataset</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="kn">import</span> <span class="nn">tensorflow_datasets</span> <span class="k">as</span> <span class="nn">tfds</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="kn">import</span> <span class="nn">csv</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="c1"># import wget as wget # only for PyCharm</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="kn">import</span> <span class="nn">zipfile</span> <span class="k">as</span> <span class="nn">zf</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="kn">import</span> <span class="nn">pathlib</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="kn">import</span> <span class="nn">random</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="c1"># Used in Prepare the data</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.layers.experimental.preprocessing</span> <span class="kn">import</span> <span class="n">TextVectorization</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.preprocessing.image</span> <span class="kn">import</span> <span class="n">ImageDataGenerator</span> <span class="c1"># Use for preprocessing the data</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span><span class="p">,</span> <span class="n">LabelEncoder</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="c1"># Use in the model</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.models</span> <span class="kn">import</span> <span class="n">Sequential</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">Conv2D</span><span class="p">,</span> <span class="n">MaxPool2D</span><span class="p">,</span> <span class="n">Flatten</span><span class="p">,</span> <span class="n">Dense</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="kn">import</span> <span class="nn">tensorflow_hub</span> <span class="k">as</span> <span class="nn">hub</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.layers.experimental</span> <span class="kn">import</span> <span class="n">preprocessing</span> <span class="c1"># for data augmentation</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="kn">from</span> <span class="nn">sklearn.naive_bayes</span> <span class="kn">import</span> <span class="n">MultinomialNB</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.utils</span> <span class="kn">import</span> <span class="n">plot_model</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="c1"># Evaluate model</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span><span class="p">,</span> <span class="n">classification_report</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">precision_recall_fscore_support</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="c1"># Utility scripts (confusion matrix)</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="kn">import</span> <span class="nn">itertools</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">confusion_matrix</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="c1"># mixed_precision</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="kn">from</span> <span class="nn">tensorflow.keras</span> <span class="kn">import</span> <span class="n">mixed_precision</span>
</code></pre></div>
</td></tr></table>
<p><a name="utils"></a></p>
<h2 id="utility-functions"><strong>Utility Functions</strong></h2>
<p><a name=""></a></p>
<h3 id="plot_time_series">plot_time_series()</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-1-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-1-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-1-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-1-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-1-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-1-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-1-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-1-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-1-10">10</a></span>
<span class="normal"><a href="#__codelineno-1-11">11</a></span>
<span class="normal"><a href="#__codelineno-1-12">12</a></span>
<span class="normal"><a href="#__codelineno-1-13">13</a></span>
<span class="normal"><a href="#__codelineno-1-14">14</a></span>
<span class="normal"><a href="#__codelineno-1-15">15</a></span>
<span class="normal"><a href="#__codelineno-1-16">16</a></span>
<span class="normal"><a href="#__codelineno-1-17">17</a></span>
<span class="normal"><a href="#__codelineno-1-18">18</a></span>
<span class="normal"><a href="#__codelineno-1-19">19</a></span>
<span class="normal"><a href="#__codelineno-1-20">20</a></span>
<span class="normal"><a href="#__codelineno-1-21">21</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="c1"># Create a function to plot time series data</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="k">def</span> <span class="nf">plot_time_series</span><span class="p">(</span><span class="n">timesteps</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a>  <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="sd">  Plots a timesteps (a series of points in time) against values (a series of values across timesteps).</span>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="sd">  Parameters</span>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="sd">  ---------</span>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="sd">  timesteps : array of timesteps</span>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="sd">  values : array of values across time</span>
<a id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="sd">  format : style of plot, default &quot;.&quot;</span>
<a id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="sd">  start : where to start the plot (setting a value will index from start of timesteps &amp; values)</span>
<a id="__codelineno-1-12" name="__codelineno-1-12"></a><span class="sd">  end : where to end the plot (setting a value will index from end of timesteps &amp; values)</span>
<a id="__codelineno-1-13" name="__codelineno-1-13"></a><span class="sd">  label : label to show on plot of values</span>
<a id="__codelineno-1-14" name="__codelineno-1-14"></a><span class="sd">  &quot;&quot;&quot;</span>
<a id="__codelineno-1-15" name="__codelineno-1-15"></a>  <span class="c1"># Plot the series</span>
<a id="__codelineno-1-16" name="__codelineno-1-16"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timesteps</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">],</span> <span class="nb">format</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
<a id="__codelineno-1-17" name="__codelineno-1-17"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">)</span>
<a id="__codelineno-1-18" name="__codelineno-1-18"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;BTC Price&quot;</span><span class="p">)</span>
<a id="__codelineno-1-19" name="__codelineno-1-19"></a>  <span class="k">if</span> <span class="n">label</span><span class="p">:</span>
<a id="__codelineno-1-20" name="__codelineno-1-20"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span> <span class="c1"># make label bigger</span>
<a id="__codelineno-1-21" name="__codelineno-1-21"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<p><a name=""></a></p>
<h3 id="mean_absolute_scaled_error">mean_absolute_scaled_error()</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-2-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-2-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-2-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-2-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-2-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-2-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-2-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-2-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-2-10">10</a></span>
<span class="normal"><a href="#__codelineno-2-11">11</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="c1"># MASE implemented courtesy of sktime - https://github.com/alan-turing-institute/sktime/blob/ee7a06843a44f4aaec7582d847e36073a9ab0566/sktime/performance_metrics/forecasting/_functions.py#L16</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="k">def</span> <span class="nf">mean_absolute_scaled_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a>  <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="sd">  Implement MASE (assuming no seasonality of data).</span>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="sd">  &quot;&quot;&quot;</span>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a>  <span class="n">mae</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_true</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">))</span>
<a id="__codelineno-2-7" name="__codelineno-2-7"></a>
<a id="__codelineno-2-8" name="__codelineno-2-8"></a>  <span class="c1"># Find MAE of naive forecast (no seasonality)</span>
<a id="__codelineno-2-9" name="__codelineno-2-9"></a>  <span class="n">mae_naive_no_season</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_true</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">y_true</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span> <span class="c1"># our seasonality is 1 day (hence the shifting of 1 day)</span>
<a id="__codelineno-2-10" name="__codelineno-2-10"></a>
<a id="__codelineno-2-11" name="__codelineno-2-11"></a>  <span class="k">return</span> <span class="n">mae</span> <span class="o">/</span> <span class="n">mae_naive_no_season</span>
</code></pre></div>
</td></tr></table>
<p><a name=""></a></p>
<h3 id="evaluate_preds">evaluate_preds()</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-3-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-3-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-3-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-3-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-3-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-3-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-3-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-3-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-3-10">10</a></span>
<span class="normal"><a href="#__codelineno-3-11">11</a></span>
<span class="normal"><a href="#__codelineno-3-12">12</a></span>
<span class="normal"><a href="#__codelineno-3-13">13</a></span>
<span class="normal"><a href="#__codelineno-3-14">14</a></span>
<span class="normal"><a href="#__codelineno-3-15">15</a></span>
<span class="normal"><a href="#__codelineno-3-16">16</a></span>
<span class="normal"><a href="#__codelineno-3-17">17</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="k">def</span> <span class="nf">evaluate_preds</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a>  <span class="c1"># Make sure float32 (for metric calculations)</span>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a>  <span class="n">y_true</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a>  <span class="n">y_pred</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a>
<a id="__codelineno-3-6" name="__codelineno-3-6"></a>  <span class="c1"># Calculate various metrics</span>
<a id="__codelineno-3-7" name="__codelineno-3-7"></a>  <span class="n">mae</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<a id="__codelineno-3-8" name="__codelineno-3-8"></a>  <span class="n">mse</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span> <span class="c1"># puts and emphasis on outliers (all errors get squared)</span>
<a id="__codelineno-3-9" name="__codelineno-3-9"></a>  <span class="n">rmse</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mse</span><span class="p">)</span>
<a id="__codelineno-3-10" name="__codelineno-3-10"></a>  <span class="n">mape</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_percentage_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<a id="__codelineno-3-11" name="__codelineno-3-11"></a>  <span class="n">mase</span> <span class="o">=</span> <span class="n">mean_absolute_scaled_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<a id="__codelineno-3-12" name="__codelineno-3-12"></a>
<a id="__codelineno-3-13" name="__codelineno-3-13"></a>  <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;mae&quot;</span><span class="p">:</span> <span class="n">mae</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-3-14" name="__codelineno-3-14"></a>          <span class="s2">&quot;mse&quot;</span><span class="p">:</span> <span class="n">mse</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-3-15" name="__codelineno-3-15"></a>          <span class="s2">&quot;rmse&quot;</span><span class="p">:</span> <span class="n">rmse</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-3-16" name="__codelineno-3-16"></a>          <span class="s2">&quot;mape&quot;</span><span class="p">:</span> <span class="n">mape</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-3-17" name="__codelineno-3-17"></a>          <span class="s2">&quot;mase&quot;</span><span class="p">:</span> <span class="n">mase</span><span class="o">.</span><span class="n">numpy</span><span class="p">()}</span>
</code></pre></div>
</td></tr></table>
<p><a name=""></a></p>
<h3 id="get_labelled_windows">get_labelled_windows()</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span>
<span class="normal"><a href="#__codelineno-4-2">2</a></span>
<span class="normal"><a href="#__codelineno-4-3">3</a></span>
<span class="normal"><a href="#__codelineno-4-4">4</a></span>
<span class="normal"><a href="#__codelineno-4-5">5</a></span>
<span class="normal"><a href="#__codelineno-4-6">6</a></span>
<span class="normal"><a href="#__codelineno-4-7">7</a></span>
<span class="normal"><a href="#__codelineno-4-8">8</a></span>
<span class="normal"><a href="#__codelineno-4-9">9</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="c1"># Create function to label windowed data</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="k">def</span> <span class="nf">get_labelled_windows</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">horizon</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a>  <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="sd">  Creates labels for windowed dataset.</span>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a><span class="sd">  E.g. if horizon=1 (default)</span>
<a id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="sd">  Input: [1, 2, 3, 4, 5, 6] -&gt; Output: ([1, 2, 3, 4, 5], [6])</span>
<a id="__codelineno-4-8" name="__codelineno-4-8"></a><span class="sd">  &quot;&quot;&quot;</span>
<a id="__codelineno-4-9" name="__codelineno-4-9"></a>  <span class="k">return</span> <span class="n">x</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="n">horizon</span><span class="p">],</span> <span class="n">x</span><span class="p">[:,</span> <span class="o">-</span><span class="n">horizon</span><span class="p">:]</span>
</code></pre></div>
</td></tr></table>
<p><a name=""></a></p>
<h3 id="make_windows">make_windows()</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-5-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-5-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-5-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-5-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-5-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-5-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-5-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-5-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-5-10">10</a></span>
<span class="normal"><a href="#__codelineno-5-11">11</a></span>
<span class="normal"><a href="#__codelineno-5-12">12</a></span>
<span class="normal"><a href="#__codelineno-5-13">13</a></span>
<span class="normal"><a href="#__codelineno-5-14">14</a></span>
<span class="normal"><a href="#__codelineno-5-15">15</a></span>
<span class="normal"><a href="#__codelineno-5-16">16</a></span>
<span class="normal"><a href="#__codelineno-5-17">17</a></span>
<span class="normal"><a href="#__codelineno-5-18">18</a></span>
<span class="normal"><a href="#__codelineno-5-19">19</a></span>
<span class="normal"><a href="#__codelineno-5-20">20</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="c1"># Create function to view NumPy arrays as windows </span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="k">def</span> <span class="nf">make_windows</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">window_size</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">horizon</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a>  <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="sd">  Turns a 1D array into a 2D array of sequential windows of window_size.</span>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="sd">  &quot;&quot;&quot;</span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a>  <span class="c1"># 1. Create a window of specific window_size (add the horizon on the end for later labelling)</span>
<a id="__codelineno-5-7" name="__codelineno-5-7"></a>  <span class="n">window_step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">window_size</span><span class="o">+</span><span class="n">horizon</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-5-8" name="__codelineno-5-8"></a>  <span class="c1"># print(f&quot;Window step:\n {window_step}&quot;)</span>
<a id="__codelineno-5-9" name="__codelineno-5-9"></a>
<a id="__codelineno-5-10" name="__codelineno-5-10"></a>  <span class="c1"># 2. Create a 2D array of multiple window steps (minus 1 to account for 0 indexing)</span>
<a id="__codelineno-5-11" name="__codelineno-5-11"></a>  <span class="n">window_indexes</span> <span class="o">=</span> <span class="n">window_step</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">window_size</span><span class="o">+</span><span class="n">horizon</span><span class="o">-</span><span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="c1"># create 2D array of windows of size window_size</span>
<a id="__codelineno-5-12" name="__codelineno-5-12"></a>  <span class="c1"># print(f&quot;Window indexes:\n {window_indexes[:3], window_indexes[-3:], window_indexes.shape}&quot;)</span>
<a id="__codelineno-5-13" name="__codelineno-5-13"></a>
<a id="__codelineno-5-14" name="__codelineno-5-14"></a>  <span class="c1"># 3. Index on the target array (time series) with 2D array of multiple window steps</span>
<a id="__codelineno-5-15" name="__codelineno-5-15"></a>  <span class="n">windowed_array</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">window_indexes</span><span class="p">]</span>
<a id="__codelineno-5-16" name="__codelineno-5-16"></a>
<a id="__codelineno-5-17" name="__codelineno-5-17"></a>  <span class="c1"># 4. Get the labelled windows</span>
<a id="__codelineno-5-18" name="__codelineno-5-18"></a>  <span class="n">windows</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">get_labelled_windows</span><span class="p">(</span><span class="n">windowed_array</span><span class="p">,</span> <span class="n">horizon</span><span class="o">=</span><span class="n">horizon</span><span class="p">)</span>
<a id="__codelineno-5-19" name="__codelineno-5-19"></a>
<a id="__codelineno-5-20" name="__codelineno-5-20"></a>  <span class="k">return</span> <span class="n">windows</span><span class="p">,</span> <span class="n">labels</span>
</code></pre></div>
</td></tr></table>
<p><a name=""></a></p>
<h3 id="windowgenerator">WindowGenerator()</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-6-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-6-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-6-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-6-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-6-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-6-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-6-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-6-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-6-10">10</a></span>
<span class="normal"><a href="#__codelineno-6-11">11</a></span>
<span class="normal"><a href="#__codelineno-6-12">12</a></span>
<span class="normal"><a href="#__codelineno-6-13">13</a></span>
<span class="normal"><a href="#__codelineno-6-14">14</a></span>
<span class="normal"><a href="#__codelineno-6-15">15</a></span>
<span class="normal"><a href="#__codelineno-6-16">16</a></span>
<span class="normal"><a href="#__codelineno-6-17">17</a></span>
<span class="normal"><a href="#__codelineno-6-18">18</a></span>
<span class="normal"><a href="#__codelineno-6-19">19</a></span>
<span class="normal"><a href="#__codelineno-6-20">20</a></span>
<span class="normal"><a href="#__codelineno-6-21">21</a></span>
<span class="normal"><a href="#__codelineno-6-22">22</a></span>
<span class="normal"><a href="#__codelineno-6-23">23</a></span>
<span class="normal"><a href="#__codelineno-6-24">24</a></span>
<span class="normal"><a href="#__codelineno-6-25">25</a></span>
<span class="normal"><a href="#__codelineno-6-26">26</a></span>
<span class="normal"><a href="#__codelineno-6-27">27</a></span>
<span class="normal"><a href="#__codelineno-6-28">28</a></span>
<span class="normal"><a href="#__codelineno-6-29">29</a></span>
<span class="normal"><a href="#__codelineno-6-30">30</a></span>
<span class="normal"><a href="#__codelineno-6-31">31</a></span>
<span class="normal"><a href="#__codelineno-6-32">32</a></span>
<span class="normal"><a href="#__codelineno-6-33">33</a></span>
<span class="normal"><a href="#__codelineno-6-34">34</a></span>
<span class="normal"><a href="#__codelineno-6-35">35</a></span>
<span class="normal"><a href="#__codelineno-6-36">36</a></span>
<span class="normal"><a href="#__codelineno-6-37">37</a></span>
<span class="normal"><a href="#__codelineno-6-38">38</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="k">class</span> <span class="nc">WindowGenerator</span><span class="p">():</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_width</span><span class="p">,</span> <span class="n">label_width</span><span class="p">,</span> <span class="n">shift</span><span class="p">,</span>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a>               <span class="n">train_df</span><span class="o">=</span><span class="n">train_df</span><span class="p">,</span> <span class="n">val_df</span><span class="o">=</span><span class="n">val_df</span><span class="p">,</span> 
<a id="__codelineno-6-4" name="__codelineno-6-4"></a>              <span class="c1">#  test_df=test_df, # optional</span>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a>               <span class="n">label_columns</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-6-6" name="__codelineno-6-6"></a>    <span class="c1"># Store the raw data.</span>
<a id="__codelineno-6-7" name="__codelineno-6-7"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">train_df</span> <span class="o">=</span> <span class="n">train_df</span>
<a id="__codelineno-6-8" name="__codelineno-6-8"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">val_df</span> <span class="o">=</span> <span class="n">val_df</span>
<a id="__codelineno-6-9" name="__codelineno-6-9"></a>    <span class="c1"># self.test_df = test_df # optional</span>
<a id="__codelineno-6-10" name="__codelineno-6-10"></a>
<a id="__codelineno-6-11" name="__codelineno-6-11"></a>    <span class="c1"># Work out the label column indices.</span>
<a id="__codelineno-6-12" name="__codelineno-6-12"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">label_columns</span> <span class="o">=</span> <span class="n">label_columns</span>
<a id="__codelineno-6-13" name="__codelineno-6-13"></a>    <span class="k">if</span> <span class="n">label_columns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-6-14" name="__codelineno-6-14"></a>      <span class="bp">self</span><span class="o">.</span><span class="n">label_columns_indices</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span>
<a id="__codelineno-6-15" name="__codelineno-6-15"></a>                                    <span class="nb">enumerate</span><span class="p">(</span><span class="n">label_columns</span><span class="p">)}</span>
<a id="__codelineno-6-16" name="__codelineno-6-16"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">column_indices</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span>
<a id="__codelineno-6-17" name="__codelineno-6-17"></a>                           <span class="nb">enumerate</span><span class="p">(</span><span class="n">train_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)}</span>
<a id="__codelineno-6-18" name="__codelineno-6-18"></a>
<a id="__codelineno-6-19" name="__codelineno-6-19"></a>    <span class="c1"># Work out the window parameters.</span>
<a id="__codelineno-6-20" name="__codelineno-6-20"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">input_width</span> <span class="o">=</span> <span class="n">input_width</span>
<a id="__codelineno-6-21" name="__codelineno-6-21"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">label_width</span> <span class="o">=</span> <span class="n">label_width</span>
<a id="__codelineno-6-22" name="__codelineno-6-22"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">shift</span> <span class="o">=</span> <span class="n">shift</span>
<a id="__codelineno-6-23" name="__codelineno-6-23"></a>
<a id="__codelineno-6-24" name="__codelineno-6-24"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">total_window_size</span> <span class="o">=</span> <span class="n">input_width</span> <span class="o">+</span> <span class="n">shift</span>
<a id="__codelineno-6-25" name="__codelineno-6-25"></a>
<a id="__codelineno-6-26" name="__codelineno-6-26"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">input_slice</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">input_width</span><span class="p">)</span>
<a id="__codelineno-6-27" name="__codelineno-6-27"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">input_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_window_size</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">input_slice</span><span class="p">]</span>
<a id="__codelineno-6-28" name="__codelineno-6-28"></a>
<a id="__codelineno-6-29" name="__codelineno-6-29"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_window_size</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_width</span>
<a id="__codelineno-6-30" name="__codelineno-6-30"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">labels_slice</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label_start</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-6-31" name="__codelineno-6-31"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">label_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_window_size</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">labels_slice</span><span class="p">]</span>
<a id="__codelineno-6-32" name="__codelineno-6-32"></a>
<a id="__codelineno-6-33" name="__codelineno-6-33"></a>  <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-6-34" name="__codelineno-6-34"></a>    <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
<a id="__codelineno-6-35" name="__codelineno-6-35"></a>        <span class="sa">f</span><span class="s1">&#39;Total window size: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">total_window_size</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
<a id="__codelineno-6-36" name="__codelineno-6-36"></a>        <span class="sa">f</span><span class="s1">&#39;Input indices: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">input_indices</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
<a id="__codelineno-6-37" name="__codelineno-6-37"></a>        <span class="sa">f</span><span class="s1">&#39;Label indices: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label_indices</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
<a id="__codelineno-6-38" name="__codelineno-6-38"></a>        <span class="sa">f</span><span class="s1">&#39;Label column name(s): </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label_columns</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">])</span>
</code></pre></div>
</td></tr></table>
<p><a name=""></a></p>
<h3 id="split_window">split_window()</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-7-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-7-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-7-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-7-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-7-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-7-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-7-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-7-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-7-10">10</a></span>
<span class="normal"><a href="#__codelineno-7-11">11</a></span>
<span class="normal"><a href="#__codelineno-7-12">12</a></span>
<span class="normal"><a href="#__codelineno-7-13">13</a></span>
<span class="normal"><a href="#__codelineno-7-14">14</a></span>
<span class="normal"><a href="#__codelineno-7-15">15</a></span>
<span class="normal"><a href="#__codelineno-7-16">16</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="k">def</span> <span class="nf">split_window</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">):</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a>  <span class="n">inputs</span> <span class="o">=</span> <span class="n">features</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_slice</span><span class="p">,</span> <span class="p">:]</span>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a>  <span class="n">labels</span> <span class="o">=</span> <span class="n">features</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels_slice</span><span class="p">,</span> <span class="p">:]</span>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a>  <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_columns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-7-5" name="__codelineno-7-5"></a>    <span class="n">labels</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span>
<a id="__codelineno-7-6" name="__codelineno-7-6"></a>        <span class="p">[</span><span class="n">labels</span><span class="p">[:,</span> <span class="p">:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_indices</span><span class="p">[</span><span class="n">name</span><span class="p">]]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_columns</span><span class="p">],</span>
<a id="__codelineno-7-7" name="__codelineno-7-7"></a>        <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-7-8" name="__codelineno-7-8"></a>
<a id="__codelineno-7-9" name="__codelineno-7-9"></a>  <span class="c1"># Slicing doesn&#39;t preserve static shape information, so set the shapes</span>
<a id="__codelineno-7-10" name="__codelineno-7-10"></a>  <span class="c1"># manually. This way the `tf.data.Datasets` are easier to inspect.</span>
<a id="__codelineno-7-11" name="__codelineno-7-11"></a>  <span class="n">inputs</span><span class="o">.</span><span class="n">set_shape</span><span class="p">([</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_width</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-7-12" name="__codelineno-7-12"></a>  <span class="n">labels</span><span class="o">.</span><span class="n">set_shape</span><span class="p">([</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_width</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-7-13" name="__codelineno-7-13"></a>
<a id="__codelineno-7-14" name="__codelineno-7-14"></a>  <span class="k">return</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">labels</span>
<a id="__codelineno-7-15" name="__codelineno-7-15"></a>
<a id="__codelineno-7-16" name="__codelineno-7-16"></a><span class="n">WindowGenerator</span><span class="o">.</span><span class="n">split_window</span> <span class="o">=</span> <span class="n">split_window</span>
</code></pre></div>
</td></tr></table>
<p><a name=""></a></p>
<h3 id="make_dataset">make_dataset()</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-8-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-8-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-8-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-8-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-8-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-8-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-8-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-8-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-8-10">10</a></span>
<span class="normal"><a href="#__codelineno-8-11">11</a></span>
<span class="normal"><a href="#__codelineno-8-12">12</a></span>
<span class="normal"><a href="#__codelineno-8-13">13</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="k">def</span> <span class="nf">make_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a>  <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a>  <span class="n">ds</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">timeseries_dataset_from_array</span><span class="p">(</span>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a>      <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
<a id="__codelineno-8-5" name="__codelineno-8-5"></a>      <span class="n">targets</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-8-6" name="__codelineno-8-6"></a>      <span class="n">sequence_length</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">total_window_size</span><span class="p">,</span>
<a id="__codelineno-8-7" name="__codelineno-8-7"></a>      <span class="n">sequence_stride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-8-8" name="__codelineno-8-8"></a>      <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-8-9" name="__codelineno-8-9"></a>      <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,)</span>
<a id="__codelineno-8-10" name="__codelineno-8-10"></a>
<a id="__codelineno-8-11" name="__codelineno-8-11"></a>  <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">split_window</span><span class="p">)</span>
<a id="__codelineno-8-12" name="__codelineno-8-12"></a>
<a id="__codelineno-8-13" name="__codelineno-8-13"></a>  <span class="k">return</span> <span class="n">ds</span>
</code></pre></div>
</td></tr></table>
<p><a name=""></a></p>
<h3 id="make_train_test_splits">make_train_test_splits()</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-9-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-9-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-9-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-9-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-9-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-9-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-9-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-9-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-9-10">10</a></span>
<span class="normal"><a href="#__codelineno-9-11">11</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="c1"># Make the train/test splits</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="k">def</span> <span class="nf">make_train_test_splits</span><span class="p">(</span><span class="n">windows</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">test_split</span><span class="o">=</span><span class="mf">0.2</span><span class="p">):</span>
<a id="__codelineno-9-3" name="__codelineno-9-3"></a>  <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="sd">  Splits matching pairs of windows and labels into train and test splits.</span>
<a id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="sd">  &quot;&quot;&quot;</span>
<a id="__codelineno-9-6" name="__codelineno-9-6"></a>  <span class="n">split_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">windows</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">test_split</span><span class="p">))</span> <span class="c1"># this will default to 80% train/20% test</span>
<a id="__codelineno-9-7" name="__codelineno-9-7"></a>  <span class="n">train_windows</span> <span class="o">=</span> <span class="n">windows</span><span class="p">[:</span><span class="n">split_size</span><span class="p">]</span>
<a id="__codelineno-9-8" name="__codelineno-9-8"></a>  <span class="n">train_labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[:</span><span class="n">split_size</span><span class="p">]</span>
<a id="__codelineno-9-9" name="__codelineno-9-9"></a>  <span class="n">test_windows</span> <span class="o">=</span> <span class="n">windows</span><span class="p">[</span><span class="n">split_size</span><span class="p">:]</span>
<a id="__codelineno-9-10" name="__codelineno-9-10"></a>  <span class="n">test_labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">split_size</span><span class="p">:]</span>
<a id="__codelineno-9-11" name="__codelineno-9-11"></a>  <span class="k">return</span> <span class="n">train_windows</span><span class="p">,</span> <span class="n">test_windows</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">test_labels</span>
</code></pre></div>
</td></tr></table>
<p><a name=""></a></p>
<h3 id="create_model_checkpoint">create_model_checkpoint()</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1">1</a></span>
<span class="normal"><a href="#__codelineno-10-2">2</a></span>
<span class="normal"><a href="#__codelineno-10-3">3</a></span>
<span class="normal"><a href="#__codelineno-10-4">4</a></span>
<span class="normal"><a href="#__codelineno-10-5">5</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="c1"># Create a function to implement a ModelCheckpoint callback with a specific filename </span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="k">def</span> <span class="nf">create_model_checkpoint</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="s2">&quot;model_experiments&quot;</span><span class="p">):</span>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a>  <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">ModelCheckpoint</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">model_name</span><span class="p">),</span> <span class="c1"># create filepath to save model</span>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a>                                            <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="c1"># only output a limited amount of text</span>
<a id="__codelineno-10-5" name="__codelineno-10-5"></a>                                            <span class="n">save_best_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># save only the best model to file</span>
</code></pre></div>
</td></tr></table>
<p><a name=""></a></p>
<h3 id="make_preds">make_preds()</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-11-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-11-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-11-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-11-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-11-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-11-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-11-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-11-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-11-10">10</a></span>
<span class="normal"><a href="#__codelineno-11-11">11</a></span>
<span class="normal"><a href="#__codelineno-11-12">12</a></span>
<span class="normal"><a href="#__codelineno-11-13">13</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="k">def</span> <span class="nf">make_preds</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">input_data</span><span class="p">):</span>
<a id="__codelineno-11-2" name="__codelineno-11-2"></a>  <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="sd">  Uses model to make predictions on input_data.</span>
<a id="__codelineno-11-4" name="__codelineno-11-4"></a>
<a id="__codelineno-11-5" name="__codelineno-11-5"></a><span class="sd">  Parameters</span>
<a id="__codelineno-11-6" name="__codelineno-11-6"></a><span class="sd">  ----------</span>
<a id="__codelineno-11-7" name="__codelineno-11-7"></a><span class="sd">  model: trained model </span>
<a id="__codelineno-11-8" name="__codelineno-11-8"></a><span class="sd">  input_data: windowed input data (same kind of data model was trained on)</span>
<a id="__codelineno-11-9" name="__codelineno-11-9"></a>
<a id="__codelineno-11-10" name="__codelineno-11-10"></a><span class="sd">  Returns model predictions on input_data.</span>
<a id="__codelineno-11-11" name="__codelineno-11-11"></a><span class="sd">  &quot;&quot;&quot;</span>
<a id="__codelineno-11-12" name="__codelineno-11-12"></a>  <span class="n">forecast</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span>
<a id="__codelineno-11-13" name="__codelineno-11-13"></a>  <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">forecast</span><span class="p">)</span> <span class="c1"># return 1D array of predictions</span>
</code></pre></div>
</td></tr></table>
<p><a name=""></a></p>
<h3 id="evaluate_preds_1">evaluate_preds()</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-12-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-12-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-12-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-12-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-12-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-12-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-12-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-12-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-12-10">10</a></span>
<span class="normal"><a href="#__codelineno-12-11">11</a></span>
<span class="normal"><a href="#__codelineno-12-12">12</a></span>
<span class="normal"><a href="#__codelineno-12-13">13</a></span>
<span class="normal"><a href="#__codelineno-12-14">14</a></span>
<span class="normal"><a href="#__codelineno-12-15">15</a></span>
<span class="normal"><a href="#__codelineno-12-16">16</a></span>
<span class="normal"><a href="#__codelineno-12-17">17</a></span>
<span class="normal"><a href="#__codelineno-12-18">18</a></span>
<span class="normal"><a href="#__codelineno-12-19">19</a></span>
<span class="normal"><a href="#__codelineno-12-20">20</a></span>
<span class="normal"><a href="#__codelineno-12-21">21</a></span>
<span class="normal"><a href="#__codelineno-12-22">22</a></span>
<span class="normal"><a href="#__codelineno-12-23">23</a></span>
<span class="normal"><a href="#__codelineno-12-24">24</a></span>
<span class="normal"><a href="#__codelineno-12-25">25</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="k">def</span> <span class="nf">evaluate_preds</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a>  <span class="c1"># Make sure float32 (for metric calculations)</span>
<a id="__codelineno-12-3" name="__codelineno-12-3"></a>  <span class="n">y_true</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-12-4" name="__codelineno-12-4"></a>  <span class="n">y_pred</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-12-5" name="__codelineno-12-5"></a>
<a id="__codelineno-12-6" name="__codelineno-12-6"></a>  <span class="c1"># Calculate various metrics</span>
<a id="__codelineno-12-7" name="__codelineno-12-7"></a>  <span class="n">mae</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<a id="__codelineno-12-8" name="__codelineno-12-8"></a>  <span class="n">mse</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<a id="__codelineno-12-9" name="__codelineno-12-9"></a>  <span class="n">rmse</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mse</span><span class="p">)</span>
<a id="__codelineno-12-10" name="__codelineno-12-10"></a>  <span class="n">mape</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_percentage_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<a id="__codelineno-12-11" name="__codelineno-12-11"></a>  <span class="n">mase</span> <span class="o">=</span> <span class="n">mean_absolute_scaled_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<a id="__codelineno-12-12" name="__codelineno-12-12"></a>
<a id="__codelineno-12-13" name="__codelineno-12-13"></a>  <span class="c1"># Account for different sized metrics (for longer horizons, reduce to single number)</span>
<a id="__codelineno-12-14" name="__codelineno-12-14"></a>  <span class="k">if</span> <span class="n">mae</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># if mae isn&#39;t already a scalar, reduce it to one by aggregating tensors to mean</span>
<a id="__codelineno-12-15" name="__codelineno-12-15"></a>    <span class="n">mae</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">mae</span><span class="p">)</span>
<a id="__codelineno-12-16" name="__codelineno-12-16"></a>    <span class="n">mse</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">mse</span><span class="p">)</span>
<a id="__codelineno-12-17" name="__codelineno-12-17"></a>    <span class="n">rmse</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">rmse</span><span class="p">)</span>
<a id="__codelineno-12-18" name="__codelineno-12-18"></a>    <span class="n">mape</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">mape</span><span class="p">)</span>
<a id="__codelineno-12-19" name="__codelineno-12-19"></a>    <span class="n">mase</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">mase</span><span class="p">)</span>
<a id="__codelineno-12-20" name="__codelineno-12-20"></a>
<a id="__codelineno-12-21" name="__codelineno-12-21"></a>  <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;mae&quot;</span><span class="p">:</span> <span class="n">mae</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-12-22" name="__codelineno-12-22"></a>          <span class="s2">&quot;mse&quot;</span><span class="p">:</span> <span class="n">mse</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-12-23" name="__codelineno-12-23"></a>          <span class="s2">&quot;rmse&quot;</span><span class="p">:</span> <span class="n">rmse</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-12-24" name="__codelineno-12-24"></a>          <span class="s2">&quot;mape&quot;</span><span class="p">:</span> <span class="n">mape</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-12-25" name="__codelineno-12-25"></a>          <span class="s2">&quot;mase&quot;</span><span class="p">:</span> <span class="n">mase</span><span class="o">.</span><span class="n">numpy</span><span class="p">()}</span>
</code></pre></div>
</td></tr></table>
<p><a name=""></a></p>
<h3 id="make_ensemble_preds">make_ensemble_preds()</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1">1</a></span>
<span class="normal"><a href="#__codelineno-13-2">2</a></span>
<span class="normal"><a href="#__codelineno-13-3">3</a></span>
<span class="normal"><a href="#__codelineno-13-4">4</a></span>
<span class="normal"><a href="#__codelineno-13-5">5</a></span>
<span class="normal"><a href="#__codelineno-13-6">6</a></span>
<span class="normal"><a href="#__codelineno-13-7">7</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="c1"># Create a function which uses a list of trained models to make and return a list of predictions</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="k">def</span> <span class="nf">make_ensemble_preds</span><span class="p">(</span><span class="n">ensemble_models</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a>  <span class="n">ensemble_preds</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a>  <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">ensemble_models</span><span class="p">:</span>
<a id="__codelineno-13-5" name="__codelineno-13-5"></a>    <span class="n">preds</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="c1"># make predictions with current ensemble model</span>
<a id="__codelineno-13-6" name="__codelineno-13-6"></a>    <span class="n">ensemble_preds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">preds</span><span class="p">)</span>
<a id="__codelineno-13-7" name="__codelineno-13-7"></a>  <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">ensemble_preds</span><span class="p">))</span>
</code></pre></div>
</td></tr></table>
<p><a name=""></a></p>
<h3 id="get_upper_lower">get_upper_lower()</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-14-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-14-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-14-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-14-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-14-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-14-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-14-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-14-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-14-10">10</a></span>
<span class="normal"><a href="#__codelineno-14-11">11</a></span>
<span class="normal"><a href="#__codelineno-14-12">12</a></span>
<span class="normal"><a href="#__codelineno-14-13">13</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="c1"># Find upper and lower bounds of ensemble predictions</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="k">def</span> <span class="nf">get_upper_lower</span><span class="p">(</span><span class="n">preds</span><span class="p">):</span> <span class="c1"># 1. Take the predictions of multiple randomly initialized deep learning neural networks</span>
<a id="__codelineno-14-3" name="__codelineno-14-3"></a>
<a id="__codelineno-14-4" name="__codelineno-14-4"></a>  <span class="c1"># 2. Measure the standard deviation of the predictions</span>
<a id="__codelineno-14-5" name="__codelineno-14-5"></a>  <span class="n">std</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">reduce_std</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-14-6" name="__codelineno-14-6"></a>
<a id="__codelineno-14-7" name="__codelineno-14-7"></a>  <span class="c1"># 3. Multiply the standard deviation by 1.96</span>
<a id="__codelineno-14-8" name="__codelineno-14-8"></a>  <span class="n">interval</span> <span class="o">=</span> <span class="mf">1.96</span> <span class="o">*</span> <span class="n">std</span> <span class="c1"># https://en.wikipedia.org/wiki/1.96 </span>
<a id="__codelineno-14-9" name="__codelineno-14-9"></a>
<a id="__codelineno-14-10" name="__codelineno-14-10"></a>  <span class="c1"># 4. Get the prediction interval upper and lower bounds</span>
<a id="__codelineno-14-11" name="__codelineno-14-11"></a>  <span class="n">preds_mean</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-14-12" name="__codelineno-14-12"></a>  <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">preds_mean</span> <span class="o">-</span> <span class="n">interval</span><span class="p">,</span> <span class="n">preds_mean</span> <span class="o">+</span> <span class="n">interval</span>
<a id="__codelineno-14-13" name="__codelineno-14-13"></a>  <span class="k">return</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span>
</code></pre></div>
</td></tr></table>
<p><a name="callbacks"></a></p>
<h2 id="callbacks"><strong>Callbacks</strong></h2>
<p><a name=""></a></p>
<h3 id="early_stopping">early_stopping</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1">1</a></span>
<span class="normal"><a href="#__codelineno-15-2">2</a></span>
<span class="normal"><a href="#__codelineno-15-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="n">early_stopping</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">EarlyStopping</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;val_loss&#39;</span><span class="p">,</span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a>                                                    <span class="n">patience</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-15-3" name="__codelineno-15-3"></a>                                                    <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<p><a name="prepare-data"></a></p>
<h2 id="prepare-data"><strong>Prepare Data</strong></h2>
<p><a name=""></a></p>
<h3 id="download-data">Download Data</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1">1</a></span>
<span class="normal"><a href="#__codelineno-16-2">2</a></span>
<span class="normal"><a href="#__codelineno-16-3">3</a></span>
<span class="normal"><a href="#__codelineno-16-4">4</a></span>
<span class="normal"><a href="#__codelineno-16-5">5</a></span>
<span class="normal"><a href="#__codelineno-16-6">6</a></span>
<span class="normal"><a href="#__codelineno-16-7">7</a></span>
<span class="normal"><a href="#__codelineno-16-8">8</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="c1"># DOWNLOAD PROJECT FILE</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="c1"># pizza_file = wget.download(url) # Only for Pycharm</span>
<a id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="err">!</span><span class="n">wget</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">storage</span><span class="o">.</span><span class="n">googleapis</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">tensorflow</span><span class="o">/</span><span class="n">tf</span><span class="o">-</span><span class="n">keras</span><span class="o">-</span><span class="n">datasets</span><span class="o">/</span><span class="n">jena_climate_2009_2016</span><span class="o">.</span><span class="n">csv</span><span class="o">.</span><span class="n">zip</span> 
<a id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="c1"># EXTRACT PROJECT FILE</span>
<a id="__codelineno-16-5" name="__codelineno-16-5"></a><span class="c1"># zip_ref = zf.ZipFile(pizza_file, &quot;r&quot;) # Only for Pycharm</span>
<a id="__codelineno-16-6" name="__codelineno-16-6"></a><span class="n">zip_ref</span> <span class="o">=</span> <span class="n">zf</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="s2">&quot;jena_climate_2009_2016.csv.zip&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
<a id="__codelineno-16-7" name="__codelineno-16-7"></a><span class="n">zip_ref</span><span class="o">.</span><span class="n">extractall</span><span class="p">()</span>
<a id="__codelineno-16-8" name="__codelineno-16-8"></a><span class="n">zip_ref</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    --2021-12-22 19:07:28--  https://storage.googleapis.com/tensorflow/tf-keras-datasets/jena_climate_2009_2016.csv.zip
    Resolving storage.googleapis.com (storage.googleapis.com)... 173.194.197.128, 173.194.198.128, 64.233.191.128, ...
    Connecting to storage.googleapis.com (storage.googleapis.com)|173.194.197.128|:443... connected.
    HTTP request sent, awaiting response... 200 OK
    Length: 13568290 (13M) [application/zip]
    Saving to: ‘jena_climate_2009_2016.csv.zip’

    jena_climate_2009_2 100%[===================>]  12.94M  --.-KB/s    in 0.1s    

    2021-12-22 19:07:28 (95.2 MB/s) - ‘jena_climate_2009_2016.csv.zip’ saved [13568290/13568290]
</pre>
</div>

<p><a name=""></a></p>
<h3 id="inspect-data">Inspect Data</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1">1</a></span>
<span class="normal"><a href="#__codelineno-17-2">2</a></span>
<span class="normal"><a href="#__codelineno-17-3">3</a></span>
<span class="normal"><a href="#__codelineno-17-4">4</a></span>
<span class="normal"><a href="#__codelineno-17-5">5</a></span>
<span class="normal"><a href="#__codelineno-17-6">6</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="c1"># Parse dates and set date column to index</span>
<a id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;jena_climate_2009_2016.csv&quot;</span><span class="p">,</span> 
<a id="__codelineno-17-3" name="__codelineno-17-3"></a>                <span class="c1">#  parse_dates=[&quot;Date Time&quot;], </span>
<a id="__codelineno-17-4" name="__codelineno-17-4"></a>                <span class="c1">#  index_col=[&quot;Date Time&quot;] # parse the date column (tell pandas column 1 is a datetime)</span>
<a id="__codelineno-17-5" name="__codelineno-17-5"></a>                 <span class="p">)</span> 
<a id="__codelineno-17-6" name="__codelineno-17-6"></a><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
        Date Time           p (mbar)    T (degC)    Tpot (K)    Tdew (degC) rh (%)  VPmax (mbar)    VPact (mbar)    VPdef (mbar)    sh (g/kg)   H2OC (mmol/mol) rho (g/m**3)    wv (m/s)    max. wv (m/s)   wd (deg)
    0   01.01.2009 00:10:00 996.52      -8.02       265.40      -8.90       93.3    3.33            3.11            0.22            1.94        3.12            1307.75         1.03        1.75            152.3
    1   01.01.2009 00:20:00 996.57      -8.41       265.01      -9.28       93.4    3.23            3.02            0.21            1.89        3.03            1309.80         0.72        1.50            136.1
    2   01.01.2009 00:30:00 996.53      -8.51       264.91      -9.31       93.9    3.21            3.01            0.20            1.88        3.02            1310.24         0.19        0.63            171.6
    3   01.01.2009 00:40:00 996.51      -8.31       265.12      -9.07       94.2    3.26            3.07            0.19            1.92        3.08            1309.19         0.34        0.50            198.0
    4   01.01.2009 00:50:00 996.51      -8.27       265.15      -9.04       94.1    3.27            3.08            0.19            1.92        3.09            1309.00         0.32        0.63            214.3

</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1">1</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
            Date Time           p (mbar)    T (degC)    Tpot (K)    Tdew (degC) rh (%)  VPmax (mbar)    VPact (mbar)    VPdef (mbar)    sh (g/kg)   H2OC (mmol/mol) rho (g/m**3)    wv (m/s)    max. wv (m/s)   wd (deg)
    420546  31.12.2016 23:20:00 1000.07     -4.05       269.10      -8.13       73.10   4.52            3.30            1.22            2.06        3.30            1292.98         0.67        1.52            240.0
    420547  31.12.2016 23:30:00 999.93      -3.35       269.81      -8.06       69.71   4.77            3.32            1.44            2.07        3.32            1289.44         1.14        1.92            234.3
    420548  31.12.2016 23:40:00 999.82      -3.16       270.01      -8.21       67.91   4.84            3.28            1.55            2.05        3.28            1288.39         1.08        2.00            215.2
    420549  31.12.2016 23:50:00 999.81      -4.23       268.94      -8.53       71.80   4.46            3.20            1.26            1.99        3.20            1293.56         1.49        2.16            225.8
    420550  01.01.2017 00:00:00 999.82      -4.82       268.36      -8.42       75.70   4.27            3.23            1.04            2.01        3.23            1296.38         1.23        1.96            184.9
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1">1</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (class 'pandas.core.frame.DataFrame')
    RangeIndex: 420551 entries, 0 to 420550
    Data columns (total 15 columns):
     #   Column           Non-Null Count   Dtype  
    ---  ------           --------------   -----  
     0   Date Time        420551 non-null  object 
     1   p (mbar)         420551 non-null  float64
     2   T (degC)         420551 non-null  float64
     3   Tpot (K)         420551 non-null  float64
     4   Tdew (degC)      420551 non-null  float64
     5   rh (%)           420551 non-null  float64
     6   VPmax (mbar)     420551 non-null  float64
     7   VPact (mbar)     420551 non-null  float64
     8   VPdef (mbar)     420551 non-null  float64
     9   sh (g/kg)        420551 non-null  float64
     10  H2OC (mmol/mol)  420551 non-null  float64
     11  rho (g/m**3)     420551 non-null  float64
     12  wv (m/s)         420551 non-null  float64
     13  max. wv (m/s)    420551 non-null  float64
     14  wd (deg)         420551 non-null  float64
    dtypes: float64(14), object(1)
    memory usage: 48.1+ MB
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1">1</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    0         01.01.2009 00:10:00
    1         01.01.2009 00:20:00
    2         01.01.2009 00:30:00
    3         01.01.2009 00:40:00
    4         01.01.2009 00:50:00
                     ...         
    420546    31.12.2016 23:20:00
    420547    31.12.2016 23:30:00
    420548    31.12.2016 23:40:00
    420549    31.12.2016 23:50:00
    420550    01.01.2017 00:00:00
    Name: Date Time, Length: 420551, dtype: object
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1">1</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="n">df</span><span class="o">.</span><span class="n">index</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    RangeIndex(start=0, stop=420551, step=1)
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1">1</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="n">date_time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;Date Time&#39;</span><span class="p">),</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">.%m.%Y %H:%M:%S&#39;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1">1</a></span>
<span class="normal"><a href="#__codelineno-23-2">2</a></span>
<span class="normal"><a href="#__codelineno-23-3">3</a></span>
<span class="normal"><a href="#__codelineno-23-4">4</a></span>
<span class="normal"><a href="#__codelineno-23-5">5</a></span>
<span class="normal"><a href="#__codelineno-23-6">6</a></span>
<span class="normal"><a href="#__codelineno-23-7">7</a></span>
<span class="normal"><a href="#__codelineno-23-8">8</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="n">plot_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;T (degC)&#39;</span><span class="p">,</span> <span class="s1">&#39;p (mbar)&#39;</span><span class="p">,</span> <span class="s1">&#39;rho (g/m**3)&#39;</span><span class="p">]</span>
<a id="__codelineno-23-2" name="__codelineno-23-2"></a><span class="n">plot_features</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">plot_cols</span><span class="p">]</span>
<a id="__codelineno-23-3" name="__codelineno-23-3"></a><span class="n">plot_features</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">date_time</span>
<a id="__codelineno-23-4" name="__codelineno-23-4"></a><span class="n">_</span> <span class="o">=</span> <span class="n">plot_features</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span> <span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-23-5" name="__codelineno-23-5"></a>
<a id="__codelineno-23-6" name="__codelineno-23-6"></a><span class="n">plot_features</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">plot_cols</span><span class="p">][:</span><span class="mi">480</span><span class="p">]</span>
<a id="__codelineno-23-7" name="__codelineno-23-7"></a><span class="n">plot_features</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">date_time</span><span class="p">[:</span><span class="mi">480</span><span class="p">]</span>
<a id="__codelineno-23-8" name="__codelineno-23-8"></a><span class="n">_</span> <span class="o">=</span> <span class="n">plot_features</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span> <span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<img alt="ts-weather-1" src="../../../images/ts-weather-1.png" /></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1">1</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
                    count       mean        std         min         25%     50%     75%     max
    p (mbar)        420551.0    989.212776  8.358481    913.60      984.20  989.58  994.72  1015.35
    T (degC)        420551.0    9.450147    8.423365    -23.01      3.36    9.42    15.47   37.28
    Tpot (K)        420551.0    283.492743  8.504471    250.60      277.43  283.47  289.53  311.34
    Tdew (degC)     420551.0    4.955854    6.730674    -25.01      0.24    5.22    10.07   23.11
    rh (%)          420551.0    76.008259   16.476175   12.95       65.21   79.30   89.40   100.00
    VPmax (mbar)    420551.0    13.576251   7.739020    0.95        7.78    11.82   17.60   63.77
    VPact (mbar)    420551.0    9.533756    4.184164    0.79        6.21    8.86    12.35   28.32
    VPdef (mbar)    420551.0    4.042412    4.896851    0.00        0.87    2.19    5.30    46.01
    sh (g/kg)       420551.0    6.022408    2.656139    0.50        3.92    5.59    7.80    18.13
    H2OC (mmol/mol) 420551.0    9.640223    4.235395    0.80        6.29    8.96    12.49   28.82
    rho (g/m**3)    420551.0    1216.062748 39.975208   1059.45     1187.49 1213.79 1242.77 1393.54
    wv (m/s)        420551.0    1.702224    65.446714   -9999.00    0.99    1.76    2.86    28.49
    max. wv (m/s)   420551.0    3.056555    69.016932   -9999.00    1.76    2.96    4.74    23.50
    wd (deg)        420551.0    174.743738  86.681693   0.00        124.90  198.10  234.10  360.00
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-25-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-25-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-25-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-25-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-25-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-25-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-25-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-25-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-25-10">10</a></span>
<span class="normal"><a href="#__codelineno-25-11">11</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="c1"># Wind velocity min values is likely errorneous (need to be fix)</span>
<a id="__codelineno-25-2" name="__codelineno-25-2"></a><span class="n">wv</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;wv (m/s)&#39;</span><span class="p">]</span>
<a id="__codelineno-25-3" name="__codelineno-25-3"></a><span class="n">bad_wv</span> <span class="o">=</span> <span class="n">wv</span> <span class="o">==</span> <span class="o">-</span><span class="mf">9999.0</span>
<a id="__codelineno-25-4" name="__codelineno-25-4"></a><span class="n">wv</span><span class="p">[</span><span class="n">bad_wv</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-25-5" name="__codelineno-25-5"></a>
<a id="__codelineno-25-6" name="__codelineno-25-6"></a><span class="n">max_wv</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;max. wv (m/s)&#39;</span><span class="p">]</span>
<a id="__codelineno-25-7" name="__codelineno-25-7"></a><span class="n">bad_max_wv</span> <span class="o">=</span> <span class="n">max_wv</span> <span class="o">==</span> <span class="o">-</span><span class="mf">9999.0</span>
<a id="__codelineno-25-8" name="__codelineno-25-8"></a><span class="n">max_wv</span><span class="p">[</span><span class="n">bad_max_wv</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-25-9" name="__codelineno-25-9"></a>
<a id="__codelineno-25-10" name="__codelineno-25-10"></a><span class="c1"># The above inplace edits are reflected in the DataFrame.</span>
<a id="__codelineno-25-11" name="__codelineno-25-11"></a><span class="n">df</span><span class="p">[</span><span class="s1">&#39;wv (m/s)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    0.0
</pre>
</div>

<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-26-1">1</a></span>
<span class="normal"><a href="#__codelineno-26-2">2</a></span>
<span class="normal"><a href="#__codelineno-26-3">3</a></span>
<span class="normal"><a href="#__codelineno-26-4">4</a></span>
<span class="normal"><a href="#__codelineno-26-5">5</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="c1"># Current wind direction</span>
<a id="__codelineno-26-2" name="__codelineno-26-2"></a><span class="n">plt</span><span class="o">.</span><span class="n">hist2d</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;wd (deg)&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;wv (m/s)&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
<a id="__codelineno-26-3" name="__codelineno-26-3"></a><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<a id="__codelineno-26-4" name="__codelineno-26-4"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Wind Direction [deg]&#39;</span><span class="p">)</span>
<a id="__codelineno-26-5" name="__codelineno-26-5"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Wind Velocity [m/s]&#39;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<img alt="ts-weather-2" src="../../../images/ts-weather-2.png" /></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-27-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-27-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-27-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-27-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-27-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-27-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-27-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-27-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-27-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-27-10">10</a></span>
<span class="normal"><a href="#__codelineno-27-11">11</a></span>
<span class="normal"><a href="#__codelineno-27-12">12</a></span>
<span class="normal"><a href="#__codelineno-27-13">13</a></span>
<span class="normal"><a href="#__codelineno-27-14">14</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="c1"># It will be easier to interpred if change the wind direction into a wind vector</span>
<a id="__codelineno-27-2" name="__codelineno-27-2"></a><span class="n">wv</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;wv (m/s)&#39;</span><span class="p">)</span>
<a id="__codelineno-27-3" name="__codelineno-27-3"></a><span class="n">max_wv</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;max. wv (m/s)&#39;</span><span class="p">)</span>
<a id="__codelineno-27-4" name="__codelineno-27-4"></a>
<a id="__codelineno-27-5" name="__codelineno-27-5"></a><span class="c1"># Convert to radians.</span>
<a id="__codelineno-27-6" name="__codelineno-27-6"></a><span class="n">wd_rad</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;wd (deg)&#39;</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span>
<a id="__codelineno-27-7" name="__codelineno-27-7"></a>
<a id="__codelineno-27-8" name="__codelineno-27-8"></a><span class="c1"># Calculate the wind x and y components.</span>
<a id="__codelineno-27-9" name="__codelineno-27-9"></a><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Wx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wv</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">wd_rad</span><span class="p">)</span>
<a id="__codelineno-27-10" name="__codelineno-27-10"></a><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Wy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wv</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">wd_rad</span><span class="p">)</span>
<a id="__codelineno-27-11" name="__codelineno-27-11"></a>
<a id="__codelineno-27-12" name="__codelineno-27-12"></a><span class="c1"># Calculate the max wind x and y components.</span>
<a id="__codelineno-27-13" name="__codelineno-27-13"></a><span class="n">df</span><span class="p">[</span><span class="s1">&#39;max Wx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_wv</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">wd_rad</span><span class="p">)</span>
<a id="__codelineno-27-14" name="__codelineno-27-14"></a><span class="n">df</span><span class="p">[</span><span class="s1">&#39;max Wy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_wv</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">wd_rad</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-28-1">1</a></span>
<span class="normal"><a href="#__codelineno-28-2">2</a></span>
<span class="normal"><a href="#__codelineno-28-3">3</a></span>
<span class="normal"><a href="#__codelineno-28-4">4</a></span>
<span class="normal"><a href="#__codelineno-28-5">5</a></span>
<span class="normal"><a href="#__codelineno-28-6">6</a></span>
<span class="normal"><a href="#__codelineno-28-7">7</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="c1"># Visualize our changes of wind direction vectors</span>
<a id="__codelineno-28-2" name="__codelineno-28-2"></a><span class="n">plt</span><span class="o">.</span><span class="n">hist2d</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Wx&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Wy&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
<a id="__codelineno-28-3" name="__codelineno-28-3"></a><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<a id="__codelineno-28-4" name="__codelineno-28-4"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Wind X [m/s]&#39;</span><span class="p">)</span>
<a id="__codelineno-28-5" name="__codelineno-28-5"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Wind Y [m/s]&#39;</span><span class="p">)</span>
<a id="__codelineno-28-6" name="__codelineno-28-6"></a><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<a id="__codelineno-28-7" name="__codelineno-28-7"></a><span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<img alt="ts-weather-3" src="../../../images/ts-weather-3.png" /></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-29-1">1</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="n">timestamp_s</span> <span class="o">=</span> <span class="n">date_time</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-30-1">1</a></span>
<span class="normal"><a href="#__codelineno-30-2">2</a></span>
<span class="normal"><a href="#__codelineno-30-3">3</a></span>
<span class="normal"><a href="#__codelineno-30-4">4</a></span>
<span class="normal"><a href="#__codelineno-30-5">5</a></span>
<span class="normal"><a href="#__codelineno-30-6">6</a></span>
<span class="normal"><a href="#__codelineno-30-7">7</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1"></a><span class="n">day</span> <span class="o">=</span> <span class="mi">24</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span>
<a id="__codelineno-30-2" name="__codelineno-30-2"></a><span class="n">year</span> <span class="o">=</span> <span class="p">(</span><span class="mf">365.2425</span><span class="p">)</span><span class="o">*</span><span class="n">day</span>
<a id="__codelineno-30-3" name="__codelineno-30-3"></a>
<a id="__codelineno-30-4" name="__codelineno-30-4"></a><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Day sin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">timestamp_s</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">day</span><span class="p">))</span>
<a id="__codelineno-30-5" name="__codelineno-30-5"></a><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Day cos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">timestamp_s</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">day</span><span class="p">))</span>
<a id="__codelineno-30-6" name="__codelineno-30-6"></a><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Year sin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">timestamp_s</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">year</span><span class="p">))</span>
<a id="__codelineno-30-7" name="__codelineno-30-7"></a><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Year cos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">timestamp_s</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">year</span><span class="p">))</span>
</code></pre></div>
</td></tr></table>
<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-31-1">1</a></span>
<span class="normal"><a href="#__codelineno-31-2">2</a></span>
<span class="normal"><a href="#__codelineno-31-3">3</a></span>
<span class="normal"><a href="#__codelineno-31-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Day sin&#39;</span><span class="p">])[:</span><span class="mi">150</span><span class="p">])</span>
<a id="__codelineno-31-2" name="__codelineno-31-2"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Day cos&#39;</span><span class="p">])[:</span><span class="mi">150</span><span class="p">])</span>
<a id="__codelineno-31-3" name="__codelineno-31-3"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time [h]&#39;</span><span class="p">)</span>
<a id="__codelineno-31-4" name="__codelineno-31-4"></a><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Time of day signal&#39;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<img alt="ts-weather-4" src="../../../images/ts-weather-4.png" /></p>
<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-32-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-32-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-32-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-32-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-32-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-32-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-32-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-32-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-32-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-32-10">10</a></span>
<span class="normal"><a href="#__codelineno-32-11">11</a></span>
<span class="normal"><a href="#__codelineno-32-12">12</a></span>
<span class="normal"><a href="#__codelineno-32-13">13</a></span>
<span class="normal"><a href="#__codelineno-32-14">14</a></span>
<span class="normal"><a href="#__codelineno-32-15">15</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1"></a><span class="c1"># Find the freaquncy of the peak temperater of the year and day (optional)</span>
<a id="__codelineno-32-2" name="__codelineno-32-2"></a><span class="n">fft</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">rfft</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;T (degC)&#39;</span><span class="p">])</span>
<a id="__codelineno-32-3" name="__codelineno-32-3"></a><span class="n">f_per_dataset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">fft</span><span class="p">))</span>
<a id="__codelineno-32-4" name="__codelineno-32-4"></a>
<a id="__codelineno-32-5" name="__codelineno-32-5"></a><span class="n">n_samples_h</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;T (degC)&#39;</span><span class="p">])</span>
<a id="__codelineno-32-6" name="__codelineno-32-6"></a><span class="n">hours_per_year</span> <span class="o">=</span> <span class="mi">24</span><span class="o">*</span><span class="mf">365.2524</span>
<a id="__codelineno-32-7" name="__codelineno-32-7"></a><span class="n">years_per_dataset</span> <span class="o">=</span> <span class="n">n_samples_h</span><span class="o">/</span><span class="p">(</span><span class="n">hours_per_year</span><span class="p">)</span>
<a id="__codelineno-32-8" name="__codelineno-32-8"></a>
<a id="__codelineno-32-9" name="__codelineno-32-9"></a><span class="n">f_per_year</span> <span class="o">=</span> <span class="n">f_per_dataset</span><span class="o">/</span><span class="n">years_per_dataset</span>
<a id="__codelineno-32-10" name="__codelineno-32-10"></a><span class="n">plt</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">f_per_year</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">fft</span><span class="p">))</span>
<a id="__codelineno-32-11" name="__codelineno-32-11"></a><span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<a id="__codelineno-32-12" name="__codelineno-32-12"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2000000</span><span class="p">)</span>
<a id="__codelineno-32-13" name="__codelineno-32-13"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">())])</span>
<a id="__codelineno-32-14" name="__codelineno-32-14"></a><span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mf">365.2524</span><span class="p">],</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;1/Year&#39;</span><span class="p">,</span> <span class="s1">&#39;1/day&#39;</span><span class="p">])</span>
<a id="__codelineno-32-15" name="__codelineno-32-15"></a><span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (log scale)&#39;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<img alt="ts-weather-5" src="../../../images/ts-weather-5.png" /></p>
<p><a name=""></a></p>
<h3 id="prepare-data_1">Prepare Data</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-33-1">1</a></span>
<span class="normal"><a href="#__codelineno-33-2">2</a></span>
<span class="normal"><a href="#__codelineno-33-3">3</a></span>
<span class="normal"><a href="#__codelineno-33-4">4</a></span>
<span class="normal"><a href="#__codelineno-33-5">5</a></span>
<span class="normal"><a href="#__codelineno-33-6">6</a></span>
<span class="normal"><a href="#__codelineno-33-7">7</a></span>
<span class="normal"><a href="#__codelineno-33-8">8</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="c1"># Split the data</span>
<a id="__codelineno-33-2" name="__codelineno-33-2"></a><span class="n">column_indices</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)}</span>
<a id="__codelineno-33-3" name="__codelineno-33-3"></a>
<a id="__codelineno-33-4" name="__codelineno-33-4"></a><span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<a id="__codelineno-33-5" name="__codelineno-33-5"></a><span class="n">train_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="mf">0.8</span><span class="p">)]</span>
<a id="__codelineno-33-6" name="__codelineno-33-6"></a><span class="n">val_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="mf">0.8</span><span class="p">):]</span>
<a id="__codelineno-33-7" name="__codelineno-33-7"></a>
<a id="__codelineno-33-8" name="__codelineno-33-8"></a><span class="n">num_features</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-34-1">1</a></span>
<span class="normal"><a href="#__codelineno-34-2">2</a></span>
<span class="normal"><a href="#__codelineno-34-3">3</a></span>
<span class="normal"><a href="#__codelineno-34-4">4</a></span>
<span class="normal"><a href="#__codelineno-34-5">5</a></span>
<span class="normal"><a href="#__codelineno-34-6">6</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1"></a><span class="c1"># Normalize the data</span>
<a id="__codelineno-34-2" name="__codelineno-34-2"></a><span class="n">train_mean</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<a id="__codelineno-34-3" name="__codelineno-34-3"></a><span class="n">train_std</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
<a id="__codelineno-34-4" name="__codelineno-34-4"></a>
<a id="__codelineno-34-5" name="__codelineno-34-5"></a><span class="n">train_df</span> <span class="o">=</span> <span class="p">(</span><span class="n">train_df</span> <span class="o">-</span> <span class="n">train_mean</span><span class="p">)</span> <span class="o">/</span> <span class="n">train_std</span>
<a id="__codelineno-34-6" name="__codelineno-34-6"></a><span class="n">val_df</span> <span class="o">=</span> <span class="p">(</span><span class="n">val_df</span> <span class="o">-</span> <span class="n">train_mean</span><span class="p">)</span> <span class="o">/</span> <span class="n">train_std</span>
</code></pre></div>
</td></tr></table>
<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-35-1">1</a></span>
<span class="normal"><a href="#__codelineno-35-2">2</a></span>
<span class="normal"><a href="#__codelineno-35-3">3</a></span>
<span class="normal"><a href="#__codelineno-35-4">4</a></span>
<span class="normal"><a href="#__codelineno-35-5">5</a></span>
<span class="normal"><a href="#__codelineno-35-6">6</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1"></a><span class="c1"># Viaulize the data</span>
<a id="__codelineno-35-2" name="__codelineno-35-2"></a><span class="n">df_std</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span> <span class="o">-</span> <span class="n">train_mean</span><span class="p">)</span> <span class="o">/</span> <span class="n">train_std</span>
<a id="__codelineno-35-3" name="__codelineno-35-3"></a><span class="n">df_std</span> <span class="o">=</span> <span class="n">df_std</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">var_name</span><span class="o">=</span><span class="s1">&#39;Column&#39;</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s1">&#39;Normalized&#39;</span><span class="p">)</span>
<a id="__codelineno-35-4" name="__codelineno-35-4"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<a id="__codelineno-35-5" name="__codelineno-35-5"></a><span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">violinplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;Column&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Normalized&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_std</span><span class="p">)</span>
<a id="__codelineno-35-6" name="__codelineno-35-6"></a><span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<img alt="ts-weather-6" src="../../../images/ts-weather-6.png" /></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-36-1">1</a></span>
<span class="normal"><a href="#__codelineno-36-2">2</a></span>
<span class="normal"><a href="#__codelineno-36-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1"></a><span class="n">w1</span> <span class="o">=</span> <span class="n">WindowGenerator</span><span class="p">(</span><span class="n">input_width</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span> <span class="n">label_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span>
<a id="__codelineno-36-2" name="__codelineno-36-2"></a>                     <span class="n">label_columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;T (degC)&#39;</span><span class="p">])</span>
<a id="__codelineno-36-3" name="__codelineno-36-3"></a><span class="n">w1</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Total window size: 48
    Input indices: [ 0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23]
    Label indices: [47]
    Label column name(s): ['T (degC)']
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-37-1">1</a></span>
<span class="normal"><a href="#__codelineno-37-2">2</a></span>
<span class="normal"><a href="#__codelineno-37-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1"></a><span class="n">w2</span> <span class="o">=</span> <span class="n">WindowGenerator</span><span class="p">(</span><span class="n">input_width</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">label_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-37-2" name="__codelineno-37-2"></a>                     <span class="n">label_columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;T (degC)&#39;</span><span class="p">])</span>
<a id="__codelineno-37-3" name="__codelineno-37-3"></a><span class="n">w2</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Total window size: 7
    Input indices: [0 1 2 3 4 5]
    Label indices: [6]
    Label column name(s): ['T (degC)']
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-38-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-38-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-38-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-38-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-38-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-38-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-38-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-38-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-38-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-38-10">10</a></span>
<span class="normal"><a href="#__codelineno-38-11">11</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1"></a><span class="c1"># Stack three slices, the length of the total window.</span>
<a id="__codelineno-38-2" name="__codelineno-38-2"></a><span class="n">example_window</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">train_df</span><span class="p">[:</span><span class="n">w2</span><span class="o">.</span><span class="n">total_window_size</span><span class="p">]),</span>
<a id="__codelineno-38-3" name="__codelineno-38-3"></a>                           <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">train_df</span><span class="p">[</span><span class="mi">100</span><span class="p">:</span><span class="mi">100</span><span class="o">+</span><span class="n">w2</span><span class="o">.</span><span class="n">total_window_size</span><span class="p">]),</span>
<a id="__codelineno-38-4" name="__codelineno-38-4"></a>                           <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">train_df</span><span class="p">[</span><span class="mi">200</span><span class="p">:</span><span class="mi">200</span><span class="o">+</span><span class="n">w2</span><span class="o">.</span><span class="n">total_window_size</span><span class="p">])])</span>
<a id="__codelineno-38-5" name="__codelineno-38-5"></a>
<a id="__codelineno-38-6" name="__codelineno-38-6"></a><span class="n">example_inputs</span><span class="p">,</span> <span class="n">example_labels</span> <span class="o">=</span> <span class="n">w2</span><span class="o">.</span><span class="n">split_window</span><span class="p">(</span><span class="n">example_window</span><span class="p">)</span>
<a id="__codelineno-38-7" name="__codelineno-38-7"></a>
<a id="__codelineno-38-8" name="__codelineno-38-8"></a><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;All shapes are: (batch, time, features)&#39;</span><span class="p">)</span>
<a id="__codelineno-38-9" name="__codelineno-38-9"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Window shape: </span><span class="si">{</span><span class="n">example_window</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-38-10" name="__codelineno-38-10"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Inputs shape: </span><span class="si">{</span><span class="n">example_inputs</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-38-11" name="__codelineno-38-11"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Labels shape: </span><span class="si">{</span><span class="n">example_labels</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    All shapes are: (batch, time, features)
    Window shape: (3, 7, 19)
    Inputs shape: (3, 6, 19)
    Labels shape: (3, 1, 1)
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-39-1">1</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1"></a><span class="n">WindowGenerator</span><span class="o">.</span><span class="n">make_dataset</span> <span class="o">=</span> <span class="n">make_dataset</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-40-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-40-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-40-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-40-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-40-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-40-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-40-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-40-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-40-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-40-10">10</a></span>
<span class="normal"><a href="#__codelineno-40-11">11</a></span>
<span class="normal"><a href="#__codelineno-40-12">12</a></span>
<span class="normal"><a href="#__codelineno-40-13">13</a></span>
<span class="normal"><a href="#__codelineno-40-14">14</a></span>
<span class="normal"><a href="#__codelineno-40-15">15</a></span>
<span class="normal"><a href="#__codelineno-40-16">16</a></span>
<span class="normal"><a href="#__codelineno-40-17">17</a></span>
<span class="normal"><a href="#__codelineno-40-18">18</a></span>
<span class="normal"><a href="#__codelineno-40-19">19</a></span>
<span class="normal"><a href="#__codelineno-40-20">20</a></span>
<span class="normal"><a href="#__codelineno-40-21">21</a></span>
<span class="normal"><a href="#__codelineno-40-22">22</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1"></a><span class="nd">@property</span>
<a id="__codelineno-40-2" name="__codelineno-40-2"></a><span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-40-3" name="__codelineno-40-3"></a>  <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_dataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_df</span><span class="p">)</span>
<a id="__codelineno-40-4" name="__codelineno-40-4"></a>
<a id="__codelineno-40-5" name="__codelineno-40-5"></a><span class="nd">@property</span>
<a id="__codelineno-40-6" name="__codelineno-40-6"></a><span class="k">def</span> <span class="nf">val</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-40-7" name="__codelineno-40-7"></a>  <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_dataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">val_df</span><span class="p">)</span>
<a id="__codelineno-40-8" name="__codelineno-40-8"></a>
<a id="__codelineno-40-9" name="__codelineno-40-9"></a><span class="nd">@property</span>
<a id="__codelineno-40-10" name="__codelineno-40-10"></a><span class="k">def</span> <span class="nf">example</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-40-11" name="__codelineno-40-11"></a>  <span class="sd">&quot;&quot;&quot;Get and cache an example batch of `inputs, labels` for plotting.&quot;&quot;&quot;</span>
<a id="__codelineno-40-12" name="__codelineno-40-12"></a>  <span class="n">result</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_example&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-40-13" name="__codelineno-40-13"></a>  <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-40-14" name="__codelineno-40-14"></a>    <span class="c1"># No example batch was found, so get one from the `.train` dataset</span>
<a id="__codelineno-40-15" name="__codelineno-40-15"></a>    <span class="n">result</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train</span><span class="p">))</span>
<a id="__codelineno-40-16" name="__codelineno-40-16"></a>    <span class="c1"># And cache it for next time</span>
<a id="__codelineno-40-17" name="__codelineno-40-17"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_example</span> <span class="o">=</span> <span class="n">result</span>
<a id="__codelineno-40-18" name="__codelineno-40-18"></a>  <span class="k">return</span> <span class="n">result</span>
<a id="__codelineno-40-19" name="__codelineno-40-19"></a>
<a id="__codelineno-40-20" name="__codelineno-40-20"></a><span class="n">WindowGenerator</span><span class="o">.</span><span class="n">train</span> <span class="o">=</span> <span class="n">train</span>
<a id="__codelineno-40-21" name="__codelineno-40-21"></a><span class="n">WindowGenerator</span><span class="o">.</span><span class="n">val</span> <span class="o">=</span> <span class="n">val</span>
<a id="__codelineno-40-22" name="__codelineno-40-22"></a><span class="n">WindowGenerator</span><span class="o">.</span><span class="n">example</span> <span class="o">=</span> <span class="n">example</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-41-1">1</a></span>
<span class="normal"><a href="#__codelineno-41-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1"></a><span class="c1"># Each element is an (inputs, label) pair.</span>
<a id="__codelineno-41-2" name="__codelineno-41-2"></a><span class="n">w2</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">element_spec</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (TensorSpec(shape=(None, 6, 19), dtype=tf.float32, name=None),
     TensorSpec(shape=(None, 1, 1), dtype=tf.float32, name=None))
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-42-1">1</a></span>
<span class="normal"><a href="#__codelineno-42-2">2</a></span>
<span class="normal"><a href="#__codelineno-42-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1"></a><span class="k">for</span> <span class="n">example_inputs</span><span class="p">,</span> <span class="n">example_labels</span> <span class="ow">in</span> <span class="n">w2</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-42-2" name="__codelineno-42-2"></a>  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Inputs shape (batch, time, features): </span><span class="si">{</span><span class="n">example_inputs</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-42-3" name="__codelineno-42-3"></a>  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Labels shape (batch, time, features): </span><span class="si">{</span><span class="n">example_labels</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Inputs shape (batch, time, features): (32, 6, 19)
    Labels shape (batch, time, features): (32, 1, 1)
</pre>
</div>

<p><a name="model-0"></a></p>
<h2 id="model-0-naive-forecast"><strong>Model 0: Naive Forecast</strong></h2>
<p><a name=""></a></p>
<h3 id="adjust-data">Adjust Data</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-43-1">1</a></span>
<span class="normal"><a href="#__codelineno-43-2">2</a></span>
<span class="normal"><a href="#__codelineno-43-3">3</a></span>
<span class="normal"><a href="#__codelineno-43-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1"></a><span class="n">single_step_window</span> <span class="o">=</span> <span class="n">WindowGenerator</span><span class="p">(</span>
<a id="__codelineno-43-2" name="__codelineno-43-2"></a>    <span class="n">input_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-43-3" name="__codelineno-43-3"></a>    <span class="n">label_columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;T (degC)&#39;</span><span class="p">])</span>
<a id="__codelineno-43-4" name="__codelineno-43-4"></a><span class="n">single_step_window</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Total window size: 2
    Input indices: [0]
    Label indices: [1]
    Label column name(s): ['T (degC)']
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-44-1">1</a></span>
<span class="normal"><a href="#__codelineno-44-2">2</a></span>
<span class="normal"><a href="#__codelineno-44-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1"></a><span class="k">for</span> <span class="n">example_inputs</span><span class="p">,</span> <span class="n">example_labels</span> <span class="ow">in</span> <span class="n">single_step_window</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-44-2" name="__codelineno-44-2"></a>  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Inputs shape (batch, time, features): </span><span class="si">{</span><span class="n">example_inputs</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-44-3" name="__codelineno-44-3"></a>  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Labels shape (batch, time, features): </span><span class="si">{</span><span class="n">example_labels</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Inputs shape (batch, time, features): (32, 1, 19)
    Labels shape (batch, time, features): (32, 1, 1)
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-45-1">1</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1"></a><span class="n">train_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
        p (mbar)    T (degC)    Tpot (K)    Tdew (degC) rh (%)      VPmax (mbar)    VPact (mbar)    VPdef (mbar)    sh (g/kg)   H2OC (mmol/mol) rho (g/m**3)    Wx          Wy          max Wx      max Wy      Day sin     Day cos     Year sin    Year cos
    0   0.920680    -2.014957   -2.073273   -1.969043   1.036096    -1.315985       -1.490551       -0.782128       -1.493218   -1.495486       2.243867        -0.147651   0.571124    -0.177126   0.594215    0.061760    1.413193    -0.050445   1.401962
    1   0.926669    -2.061161   -2.119059   -2.024671   1.042156    -1.329358       -1.512235       -0.784268       -1.512194   -1.516904       2.294952        0.048198    0.584294    -0.026887   0.680929    0.123331    1.409158    -0.050276   1.401960
    2   0.921878    -2.073009   -2.130799   -2.029063   1.072460    -1.332033       -1.514644       -0.786409       -1.515989   -1.519284       2.305916        0.213002    0.280838    0.119816    0.318173    0.184668    1.402441    -0.050108   1.401958
    3   0.919483    -2.049314   -2.106145   -1.993929   1.090642    -1.325346       -1.500188       -0.788550       -1.500808   -1.505005       2.279751        0.145554    0.195354    0.167174    0.223840    0.245653    1.393055    -0.049940   1.401957
    4   0.919483    -2.044575   -2.102623   -1.989538   1.084582    -1.324009       -1.497779       -0.788550       -1.500808   -1.502625       2.275016        0.174949    0.146914    0.152774    0.147118    0.306170    1.381018    -0.049772   1.401955
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-46-1">1</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1"></a><span class="n">mod_0_y</span> <span class="o">=</span> <span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;T (degC)&quot;</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-47-1">1</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1"></a><span class="n">mod_0_y</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    0   -2.014957
    1   -2.061161
    2   -2.073009
    3   -2.049314
    4   -2.044575
    Name: T (degC), dtype: float64
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-48-1">1</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1"></a><span class="n">mod_0_x</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">index</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-49-1">1</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1"></a><span class="nb">len</span><span class="p">(</span><span class="n">mod_0_y</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">mod_0_x</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (336440, 336440)
</pre>
</div>

<p><a name=""></a></p>
<h3 id="create-compile-and-run-model">Create, Compile, and Run Model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-50-1">1</a></span>
<span class="normal"><a href="#__codelineno-50-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1"></a><span class="c1"># Create a naïve forecast</span>
<a id="__codelineno-50-2" name="__codelineno-50-2"></a><span class="n">naive_forecast</span> <span class="o">=</span> <span class="n">mod_0_y</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># Naïve forecast equals every value excluding the last value</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-51-1">1</a></span>
<span class="normal"><a href="#__codelineno-51-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1"></a><span class="c1"># [Optional, Visualize] View frist 10 and last 10</span>
<a id="__codelineno-51-2" name="__codelineno-51-2"></a><span class="n">naive_forecast</span><span class="p">[:</span><span class="mi">10</span><span class="p">],</span> <span class="n">naive_forecast</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">:]</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (0   -2.014957
     1   -2.061161
     2   -2.073009
     3   -2.049314
     4   -2.044575
     5   -2.018511
     6   -1.967567
     7   -1.967567
     8   -2.001924
     9   -2.063531
     Name: T (degC), dtype: float64, 336429    1.134077
     336430    1.129338
     336431    1.122230
     336432    1.126969
     336433    1.105643
     336434    1.087872
     336435    1.085503
     336436    1.073655
     336437    1.059439
     336438    1.035744
     Name: T (degC), dtype: float64)
</pre>
</div>

<p><a name=""></a></p>
<h3 id="evaluate-model">Evaluate Model</h3>
<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-52-1">1</a></span>
<span class="normal"><a href="#__codelineno-52-2">2</a></span>
<span class="normal"><a href="#__codelineno-52-3">3</a></span>
<span class="normal"><a href="#__codelineno-52-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<a id="__codelineno-52-2" name="__codelineno-52-2"></a><span class="n">offset</span> <span class="o">=</span> <span class="mi">300</span> <span class="c1"># offset the values by 300 timesteps </span>
<a id="__codelineno-52-3" name="__codelineno-52-3"></a><span class="n">plot_time_series</span><span class="p">(</span><span class="n">timesteps</span><span class="o">=</span><span class="n">mod_0_x</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">mod_0_y</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test data&quot;</span><span class="p">)</span>
<a id="__codelineno-52-4" name="__codelineno-52-4"></a><span class="n">plot_time_series</span><span class="p">(</span><span class="n">timesteps</span><span class="o">=</span><span class="n">mod_0_x</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">values</span><span class="o">=</span><span class="n">naive_forecast</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Naive forecast&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<img alt="ts-weather-7" src="../../../images/ts-weather-7.png" /></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-53-1">1</a></span>
<span class="normal"><a href="#__codelineno-53-2">2</a></span>
<span class="normal"><a href="#__codelineno-53-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1"></a><span class="n">model_0_results</span> <span class="o">=</span> <span class="n">evaluate_preds</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">mod_0_y</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>
<a id="__codelineno-53-2" name="__codelineno-53-2"></a>                               <span class="n">y_pred</span><span class="o">=</span><span class="n">naive_forecast</span><span class="p">)</span>
<a id="__codelineno-53-3" name="__codelineno-53-3"></a><span class="n">model_0_results</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    {'mae': 0.019306783,
     'mape': 13.094261,
     'mase': 1.000004,
     'mse': 0.00086315005,
     'rmse': 0.029379414}
</pre>
</div>

<p><a name="model-1"></a></p>
<h2 id="model-1-dense-window30-horizon7"><strong>Model 1: Dense (window=30, horizon=7)</strong></h2>
<p><a name=""></a></p>
<h3 id="adjust-data_1">Adjust Data</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-54-1">1</a></span>
<span class="normal"><a href="#__codelineno-54-2">2</a></span>
<span class="normal"><a href="#__codelineno-54-3">3</a></span>
<span class="normal"><a href="#__codelineno-54-4">4</a></span>
<span class="normal"><a href="#__codelineno-54-5">5</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1"></a><span class="n">HORIZON</span> <span class="o">=</span> <span class="mi">7</span>
<a id="__codelineno-54-2" name="__codelineno-54-2"></a><span class="n">WINDOW_SIZE</span> <span class="o">=</span> <span class="mi">30</span>
<a id="__codelineno-54-3" name="__codelineno-54-3"></a>
<a id="__codelineno-54-4" name="__codelineno-54-4"></a><span class="n">full_windows</span><span class="p">,</span> <span class="n">full_labels</span> <span class="o">=</span> <span class="n">make_windows</span><span class="p">(</span><span class="n">prices</span><span class="p">,</span> <span class="n">window_size</span><span class="o">=</span><span class="n">WINDOW_SIZE</span><span class="p">,</span> <span class="n">horizon</span><span class="o">=</span><span class="n">HORIZON</span><span class="p">)</span>
<a id="__codelineno-54-5" name="__codelineno-54-5"></a><span class="nb">len</span><span class="p">(</span><span class="n">full_windows</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">full_labels</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (420515, 420515)
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-55-1">1</a></span>
<span class="normal"><a href="#__codelineno-55-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1"></a><span class="n">train_windows</span><span class="p">,</span> <span class="n">test_windows</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">test_labels</span> <span class="o">=</span> <span class="n">make_train_test_splits</span><span class="p">(</span><span class="n">windows</span><span class="o">=</span><span class="n">full_windows</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">full_labels</span><span class="p">,</span> <span class="n">test_split</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<a id="__codelineno-55-2" name="__codelineno-55-2"></a><span class="nb">len</span><span class="p">(</span><span class="n">train_windows</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_windows</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_labels</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_labels</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (336412, 84103, 336412, 84103)
</pre>
</div>

<p><a name=""></a></p>
<h3 id="create-compile-and-run-model_1">Create, Compile, and Run Model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-56-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-56-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-56-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-56-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-56-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-56-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-56-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-56-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-56-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-56-10">10</a></span>
<span class="normal"><a href="#__codelineno-56-11">11</a></span>
<span class="normal"><a href="#__codelineno-56-12">12</a></span>
<span class="normal"><a href="#__codelineno-56-13">13</a></span>
<span class="normal"><a href="#__codelineno-56-14">14</a></span>
<span class="normal"><a href="#__codelineno-56-15">15</a></span>
<span class="normal"><a href="#__codelineno-56-16">16</a></span>
<span class="normal"><a href="#__codelineno-56-17">17</a></span>
<span class="normal"><a href="#__codelineno-56-18">18</a></span>
<span class="normal"><a href="#__codelineno-56-19">19</a></span>
<span class="normal"><a href="#__codelineno-56-20">20</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1"></a><span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">set_seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<a id="__codelineno-56-2" name="__codelineno-56-2"></a>
<a id="__codelineno-56-3" name="__codelineno-56-3"></a><span class="c1"># CREATE MODEL (same as model_1 except with different data input size)</span>
<a id="__codelineno-56-4" name="__codelineno-56-4"></a><span class="n">model_1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
<a id="__codelineno-56-5" name="__codelineno-56-5"></a>  <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;relu&quot;</span><span class="p">),</span>
<a id="__codelineno-56-6" name="__codelineno-56-6"></a>  <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">HORIZON</span><span class="p">)</span>
<a id="__codelineno-56-7" name="__codelineno-56-7"></a><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;model_1_dense&quot;</span><span class="p">)</span>
<a id="__codelineno-56-8" name="__codelineno-56-8"></a>
<a id="__codelineno-56-9" name="__codelineno-56-9"></a><span class="c1"># COMPILE MODEL</span>
<a id="__codelineno-56-10" name="__codelineno-56-10"></a><span class="n">model_1</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s2">&quot;mae&quot;</span><span class="p">,</span>
<a id="__codelineno-56-11" name="__codelineno-56-11"></a>                <span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">())</span>
<a id="__codelineno-56-12" name="__codelineno-56-12"></a>
<a id="__codelineno-56-13" name="__codelineno-56-13"></a><span class="c1"># FIT MODEL</span>
<a id="__codelineno-56-14" name="__codelineno-56-14"></a><span class="n">model_1</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_windows</span><span class="p">,</span>
<a id="__codelineno-56-15" name="__codelineno-56-15"></a>            <span class="n">train_labels</span><span class="p">,</span>
<a id="__codelineno-56-16" name="__codelineno-56-16"></a>            <span class="n">batch_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
<a id="__codelineno-56-17" name="__codelineno-56-17"></a>            <span class="n">epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-56-18" name="__codelineno-56-18"></a>            <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-56-19" name="__codelineno-56-19"></a>            <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">test_windows</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">),</span>
<a id="__codelineno-56-20" name="__codelineno-56-20"></a>            <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">create_model_checkpoint</span><span class="p">(</span><span class="n">model_name</span><span class="o">=</span><span class="n">model_1</span><span class="o">.</span><span class="n">name</span><span class="p">)])</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    INFO:tensorflow:Assets written to: model_experiments/model_1_dense/assets
    (keras.callbacks.History at 0x7f6661d09ed0)
</pre>
</div>

<p><a name=""></a></p>
<h3 id="evaluate-model_1">Evaluate Model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-57-1">1</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1"></a><span class="n">model_1</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">test_windows</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    2629/2629 [==============================] - 6s 2ms/step - loss: 0.3824
    0.3823564350605011
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-58-1">1</a></span>
<span class="normal"><a href="#__codelineno-58-2">2</a></span>
<span class="normal"><a href="#__codelineno-58-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1"></a><span class="c1"># Load in best version of model_1 and evaluate</span>
<a id="__codelineno-58-2" name="__codelineno-58-2"></a><span class="n">model_1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="s2">&quot;model_experiments/model_1_dense/&quot;</span><span class="p">)</span>
<a id="__codelineno-58-3" name="__codelineno-58-3"></a><span class="n">model_1</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">test_windows</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    2629/2629 [==============================] - 6s 2ms/step - loss: 0.3824
    0.3823564350605011
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-59-1">1</a></span>
<span class="normal"><a href="#__codelineno-59-2">2</a></span>
<span class="normal"><a href="#__codelineno-59-3">3</a></span>
<span class="normal"><a href="#__codelineno-59-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1"></a><span class="c1"># The predictions are going to be 7 steps at a time (this is the HORIZON size)</span>
<a id="__codelineno-59-2" name="__codelineno-59-2"></a><span class="n">model_1_preds</span> <span class="o">=</span> <span class="n">make_preds</span><span class="p">(</span><span class="n">model_1</span><span class="p">,</span>
<a id="__codelineno-59-3" name="__codelineno-59-3"></a>                           <span class="n">input_data</span><span class="o">=</span><span class="n">test_windows</span><span class="p">)</span>
<a id="__codelineno-59-4" name="__codelineno-59-4"></a><span class="n">model_1_preds</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (tf.Tensor: shape=(5, 7), dtype=float32, numpy=
    array([[17.249609, 17.100615, 16.99247 , 16.85171 , 16.87737 , 16.676012,
            16.517342],
           [17.051706, 16.961212, 16.77145 , 16.689157, 16.607464, 16.557093,
            16.300009],
           [16.823112, 16.763466, 16.553705, 16.413565, 16.283573, 16.198637,
            15.992966],
           [16.50794 , 16.393263, 16.236275, 16.11251 , 16.019592, 15.820904,
            15.609121],
           [16.447262, 16.299593, 16.120775, 15.986055, 15.925607, 15.761848,
            15.614763]], dtype=float32))
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-60-1">1</a></span>
<span class="normal"><a href="#__codelineno-60-2">2</a></span>
<span class="normal"><a href="#__codelineno-60-3">3</a></span>
<span class="normal"><a href="#__codelineno-60-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1"></a><span class="c1"># Get model_3 results aggregated to single values</span>
<a id="__codelineno-60-2" name="__codelineno-60-2"></a><span class="n">model_1_results</span> <span class="o">=</span> <span class="n">evaluate_preds</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">test_labels</span><span class="p">),</span>
<a id="__codelineno-60-3" name="__codelineno-60-3"></a>                                 <span class="n">y_pred</span><span class="o">=</span><span class="n">model_1_preds</span><span class="p">)</span>
<a id="__codelineno-60-4" name="__codelineno-60-4"></a><span class="n">model_1_results</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    {'mae': 0.38235667,
     'mape': 53578.86,
     'mase': 2.307819,
     'mse': 0.37676606,
     'rmse': 0.4397074}
</pre>
</div>

<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-61-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-61-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-61-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-61-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-61-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-61-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-61-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-61-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-61-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-61-10">10</a></span>
<span class="normal"><a href="#__codelineno-61-11">11</a></span>
<span class="normal"><a href="#__codelineno-61-12">12</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1"></a><span class="n">offset</span> <span class="o">=</span> <span class="mi">300</span>
<a id="__codelineno-61-2" name="__codelineno-61-2"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<a id="__codelineno-61-3" name="__codelineno-61-3"></a><span class="c1"># Plot model_3_preds by aggregating them (note: this condenses information so the preds will look fruther ahead than the test data)</span>
<a id="__codelineno-61-4" name="__codelineno-61-4"></a><span class="n">plot_time_series</span><span class="p">(</span><span class="n">timesteps</span><span class="o">=</span><span class="n">X_test</span><span class="p">[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">test_windows</span><span class="p">):],</span> 
<a id="__codelineno-61-5" name="__codelineno-61-5"></a>                 <span class="n">values</span><span class="o">=</span><span class="n">test_labels</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> 
<a id="__codelineno-61-6" name="__codelineno-61-6"></a>                 <span class="n">start</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span> 
<a id="__codelineno-61-7" name="__codelineno-61-7"></a>                 <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test_data&quot;</span><span class="p">)</span>
<a id="__codelineno-61-8" name="__codelineno-61-8"></a><span class="n">plot_time_series</span><span class="p">(</span><span class="n">timesteps</span><span class="o">=</span><span class="n">X_test</span><span class="p">[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">test_windows</span><span class="p">):],</span> 
<a id="__codelineno-61-9" name="__codelineno-61-9"></a>                 <span class="n">values</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">model_1_preds</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> 
<a id="__codelineno-61-10" name="__codelineno-61-10"></a>                 <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
<a id="__codelineno-61-11" name="__codelineno-61-11"></a>                 <span class="n">start</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span> 
<a id="__codelineno-61-12" name="__codelineno-61-12"></a>                 <span class="n">label</span><span class="o">=</span><span class="s2">&quot;model_1_preds&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<img alt="ts-weather-8" src="../../../images/ts-weather-8.png" /></p>
<p><a name="model-2"></a></p>
<h2 id="model-2-conv1d"><strong>Model 2: Conv1D</strong></h2>
<p><a name=""></a></p>
<h3 id="adjust-data_2">Adjust Data</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-62-1">1</a></span>
<span class="normal"><a href="#__codelineno-62-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1"></a><span class="n">HORIZON</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># predict next day</span>
<a id="__codelineno-62-2" name="__codelineno-62-2"></a><span class="n">WINDOW_SIZE</span> <span class="o">=</span> <span class="mi">7</span> <span class="c1"># use previous week worth of data</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-63-1">1</a></span>
<span class="normal"><a href="#__codelineno-63-2">2</a></span>
<span class="normal"><a href="#__codelineno-63-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1"></a><span class="c1"># Create windowed dataset</span>
<a id="__codelineno-63-2" name="__codelineno-63-2"></a><span class="n">full_windows</span><span class="p">,</span> <span class="n">full_labels</span> <span class="o">=</span> <span class="n">make_windows</span><span class="p">(</span><span class="n">prices</span><span class="p">,</span> <span class="n">window_size</span><span class="o">=</span><span class="n">WINDOW_SIZE</span><span class="p">,</span> <span class="n">horizon</span><span class="o">=</span><span class="n">HORIZON</span><span class="p">)</span>
<a id="__codelineno-63-3" name="__codelineno-63-3"></a><span class="nb">len</span><span class="p">(</span><span class="n">full_windows</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">full_labels</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (420544, 420544)
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-64-1">1</a></span>
<span class="normal"><a href="#__codelineno-64-2">2</a></span>
<span class="normal"><a href="#__codelineno-64-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1"></a><span class="c1"># Create train/test splits</span>
<a id="__codelineno-64-2" name="__codelineno-64-2"></a><span class="n">train_windows</span><span class="p">,</span> <span class="n">test_windows</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">test_labels</span> <span class="o">=</span> <span class="n">make_train_test_splits</span><span class="p">(</span><span class="n">full_windows</span><span class="p">,</span> <span class="n">full_labels</span><span class="p">)</span>
<a id="__codelineno-64-3" name="__codelineno-64-3"></a><span class="nb">len</span><span class="p">(</span><span class="n">train_windows</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_windows</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_labels</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_labels</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (336435, 84109, 336435, 84109)
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-65-1">1</a></span>
<span class="normal"><a href="#__codelineno-65-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1"></a><span class="c1"># Check data sample shapes</span>
<a id="__codelineno-65-2" name="__codelineno-65-2"></a><span class="n">train_windows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="c1"># returns (WINDOW_SIZE, )</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (7,)
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-66-1">1</a></span>
<span class="normal"><a href="#__codelineno-66-2">2</a></span>
<span class="normal"><a href="#__codelineno-66-3">3</a></span>
<span class="normal"><a href="#__codelineno-66-4">4</a></span>
<span class="normal"><a href="#__codelineno-66-5">5</a></span>
<span class="normal"><a href="#__codelineno-66-6">6</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1"></a><span class="c1"># Before we pass our data to the Conv1D layer, we have to reshape it in order to make sure it works</span>
<a id="__codelineno-66-2" name="__codelineno-66-2"></a><span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">train_windows</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-66-3" name="__codelineno-66-3"></a><span class="n">expand_dims_layer</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Lambda</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span> <span class="c1"># add an extra dimension for timesteps</span>
<a id="__codelineno-66-4" name="__codelineno-66-4"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Original shape: </span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># (WINDOW_SIZE)</span>
<a id="__codelineno-66-5" name="__codelineno-66-5"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expanded shape: </span><span class="si">{</span><span class="n">expand_dims_layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># (WINDOW_SIZE, input_dim) </span>
<a id="__codelineno-66-6" name="__codelineno-66-6"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Original values with expanded shape:</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">expand_dims_layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Original shape: (7,)
    Expanded shape: (7, 1)
    Original values with expanded shape:
     [[-8.02]
     [-8.41]
     [-8.51]
     [-8.31]
     [-8.27]
     [-8.05]
     [-7.62]]
</pre>
</div>

<p><a name=""></a></p>
<h3 id="create-compile-and-run-model_2">Create, Compile, and Run Model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-67-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-67-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-67-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-67-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-67-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-67-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-67-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-67-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-67-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-67-10">10</a></span>
<span class="normal"><a href="#__codelineno-67-11">11</a></span>
<span class="normal"><a href="#__codelineno-67-12">12</a></span>
<span class="normal"><a href="#__codelineno-67-13">13</a></span>
<span class="normal"><a href="#__codelineno-67-14">14</a></span>
<span class="normal"><a href="#__codelineno-67-15">15</a></span>
<span class="normal"><a href="#__codelineno-67-16">16</a></span>
<span class="normal"><a href="#__codelineno-67-17">17</a></span>
<span class="normal"><a href="#__codelineno-67-18">18</a></span>
<span class="normal"><a href="#__codelineno-67-19">19</a></span>
<span class="normal"><a href="#__codelineno-67-20">20</a></span>
<span class="normal"><a href="#__codelineno-67-21">21</a></span>
<span class="normal"><a href="#__codelineno-67-22">22</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1"></a><span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">set_seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<a id="__codelineno-67-2" name="__codelineno-67-2"></a>
<a id="__codelineno-67-3" name="__codelineno-67-3"></a><span class="c1"># CREATE MODEL</span>
<a id="__codelineno-67-4" name="__codelineno-67-4"></a><span class="n">model_2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
<a id="__codelineno-67-5" name="__codelineno-67-5"></a>  <span class="c1"># Create Lambda layer to reshape inputs, without this layer, the model will error</span>
<a id="__codelineno-67-6" name="__codelineno-67-6"></a>  <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Lambda</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)),</span> <span class="c1"># resize the inputs to adjust for window size / Conv1D 3D input requirements</span>
<a id="__codelineno-67-7" name="__codelineno-67-7"></a>  <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Conv1D</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s2">&quot;causal&quot;</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;relu&quot;</span><span class="p">),</span>
<a id="__codelineno-67-8" name="__codelineno-67-8"></a>  <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">HORIZON</span><span class="p">)</span>
<a id="__codelineno-67-9" name="__codelineno-67-9"></a><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;model_2_conv1D&quot;</span><span class="p">)</span>
<a id="__codelineno-67-10" name="__codelineno-67-10"></a>
<a id="__codelineno-67-11" name="__codelineno-67-11"></a><span class="c1"># COMPILE MODEL</span>
<a id="__codelineno-67-12" name="__codelineno-67-12"></a><span class="n">model_2</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s2">&quot;mae&quot;</span><span class="p">,</span>
<a id="__codelineno-67-13" name="__codelineno-67-13"></a>                <span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">())</span>
<a id="__codelineno-67-14" name="__codelineno-67-14"></a>
<a id="__codelineno-67-15" name="__codelineno-67-15"></a><span class="c1"># FIT MODEL</span>
<a id="__codelineno-67-16" name="__codelineno-67-16"></a><span class="n">model_2</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_windows</span><span class="p">,</span>
<a id="__codelineno-67-17" name="__codelineno-67-17"></a>            <span class="n">train_labels</span><span class="p">,</span>
<a id="__codelineno-67-18" name="__codelineno-67-18"></a>            <span class="n">batch_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> 
<a id="__codelineno-67-19" name="__codelineno-67-19"></a>            <span class="n">epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-67-20" name="__codelineno-67-20"></a>            <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-67-21" name="__codelineno-67-21"></a>            <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">test_windows</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">),</span>
<a id="__codelineno-67-22" name="__codelineno-67-22"></a>            <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">create_model_checkpoint</span><span class="p">(</span><span class="n">model_name</span><span class="o">=</span><span class="n">model_2</span><span class="o">.</span><span class="n">name</span><span class="p">)])</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    INFO:tensorflow:Assets written to: model_experiments/model_2_conv1D/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_conv1D/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_conv1D/assets
    INFO:tensorflow:Assets written to: model_experiments/model_2_conv1D/assets
    (keras.callbacks.History at 0x7f6666c34a90)
</pre>
</div>

<p><a name=""></a></p>
<h3 id="evaluate-model_2">Evaluate Model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-68-1">1</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1"></a><span class="n">model_2</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Model: "model_2_conv1D"
    _________________________________________________________________
     Layer (type)                Output Shape              Param #   
    =================================================================
     lambda_1 (Lambda)           (None, 1, 7)              0         

     conv1d (Conv1D)             (None, 1, 128)            4608      

     dense_2 (Dense)             (None, 1, 1)              129       

    =================================================================
    Total params: 4,737
    Trainable params: 4,737
    Non-trainable params: 0
    _________________________________________________________________
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-69-1">1</a></span>
<span class="normal"><a href="#__codelineno-69-2">2</a></span>
<span class="normal"><a href="#__codelineno-69-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1"></a><span class="c1"># Load in best performing Conv1D model and evaluate it on the test data</span>
<a id="__codelineno-69-2" name="__codelineno-69-2"></a><span class="n">model_2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="s2">&quot;model_experiments/model_2_conv1D&quot;</span><span class="p">)</span>
<a id="__codelineno-69-3" name="__codelineno-69-3"></a><span class="n">model_2</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">test_windows</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    2629/2629 [==============================] - 10s 4ms/step - loss: 0.1316
    0.13161008059978485
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-70-1">1</a></span>
<span class="normal"><a href="#__codelineno-70-2">2</a></span>
<span class="normal"><a href="#__codelineno-70-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1"></a><span class="c1"># Make predictions</span>
<a id="__codelineno-70-2" name="__codelineno-70-2"></a><span class="n">model_2_preds</span> <span class="o">=</span> <span class="n">make_preds</span><span class="p">(</span><span class="n">model_2</span><span class="p">,</span> <span class="n">test_windows</span><span class="p">)</span>
<a id="__codelineno-70-3" name="__codelineno-70-3"></a><span class="n">model_2_preds</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (tf.Tensor: shape=(10,), dtype=float32, numpy=
    array([17.277367, 17.02112 , 16.778587, 16.547289, 16.379845, 16.107668,
           15.943503, 15.86677 , 15.689507, 15.839124], dtype=float32))
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-71-1">1</a></span>
<span class="normal"><a href="#__codelineno-71-2">2</a></span>
<span class="normal"><a href="#__codelineno-71-3">3</a></span>
<span class="normal"><a href="#__codelineno-71-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1"></a><span class="c1"># Evaluate predictions</span>
<a id="__codelineno-71-2" name="__codelineno-71-2"></a><span class="n">model_2_results</span> <span class="o">=</span> <span class="n">evaluate_preds</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">test_labels</span><span class="p">),</span>
<a id="__codelineno-71-3" name="__codelineno-71-3"></a>                                 <span class="n">y_pred</span><span class="o">=</span><span class="n">model_2_preds</span><span class="p">)</span>
<a id="__codelineno-71-4" name="__codelineno-71-4"></a><span class="n">model_2_results</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    {'mae': 0.13160992,
     'mape': 21096.268,
     'mase': 0.79428935,
     'mse': 0.04322096,
     'rmse': 0.20789652}
</pre>
</div>

<p><a name="model-3"></a></p>
<h2 id="model-3-rnn-lstm"><strong>Model 3: RNN (LSTM)</strong></h2>
<p><a name=""></a></p>
<h3 id="adjust-data_3">Adjust Data</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-72-1">1</a></span>
<span class="normal"><a href="#__codelineno-72-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1"></a><span class="n">HORIZON</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># predict next day</span>
<a id="__codelineno-72-2" name="__codelineno-72-2"></a><span class="n">WINDOW_SIZE</span> <span class="o">=</span> <span class="mi">7</span> <span class="c1"># use previous week worth of data</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-73-1">1</a></span>
<span class="normal"><a href="#__codelineno-73-2">2</a></span>
<span class="normal"><a href="#__codelineno-73-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1"></a><span class="c1"># Create windowed dataset</span>
<a id="__codelineno-73-2" name="__codelineno-73-2"></a><span class="n">full_windows</span><span class="p">,</span> <span class="n">full_labels</span> <span class="o">=</span> <span class="n">make_windows</span><span class="p">(</span><span class="n">prices</span><span class="p">,</span> <span class="n">window_size</span><span class="o">=</span><span class="n">WINDOW_SIZE</span><span class="p">,</span> <span class="n">horizon</span><span class="o">=</span><span class="n">HORIZON</span><span class="p">)</span>
<a id="__codelineno-73-3" name="__codelineno-73-3"></a><span class="nb">len</span><span class="p">(</span><span class="n">full_windows</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">full_labels</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (420544, 420544)
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-74-1">1</a></span>
<span class="normal"><a href="#__codelineno-74-2">2</a></span>
<span class="normal"><a href="#__codelineno-74-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1"></a><span class="c1"># Create train/test splits</span>
<a id="__codelineno-74-2" name="__codelineno-74-2"></a><span class="n">train_windows</span><span class="p">,</span> <span class="n">test_windows</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">test_labels</span> <span class="o">=</span> <span class="n">make_train_test_splits</span><span class="p">(</span><span class="n">full_windows</span><span class="p">,</span> <span class="n">full_labels</span><span class="p">)</span>
<a id="__codelineno-74-3" name="__codelineno-74-3"></a><span class="nb">len</span><span class="p">(</span><span class="n">train_windows</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_windows</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_labels</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_labels</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (336435, 84109, 336435, 84109)
</pre>
</div>

<p><a name=""></a></p>
<h3 id="create-compile-and-run-model_3">Create, Compile, and Run Model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-75-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-75-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-75-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-75-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-75-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-75-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-75-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-75-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-75-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-75-10">10</a></span>
<span class="normal"><a href="#__codelineno-75-11">11</a></span>
<span class="normal"><a href="#__codelineno-75-12">12</a></span>
<span class="normal"><a href="#__codelineno-75-13">13</a></span>
<span class="normal"><a href="#__codelineno-75-14">14</a></span>
<span class="normal"><a href="#__codelineno-75-15">15</a></span>
<span class="normal"><a href="#__codelineno-75-16">16</a></span>
<span class="normal"><a href="#__codelineno-75-17">17</a></span>
<span class="normal"><a href="#__codelineno-75-18">18</a></span>
<span class="normal"><a href="#__codelineno-75-19">19</a></span>
<span class="normal"><a href="#__codelineno-75-20">20</a></span>
<span class="normal"><a href="#__codelineno-75-21">21</a></span>
<span class="normal"><a href="#__codelineno-75-22">22</a></span>
<span class="normal"><a href="#__codelineno-75-23">23</a></span>
<span class="normal"><a href="#__codelineno-75-24">24</a></span>
<span class="normal"><a href="#__codelineno-75-25">25</a></span>
<span class="normal"><a href="#__codelineno-75-26">26</a></span>
<span class="normal"><a href="#__codelineno-75-27">27</a></span>
<span class="normal"><a href="#__codelineno-75-28">28</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1"></a><span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">set_seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<a id="__codelineno-75-2" name="__codelineno-75-2"></a>
<a id="__codelineno-75-3" name="__codelineno-75-3"></a><span class="c1"># CREATE MODEL</span>
<a id="__codelineno-75-4" name="__codelineno-75-4"></a><span class="c1"># Let&#39;s build an LSTM model with the Functional API</span>
<a id="__codelineno-75-5" name="__codelineno-75-5"></a><span class="n">inputs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">WINDOW_SIZE</span><span class="p">))</span>
<a id="__codelineno-75-6" name="__codelineno-75-6"></a><span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Lambda</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))(</span><span class="n">inputs</span><span class="p">)</span> <span class="c1"># expand input dimension to be compatible with LSTM</span>
<a id="__codelineno-75-7" name="__codelineno-75-7"></a><span class="c1"># print(x.shape)</span>
<a id="__codelineno-75-8" name="__codelineno-75-8"></a><span class="c1"># x = layers.LSTM(128, activation=&quot;relu&quot;, return_sequences=True)(x) # this layer will error if the inputs are not the right shape</span>
<a id="__codelineno-75-9" name="__codelineno-75-9"></a><span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;relu&quot;</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span> <span class="c1"># using the tanh loss function results in a massive error</span>
<a id="__codelineno-75-10" name="__codelineno-75-10"></a><span class="c1"># print(x.shape)</span>
<a id="__codelineno-75-11" name="__codelineno-75-11"></a><span class="c1"># Add another optional dense layer (you could add more of these to see if they improve model performance)</span>
<a id="__codelineno-75-12" name="__codelineno-75-12"></a><span class="c1"># x = layers.Dense(32, activation=&quot;relu&quot;)(x)</span>
<a id="__codelineno-75-13" name="__codelineno-75-13"></a><span class="n">output</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">HORIZON</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-75-14" name="__codelineno-75-14"></a><span class="n">model_3</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">output</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;model_3_lstm&quot;</span><span class="p">)</span>
<a id="__codelineno-75-15" name="__codelineno-75-15"></a>
<a id="__codelineno-75-16" name="__codelineno-75-16"></a><span class="c1"># COMPILE MODEL</span>
<a id="__codelineno-75-17" name="__codelineno-75-17"></a><span class="n">model_3</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s2">&quot;mae&quot;</span><span class="p">,</span>
<a id="__codelineno-75-18" name="__codelineno-75-18"></a>                <span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">())</span>
<a id="__codelineno-75-19" name="__codelineno-75-19"></a>
<a id="__codelineno-75-20" name="__codelineno-75-20"></a><span class="c1"># FIT MODEL</span>
<a id="__codelineno-75-21" name="__codelineno-75-21"></a><span class="c1"># Seems when saving the model several warnings are appearing: https://github.com/tensorflow/tensorflow/issues/47554 </span>
<a id="__codelineno-75-22" name="__codelineno-75-22"></a><span class="n">model_3</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_windows</span><span class="p">,</span>
<a id="__codelineno-75-23" name="__codelineno-75-23"></a>            <span class="n">train_labels</span><span class="p">,</span>
<a id="__codelineno-75-24" name="__codelineno-75-24"></a>            <span class="n">epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-75-25" name="__codelineno-75-25"></a>            <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-75-26" name="__codelineno-75-26"></a>            <span class="n">batch_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
<a id="__codelineno-75-27" name="__codelineno-75-27"></a>            <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">test_windows</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">),</span>
<a id="__codelineno-75-28" name="__codelineno-75-28"></a>            <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">create_model_checkpoint</span><span class="p">(</span><span class="n">model_name</span><span class="o">=</span><span class="n">model_3</span><span class="o">.</span><span class="n">name</span><span class="p">)])</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    WARNING:tensorflow:Layer lstm will not use cuDNN kernels since it doesn't meet the criteria. It will use a generic GPU kernel as fallback when running on GPU.
    INFO:tensorflow:Assets written to: model_experiments/model_3_lstm/assets
    WARNING:absl:(keras.layers.recurrent.LSTMCell object at 0x7f6665af9e10) has the same name 'LSTMCell' as a built-in Keras object. Consider renaming (class 'keras.layers.recurrent.LSTMCell') to avoid naming conflicts when loading with `tf.keras.models.load_model`. If renaming is not possible, pass the object in the `custom_objects` parameter of the load function.
    INFO:tensorflow:Assets written to: model_experiments/model_3_lstm/assets
    INFO:tensorflow:Assets written to: model_experiments/model_3_lstm/assets
    WARNING:absl:(keras.layers.recurrent.LSTMCell object at 0x7f6665af9e10) has the same name 'LSTMCell' as a built-in Keras object. Consider renaming (class 'keras.layers.recurrent.LSTMCell') to avoid naming conflicts when loading with `tf.keras.models.load_model`. If renaming is not possible, pass the object in the `custom_objects` parameter of the load function.
    INFO:tensorflow:Assets written to: model_experiments/model_3_lstm/assets
    INFO:tensorflow:Assets written to: model_experiments/model_3_lstm/assets
    WARNING:absl:(keras.layers.recurrent.LSTMCell object at 0x7f6665af9e10) has the same name 'LSTMCell' as a built-in Keras object. Consider renaming (class 'keras.layers.recurrent.LSTMCell') to avoid naming conflicts when loading with `tf.keras.models.load_model`. If renaming is not possible, pass the object in the `custom_objects` parameter of the load function.
    INFO:tensorflow:Assets written to: model_experiments/model_3_lstm/assets
    INFO:tensorflow:Assets written to: model_experiments/model_3_lstm/assets
    WARNING:absl:(keras.layers.recurrent.LSTMCell object at 0x7f6665af9e10) has the same name 'LSTMCell' as a built-in Keras object. Consider renaming (class 'keras.layers.recurrent.LSTMCell') to avoid naming conflicts when loading with `tf.keras.models.load_model`. If renaming is not possible, pass the object in the `custom_objects` parameter of the load function.
    INFO:tensorflow:Assets written to: model_experiments/model_3_lstm/assets
    INFO:tensorflow:Assets written to: model_experiments/model_3_lstm/assets
    WARNING:absl:(keras.layers.recurrent.LSTMCell object at 0x7f6665af9e10) has the same name 'LSTMCell' as a built-in Keras object. Consider renaming (class 'keras.layers.recurrent.LSTMCell') to avoid naming conflicts when loading with `tf.keras.models.load_model`. If renaming is not possible, pass the object in the `custom_objects` parameter of the load function.
    (keras.callbacks.History at 0x7f66613d2e50)
</pre>
</div>

<p><a name=""></a></p>
<h3 id="evaluate-model_3">Evaluate Model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-76-1">1</a></span>
<span class="normal"><a href="#__codelineno-76-2">2</a></span>
<span class="normal"><a href="#__codelineno-76-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-76-1" name="__codelineno-76-1"></a><span class="c1"># Load in best version of model 5 and evaluate on the test data</span>
<a id="__codelineno-76-2" name="__codelineno-76-2"></a><span class="n">model_3</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="s2">&quot;model_experiments/model_3_lstm/&quot;</span><span class="p">)</span>
<a id="__codelineno-76-3" name="__codelineno-76-3"></a><span class="n">model_3</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">test_windows</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    WARNING:tensorflow:Layer lstm will not use cuDNN kernels since it doesn't meet the criteria. It will use a generic GPU kernel as fallback when running on GPU.
    WARNING:tensorflow:Layer lstm will not use cuDNN kernels since it doesn't meet the criteria. It will use a generic GPU kernel as fallback when running on GPU.
    2629/2629 [==============================] - 13s 5ms/step - loss: 0.1325
    0.1324942260980606
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-77-1">1</a></span>
<span class="normal"><a href="#__codelineno-77-2">2</a></span>
<span class="normal"><a href="#__codelineno-77-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-77-1" name="__codelineno-77-1"></a><span class="c1"># Make predictions with our LSTM model</span>
<a id="__codelineno-77-2" name="__codelineno-77-2"></a><span class="n">model_3_preds</span> <span class="o">=</span> <span class="n">make_preds</span><span class="p">(</span><span class="n">model_3</span><span class="p">,</span> <span class="n">test_windows</span><span class="p">)</span>
<a id="__codelineno-77-3" name="__codelineno-77-3"></a><span class="n">model_3_preds</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (tf.Tensor: shape=(10,), dtype=float32, numpy=
    array([17.283913, 17.03394 , 16.7935  , 16.560795, 16.391624, 16.124992,
           15.958645, 15.876349, 15.701792, 15.841902], dtype=float32))
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-78-1">1</a></span>
<span class="normal"><a href="#__codelineno-78-2">2</a></span>
<span class="normal"><a href="#__codelineno-78-3">3</a></span>
<span class="normal"><a href="#__codelineno-78-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-78-1" name="__codelineno-78-1"></a><span class="c1"># Evaluate model 5 preds</span>
<a id="__codelineno-78-2" name="__codelineno-78-2"></a><span class="n">model_3_results</span> <span class="o">=</span> <span class="n">evaluate_preds</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">test_labels</span><span class="p">),</span>
<a id="__codelineno-78-3" name="__codelineno-78-3"></a>                                 <span class="n">y_pred</span><span class="o">=</span><span class="n">model_3_preds</span><span class="p">)</span>
<a id="__codelineno-78-4" name="__codelineno-78-4"></a><span class="n">model_3_results</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    {'mae': 0.13249426,
     'mape': 20953.273,
     'mase': 0.7996265,
     'mse': 0.043446194,
     'rmse': 0.20843752}
</pre>
</div>

<p><a name="model-4"></a></p>
<h2 id="model-4-multivariate-time-series-model"><strong>Model 4: Multivariate Time Series Model</strong></h2>
<p><a name=""></a></p>
<h3 id="adjust-data_4">Adjust Data</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-79-1">1</a></span>
<span class="normal"><a href="#__codelineno-79-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-79-1" name="__codelineno-79-1"></a><span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">set_var</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> 
<a id="__codelineno-79-2" name="__codelineno-79-2"></a><span class="n">X</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
        p (mbar)    Tpot (K)    Tdew (degC) rh (%)      VPmax (mbar)    VPact (mbar)    VPdef (mbar)    sh (g/kg)   H2OC (mmol/mol) rho (g/m**3)    Wx          Wy  max     Wx  max     Wy          Day sin     Day cos     Year sin    Year cos
    0   996.520020  265.399994  -8.90       93.300003   3.33            3.11            0.22            1.94        3.12            1307.750000     -0.911955   0.478787    -1.549439   0.813474    0.043619    0.999048    0.009452    0.999955
    1   996.570007  265.010010  -9.28       93.400002   3.23            3.02            0.21            1.89        3.03            1309.800049     -0.518797   0.499249    -1.080827   1.040103    0.087156    0.996195    0.009571    0.999954
    2   996.530029  264.910004  -9.31       93.900002   3.21            3.01            0.20            1.88        3.02            1310.239990     -0.187962   0.027756    -0.623242   0.092032    0.130526    0.991445    0.009691    0.999953
    3   996.510010  265.119995  -9.07       94.199997   3.26            3.07            0.19            1.92        3.08            1309.189941     -0.323359   -0.105066   -0.475528   -0.154509   0.173648    0.984808    0.009810    0.999952
    4   996.510010  265.149994  -9.04       94.099998   3.27            3.08            0.19            1.92        3.09            1309.000000     -0.264351   -0.180328   -0.520442   -0.355021   0.216440    0.976296    0.009930    0.999951
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-80-1">1</a></span>
<span class="normal"><a href="#__codelineno-80-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-80-1" name="__codelineno-80-1"></a><span class="n">y</span> <span class="o">=</span> <span class="n">var_df</span>
<a id="__codelineno-80-2" name="__codelineno-80-2"></a><span class="n">y</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    0   -8.02
    1   -8.41
    2   -8.51
    3   -8.31
    4   -8.27
    Name: T (degC), dtype: float64
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-81-1">1</a></span>
<span class="normal"><a href="#__codelineno-81-2">2</a></span>
<span class="normal"><a href="#__codelineno-81-3">3</a></span>
<span class="normal"><a href="#__codelineno-81-4">4</a></span>
<span class="normal"><a href="#__codelineno-81-5">5</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-81-1" name="__codelineno-81-1"></a><span class="c1"># Make train and test sets</span>
<a id="__codelineno-81-2" name="__codelineno-81-2"></a><span class="n">split_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.8</span><span class="p">)</span>
<a id="__codelineno-81-3" name="__codelineno-81-3"></a><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:</span><span class="n">split_size</span><span class="p">],</span> <span class="n">y</span><span class="p">[:</span><span class="n">split_size</span><span class="p">]</span>
<a id="__codelineno-81-4" name="__codelineno-81-4"></a><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">split_size</span><span class="p">:],</span> <span class="n">y</span><span class="p">[</span><span class="n">split_size</span><span class="p">:]</span>
<a id="__codelineno-81-5" name="__codelineno-81-5"></a><span class="nb">len</span><span class="p">(</span><span class="n">X_train</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_train</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_test</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (336440, 336440, 84111, 84111)
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-82-1">1</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-82-1" name="__codelineno-82-1"></a><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (336440, 18)
</pre>
</div>

<p><a name=""></a></p>
<h3 id="create-compile-and-run-model_4">Create, Compile, and Run Model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-83-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-83-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-83-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-83-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-83-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-83-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-83-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-83-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-83-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-83-10">10</a></span>
<span class="normal"><a href="#__codelineno-83-11">11</a></span>
<span class="normal"><a href="#__codelineno-83-12">12</a></span>
<span class="normal"><a href="#__codelineno-83-13">13</a></span>
<span class="normal"><a href="#__codelineno-83-14">14</a></span>
<span class="normal"><a href="#__codelineno-83-15">15</a></span>
<span class="normal"><a href="#__codelineno-83-16">16</a></span>
<span class="normal"><a href="#__codelineno-83-17">17</a></span>
<span class="normal"><a href="#__codelineno-83-18">18</a></span>
<span class="normal"><a href="#__codelineno-83-19">19</a></span>
<span class="normal"><a href="#__codelineno-83-20">20</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-83-1" name="__codelineno-83-1"></a><span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">set_seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<a id="__codelineno-83-2" name="__codelineno-83-2"></a>
<a id="__codelineno-83-3" name="__codelineno-83-3"></a><span class="c1"># Make multivariate time series model</span>
<a id="__codelineno-83-4" name="__codelineno-83-4"></a><span class="n">inputs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-83-5" name="__codelineno-83-5"></a><span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;relu&quot;</span><span class="p">)(</span><span class="n">inputs</span><span class="p">)</span>
<a id="__codelineno-83-6" name="__codelineno-83-6"></a><span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;relu&quot;</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span> <span class="c1"># adding an extra layer here should lead to beating the naive Model</span>
<a id="__codelineno-83-7" name="__codelineno-83-7"></a><span class="n">outputs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">HORIZON</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-83-8" name="__codelineno-83-8"></a><span class="n">model_4</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;model_4_dense_multivariate&quot;</span><span class="p">)</span>
<a id="__codelineno-83-9" name="__codelineno-83-9"></a>
<a id="__codelineno-83-10" name="__codelineno-83-10"></a><span class="c1"># Compile</span>
<a id="__codelineno-83-11" name="__codelineno-83-11"></a><span class="n">model_4</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s2">&quot;mae&quot;</span><span class="p">,</span>
<a id="__codelineno-83-12" name="__codelineno-83-12"></a>                <span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">())</span>
<a id="__codelineno-83-13" name="__codelineno-83-13"></a>
<a id="__codelineno-83-14" name="__codelineno-83-14"></a><span class="c1"># Fit</span>
<a id="__codelineno-83-15" name="__codelineno-83-15"></a><span class="n">model_4</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span>
<a id="__codelineno-83-16" name="__codelineno-83-16"></a>            <span class="n">epochs</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<a id="__codelineno-83-17" name="__codelineno-83-17"></a>            <span class="n">batch_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
<a id="__codelineno-83-18" name="__codelineno-83-18"></a>            <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-83-19" name="__codelineno-83-19"></a>            <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">),</span>
<a id="__codelineno-83-20" name="__codelineno-83-20"></a>            <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">create_model_checkpoint</span><span class="p">(</span><span class="n">model_name</span><span class="o">=</span><span class="n">model_4</span><span class="o">.</span><span class="n">name</span><span class="p">)])</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Epoch 1/10
    2628/2629 [============================>.] - ETA: 0s - loss: 3.7433INFO:tensorflow:Assets written to: model_experiments/model_4_dense_multivariate/assets
    INFO:tensorflow:Assets written to: model_experiments/model_4_dense_multivariate/assets
    2629/2629 [==============================] - 13s 5ms/step - loss: 3.7427 - val_loss: 3.1779
    Epoch 2/10
    2628/2629 [============================>.] - ETA: 0s - loss: 1.2714INFO:tensorflow:Assets written to: model_experiments/model_4_dense_multivariate/assets
    INFO:tensorflow:Assets written to: model_experiments/model_4_dense_multivariate/assets
    2629/2629 [==============================] - 11s 4ms/step - loss: 1.2714 - val_loss: 0.8821
    Epoch 3/10
    2629/2629 [==============================] - 10s 4ms/step - loss: 0.8113 - val_loss: 2.1001
    Epoch 4/10
    2629/2629 [==============================] - 10s 4ms/step - loss: 0.5832 - val_loss: 1.7492
    Epoch 5/10
    2621/2629 [============================>.] - ETA: 0s - loss: 0.4073INFO:tensorflow:Assets written to: model_experiments/model_4_dense_multivariate/assets
    INFO:tensorflow:Assets written to: model_experiments/model_4_dense_multivariate/assets
    2629/2629 [==============================] - 11s 4ms/step - loss: 0.4071 - val_loss: 0.3308
    Epoch 6/10
    2619/2629 [============================>.] - ETA: 0s - loss: 0.3046INFO:tensorflow:Assets written to: model_experiments/model_4_dense_multivariate/assets
    INFO:tensorflow:Assets written to: model_experiments/model_4_dense_multivariate/assets
    2629/2629 [==============================] - 11s 4ms/step - loss: 0.3052 - val_loss: 0.1936
    Epoch 7/10
    2629/2629 [==============================] - ETA: 0s - loss: 0.2587INFO:tensorflow:Assets written to: model_experiments/model_4_dense_multivariate/assets
    INFO:tensorflow:Assets written to: model_experiments/model_4_dense_multivariate/assets
    2629/2629 [==============================] - 11s 4ms/step - loss: 0.2587 - val_loss: 0.0786
    Epoch 8/10
    2629/2629 [==============================] - 14s 5ms/step - loss: 0.2296 - val_loss: 0.1550
    Epoch 9/10
    2629/2629 [==============================] - 10s 4ms/step - loss: 0.2188 - val_loss: 0.2338
    Epoch 10/10
    2629/2629 [==============================] - 10s 4ms/step - loss: 0.1769 - val_loss: 0.1046
    (keras.callbacks.History at 0x7f65670c1a50)
</pre>
</div>

<p><a name=""></a></p>
<h3 id="evaluate-model_4">Evaluate Model</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-84-1">1</a></span>
<span class="normal"><a href="#__codelineno-84-2">2</a></span>
<span class="normal"><a href="#__codelineno-84-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-84-1" name="__codelineno-84-1"></a><span class="c1"># Make sure best model is loaded and evaluate</span>
<a id="__codelineno-84-2" name="__codelineno-84-2"></a><span class="n">model_4</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="s2">&quot;model_experiments/model_4_dense_multivariate&quot;</span><span class="p">)</span>
<a id="__codelineno-84-3" name="__codelineno-84-3"></a><span class="n">model_4</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    2629/2629 [==============================] - 7s 2ms/step - loss: 0.0786
    0.07864639163017273
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-85-1">1</a></span>
<span class="normal"><a href="#__codelineno-85-2">2</a></span>
<span class="normal"><a href="#__codelineno-85-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-85-1" name="__codelineno-85-1"></a><span class="c1"># Make predictions on multivariate data</span>
<a id="__codelineno-85-2" name="__codelineno-85-2"></a><span class="n">model_4_preds</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">model_4</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">))</span>
<a id="__codelineno-85-3" name="__codelineno-85-3"></a><span class="n">model_4_preds</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (tf.Tensor: shape=(10,), dtype=float32, numpy=
    array([17.53682 , 17.427748, 17.19194 , 16.96452 , 16.747868, 16.57054 ,
           16.33654 , 16.159548, 16.047775, 15.887789], dtype=float32))
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-86-1">1</a></span>
<span class="normal"><a href="#__codelineno-86-2">2</a></span>
<span class="normal"><a href="#__codelineno-86-3">3</a></span>
<span class="normal"><a href="#__codelineno-86-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-86-1" name="__codelineno-86-1"></a><span class="c1"># Evaluate preds</span>
<a id="__codelineno-86-2" name="__codelineno-86-2"></a><span class="n">model_4_results</span> <span class="o">=</span> <span class="n">evaluate_preds</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">y_test</span><span class="p">,</span>
<a id="__codelineno-86-3" name="__codelineno-86-3"></a>                                 <span class="n">y_pred</span><span class="o">=</span><span class="n">model_4_preds</span><span class="p">)</span>
<a id="__codelineno-86-4" name="__codelineno-86-4"></a><span class="n">model_4_results</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    {'mae': 0.07864646,
     'mape': 16434.877,
     'mase': 0.47464615,
     'mse': 0.011551642,
     'rmse': 0.10747856}
</pre>
</div>

<p><a name="compare-models"></a></p>
<h2 id="compare-models"><strong>Compare Models</strong></h2>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-87-1">1</a></span>
<span class="normal"><a href="#__codelineno-87-2">2</a></span>
<span class="normal"><a href="#__codelineno-87-3">3</a></span>
<span class="normal"><a href="#__codelineno-87-4">4</a></span>
<span class="normal"><a href="#__codelineno-87-5">5</a></span>
<span class="normal"><a href="#__codelineno-87-6">6</a></span>
<span class="normal"><a href="#__codelineno-87-7">7</a></span>
<span class="normal"><a href="#__codelineno-87-8">8</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-87-1" name="__codelineno-87-1"></a><span class="c1"># Compare different model results (w = window, h = horizon, e.g. w=7 means a window size of 7)</span>
<a id="__codelineno-87-2" name="__codelineno-87-2"></a><span class="n">model_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;model_0_naive_forecast&quot;</span><span class="p">:</span> <span class="n">model_0_results</span><span class="p">,</span>
<a id="__codelineno-87-3" name="__codelineno-87-3"></a>                              <span class="s2">&quot;model_1_dense_w30_h7&quot;</span><span class="p">:</span> <span class="n">model_1_results</span><span class="p">,</span>
<a id="__codelineno-87-4" name="__codelineno-87-4"></a>                              <span class="s2">&quot;model_2_Conv1D&quot;</span><span class="p">:</span> <span class="n">model_2_results</span><span class="p">,</span>
<a id="__codelineno-87-5" name="__codelineno-87-5"></a>                              <span class="s2">&quot;model_3_RNN (LSTM)&quot;</span><span class="p">:</span> <span class="n">model_3_results</span><span class="p">,</span>
<a id="__codelineno-87-6" name="__codelineno-87-6"></a>                              <span class="s2">&quot;model_4_Multivariate&quot;</span><span class="p">:</span> <span class="n">model_4_results</span>
<a id="__codelineno-87-7" name="__codelineno-87-7"></a>                              <span class="p">})</span><span class="o">.</span><span class="n">T</span>
<a id="__codelineno-87-8" name="__codelineno-87-8"></a><span class="n">model_results</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
                            mae         mse         rmse        mape            mase
    model_0_naive_forecast  0.162962    0.061495    0.247982    31095.935547    1.000004
    model_1_dense_w30_h7    0.382357    0.376766    0.439707    53578.859375    2.307819
    model_2_Conv1D          0.131610    0.043221    0.207897    21096.267578    0.794289
    model_3_RNN (LSTM)      0.132494    0.043446    0.208438    20953.273438    0.799627
    model_4_Multivariate    0.078646    0.011552    0.107479    16434.876953    0.474646
</pre>
</div>

<p><a name="prediction"></a></p>
<h2 id="make-predictions"><strong>Make Predictions</strong></h2>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-88-1">1</a></span>
<span class="normal"><a href="#__codelineno-88-2">2</a></span>
<span class="normal"><a href="#__codelineno-88-3">3</a></span>
<span class="normal"><a href="#__codelineno-88-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-88-1" name="__codelineno-88-1"></a><span class="n">y_all</span> <span class="o">=</span> <span class="n">y_var</span>
<a id="__codelineno-88-2" name="__codelineno-88-2"></a>
<a id="__codelineno-88-3" name="__codelineno-88-3"></a><span class="n">INTO_FUTURE</span> <span class="o">=</span> <span class="mi">10</span>
<a id="__codelineno-88-4" name="__codelineno-88-4"></a><span class="n">WINDOW_SIZE</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-89-1">1</a></span>
<span class="normal"><a href="#__codelineno-89-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-89-1" name="__codelineno-89-1"></a><span class="n">next_time_steps</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-89-2" name="__codelineno-89-2"></a><span class="n">future_forecast</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-90-1">1</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-90-1" name="__codelineno-90-1"></a><span class="n">WINDOW_SIZE</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    18
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-91-1">1</a></span>
<span class="normal"><a href="#__codelineno-91-2">2</a></span>
<span class="normal"><a href="#__codelineno-91-3">3</a></span>
<span class="normal"><a href="#__codelineno-91-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-91-1" name="__codelineno-91-1"></a><span class="n">future_forecast</span> <span class="o">=</span> <span class="n">make_future_forecast</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="n">y_all</span><span class="p">,</span>
<a id="__codelineno-91-2" name="__codelineno-91-2"></a>                                       <span class="n">model</span><span class="o">=</span><span class="n">model_4</span><span class="p">,</span>
<a id="__codelineno-91-3" name="__codelineno-91-3"></a>                                       <span class="n">into_future</span><span class="o">=</span><span class="n">INTO_FUTURE</span><span class="p">,</span>
<a id="__codelineno-91-4" name="__codelineno-91-4"></a>                                       <span class="n">window_size</span><span class="o">=</span><span class="n">WINDOW_SIZE</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Predicting on: 
     [-2.75 -2.61 -2.51 -2.48 -2.48 -2.59 -2.89 -3.22 -4.08 -4.45 -4.09 -3.76
     -3.93 -4.05 -3.35 -3.16 -4.23 -4.82] -> Prediction: -2.8843555450439453

    Predicting on: 
     [-2.61       -2.51       -2.48       -2.48       -2.59       -2.89
     -3.22       -4.08       -4.45       -4.09       -3.76       -3.93
     -4.05       -3.35       -3.16       -4.23       -4.82       -2.88435555] -> Prediction: -3.3879714012145996

    Predicting on: 
     [-2.51       -2.48       -2.48       -2.59       -2.89       -3.22
     -4.08       -4.45       -4.09       -3.76       -3.93       -4.05
     -3.35       -3.16       -4.23       -4.82       -2.88435555 -3.3879714 ] -> Prediction: -3.3073337078094482

    Predicting on: 
     [-2.48       -2.48       -2.59       -2.89       -3.22       -4.08
     -4.45       -4.09       -3.76       -3.93       -4.05       -3.35
     -3.16       -4.23       -4.82       -2.88435555 -3.3879714  -3.30733371] -> Prediction: -3.511876106262207

    Predicting on: 
     [-2.48       -2.59       -2.89       -3.22       -4.08       -4.45
     -4.09       -3.76       -3.93       -4.05       -3.35       -3.16
     -4.23       -4.82       -2.88435555 -3.3879714  -3.30733371 -3.51187611] -> Prediction: -3.848367929458618

    Predicting on: 
     [-2.59       -2.89       -3.22       -4.08       -4.45       -4.09
     -3.76       -3.93       -4.05       -3.35       -3.16       -4.23
     -4.82       -2.88435555 -3.3879714  -3.30733371 -3.51187611 -3.84836793] -> Prediction: -3.9746413230895996

    Predicting on: 
     [-2.89       -3.22       -4.08       -4.45       -4.09       -3.76
     -3.93       -4.05       -3.35       -3.16       -4.23       -4.82
     -2.88435555 -3.3879714  -3.30733371 -3.51187611 -3.84836793 -3.97464132] -> Prediction: -4.36744499206543

    Predicting on: 
     [-3.22       -4.08       -4.45       -4.09       -3.76       -3.93
     -4.05       -3.35       -3.16       -4.23       -4.82       -2.88435555
     -3.3879714  -3.30733371 -3.51187611 -3.84836793 -3.97464132 -4.36744499] -> Prediction: -4.383545398712158

    Predicting on: 
     [-4.08       -4.45       -4.09       -3.76       -3.93       -4.05
     -3.35       -3.16       -4.23       -4.82       -2.88435555 -3.3879714
     -3.30733371 -3.51187611 -3.84836793 -3.97464132 -4.36744499 -4.3835454 ] -> Prediction: -4.106844902038574

    Predicting on: 
     [-4.45       -4.09       -3.76       -3.93       -4.05       -3.35
     -3.16       -4.23       -4.82       -2.88435555 -3.3879714  -3.30733371
     -3.51187611 -3.84836793 -3.97464132 -4.36744499 -4.3835454  -4.1068449 ] -> Prediction: -4.239135265350342
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-92-1">1</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-92-1" name="__codelineno-92-1"></a><span class="n">dt</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
            Date Time
    420546  2016-12-31 23:20:00
    420547  2016-12-31 23:30:00
    420548  2016-12-31 23:40:00
    420549  2016-12-31 23:50:00
    420550  2017-01-01 00:00:00
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-93-1">1</a></span>
<span class="normal"><a href="#__codelineno-93-2">2</a></span>
<span class="normal"><a href="#__codelineno-93-3">3</a></span>
<span class="normal"><a href="#__codelineno-93-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-93-1" name="__codelineno-93-1"></a><span class="c1"># Last timestep of timesteps (currently in np.datetime64 format)</span>
<a id="__codelineno-93-2" name="__codelineno-93-2"></a><span class="c1"># last_timestep = dt.iloc[0][-1]</span>
<a id="__codelineno-93-3" name="__codelineno-93-3"></a><span class="n">last_timestep</span> <span class="o">=</span> <span class="n">dt</span><span class="p">[</span><span class="s2">&quot;Date Time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-93-4" name="__codelineno-93-4"></a><span class="n">last_timestep</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    Timestamp('2017-01-01 00:00:00')
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-94-1">1</a></span>
<span class="normal"><a href="#__codelineno-94-2">2</a></span>
<span class="normal"><a href="#__codelineno-94-3">3</a></span>
<span class="normal"><a href="#__codelineno-94-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-94-1" name="__codelineno-94-1"></a><span class="c1"># Get next two weeks of timesteps</span>
<a id="__codelineno-94-2" name="__codelineno-94-2"></a><span class="n">next_time_steps</span> <span class="o">=</span> <span class="n">get_future_dates</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="n">last_timestep</span><span class="p">,</span> 
<a id="__codelineno-94-3" name="__codelineno-94-3"></a>                                   <span class="n">into_future</span><span class="o">=</span><span class="n">INTO_FUTURE</span><span class="p">)</span>
<a id="__codelineno-94-4" name="__codelineno-94-4"></a><span class="n">next_time_steps</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    array(['2017-01-02', '2017-01-03', '2017-01-04', '2017-01-05',
           '2017-01-06', '2017-01-07', '2017-01-08', '2017-01-09',
           '2017-01-10', '2017-01-11'], dtype='datetime64[D]')
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-95-1">1</a></span>
<span class="normal"><a href="#__codelineno-95-2">2</a></span>
<span class="normal"><a href="#__codelineno-95-3">3</a></span>
<span class="normal"><a href="#__codelineno-95-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-95-1" name="__codelineno-95-1"></a><span class="c1"># Insert last timestep/final price so the graph doesn&#39;t look messed</span>
<a id="__codelineno-95-2" name="__codelineno-95-2"></a><span class="n">next_time_steps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">next_time_steps</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">last_timestep</span><span class="p">)</span>
<a id="__codelineno-95-3" name="__codelineno-95-3"></a><span class="n">future_forecast</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">future_forecast</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y_all</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-95-4" name="__codelineno-95-4"></a><span class="n">next_time_steps</span><span class="p">,</span> <span class="n">future_forecast</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (array(['2017-01-01', '2017-01-02', '2017-01-03', '2017-01-04',
            '2017-01-05', '2017-01-06', '2017-01-07', '2017-01-08',
            '2017-01-09', '2017-01-10', '2017-01-11'], dtype='datetime64[D]'),
     array([-4.82     , -2.8843555, -3.3879714, -3.3073337, -3.511876 ,
            -3.848368 , -3.9746413, -4.367445 , -4.3835454, -4.106845 ,
            -4.2391353], dtype=float32))
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-96-1">1</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-96-1" name="__codelineno-96-1"></a><span class="nb">len</span><span class="p">(</span><span class="n">next_time_steps</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">future_forecast</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    (11, 11)
</pre>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-97-1">1</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-97-1" name="__codelineno-97-1"></a><span class="nb">len</span><span class="p">(</span><span class="n">y_all</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<div class="test">
<pre id="__code_7">
    420551
</pre>
</div>

<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-98-1">1</a></span>
<span class="normal"><a href="#__codelineno-98-2">2</a></span>
<span class="normal"><a href="#__codelineno-98-3">3</a></span>
<span class="normal"><a href="#__codelineno-98-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-98-1" name="__codelineno-98-1"></a><span class="c1"># Plot future price predictions of Bitcoin</span>
<a id="__codelineno-98-2" name="__codelineno-98-2"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<a id="__codelineno-98-3" name="__codelineno-98-3"></a><span class="n">plot_time_series</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="s2">&quot;Date Time&quot;</span><span class="p">],</span> <span class="n">y_all</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mf">0.999</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">y_all</span><span class="p">)),</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Actual Temperature&quot;</span><span class="p">)</span>
<a id="__codelineno-98-4" name="__codelineno-98-4"></a><span class="n">plot_time_series</span><span class="p">(</span><span class="n">next_time_steps</span><span class="p">,</span> <span class="n">future_forecast</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Predicted Temperature&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<img alt="ts-weather-9" src="../../../images/ts-weather-9.png" /></p>

              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../ts-bitcoin/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Time Series - Bitcoin Price Forecast" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Time Series - Bitcoin Price Forecast
            </div>
          </div>
        </a>
      
      
        
        <a href="../utilities/" class="md-footer__link md-footer__link--next" aria-label="Next: Utility Functions" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Utility Functions
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2020 - 2022 Mark Schwarz
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["search.suggest", "search.highlight", "search.tabs.link", "content.tabs.link", "navigation.indexes", "navigation.tabs", "navigation.top"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../../../assets/javascripts/workers/search.cefbb252.min.js"}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.a5f8ea78.min.js"></script>
      
    
  </body>
</html>