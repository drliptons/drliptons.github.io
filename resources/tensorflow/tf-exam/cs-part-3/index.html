
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../../../assets/dl-logo-big-512x512-color.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.0.5">
    
    
      
        <title>Part 3 - NLP in TF - DrLiptons</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.a617204b.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.9204c3b2.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../stylesheets/extra.css">
    
      <link rel="stylesheet" href="../../../../stylesheets/contact-style.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  <link rel="stylesheet" href="../../../../overrides/assets/stylesheets/main.d9227bb8.min.css">

  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="indigo" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#part-3-natural-language-processing-in-tensorflow" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="DrLiptons" class="md-header__button md-logo" aria-label="DrLiptons" data-md-component="logo">
      
  <img src="../../../../assets/dl-logo-big-512x512-color.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DrLiptons
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Part 3 -  NLP in TF
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="" data-md-color-primary="indigo" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../../about/" class="md-tabs__link">
      About
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../reference/" class="md-tabs__link">
        Reference
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../resource/" class="md-tabs__link md-tabs__link--active">
        Resource
      </a>
    </li>
  

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../../contact/" class="md-tabs__link">
      Contact
    </a>
  </li>

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="DrLiptons" class="md-nav__button md-logo" aria-label="DrLiptons" data-md-component="logo">
      
  <img src="../../../../assets/dl-logo-big-512x512-color.png" alt="logo">

    </a>
    DrLiptons
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../about/" class="md-nav__link">
        About
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3">
          Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../reference/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2" type="checkbox" id="__nav_3_2" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_2">
          Python
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Python" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          Python
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/get-live-financial-data/" class="md-nav__link">
        Get Live Financial Data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/flight-deals/" class="md-nav__link">
        Flight Deals
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/alien-invaders/" class="md-nav__link">
        Alien Invaders
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/auto-job-app/" class="md-nav__link">
        Automated Job Application
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/price-tracker/" class="md-nav__link">
        Price Tracker
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/password-manager/" class="md-nav__link">
        Password Manager
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/text-2-morse-code/" class="md-nav__link">
        Text2MorseCode
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/stock-news-alerts/" class="md-nav__link">
        Stock News Alert
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/tetris/" class="md-nav__link">
        Tetris Clone
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3" type="checkbox" id="__nav_3_3" >
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_3">
          TensorFlow
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="TensorFlow" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          TensorFlow
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3_1" type="checkbox" id="__nav_3_3_1" >
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_3_1">
          Plant Disease Detection
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Plant Disease Detection" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_3_1">
          <span class="md-nav__icon md-icon"></span>
          Plant Disease Detection
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/pdd/plant-disease-detection/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/pdd/part-1-create-ml-model/" class="md-nav__link">
        Part 1 - Create ML Model
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/pdd/part-2-create-app/" class="md-nav__link">
        Part 2 - Desktop App
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/pdd/part-3-make-exe/" class="md-nav__link">
        Part 3 - Make Executable
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/object-detection/" class="md-nav__link">
        Object Detection
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_4" type="checkbox" id="__nav_3_4" >
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_4">
          Applications
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Applications" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_4">
          <span class="md-nav__icon md-icon"></span>
          Applications
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/untitled-project-1/pt/" class="md-nav__link">
        Untitled Project 1
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/application/ebook-reader/" class="md-nav__link">
        EBook Text2Speech
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../references/application/media-player/" class="md-nav__link">
        Media Player
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4">
          Resource
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Resource" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Resource
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../resource/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2" type="checkbox" id="__nav_4_2" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_2">
          Python
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Python" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          Python
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../python/scikit-learn/" class="md-nav__link">
        Scikit-Learn
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../python/matplotlib/" class="md-nav__link">
        Matplotlib
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../python/numpy/" class="md-nav__link">
        Numpy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../python/pandas/" class="md-nav__link">
        Pandas
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../python/mplfinance/" class="md-nav__link">
        mplfinance
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../python/json/" class="md-nav__link">
        json
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3" type="checkbox" id="__nav_4_3" checked>
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_3">
          TensorFlow
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="TensorFlow" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_3">
          <span class="md-nav__icon md-icon"></span>
          TensorFlow
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3_1" type="checkbox" id="__nav_4_3_1" checked>
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_3_1">
          TensorFlow Exam
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="TensorFlow Exam" data-md-level="3">
        <label class="md-nav__title" for="__nav_4_3_1">
          <span class="md-nav__icon md-icon"></span>
          TensorFlow Exam
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tf-exam-overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3_1_2" type="checkbox" id="__nav_4_3_1_2" checked>
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_3_1_2">
          Coursera - DeepLearning.AI TensorFlow Developer
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Coursera - DeepLearning.AI TensorFlow Developer" data-md-level="4">
        <label class="md-nav__title" for="__nav_4_3_1_2">
          <span class="md-nav__icon md-icon"></span>
          Coursera - DeepLearning.AI TensorFlow Developer
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cs-part-1/" class="md-nav__link">
        Part 1 - Introduction to TF
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cs-part-2/" class="md-nav__link">
        Part 2 - CNN in TF
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Part 3 -  NLP in TF
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Part 3 -  NLP in TF
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    Table of Contents
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#week-1-sentiment-in-text" class="md-nav__link">
    Week 1: Sentiment in Text
  </a>
  
    <nav class="md-nav" aria-label="Week 1: Sentiment in Text">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lecture-code-bbc-text-archive" class="md-nav__link">
    Lecture Code: BBC Text Archive
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exercise-explore-the-bbc-news-archive" class="md-nav__link">
    Exercise: Explore the BBC News Archive
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#week-2-word-embeddings" class="md-nav__link">
    Week 2: Word Embeddings
  </a>
  
    <nav class="md-nav" aria-label="Week 2: Word Embeddings">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lecture-code-1-imdb-movie-reviews" class="md-nav__link">
    Lecture Code 1: IMDB Movie Reviews
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lecture-code-2-news-headlines" class="md-nav__link">
    Lecture Code 2: News Headlines
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exercise-bbc-news-archive" class="md-nav__link">
    Exercise: BBC News Archive
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#week-3-sequence-model" class="md-nav__link">
    Week 3: Sequence Model
  </a>
  
    <nav class="md-nav" aria-label="Week 3: Sequence Model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lecture-1-imdb-subwords-8k-with-single-layer-lstm" class="md-nav__link">
    Lecture 1: IMDB Subwords 8K with Single Layer LSTM
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lecture-2-imdb-subwords-8k-with-multi-layer-lstm" class="md-nav__link">
    Lecture 2: IMDB Subwords 8K with Multi Layer LSTM
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lecture-3-imdb-subwords-8k-with-1d-convolutional-layer" class="md-nav__link">
    Lecture 3: IMDB Subwords 8K with 1D Convolutional Layer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lecture-4-imdb-reviews-with-gru" class="md-nav__link">
    Lecture 4: IMDB Reviews with GRU
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lecture-5-sarcasm-with-bidirectional-lstm" class="md-nav__link">
    Lecture 5: Sarcasm with Bidirectional LSTM
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lecture-6-sarcasm-with-1d-convolutional-layer" class="md-nav__link">
    Lecture 6: Sarcasm with 1D Convolutional Layer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exercise-overfitting-in-nlp" class="md-nav__link">
    Exercise: Overfitting in NLP
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#week-4-sequence-models-and-literature" class="md-nav__link">
    Week 4: Sequence models and literature
  </a>
  
    <nav class="md-nav" aria-label="Week 4: Sequence models and literature">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lecture-code-1-create-texts-using-ml-from-simple-texts" class="md-nav__link">
    Lecture Code 1: Create Texts using ML from Simple Texts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lecture-code-2-generating-text-from-irish-lyrics" class="md-nav__link">
    Lecture Code 2: Generating Text from Irish Lyrics
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exercise-using-lstms-create-poetry" class="md-nav__link">
    Exercise: Using LSTMs Create Poetry
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cs-part-4/" class="md-nav__link">
        Part 4 - Time Series
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../pass-tensorflow-cert/" class="md-nav__link">
        How I past TensorFlow Exam
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tf-model-bp/" class="md-nav__link">
        TensorFlow Blueprint
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3_3" type="checkbox" id="__nav_4_3_3" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_3_3">
          TensorFlow Models
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="TensorFlow Models" data-md-level="3">
        <label class="md-nav__title" for="__nav_4_3_3">
          <span class="md-nav__icon md-icon"></span>
          TensorFlow Models
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../models/model-list/" class="md-nav__link">
        List of Models
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3_3_2" type="checkbox" id="__nav_4_3_3_2" >
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_3_3_2">
          Neural Network Regressions
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Neural Network Regressions" data-md-level="4">
        <label class="md-nav__title" for="__nav_4_3_3_2">
          <span class="md-nav__icon md-icon"></span>
          Neural Network Regressions
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../models/simple-regression/" class="md-nav__link">
        NNR - House Prices
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../models/regression-boston-housing/" class="md-nav__link">
        NNR - Boston Housing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../models/titanic/" class="md-nav__link">
        NNR - Titanic
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3_3_3" type="checkbox" id="__nav_4_3_3_3" >
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_3_3_3">
          Image Classification
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Image Classification" data-md-level="4">
        <label class="md-nav__title" for="__nav_4_3_3_3">
          <span class="md-nav__icon md-icon"></span>
          Image Classification
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../models/basic-fmnist/" class="md-nav__link">
        Basic Image Classification - FMNIST
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../models/image-classification-dogs-cats/" class="md-nav__link">
        Image Classification - Dogs & Cats
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../models/cnn-fmnist/" class="md-nav__link">
        CNN - FMNIST
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3_3_4" type="checkbox" id="__nav_4_3_3_4" >
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_3_3_4">
          Natural Language Processing
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Natural Language Processing" data-md-level="4">
        <label class="md-nav__title" for="__nav_4_3_3_4">
          <span class="md-nav__icon md-icon"></span>
          Natural Language Processing
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../models/imdb/" class="md-nav__link">
        NLP - Binary-Class IMDB
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../models/nlp-1-binary/" class="md-nav__link">
        NLP - Binary-Class Disaster Tweets
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../models/nlp-2-multi/" class="md-nav__link">
        NLP - Multi-Class PedMed
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../models/nlp-3-sentiment/" class="md-nav__link">
        NLP - Multi-Class Sentiment Analysis
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3_3_5" type="checkbox" id="__nav_4_3_3_5" >
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_3_3_5">
          Time Series
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Time Series" data-md-level="4">
        <label class="md-nav__title" for="__nav_4_3_3_5">
          <span class="md-nav__icon md-icon"></span>
          Time Series
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../models/ts-bitcoin/" class="md-nav__link">
        Time Series - Bitcoin Price Forecast
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../models/ts-weather/" class="md-nav__link">
        Time Series - Weather Forecast
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3_3_6" type="checkbox" id="__nav_4_3_3_6" >
      
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_3_3_6">
          Miscellaneous
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Miscellaneous" data-md-level="4">
        <label class="md-nav__title" for="__nav_4_3_3_6">
          <span class="md-nav__icon md-icon"></span>
          Miscellaneous
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../models/utilities/" class="md-nav__link">
        Utility Functions
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_4" type="checkbox" id="__nav_4_4" >
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_4">
          Microsoft Certification
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Microsoft Certification" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_4">
          <span class="md-nav__icon md-icon"></span>
          Microsoft Certification
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ms/ms-overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ms/az-900/" class="md-nav__link">
        Azure Fundamentals
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ms/ai-900/" class="md-nav__link">
        Azure AI Fundamentals
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ms/dp-900/" class="md-nav__link">
        Azure Data Fundamentals
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../contact/" class="md-nav__link">
        Contact
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    Table of Contents
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#week-1-sentiment-in-text" class="md-nav__link">
    Week 1: Sentiment in Text
  </a>
  
    <nav class="md-nav" aria-label="Week 1: Sentiment in Text">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lecture-code-bbc-text-archive" class="md-nav__link">
    Lecture Code: BBC Text Archive
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exercise-explore-the-bbc-news-archive" class="md-nav__link">
    Exercise: Explore the BBC News Archive
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#week-2-word-embeddings" class="md-nav__link">
    Week 2: Word Embeddings
  </a>
  
    <nav class="md-nav" aria-label="Week 2: Word Embeddings">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lecture-code-1-imdb-movie-reviews" class="md-nav__link">
    Lecture Code 1: IMDB Movie Reviews
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lecture-code-2-news-headlines" class="md-nav__link">
    Lecture Code 2: News Headlines
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exercise-bbc-news-archive" class="md-nav__link">
    Exercise: BBC News Archive
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#week-3-sequence-model" class="md-nav__link">
    Week 3: Sequence Model
  </a>
  
    <nav class="md-nav" aria-label="Week 3: Sequence Model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lecture-1-imdb-subwords-8k-with-single-layer-lstm" class="md-nav__link">
    Lecture 1: IMDB Subwords 8K with Single Layer LSTM
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lecture-2-imdb-subwords-8k-with-multi-layer-lstm" class="md-nav__link">
    Lecture 2: IMDB Subwords 8K with Multi Layer LSTM
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lecture-3-imdb-subwords-8k-with-1d-convolutional-layer" class="md-nav__link">
    Lecture 3: IMDB Subwords 8K with 1D Convolutional Layer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lecture-4-imdb-reviews-with-gru" class="md-nav__link">
    Lecture 4: IMDB Reviews with GRU
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lecture-5-sarcasm-with-bidirectional-lstm" class="md-nav__link">
    Lecture 5: Sarcasm with Bidirectional LSTM
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lecture-6-sarcasm-with-1d-convolutional-layer" class="md-nav__link">
    Lecture 6: Sarcasm with 1D Convolutional Layer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exercise-overfitting-in-nlp" class="md-nav__link">
    Exercise: Overfitting in NLP
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#week-4-sequence-models-and-literature" class="md-nav__link">
    Week 4: Sequence models and literature
  </a>
  
    <nav class="md-nav" aria-label="Week 4: Sequence models and literature">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lecture-code-1-create-texts-using-ml-from-simple-texts" class="md-nav__link">
    Lecture Code 1: Create Texts using ML from Simple Texts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lecture-code-2-generating-text-from-irish-lyrics" class="md-nav__link">
    Lecture Code 2: Generating Text from Irish Lyrics
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exercise-using-lstms-create-poetry" class="md-nav__link">
    Exercise: Using LSTMs Create Poetry
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

<h1 id="part-3-natural-language-processing-in-tensorflow"><b>Part 3: Natural Language Processing in TensorFlow</b></h1>
<h2 id="table-of-contents"><strong>Table of Contents</strong></h2>
<details class="example" open="open">
<summary>At a Glance</summary>
<ul>
<li><a href="#week-1">Week 1: Sentiment in Text</a></li>
<li><a href="#week-2">Week 2: Word Embeddings</a></li>
<li><a href="#week-3">Week 3: Sequence Models</a></li>
<li><a href="#week-4">Week 4: Sequence Models and Literature</a></li>
</ul>
</details>
<p><a name="week-1"></a></p>
<h2 id="week-1-sentiment-in-text"><strong>Week 1: Sentiment in Text</strong></h2>
<p>Learn the basics of NLP and how to convert text into numbers. Preparing data to feed into a Neural Network with 
TensorFlow.</p>
<ul>
<li><strong>Word Based Encoding:</strong> typically we will convert alphabetic letters into numbers. The problem is that the same 
letters can be rearranged and form a new word (for instance, listen and silent). However, a better way is to assign a 
whole word into a number.</li>
<li><strong>Tokenization:</strong> a method (<code>Tokenizer()</code>) to convert words into numbers. By default, it will only take words in a 
sentence without spaces and symbols</li>
<li><strong>Text to Sequence</strong> is to turn tokenized words into a list of sequences (<code>texts_to_sequences()</code>). In other words, 
recreate the sentences with numbers instead of words and letters.</li>
<li><strong>Out Of Vocabulary:</strong> to include words that are out of index by turning them into a token.</li>
<li><strong>Padding:</strong> resize sequences into a uniform size (<code>pad_sequences</code>)</li>
</ul>
<h3 id="lecture-code-bbc-text-archive">Lecture Code: BBC Text Archive</h3>
<details class="- success">
<summary>Lecture Code: BBC Text Archive</summary>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-0-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-0-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-0-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-0-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="c1"># Download the dataset</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="err">!</span><span class="n">wget</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">storage</span><span class="o">.</span><span class="n">googleapis</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">tensorflow</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">public</span><span class="o">/</span><span class="n">course3</span><span class="o">/</span><span class="n">sarcasm</span><span class="o">.</span><span class="n">json</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="kn">import</span> <span class="nn">json</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="c1"># Load the JSON file</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;./sarcasm.json&quot;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a>    <span class="n">datastore</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="c1"># Non-sarcastic headline</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="nb">print</span><span class="p">(</span><span class="n">datastore</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="c1"># Sarcastic headline</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="nb">print</span><span class="p">(</span><span class="n">datastore</span><span class="p">[</span><span class="mi">20000</span><span class="p">])</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="c1"># Initialize lists</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="n">sentences</span> <span class="o">=</span> <span class="p">[]</span> 
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="n">urls</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="c1"># Append elements in the dictionaries into each list</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">datastore</span><span class="p">:</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>    <span class="n">sentences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;headline&#39;</span><span class="p">])</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>    <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;is_sarcastic&#39;</span><span class="p">])</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>    <span class="n">urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;article_link&#39;</span><span class="p">])</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.preprocessing.text</span> <span class="kn">import</span> <span class="n">Tokenizer</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.preprocessing.sequence</span> <span class="kn">import</span> <span class="n">pad_sequences</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="c1"># Initialize the Tokenizer class</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="n">tokenizer</span> <span class="o">=</span> <span class="n">Tokenizer</span><span class="p">(</span><span class="n">oov_token</span><span class="o">=</span><span class="s2">&quot;&lt;OOV&gt;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="c1"># Generate the word index dictionary</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="n">tokenizer</span><span class="o">.</span><span class="n">fit_on_texts</span><span class="p">(</span><span class="n">sentences</span><span class="p">)</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="c1"># Print the length of the word index</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="n">word_index</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">word_index</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;number of words in word_index: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">word_index</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="c1"># Print the word index</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;word_index: </span><span class="si">{</span><span class="n">word_index</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="nb">print</span><span class="p">()</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="c1"># Generate and pad the sequences</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="n">sequences</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">texts_to_sequences</span><span class="p">(</span><span class="n">sentences</span><span class="p">)</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="n">padded</span> <span class="o">=</span> <span class="n">pad_sequences</span><span class="p">(</span><span class="n">sequences</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;post&#39;</span><span class="p">)</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="c1"># Print a sample headline</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="n">index</span> <span class="o">=</span> <span class="mi">2</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;sample headline: </span><span class="si">{</span><span class="n">sentences</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;padded sequence: </span><span class="si">{</span><span class="n">padded</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="nb">print</span><span class="p">()</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="c1"># Print dimensions of padded sequences</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;shape of padded sequences: </span><span class="si">{</span><span class="n">padded</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
</details>
<h3 id="exercise-explore-the-bbc-news-archive">Exercise: Explore the BBC News Archive</h3>
<p><strong>Dataset:</strong> BBC text archive</p>
<p><strong>Assignment:</strong> use tokenization and remove common stop words</p>
<details class="- success">
<summary>Final code for the exercise</summary>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-1-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-1-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-1-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-1-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-1-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-1-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-1-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-1-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-1-10">10</a></span>
<span class="normal"><a href="#__codelineno-1-11">11</a></span>
<span class="normal"><a href="#__codelineno-1-12">12</a></span>
<span class="normal"><a href="#__codelineno-1-13">13</a></span>
<span class="normal"><a href="#__codelineno-1-14">14</a></span>
<span class="normal"><a href="#__codelineno-1-15">15</a></span>
<span class="normal"><a href="#__codelineno-1-16">16</a></span>
<span class="normal"><a href="#__codelineno-1-17">17</a></span>
<span class="normal"><a href="#__codelineno-1-18">18</a></span>
<span class="normal"><a href="#__codelineno-1-19">19</a></span>
<span class="normal"><a href="#__codelineno-1-20">20</a></span>
<span class="normal"><a href="#__codelineno-1-21">21</a></span>
<span class="normal"><a href="#__codelineno-1-22">22</a></span>
<span class="normal"><a href="#__codelineno-1-23">23</a></span>
<span class="normal"><a href="#__codelineno-1-24">24</a></span>
<span class="normal"><a href="#__codelineno-1-25">25</a></span>
<span class="normal"><a href="#__codelineno-1-26">26</a></span>
<span class="normal"><a href="#__codelineno-1-27">27</a></span>
<span class="normal"><a href="#__codelineno-1-28">28</a></span>
<span class="normal"><a href="#__codelineno-1-29">29</a></span>
<span class="normal"><a href="#__codelineno-1-30">30</a></span>
<span class="normal"><a href="#__codelineno-1-31">31</a></span>
<span class="normal"><a href="#__codelineno-1-32">32</a></span>
<span class="normal"><a href="#__codelineno-1-33">33</a></span>
<span class="normal"><a href="#__codelineno-1-34">34</a></span>
<span class="normal"><a href="#__codelineno-1-35">35</a></span>
<span class="normal"><a href="#__codelineno-1-36">36</a></span>
<span class="normal"><a href="#__codelineno-1-37">37</a></span>
<span class="normal"><a href="#__codelineno-1-38">38</a></span>
<span class="normal"><a href="#__codelineno-1-39">39</a></span>
<span class="normal"><a href="#__codelineno-1-40">40</a></span>
<span class="normal"><a href="#__codelineno-1-41">41</a></span>
<span class="normal"><a href="#__codelineno-1-42">42</a></span>
<span class="normal"><a href="#__codelineno-1-43">43</a></span>
<span class="normal"><a href="#__codelineno-1-44">44</a></span>
<span class="normal"><a href="#__codelineno-1-45">45</a></span>
<span class="normal"><a href="#__codelineno-1-46">46</a></span>
<span class="normal"><a href="#__codelineno-1-47">47</a></span>
<span class="normal"><a href="#__codelineno-1-48">48</a></span>
<span class="normal"><a href="#__codelineno-1-49">49</a></span>
<span class="normal"><a href="#__codelineno-1-50">50</a></span>
<span class="normal"><a href="#__codelineno-1-51">51</a></span>
<span class="normal"><a href="#__codelineno-1-52">52</a></span>
<span class="normal"><a href="#__codelineno-1-53">53</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="kn">import</span> <span class="nn">csv</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.preprocessing.text</span> <span class="kn">import</span> <span class="n">Tokenizer</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.preprocessing.sequence</span> <span class="kn">import</span> <span class="n">pad_sequences</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="c1"># bbc-text.csv</span>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="err">!</span><span class="n">gdown</span> <span class="o">--</span><span class="nb">id</span> <span class="mi">1</span><span class="n">rX10xeI3eUJmOLsc4pOPY6AnCLO8DxNj</span>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="c1">#Stopwords list from https://github.com/Yoast/YoastSEO.js/blob/develop/src/config/stopwords.js</span>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="n">stopwords</span> <span class="o">=</span> <span class="p">[</span> 
<a id="__codelineno-1-10" name="__codelineno-1-10"></a>             <span class="c1"># START CODE HERE</span>
<a id="__codelineno-1-11" name="__codelineno-1-11"></a>             <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;about&quot;</span><span class="p">,</span> <span class="s2">&quot;above&quot;</span><span class="p">,</span> <span class="s2">&quot;after&quot;</span><span class="p">,</span> <span class="s2">&quot;again&quot;</span><span class="p">,</span> <span class="s2">&quot;against&quot;</span><span class="p">,</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="s2">&quot;am&quot;</span><span class="p">,</span> <span class="s2">&quot;an&quot;</span><span class="p">,</span> <span class="s2">&quot;and&quot;</span><span class="p">,</span> <span class="s2">&quot;any&quot;</span><span class="p">,</span> <span class="s2">&quot;are&quot;</span><span class="p">,</span> <span class="s2">&quot;as&quot;</span><span class="p">,</span> <span class="s2">&quot;at&quot;</span><span class="p">,</span> <span class="s2">&quot;be&quot;</span><span class="p">,</span> <span class="s2">&quot;because&quot;</span><span class="p">,</span> <span class="s2">&quot;been&quot;</span><span class="p">,</span> <span class="s2">&quot;before&quot;</span><span class="p">,</span> <span class="s2">&quot;being&quot;</span><span class="p">,</span> <span class="s2">&quot;below&quot;</span><span class="p">,</span> <span class="s2">&quot;between&quot;</span><span class="p">,</span> <span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="s2">&quot;but&quot;</span><span class="p">,</span> <span class="s2">&quot;by&quot;</span><span class="p">,</span> <span class="s2">&quot;could&quot;</span><span class="p">,</span> <span class="s2">&quot;did&quot;</span><span class="p">,</span> <span class="s2">&quot;do&quot;</span><span class="p">,</span> <span class="s2">&quot;does&quot;</span><span class="p">,</span> <span class="s2">&quot;doing&quot;</span><span class="p">,</span> <span class="s2">&quot;down&quot;</span><span class="p">,</span> <span class="s2">&quot;during&quot;</span><span class="p">,</span> <span class="s2">&quot;each&quot;</span><span class="p">,</span> <span class="s2">&quot;few&quot;</span><span class="p">,</span> <span class="s2">&quot;for&quot;</span><span class="p">,</span> <span class="s2">&quot;from&quot;</span><span class="p">,</span> <span class="s2">&quot;further&quot;</span><span class="p">,</span> <span class="s2">&quot;had&quot;</span><span class="p">,</span> <span class="s2">&quot;has&quot;</span><span class="p">,</span> <span class="s2">&quot;have&quot;</span><span class="p">,</span> <span class="s2">&quot;having&quot;</span><span class="p">,</span> <span class="s2">&quot;he&quot;</span><span class="p">,</span> <span class="s2">&quot;he&#39;d&quot;</span><span class="p">,</span> <span class="s2">&quot;he&#39;ll&quot;</span><span class="p">,</span> <span class="s2">&quot;he&#39;s&quot;</span><span class="p">,</span> <span class="s2">&quot;her&quot;</span><span class="p">,</span> <span class="s2">&quot;here&quot;</span><span class="p">,</span> <span class="s2">&quot;here&#39;s&quot;</span><span class="p">,</span> <span class="s2">&quot;hers&quot;</span><span class="p">,</span> <span class="s2">&quot;herself&quot;</span><span class="p">,</span> <span class="s2">&quot;him&quot;</span><span class="p">,</span> <span class="s2">&quot;himself&quot;</span><span class="p">,</span> <span class="s2">&quot;his&quot;</span><span class="p">,</span> <span class="s2">&quot;how&quot;</span><span class="p">,</span> <span class="s2">&quot;how&#39;s&quot;</span><span class="p">,</span> <span class="s2">&quot;i&quot;</span><span class="p">,</span> <span class="s2">&quot;i&#39;d&quot;</span><span class="p">,</span> <span class="s2">&quot;i&#39;ll&quot;</span><span class="p">,</span> <span class="s2">&quot;i&#39;m&quot;</span><span class="p">,</span> <span class="s2">&quot;i&#39;ve&quot;</span><span class="p">,</span> <span class="s2">&quot;if&quot;</span><span class="p">,</span> <span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="s2">&quot;into&quot;</span><span class="p">,</span> <span class="s2">&quot;is&quot;</span><span class="p">,</span> <span class="s2">&quot;it&quot;</span><span class="p">,</span> <span class="s2">&quot;it&#39;s&quot;</span><span class="p">,</span> <span class="s2">&quot;its&quot;</span><span class="p">,</span> <span class="s2">&quot;itself&quot;</span><span class="p">,</span> <span class="s2">&quot;let&#39;s&quot;</span><span class="p">,</span> <span class="s2">&quot;me&quot;</span><span class="p">,</span> <span class="s2">&quot;more&quot;</span><span class="p">,</span> <span class="s2">&quot;most&quot;</span><span class="p">,</span> <span class="s2">&quot;my&quot;</span><span class="p">,</span> <span class="s2">&quot;myself&quot;</span><span class="p">,</span> <span class="s2">&quot;nor&quot;</span><span class="p">,</span> <span class="s2">&quot;of&quot;</span><span class="p">,</span> <span class="s2">&quot;on&quot;</span><span class="p">,</span> <span class="s2">&quot;once&quot;</span><span class="p">,</span> <span class="s2">&quot;only&quot;</span><span class="p">,</span> <span class="s2">&quot;or&quot;</span><span class="p">,</span> <span class="s2">&quot;other&quot;</span><span class="p">,</span> <span class="s2">&quot;ought&quot;</span><span class="p">,</span> <span class="s2">&quot;our&quot;</span><span class="p">,</span> <span class="s2">&quot;ours&quot;</span><span class="p">,</span> <span class="s2">&quot;ourselves&quot;</span><span class="p">,</span> <span class="s2">&quot;out&quot;</span><span class="p">,</span> <span class="s2">&quot;over&quot;</span><span class="p">,</span> <span class="s2">&quot;own&quot;</span><span class="p">,</span> <span class="s2">&quot;same&quot;</span><span class="p">,</span> <span class="s2">&quot;she&quot;</span><span class="p">,</span> <span class="s2">&quot;she&#39;d&quot;</span><span class="p">,</span> <span class="s2">&quot;she&#39;ll&quot;</span><span class="p">,</span> <span class="s2">&quot;she&#39;s&quot;</span><span class="p">,</span> <span class="s2">&quot;should&quot;</span><span class="p">,</span> <span class="s2">&quot;so&quot;</span><span class="p">,</span> <span class="s2">&quot;some&quot;</span><span class="p">,</span> <span class="s2">&quot;such&quot;</span><span class="p">,</span> <span class="s2">&quot;than&quot;</span><span class="p">,</span> <span class="s2">&quot;that&quot;</span><span class="p">,</span> <span class="s2">&quot;that&#39;s&quot;</span><span class="p">,</span> <span class="s2">&quot;the&quot;</span><span class="p">,</span> <span class="s2">&quot;their&quot;</span><span class="p">,</span> <span class="s2">&quot;theirs&quot;</span><span class="p">,</span> <span class="s2">&quot;them&quot;</span><span class="p">,</span> <span class="s2">&quot;themselves&quot;</span><span class="p">,</span> <span class="s2">&quot;then&quot;</span><span class="p">,</span> <span class="s2">&quot;there&quot;</span><span class="p">,</span> <span class="s2">&quot;there&#39;s&quot;</span><span class="p">,</span> <span class="s2">&quot;these&quot;</span><span class="p">,</span> <span class="s2">&quot;they&quot;</span><span class="p">,</span> <span class="s2">&quot;they&#39;d&quot;</span><span class="p">,</span> <span class="s2">&quot;they&#39;ll&quot;</span><span class="p">,</span> <span class="s2">&quot;they&#39;re&quot;</span><span class="p">,</span> <span class="s2">&quot;they&#39;ve&quot;</span><span class="p">,</span> <span class="s2">&quot;this&quot;</span><span class="p">,</span> <span class="s2">&quot;those&quot;</span><span class="p">,</span> <span class="s2">&quot;through&quot;</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="s2">&quot;too&quot;</span><span class="p">,</span> <span class="s2">&quot;under&quot;</span><span class="p">,</span> <span class="s2">&quot;until&quot;</span><span class="p">,</span> <span class="s2">&quot;up&quot;</span><span class="p">,</span> <span class="s2">&quot;very&quot;</span><span class="p">,</span> <span class="s2">&quot;was&quot;</span><span class="p">,</span> <span class="s2">&quot;we&quot;</span><span class="p">,</span> <span class="s2">&quot;we&#39;d&quot;</span><span class="p">,</span> <span class="s2">&quot;we&#39;ll&quot;</span><span class="p">,</span> <span class="s2">&quot;we&#39;re&quot;</span><span class="p">,</span> <span class="s2">&quot;we&#39;ve&quot;</span><span class="p">,</span> <span class="s2">&quot;were&quot;</span><span class="p">,</span> <span class="s2">&quot;what&quot;</span><span class="p">,</span> <span class="s2">&quot;what&#39;s&quot;</span><span class="p">,</span> <span class="s2">&quot;when&quot;</span><span class="p">,</span> <span class="s2">&quot;when&#39;s&quot;</span><span class="p">,</span> <span class="s2">&quot;where&quot;</span><span class="p">,</span> <span class="s2">&quot;where&#39;s&quot;</span><span class="p">,</span> <span class="s2">&quot;which&quot;</span><span class="p">,</span> <span class="s2">&quot;while&quot;</span><span class="p">,</span> <span class="s2">&quot;who&quot;</span><span class="p">,</span> <span class="s2">&quot;who&#39;s&quot;</span><span class="p">,</span> <span class="s2">&quot;whom&quot;</span><span class="p">,</span> <span class="s2">&quot;why&quot;</span><span class="p">,</span> <span class="s2">&quot;why&#39;s&quot;</span><span class="p">,</span> <span class="s2">&quot;with&quot;</span><span class="p">,</span> <span class="s2">&quot;would&quot;</span><span class="p">,</span> <span class="s2">&quot;you&quot;</span><span class="p">,</span> <span class="s2">&quot;you&#39;d&quot;</span><span class="p">,</span> <span class="s2">&quot;you&#39;ll&quot;</span><span class="p">,</span> <span class="s2">&quot;you&#39;re&quot;</span><span class="p">,</span> <span class="s2">&quot;you&#39;ve&quot;</span><span class="p">,</span> <span class="s2">&quot;your&quot;</span><span class="p">,</span> <span class="s2">&quot;yours&quot;</span><span class="p">,</span> <span class="s2">&quot;yourself&quot;</span><span class="p">,</span> <span class="s2">&quot;yourselves&quot;</span> 
<a id="__codelineno-1-12" name="__codelineno-1-12"></a>             <span class="c1"># END CODE HERE</span>
<a id="__codelineno-1-13" name="__codelineno-1-13"></a>             <span class="p">]</span>
<a id="__codelineno-1-14" name="__codelineno-1-14"></a>
<a id="__codelineno-1-15" name="__codelineno-1-15"></a><span class="n">sentences</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-1-16" name="__codelineno-1-16"></a><span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-1-17" name="__codelineno-1-17"></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;./bbc-text.csv&quot;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
<a id="__codelineno-1-18" name="__codelineno-1-18"></a>    <span class="c1"># START CODE HERE</span>
<a id="__codelineno-1-19" name="__codelineno-1-19"></a>    <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
<a id="__codelineno-1-20" name="__codelineno-1-20"></a>    <span class="nb">next</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
<a id="__codelineno-1-21" name="__codelineno-1-21"></a>    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
<a id="__codelineno-1-22" name="__codelineno-1-22"></a>        <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-1-23" name="__codelineno-1-23"></a>        <span class="n">sentence</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-1-24" name="__codelineno-1-24"></a>        <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">stopwords</span><span class="p">:</span>
<a id="__codelineno-1-25" name="__codelineno-1-25"></a>            <span class="n">token</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">word</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span>
<a id="__codelineno-1-26" name="__codelineno-1-26"></a>            <span class="n">sentence</span> <span class="o">=</span> <span class="n">sentence</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
<a id="__codelineno-1-27" name="__codelineno-1-27"></a>            <span class="n">sentence</span> <span class="o">=</span> <span class="n">sentence</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
<a id="__codelineno-1-28" name="__codelineno-1-28"></a>        <span class="n">sentences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span>   
<a id="__codelineno-1-29" name="__codelineno-1-29"></a>    <span class="c1"># END CODE HERE</span>
<a id="__codelineno-1-30" name="__codelineno-1-30"></a>
<a id="__codelineno-1-31" name="__codelineno-1-31"></a>
<a id="__codelineno-1-32" name="__codelineno-1-32"></a><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sentences</span><span class="p">))</span>
<a id="__codelineno-1-33" name="__codelineno-1-33"></a><span class="nb">print</span><span class="p">(</span><span class="n">sentences</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-1-34" name="__codelineno-1-34"></a>
<a id="__codelineno-1-35" name="__codelineno-1-35"></a><span class="n">tokenizer</span> <span class="o">=</span> <span class="n">Tokenizer</span><span class="p">(</span><span class="n">oov_token</span><span class="o">=</span><span class="s2">&quot;&lt;OOV&gt;&quot;</span><span class="p">)</span> <span class="c1"># IN-LINE CODE HERE</span>
<a id="__codelineno-1-36" name="__codelineno-1-36"></a><span class="n">tokenizer</span><span class="o">.</span><span class="n">fit_on_texts</span><span class="p">(</span><span class="n">sentences</span><span class="p">)</span> <span class="c1"># IN-LINE CODE HERE</span>
<a id="__codelineno-1-37" name="__codelineno-1-37"></a><span class="n">word_index</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">word_index</span> <span class="c1"># IN-LINE CODE HERE</span>
<a id="__codelineno-1-38" name="__codelineno-1-38"></a><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">word_index</span><span class="p">))</span> <span class="c1"># IN-LINE CODE HERE</span>
<a id="__codelineno-1-39" name="__codelineno-1-39"></a>
<a id="__codelineno-1-40" name="__codelineno-1-40"></a><span class="n">sequences</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">texts_to_sequences</span><span class="p">(</span><span class="n">sentences</span><span class="p">)</span> <span class="c1"># IN-LINE CODE HERE</span>
<a id="__codelineno-1-41" name="__codelineno-1-41"></a><span class="n">padded</span> <span class="o">=</span> <span class="n">pad_sequences</span><span class="p">(</span><span class="n">sequences</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;post&#39;</span><span class="p">)</span> <span class="c1"># IN-LINE CODE HERE</span>
<a id="__codelineno-1-42" name="__codelineno-1-42"></a><span class="nb">print</span><span class="p">(</span><span class="n">padded</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-1-43" name="__codelineno-1-43"></a><span class="nb">print</span><span class="p">(</span><span class="n">padded</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<a id="__codelineno-1-44" name="__codelineno-1-44"></a>
<a id="__codelineno-1-45" name="__codelineno-1-45"></a><span class="c1"># START CODE HERE</span>
<a id="__codelineno-1-46" name="__codelineno-1-46"></a><span class="n">label_tokenizer</span> <span class="o">=</span> <span class="n">Tokenizer</span><span class="p">()</span>
<a id="__codelineno-1-47" name="__codelineno-1-47"></a><span class="n">label_tokenizer</span><span class="o">.</span><span class="n">fit_on_texts</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
<a id="__codelineno-1-48" name="__codelineno-1-48"></a><span class="n">label_word_index</span> <span class="o">=</span> <span class="n">label_tokenizer</span><span class="o">.</span><span class="n">word_index</span>
<a id="__codelineno-1-49" name="__codelineno-1-49"></a><span class="n">label_seq</span> <span class="o">=</span> <span class="n">label_tokenizer</span><span class="o">.</span><span class="n">texts_to_sequences</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
<a id="__codelineno-1-50" name="__codelineno-1-50"></a><span class="c1"># END CODE HERE</span>
<a id="__codelineno-1-51" name="__codelineno-1-51"></a>
<a id="__codelineno-1-52" name="__codelineno-1-52"></a><span class="nb">print</span><span class="p">(</span><span class="n">label_seq</span><span class="p">)</span>
<a id="__codelineno-1-53" name="__codelineno-1-53"></a><span class="nb">print</span><span class="p">(</span><span class="n">label_word_index</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
</details>
<p><a name="week-2"></a></p>
<h2 id="week-2-word-embeddings"><strong>Week 2: Word Embeddings</strong></h2>
<p>Learn to use word embeddings with Keras layers and start to train a neural network. Instead of representing a word 
with a number, it will be converted into vectors and explore the connection between words. The idea of embedding is 
that words and associated words are clustered as vectors in a multi-dimensional space. </p>
<ul>
<li><strong>Embedding:</strong> is a technique to represent words mathematically that allows words with similar meanings to have a 
similar representation. The technique is that each word will be represented by a vector. Words that are found often 
together will be given with similar vectors. Over time, words will begin to cluster together around similar meanings. 
This meaning can come from labels, for instance. Embedding can be used from Keras layer <code>Embedding()</code></li>
</ul>
<p>This week's lecture uses </p>
<ol>
<li><a href="http://ai.stanford.edu/~amaas/data/sentiment/">IMDB movie reviews Dataset</a> has 50,000 reviews classified as positive and negative reviews</li>
<li><a href="https://www.kaggle.com/rmisra/news-headlines-dataset-for-sarcasm-detection/home">News Headlines Dataset for Sarcasm Detection</a></li>
</ol>
<h3 id="lecture-code-1-imdb-movie-reviews">Lecture Code 1: IMDB Movie Reviews</h3>
<p>Dataset: <a href="http://ai.stanford.edu/~amaas/data/sentiment/">IMDB Movie Reviews</a></p>
<details class="- success">
<summary>Lecture Code 1: IMDB Movie Reviews</summary>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">  1</a></span>
<span class="normal"><a href="#__codelineno-2-2">  2</a></span>
<span class="normal"><a href="#__codelineno-2-3">  3</a></span>
<span class="normal"><a href="#__codelineno-2-4">  4</a></span>
<span class="normal"><a href="#__codelineno-2-5">  5</a></span>
<span class="normal"><a href="#__codelineno-2-6">  6</a></span>
<span class="normal"><a href="#__codelineno-2-7">  7</a></span>
<span class="normal"><a href="#__codelineno-2-8">  8</a></span>
<span class="normal"><a href="#__codelineno-2-9">  9</a></span>
<span class="normal"><a href="#__codelineno-2-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-2-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-2-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-2-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-2-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-2-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-2-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-2-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-2-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-2-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-2-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-2-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-2-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-2-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-2-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-2-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-2-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-2-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-2-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-2-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-2-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-2-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-2-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-2-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-2-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-2-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-2-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-2-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-2-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-2-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-2-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-2-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-2-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-2-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-2-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-2-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-2-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-2-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-2-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-2-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-2-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-2-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-2-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-2-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-2-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-2-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-2-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-2-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-2-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-2-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-2-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-2-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-2-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-2-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-2-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-2-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-2-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-2-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-2-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-2-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-2-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-2-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-2-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-2-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-2-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-2-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-2-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-2-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-2-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-2-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-2-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-2-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-2-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-2-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-2-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-2-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-2-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-2-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-2-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-2-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-2-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-2-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-2-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-2-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-2-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-2-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-2-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-2-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-2-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-2-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-2-100">100</a></span>
<span class="normal"><a href="#__codelineno-2-101">101</a></span>
<span class="normal"><a href="#__codelineno-2-102">102</a></span>
<span class="normal"><a href="#__codelineno-2-103">103</a></span>
<span class="normal"><a href="#__codelineno-2-104">104</a></span>
<span class="normal"><a href="#__codelineno-2-105">105</a></span>
<span class="normal"><a href="#__codelineno-2-106">106</a></span>
<span class="normal"><a href="#__codelineno-2-107">107</a></span>
<span class="normal"><a href="#__codelineno-2-108">108</a></span>
<span class="normal"><a href="#__codelineno-2-109">109</a></span>
<span class="normal"><a href="#__codelineno-2-110">110</a></span>
<span class="normal"><a href="#__codelineno-2-111">111</a></span>
<span class="normal"><a href="#__codelineno-2-112">112</a></span>
<span class="normal"><a href="#__codelineno-2-113">113</a></span>
<span class="normal"><a href="#__codelineno-2-114">114</a></span>
<span class="normal"><a href="#__codelineno-2-115">115</a></span>
<span class="normal"><a href="#__codelineno-2-116">116</a></span>
<span class="normal"><a href="#__codelineno-2-117">117</a></span>
<span class="normal"><a href="#__codelineno-2-118">118</a></span>
<span class="normal"><a href="#__codelineno-2-119">119</a></span>
<span class="normal"><a href="#__codelineno-2-120">120</a></span>
<span class="normal"><a href="#__codelineno-2-121">121</a></span>
<span class="normal"><a href="#__codelineno-2-122">122</a></span>
<span class="normal"><a href="#__codelineno-2-123">123</a></span>
<span class="normal"><a href="#__codelineno-2-124">124</a></span>
<span class="normal"><a href="#__codelineno-2-125">125</a></span>
<span class="normal"><a href="#__codelineno-2-126">126</a></span>
<span class="normal"><a href="#__codelineno-2-127">127</a></span>
<span class="normal"><a href="#__codelineno-2-128">128</a></span>
<span class="normal"><a href="#__codelineno-2-129">129</a></span>
<span class="normal"><a href="#__codelineno-2-130">130</a></span>
<span class="normal"><a href="#__codelineno-2-131">131</a></span>
<span class="normal"><a href="#__codelineno-2-132">132</a></span>
<span class="normal"><a href="#__codelineno-2-133">133</a></span>
<span class="normal"><a href="#__codelineno-2-134">134</a></span>
<span class="normal"><a href="#__codelineno-2-135">135</a></span>
<span class="normal"><a href="#__codelineno-2-136">136</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="kn">import</span> <span class="nn">io</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="kn">import</span> <span class="nn">tensorflow_datasets</span> <span class="k">as</span> <span class="nn">tfds</span>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<a id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.preprocessing.text</span> <span class="kn">import</span> <span class="n">Tokenizer</span>
<a id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.preprocessing.sequence</span> <span class="kn">import</span> <span class="n">pad_sequences</span>
<a id="__codelineno-2-9" name="__codelineno-2-9"></a>
<a id="__codelineno-2-10" name="__codelineno-2-10"></a><span class="c1"># Load the IMDB Reviews dataset</span>
<a id="__codelineno-2-11" name="__codelineno-2-11"></a><span class="n">imdb</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">tfds</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;imdb_reviews&quot;</span><span class="p">,</span> <span class="n">with_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">as_supervised</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-2-12" name="__codelineno-2-12"></a>
<a id="__codelineno-2-13" name="__codelineno-2-13"></a><span class="c1"># Print information about the dataset</span>
<a id="__codelineno-2-14" name="__codelineno-2-14"></a><span class="nb">print</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
<a id="__codelineno-2-15" name="__codelineno-2-15"></a><span class="c1"># Print the contents of the dataset you downloaded</span>
<a id="__codelineno-2-16" name="__codelineno-2-16"></a><span class="nb">print</span><span class="p">(</span><span class="n">imdb</span><span class="p">)</span>
<a id="__codelineno-2-17" name="__codelineno-2-17"></a><span class="c1"># Take 2 training examples and print its contents</span>
<a id="__codelineno-2-18" name="__codelineno-2-18"></a><span class="k">for</span> <span class="n">example</span> <span class="ow">in</span> <span class="n">imdb</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
<a id="__codelineno-2-19" name="__codelineno-2-19"></a>  <span class="nb">print</span><span class="p">(</span><span class="n">example</span><span class="p">)</span>
<a id="__codelineno-2-20" name="__codelineno-2-20"></a>
<a id="__codelineno-2-21" name="__codelineno-2-21"></a><span class="c1">########## SPLIT DATASET ##########</span>
<a id="__codelineno-2-22" name="__codelineno-2-22"></a><span class="c1"># Get the train and test sets</span>
<a id="__codelineno-2-23" name="__codelineno-2-23"></a><span class="n">train_data</span><span class="p">,</span> <span class="n">test_data</span> <span class="o">=</span> <span class="n">imdb</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">],</span> <span class="n">imdb</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span>
<a id="__codelineno-2-24" name="__codelineno-2-24"></a>
<a id="__codelineno-2-25" name="__codelineno-2-25"></a><span class="c1"># Initialize sentences and labels lists</span>
<a id="__codelineno-2-26" name="__codelineno-2-26"></a><span class="n">training_sentences</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-2-27" name="__codelineno-2-27"></a><span class="n">training_labels</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-2-28" name="__codelineno-2-28"></a>
<a id="__codelineno-2-29" name="__codelineno-2-29"></a><span class="n">testing_sentences</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-2-30" name="__codelineno-2-30"></a><span class="n">testing_labels</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-2-31" name="__codelineno-2-31"></a>
<a id="__codelineno-2-32" name="__codelineno-2-32"></a><span class="c1"># Loop over all training examples and save the sentences and labels</span>
<a id="__codelineno-2-33" name="__codelineno-2-33"></a><span class="k">for</span> <span class="n">s</span><span class="p">,</span><span class="n">l</span> <span class="ow">in</span> <span class="n">train_data</span><span class="p">:</span>
<a id="__codelineno-2-34" name="__codelineno-2-34"></a>  <span class="n">training_sentences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">))</span>
<a id="__codelineno-2-35" name="__codelineno-2-35"></a>  <span class="n">training_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
<a id="__codelineno-2-36" name="__codelineno-2-36"></a>
<a id="__codelineno-2-37" name="__codelineno-2-37"></a><span class="c1"># Loop over all test examples and save the sentences and labels</span>
<a id="__codelineno-2-38" name="__codelineno-2-38"></a><span class="k">for</span> <span class="n">s</span><span class="p">,</span><span class="n">l</span> <span class="ow">in</span> <span class="n">test_data</span><span class="p">:</span>
<a id="__codelineno-2-39" name="__codelineno-2-39"></a>  <span class="n">testing_sentences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">))</span>
<a id="__codelineno-2-40" name="__codelineno-2-40"></a>  <span class="n">testing_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
<a id="__codelineno-2-41" name="__codelineno-2-41"></a>
<a id="__codelineno-2-42" name="__codelineno-2-42"></a><span class="c1"># Convert labels lists to numpy array</span>
<a id="__codelineno-2-43" name="__codelineno-2-43"></a><span class="n">training_labels_final</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">training_labels</span><span class="p">)</span>
<a id="__codelineno-2-44" name="__codelineno-2-44"></a><span class="n">testing_labels_final</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">testing_labels</span><span class="p">)</span>
<a id="__codelineno-2-45" name="__codelineno-2-45"></a>
<a id="__codelineno-2-46" name="__codelineno-2-46"></a>
<a id="__codelineno-2-47" name="__codelineno-2-47"></a><span class="c1">########## GENERATE PADDED SEQUENCES ##########</span>
<a id="__codelineno-2-48" name="__codelineno-2-48"></a><span class="c1"># Parameters</span>
<a id="__codelineno-2-49" name="__codelineno-2-49"></a><span class="n">vocab_size</span> <span class="o">=</span> <span class="mi">10000</span>
<a id="__codelineno-2-50" name="__codelineno-2-50"></a><span class="n">max_length</span> <span class="o">=</span> <span class="mi">120</span>
<a id="__codelineno-2-51" name="__codelineno-2-51"></a><span class="n">embedding_dim</span> <span class="o">=</span> <span class="mi">16</span>
<a id="__codelineno-2-52" name="__codelineno-2-52"></a><span class="n">trunc_type</span><span class="o">=</span><span class="s1">&#39;post&#39;</span>
<a id="__codelineno-2-53" name="__codelineno-2-53"></a><span class="n">oov_tok</span> <span class="o">=</span> <span class="s2">&quot;&lt;OOV&gt;&quot;</span>
<a id="__codelineno-2-54" name="__codelineno-2-54"></a>
<a id="__codelineno-2-55" name="__codelineno-2-55"></a><span class="c1"># Initialize the Tokenizer class</span>
<a id="__codelineno-2-56" name="__codelineno-2-56"></a><span class="n">tokenizer</span> <span class="o">=</span> <span class="n">Tokenizer</span><span class="p">(</span><span class="n">num_words</span> <span class="o">=</span> <span class="n">vocab_size</span><span class="p">,</span> <span class="n">oov_token</span><span class="o">=</span><span class="n">oov_tok</span><span class="p">)</span>
<a id="__codelineno-2-57" name="__codelineno-2-57"></a>
<a id="__codelineno-2-58" name="__codelineno-2-58"></a><span class="c1"># Generate the word index dictionary for the training sentences</span>
<a id="__codelineno-2-59" name="__codelineno-2-59"></a><span class="n">tokenizer</span><span class="o">.</span><span class="n">fit_on_texts</span><span class="p">(</span><span class="n">training_sentences</span><span class="p">)</span>
<a id="__codelineno-2-60" name="__codelineno-2-60"></a><span class="n">word_index</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">word_index</span>
<a id="__codelineno-2-61" name="__codelineno-2-61"></a>
<a id="__codelineno-2-62" name="__codelineno-2-62"></a><span class="c1"># Generate and pad the training sequences</span>
<a id="__codelineno-2-63" name="__codelineno-2-63"></a><span class="n">sequences</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">texts_to_sequences</span><span class="p">(</span><span class="n">training_sentences</span><span class="p">)</span>
<a id="__codelineno-2-64" name="__codelineno-2-64"></a><span class="n">padded</span> <span class="o">=</span> <span class="n">pad_sequences</span><span class="p">(</span><span class="n">sequences</span><span class="p">,</span><span class="n">maxlen</span><span class="o">=</span><span class="n">max_length</span><span class="p">,</span> <span class="n">truncating</span><span class="o">=</span><span class="n">trunc_type</span><span class="p">)</span>
<a id="__codelineno-2-65" name="__codelineno-2-65"></a>
<a id="__codelineno-2-66" name="__codelineno-2-66"></a><span class="c1"># Generate and pad the test sequences</span>
<a id="__codelineno-2-67" name="__codelineno-2-67"></a><span class="n">testing_sequences</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">texts_to_sequences</span><span class="p">(</span><span class="n">testing_sentences</span><span class="p">)</span>
<a id="__codelineno-2-68" name="__codelineno-2-68"></a><span class="n">testing_padded</span> <span class="o">=</span> <span class="n">pad_sequences</span><span class="p">(</span><span class="n">testing_sequences</span><span class="p">,</span><span class="n">maxlen</span><span class="o">=</span><span class="n">max_length</span><span class="p">)</span>
<a id="__codelineno-2-69" name="__codelineno-2-69"></a>
<a id="__codelineno-2-70" name="__codelineno-2-70"></a><span class="c1">########## BUILD AND COMPILE MODEL ##########</span>
<a id="__codelineno-2-71" name="__codelineno-2-71"></a><span class="c1"># Build the model</span>
<a id="__codelineno-2-72" name="__codelineno-2-72"></a><span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
<a id="__codelineno-2-73" name="__codelineno-2-73"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">vocab_size</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="p">,</span> <span class="n">input_length</span><span class="o">=</span><span class="n">max_length</span><span class="p">),</span>
<a id="__codelineno-2-74" name="__codelineno-2-74"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Flatten</span><span class="p">(),</span>
<a id="__codelineno-2-75" name="__codelineno-2-75"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
<a id="__codelineno-2-76" name="__codelineno-2-76"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;sigmoid&#39;</span><span class="p">)</span>
<a id="__codelineno-2-77" name="__codelineno-2-77"></a><span class="p">])</span>
<a id="__codelineno-2-78" name="__codelineno-2-78"></a>
<a id="__codelineno-2-79" name="__codelineno-2-79"></a><span class="c1"># Setup the training parameters</span>
<a id="__codelineno-2-80" name="__codelineno-2-80"></a><span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">&#39;binary_crossentropy&#39;</span><span class="p">,</span><span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span><span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">])</span>
<a id="__codelineno-2-81" name="__codelineno-2-81"></a>
<a id="__codelineno-2-82" name="__codelineno-2-82"></a><span class="c1"># Print the model summary</span>
<a id="__codelineno-2-83" name="__codelineno-2-83"></a><span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
<a id="__codelineno-2-84" name="__codelineno-2-84"></a>
<a id="__codelineno-2-85" name="__codelineno-2-85"></a><span class="c1">########## TRAIN MODEL ##########</span>
<a id="__codelineno-2-86" name="__codelineno-2-86"></a><span class="n">num_epochs</span> <span class="o">=</span> <span class="mi">10</span>
<a id="__codelineno-2-87" name="__codelineno-2-87"></a>
<a id="__codelineno-2-88" name="__codelineno-2-88"></a><span class="c1"># Train the model</span>
<a id="__codelineno-2-89" name="__codelineno-2-89"></a><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">padded</span><span class="p">,</span> <span class="n">training_labels_final</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="n">num_epochs</span><span class="p">,</span> <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">testing_padded</span><span class="p">,</span> <span class="n">testing_labels_final</span><span class="p">))</span>
<a id="__codelineno-2-90" name="__codelineno-2-90"></a>
<a id="__codelineno-2-91" name="__codelineno-2-91"></a><span class="c1">########## VISUALIZE WORD EMBEDDINGS ##########</span>
<a id="__codelineno-2-92" name="__codelineno-2-92"></a><span class="c1"># Get the embedding layer from the model (i.e. first layer)</span>
<a id="__codelineno-2-93" name="__codelineno-2-93"></a><span class="n">embedding_layer</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-2-94" name="__codelineno-2-94"></a>
<a id="__codelineno-2-95" name="__codelineno-2-95"></a><span class="c1"># Get the weights of the embedding layer</span>
<a id="__codelineno-2-96" name="__codelineno-2-96"></a><span class="n">embedding_weights</span> <span class="o">=</span> <span class="n">embedding_layer</span><span class="o">.</span><span class="n">get_weights</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-2-97" name="__codelineno-2-97"></a>
<a id="__codelineno-2-98" name="__codelineno-2-98"></a><span class="c1"># Print the shape. Expected is (vocab_size, embedding_dim)</span>
<a id="__codelineno-2-99" name="__codelineno-2-99"></a><span class="nb">print</span><span class="p">(</span><span class="n">embedding_weights</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<a id="__codelineno-2-100" name="__codelineno-2-100"></a>
<a id="__codelineno-2-101" name="__codelineno-2-101"></a><span class="c1"># Get the index-word dictionary</span>
<a id="__codelineno-2-102" name="__codelineno-2-102"></a><span class="n">reverse_word_index</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">index_word</span>
<a id="__codelineno-2-103" name="__codelineno-2-103"></a>
<a id="__codelineno-2-104" name="__codelineno-2-104"></a><span class="c1"># Open writeable files</span>
<a id="__codelineno-2-105" name="__codelineno-2-105"></a><span class="n">out_v</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;vecs.tsv&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<a id="__codelineno-2-106" name="__codelineno-2-106"></a><span class="n">out_m</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;meta.tsv&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<a id="__codelineno-2-107" name="__codelineno-2-107"></a>
<a id="__codelineno-2-108" name="__codelineno-2-108"></a><span class="c1"># Initialize the loop. Start counting at `1` because `0` is just for the padding</span>
<a id="__codelineno-2-109" name="__codelineno-2-109"></a><span class="k">for</span> <span class="n">word_num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">vocab_size</span><span class="p">):</span>
<a id="__codelineno-2-110" name="__codelineno-2-110"></a>
<a id="__codelineno-2-111" name="__codelineno-2-111"></a>  <span class="c1"># Get the word associated at the current index</span>
<a id="__codelineno-2-112" name="__codelineno-2-112"></a>  <span class="n">word_name</span> <span class="o">=</span> <span class="n">reverse_word_index</span><span class="p">[</span><span class="n">word_num</span><span class="p">]</span>
<a id="__codelineno-2-113" name="__codelineno-2-113"></a>
<a id="__codelineno-2-114" name="__codelineno-2-114"></a>  <span class="c1"># Get the embedding weights associated with the current index</span>
<a id="__codelineno-2-115" name="__codelineno-2-115"></a>  <span class="n">word_embedding</span> <span class="o">=</span> <span class="n">embedding_weights</span><span class="p">[</span><span class="n">word_num</span><span class="p">]</span>
<a id="__codelineno-2-116" name="__codelineno-2-116"></a>
<a id="__codelineno-2-117" name="__codelineno-2-117"></a>  <span class="c1"># Write the word name</span>
<a id="__codelineno-2-118" name="__codelineno-2-118"></a>  <span class="n">out_m</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">word_name</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-2-119" name="__codelineno-2-119"></a>
<a id="__codelineno-2-120" name="__codelineno-2-120"></a>  <span class="c1"># Write the word embedding</span>
<a id="__codelineno-2-121" name="__codelineno-2-121"></a>  <span class="n">out_v</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">word_embedding</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-2-122" name="__codelineno-2-122"></a>
<a id="__codelineno-2-123" name="__codelineno-2-123"></a><span class="c1"># Close the files</span>
<a id="__codelineno-2-124" name="__codelineno-2-124"></a><span class="n">out_v</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-2-125" name="__codelineno-2-125"></a><span class="n">out_m</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-2-126" name="__codelineno-2-126"></a>
<a id="__codelineno-2-127" name="__codelineno-2-127"></a><span class="c1"># Import files utilities in Colab</span>
<a id="__codelineno-2-128" name="__codelineno-2-128"></a><span class="k">try</span><span class="p">:</span>
<a id="__codelineno-2-129" name="__codelineno-2-129"></a>  <span class="kn">from</span> <span class="nn">google.colab</span> <span class="kn">import</span> <span class="n">files</span>
<a id="__codelineno-2-130" name="__codelineno-2-130"></a><span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
<a id="__codelineno-2-131" name="__codelineno-2-131"></a>  <span class="k">pass</span>
<a id="__codelineno-2-132" name="__codelineno-2-132"></a>
<a id="__codelineno-2-133" name="__codelineno-2-133"></a><span class="c1"># Download the files</span>
<a id="__codelineno-2-134" name="__codelineno-2-134"></a><span class="k">else</span><span class="p">:</span>
<a id="__codelineno-2-135" name="__codelineno-2-135"></a>  <span class="n">files</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s1">&#39;vecs.tsv&#39;</span><span class="p">)</span>
<a id="__codelineno-2-136" name="__codelineno-2-136"></a>  <span class="n">files</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s1">&#39;meta.tsv&#39;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
</details>
<h3 id="lecture-code-2-news-headlines">Lecture Code 2: News Headlines</h3>
<p>Dataset: <a href="https://www.kaggle.com/rmisra/news-headlines-dataset-for-sarcasm-detection/home">News Headlines Dataset for Sarcasm Detection</a></p>
<details class="- success">
<summary>Lecture Code 2: News Headlines</summary>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">  1</a></span>
<span class="normal"><a href="#__codelineno-3-2">  2</a></span>
<span class="normal"><a href="#__codelineno-3-3">  3</a></span>
<span class="normal"><a href="#__codelineno-3-4">  4</a></span>
<span class="normal"><a href="#__codelineno-3-5">  5</a></span>
<span class="normal"><a href="#__codelineno-3-6">  6</a></span>
<span class="normal"><a href="#__codelineno-3-7">  7</a></span>
<span class="normal"><a href="#__codelineno-3-8">  8</a></span>
<span class="normal"><a href="#__codelineno-3-9">  9</a></span>
<span class="normal"><a href="#__codelineno-3-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-3-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-3-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-3-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-3-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-3-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-3-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-3-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-3-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-3-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-3-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-3-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-3-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-3-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-3-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-3-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-3-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-3-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-3-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-3-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-3-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-3-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-3-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-3-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-3-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-3-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-3-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-3-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-3-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-3-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-3-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-3-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-3-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-3-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-3-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-3-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-3-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-3-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-3-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-3-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-3-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-3-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-3-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-3-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-3-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-3-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-3-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-3-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-3-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-3-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-3-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-3-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-3-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-3-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-3-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-3-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-3-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-3-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-3-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-3-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-3-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-3-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-3-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-3-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-3-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-3-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-3-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-3-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-3-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-3-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-3-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-3-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-3-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-3-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-3-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-3-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-3-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-3-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-3-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-3-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-3-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-3-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-3-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-3-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-3-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-3-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-3-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-3-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-3-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-3-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-3-100">100</a></span>
<span class="normal"><a href="#__codelineno-3-101">101</a></span>
<span class="normal"><a href="#__codelineno-3-102">102</a></span>
<span class="normal"><a href="#__codelineno-3-103">103</a></span>
<span class="normal"><a href="#__codelineno-3-104">104</a></span>
<span class="normal"><a href="#__codelineno-3-105">105</a></span>
<span class="normal"><a href="#__codelineno-3-106">106</a></span>
<span class="normal"><a href="#__codelineno-3-107">107</a></span>
<span class="normal"><a href="#__codelineno-3-108">108</a></span>
<span class="normal"><a href="#__codelineno-3-109">109</a></span>
<span class="normal"><a href="#__codelineno-3-110">110</a></span>
<span class="normal"><a href="#__codelineno-3-111">111</a></span>
<span class="normal"><a href="#__codelineno-3-112">112</a></span>
<span class="normal"><a href="#__codelineno-3-113">113</a></span>
<span class="normal"><a href="#__codelineno-3-114">114</a></span>
<span class="normal"><a href="#__codelineno-3-115">115</a></span>
<span class="normal"><a href="#__codelineno-3-116">116</a></span>
<span class="normal"><a href="#__codelineno-3-117">117</a></span>
<span class="normal"><a href="#__codelineno-3-118">118</a></span>
<span class="normal"><a href="#__codelineno-3-119">119</a></span>
<span class="normal"><a href="#__codelineno-3-120">120</a></span>
<span class="normal"><a href="#__codelineno-3-121">121</a></span>
<span class="normal"><a href="#__codelineno-3-122">122</a></span>
<span class="normal"><a href="#__codelineno-3-123">123</a></span>
<span class="normal"><a href="#__codelineno-3-124">124</a></span>
<span class="normal"><a href="#__codelineno-3-125">125</a></span>
<span class="normal"><a href="#__codelineno-3-126">126</a></span>
<span class="normal"><a href="#__codelineno-3-127">127</a></span>
<span class="normal"><a href="#__codelineno-3-128">128</a></span>
<span class="normal"><a href="#__codelineno-3-129">129</a></span>
<span class="normal"><a href="#__codelineno-3-130">130</a></span>
<span class="normal"><a href="#__codelineno-3-131">131</a></span>
<span class="normal"><a href="#__codelineno-3-132">132</a></span>
<span class="normal"><a href="#__codelineno-3-133">133</a></span>
<span class="normal"><a href="#__codelineno-3-134">134</a></span>
<span class="normal"><a href="#__codelineno-3-135">135</a></span>
<span class="normal"><a href="#__codelineno-3-136">136</a></span>
<span class="normal"><a href="#__codelineno-3-137">137</a></span>
<span class="normal"><a href="#__codelineno-3-138">138</a></span>
<span class="normal"><a href="#__codelineno-3-139">139</a></span>
<span class="normal"><a href="#__codelineno-3-140">140</a></span>
<span class="normal"><a href="#__codelineno-3-141">141</a></span>
<span class="normal"><a href="#__codelineno-3-142">142</a></span>
<span class="normal"><a href="#__codelineno-3-143">143</a></span>
<span class="normal"><a href="#__codelineno-3-144">144</a></span>
<span class="normal"><a href="#__codelineno-3-145">145</a></span>
<span class="normal"><a href="#__codelineno-3-146">146</a></span>
<span class="normal"><a href="#__codelineno-3-147">147</a></span>
<span class="normal"><a href="#__codelineno-3-148">148</a></span>
<span class="normal"><a href="#__codelineno-3-149">149</a></span>
<span class="normal"><a href="#__codelineno-3-150">150</a></span>
<span class="normal"><a href="#__codelineno-3-151">151</a></span>
<span class="normal"><a href="#__codelineno-3-152">152</a></span>
<span class="normal"><a href="#__codelineno-3-153">153</a></span>
<span class="normal"><a href="#__codelineno-3-154">154</a></span>
<span class="normal"><a href="#__codelineno-3-155">155</a></span>
<span class="normal"><a href="#__codelineno-3-156">156</a></span>
<span class="normal"><a href="#__codelineno-3-157">157</a></span>
<span class="normal"><a href="#__codelineno-3-158">158</a></span>
<span class="normal"><a href="#__codelineno-3-159">159</a></span>
<span class="normal"><a href="#__codelineno-3-160">160</a></span>
<span class="normal"><a href="#__codelineno-3-161">161</a></span>
<span class="normal"><a href="#__codelineno-3-162">162</a></span>
<span class="normal"><a href="#__codelineno-3-163">163</a></span>
<span class="normal"><a href="#__codelineno-3-164">164</a></span>
<span class="normal"><a href="#__codelineno-3-165">165</a></span>
<span class="normal"><a href="#__codelineno-3-166">166</a></span>
<span class="normal"><a href="#__codelineno-3-167">167</a></span>
<span class="normal"><a href="#__codelineno-3-168">168</a></span>
<span class="normal"><a href="#__codelineno-3-169">169</a></span>
<span class="normal"><a href="#__codelineno-3-170">170</a></span>
<span class="normal"><a href="#__codelineno-3-171">171</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="kn">import</span> <span class="nn">json</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="kn">import</span> <span class="nn">io</span>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a>
<a id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<a id="__codelineno-3-7" name="__codelineno-3-7"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.preprocessing.text</span> <span class="kn">import</span> <span class="n">Tokenizer</span>
<a id="__codelineno-3-8" name="__codelineno-3-8"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.preprocessing.sequence</span> <span class="kn">import</span> <span class="n">pad_sequences</span>
<a id="__codelineno-3-9" name="__codelineno-3-9"></a>
<a id="__codelineno-3-10" name="__codelineno-3-10"></a><span class="c1">########## DOWNLOAD DATASET ##########</span>
<a id="__codelineno-3-11" name="__codelineno-3-11"></a><span class="c1"># Download the dataset</span>
<a id="__codelineno-3-12" name="__codelineno-3-12"></a><span class="err">!</span><span class="n">wget</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">storage</span><span class="o">.</span><span class="n">googleapis</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">tensorflow</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">public</span><span class="o">/</span><span class="n">course3</span><span class="o">/</span><span class="n">sarcasm</span><span class="o">.</span><span class="n">json</span>
<a id="__codelineno-3-13" name="__codelineno-3-13"></a>
<a id="__codelineno-3-14" name="__codelineno-3-14"></a><span class="c1"># Load the JSON file</span>
<a id="__codelineno-3-15" name="__codelineno-3-15"></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;./sarcasm.json&quot;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-3-16" name="__codelineno-3-16"></a>    <span class="n">datastore</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<a id="__codelineno-3-17" name="__codelineno-3-17"></a>
<a id="__codelineno-3-18" name="__codelineno-3-18"></a><span class="c1"># Initialize the lists</span>
<a id="__codelineno-3-19" name="__codelineno-3-19"></a><span class="n">sentences</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-3-20" name="__codelineno-3-20"></a><span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-3-21" name="__codelineno-3-21"></a>
<a id="__codelineno-3-22" name="__codelineno-3-22"></a><span class="c1"># Collect sentences and labels into the lists</span>
<a id="__codelineno-3-23" name="__codelineno-3-23"></a><span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">datastore</span><span class="p">:</span>
<a id="__codelineno-3-24" name="__codelineno-3-24"></a>    <span class="n">sentences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;headline&#39;</span><span class="p">])</span>
<a id="__codelineno-3-25" name="__codelineno-3-25"></a>    <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;is_sarcastic&#39;</span><span class="p">])</span>
<a id="__codelineno-3-26" name="__codelineno-3-26"></a>
<a id="__codelineno-3-27" name="__codelineno-3-27"></a><span class="c1">########## SET HYPERPARAMETER ##########</span>
<a id="__codelineno-3-28" name="__codelineno-3-28"></a><span class="c1"># Number of examples to use for training</span>
<a id="__codelineno-3-29" name="__codelineno-3-29"></a><span class="n">training_size</span> <span class="o">=</span> <span class="mi">20000</span>
<a id="__codelineno-3-30" name="__codelineno-3-30"></a>
<a id="__codelineno-3-31" name="__codelineno-3-31"></a><span class="c1"># Vocabulary size of the tokenizer</span>
<a id="__codelineno-3-32" name="__codelineno-3-32"></a><span class="n">vocab_size</span> <span class="o">=</span> <span class="mi">10000</span>
<a id="__codelineno-3-33" name="__codelineno-3-33"></a>
<a id="__codelineno-3-34" name="__codelineno-3-34"></a><span class="c1"># Maximum length of the padded sequences</span>
<a id="__codelineno-3-35" name="__codelineno-3-35"></a><span class="n">max_length</span> <span class="o">=</span> <span class="mi">32</span>
<a id="__codelineno-3-36" name="__codelineno-3-36"></a>
<a id="__codelineno-3-37" name="__codelineno-3-37"></a><span class="c1"># Output dimensions of the Embedding layer</span>
<a id="__codelineno-3-38" name="__codelineno-3-38"></a><span class="n">embedding_dim</span> <span class="o">=</span> <span class="mi">16</span>
<a id="__codelineno-3-39" name="__codelineno-3-39"></a>
<a id="__codelineno-3-40" name="__codelineno-3-40"></a><span class="c1">########### SPLIT DATA ##########</span>
<a id="__codelineno-3-41" name="__codelineno-3-41"></a><span class="c1"># Split the sentences</span>
<a id="__codelineno-3-42" name="__codelineno-3-42"></a><span class="n">training_sentences</span> <span class="o">=</span> <span class="n">sentences</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">training_size</span><span class="p">]</span>
<a id="__codelineno-3-43" name="__codelineno-3-43"></a><span class="n">testing_sentences</span> <span class="o">=</span> <span class="n">sentences</span><span class="p">[</span><span class="n">training_size</span><span class="p">:]</span>
<a id="__codelineno-3-44" name="__codelineno-3-44"></a>
<a id="__codelineno-3-45" name="__codelineno-3-45"></a><span class="c1"># Split the labels</span>
<a id="__codelineno-3-46" name="__codelineno-3-46"></a><span class="n">training_labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">training_size</span><span class="p">]</span>
<a id="__codelineno-3-47" name="__codelineno-3-47"></a><span class="n">testing_labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">training_size</span><span class="p">:]</span>
<a id="__codelineno-3-48" name="__codelineno-3-48"></a>
<a id="__codelineno-3-49" name="__codelineno-3-49"></a><span class="c1">########### PREPROCESSING ##########</span>
<a id="__codelineno-3-50" name="__codelineno-3-50"></a><span class="c1"># Parameters for padding and OOV tokens</span>
<a id="__codelineno-3-51" name="__codelineno-3-51"></a><span class="n">trunc_type</span><span class="o">=</span><span class="s1">&#39;post&#39;</span>
<a id="__codelineno-3-52" name="__codelineno-3-52"></a><span class="n">padding_type</span><span class="o">=</span><span class="s1">&#39;post&#39;</span>
<a id="__codelineno-3-53" name="__codelineno-3-53"></a><span class="n">oov_tok</span> <span class="o">=</span> <span class="s2">&quot;&lt;OOV&gt;&quot;</span>
<a id="__codelineno-3-54" name="__codelineno-3-54"></a>
<a id="__codelineno-3-55" name="__codelineno-3-55"></a><span class="c1"># Initialize the Tokenizer class</span>
<a id="__codelineno-3-56" name="__codelineno-3-56"></a><span class="n">tokenizer</span> <span class="o">=</span> <span class="n">Tokenizer</span><span class="p">(</span><span class="n">num_words</span><span class="o">=</span><span class="n">vocab_size</span><span class="p">,</span> <span class="n">oov_token</span><span class="o">=</span><span class="n">oov_tok</span><span class="p">)</span>
<a id="__codelineno-3-57" name="__codelineno-3-57"></a>
<a id="__codelineno-3-58" name="__codelineno-3-58"></a><span class="c1"># Generate the word index dictionary</span>
<a id="__codelineno-3-59" name="__codelineno-3-59"></a><span class="n">tokenizer</span><span class="o">.</span><span class="n">fit_on_texts</span><span class="p">(</span><span class="n">training_sentences</span><span class="p">)</span>
<a id="__codelineno-3-60" name="__codelineno-3-60"></a><span class="n">word_index</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">word_index</span>
<a id="__codelineno-3-61" name="__codelineno-3-61"></a>
<a id="__codelineno-3-62" name="__codelineno-3-62"></a><span class="c1"># Generate and pad the training sequences</span>
<a id="__codelineno-3-63" name="__codelineno-3-63"></a><span class="n">training_sequences</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">texts_to_sequences</span><span class="p">(</span><span class="n">training_sentences</span><span class="p">)</span>
<a id="__codelineno-3-64" name="__codelineno-3-64"></a><span class="n">training_padded</span> <span class="o">=</span> <span class="n">pad_sequences</span><span class="p">(</span><span class="n">training_sequences</span><span class="p">,</span> <span class="n">maxlen</span><span class="o">=</span><span class="n">max_length</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding_type</span><span class="p">,</span> <span class="n">truncating</span><span class="o">=</span><span class="n">trunc_type</span><span class="p">)</span>
<a id="__codelineno-3-65" name="__codelineno-3-65"></a>
<a id="__codelineno-3-66" name="__codelineno-3-66"></a><span class="c1"># Generate and pad the testing sequences</span>
<a id="__codelineno-3-67" name="__codelineno-3-67"></a><span class="n">testing_sequences</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">texts_to_sequences</span><span class="p">(</span><span class="n">testing_sentences</span><span class="p">)</span>
<a id="__codelineno-3-68" name="__codelineno-3-68"></a><span class="n">testing_padded</span> <span class="o">=</span> <span class="n">pad_sequences</span><span class="p">(</span><span class="n">testing_sequences</span><span class="p">,</span> <span class="n">maxlen</span><span class="o">=</span><span class="n">max_length</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding_type</span><span class="p">,</span> <span class="n">truncating</span><span class="o">=</span><span class="n">trunc_type</span><span class="p">)</span>
<a id="__codelineno-3-69" name="__codelineno-3-69"></a>
<a id="__codelineno-3-70" name="__codelineno-3-70"></a><span class="c1"># Convert the labels lists into numpy arrays</span>
<a id="__codelineno-3-71" name="__codelineno-3-71"></a><span class="n">training_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">training_labels</span><span class="p">)</span>
<a id="__codelineno-3-72" name="__codelineno-3-72"></a><span class="n">testing_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">testing_labels</span><span class="p">)</span>
<a id="__codelineno-3-73" name="__codelineno-3-73"></a>
<a id="__codelineno-3-74" name="__codelineno-3-74"></a><span class="c1">########## BUILD AND COMPILE MODEL ##########</span>
<a id="__codelineno-3-75" name="__codelineno-3-75"></a><span class="c1"># Initialize a GlobalAveragePooling1D (GAP1D) layer</span>
<a id="__codelineno-3-76" name="__codelineno-3-76"></a><span class="n">gap1d_layer</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">GlobalAveragePooling1D</span><span class="p">()</span>
<a id="__codelineno-3-77" name="__codelineno-3-77"></a>
<a id="__codelineno-3-78" name="__codelineno-3-78"></a><span class="c1"># Define sample array</span>
<a id="__codelineno-3-79" name="__codelineno-3-79"></a><span class="n">sample_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[[</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]]])</span>
<a id="__codelineno-3-80" name="__codelineno-3-80"></a>
<a id="__codelineno-3-81" name="__codelineno-3-81"></a><span class="c1"># Print shape and contents of sample array</span>
<a id="__codelineno-3-82" name="__codelineno-3-82"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;shape of sample_array = </span><span class="si">{</span><span class="n">sample_array</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-3-83" name="__codelineno-3-83"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;sample array: </span><span class="si">{</span><span class="n">sample_array</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-3-84" name="__codelineno-3-84"></a>
<a id="__codelineno-3-85" name="__codelineno-3-85"></a><span class="c1"># Pass the sample array to the GAP1D layer</span>
<a id="__codelineno-3-86" name="__codelineno-3-86"></a><span class="n">output</span> <span class="o">=</span> <span class="n">gap1d_layer</span><span class="p">(</span><span class="n">sample_array</span><span class="p">)</span>
<a id="__codelineno-3-87" name="__codelineno-3-87"></a>
<a id="__codelineno-3-88" name="__codelineno-3-88"></a><span class="c1"># Print shape and contents of the GAP1D output array</span>
<a id="__codelineno-3-89" name="__codelineno-3-89"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;output shape of gap1d_layer: </span><span class="si">{</span><span class="n">output</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-3-90" name="__codelineno-3-90"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;output array of gap1d_layer: </span><span class="si">{</span><span class="n">output</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-3-91" name="__codelineno-3-91"></a>
<a id="__codelineno-3-92" name="__codelineno-3-92"></a><span class="c1"># Build the model</span>
<a id="__codelineno-3-93" name="__codelineno-3-93"></a><span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
<a id="__codelineno-3-94" name="__codelineno-3-94"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">vocab_size</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="p">,</span> <span class="n">input_length</span><span class="o">=</span><span class="n">max_length</span><span class="p">),</span>
<a id="__codelineno-3-95" name="__codelineno-3-95"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">GlobalAveragePooling1D</span><span class="p">(),</span>
<a id="__codelineno-3-96" name="__codelineno-3-96"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
<a id="__codelineno-3-97" name="__codelineno-3-97"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;sigmoid&#39;</span><span class="p">)</span>
<a id="__codelineno-3-98" name="__codelineno-3-98"></a><span class="p">])</span>
<a id="__codelineno-3-99" name="__codelineno-3-99"></a>
<a id="__codelineno-3-100" name="__codelineno-3-100"></a><span class="c1"># Print the model summary</span>
<a id="__codelineno-3-101" name="__codelineno-3-101"></a><span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
<a id="__codelineno-3-102" name="__codelineno-3-102"></a>
<a id="__codelineno-3-103" name="__codelineno-3-103"></a><span class="c1"># Compile the model</span>
<a id="__codelineno-3-104" name="__codelineno-3-104"></a><span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">&#39;binary_crossentropy&#39;</span><span class="p">,</span><span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span><span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">])</span>
<a id="__codelineno-3-105" name="__codelineno-3-105"></a>
<a id="__codelineno-3-106" name="__codelineno-3-106"></a><span class="c1">########## TRAIN MODEL ##########</span>
<a id="__codelineno-3-107" name="__codelineno-3-107"></a><span class="n">num_epochs</span> <span class="o">=</span> <span class="mi">30</span>
<a id="__codelineno-3-108" name="__codelineno-3-108"></a>
<a id="__codelineno-3-109" name="__codelineno-3-109"></a><span class="c1"># Train the model</span>
<a id="__codelineno-3-110" name="__codelineno-3-110"></a><span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">training_padded</span><span class="p">,</span> <span class="n">training_labels</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="n">num_epochs</span><span class="p">,</span> <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">testing_padded</span><span class="p">,</span> <span class="n">testing_labels</span><span class="p">),</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-3-111" name="__codelineno-3-111"></a>
<a id="__codelineno-3-112" name="__codelineno-3-112"></a><span class="c1">########## VISUALIZE RESULT ##########</span>
<a id="__codelineno-3-113" name="__codelineno-3-113"></a><span class="c1"># Plot utility</span>
<a id="__codelineno-3-114" name="__codelineno-3-114"></a><span class="k">def</span> <span class="nf">plot_graphs</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
<a id="__codelineno-3-115" name="__codelineno-3-115"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="n">string</span><span class="p">])</span>
<a id="__codelineno-3-116" name="__codelineno-3-116"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;val_&#39;</span><span class="o">+</span><span class="n">string</span><span class="p">])</span>
<a id="__codelineno-3-117" name="__codelineno-3-117"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Epochs&quot;</span><span class="p">)</span>
<a id="__codelineno-3-118" name="__codelineno-3-118"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
<a id="__codelineno-3-119" name="__codelineno-3-119"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="n">string</span><span class="p">,</span> <span class="s1">&#39;val_&#39;</span><span class="o">+</span><span class="n">string</span><span class="p">])</span>
<a id="__codelineno-3-120" name="__codelineno-3-120"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<a id="__codelineno-3-121" name="__codelineno-3-121"></a>
<a id="__codelineno-3-122" name="__codelineno-3-122"></a><span class="c1"># Plot the accuracy and loss</span>
<a id="__codelineno-3-123" name="__codelineno-3-123"></a><span class="n">plot_graphs</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="s2">&quot;accuracy&quot;</span><span class="p">)</span>
<a id="__codelineno-3-124" name="__codelineno-3-124"></a><span class="n">plot_graphs</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="s2">&quot;loss&quot;</span><span class="p">)</span>
<a id="__codelineno-3-125" name="__codelineno-3-125"></a>
<a id="__codelineno-3-126" name="__codelineno-3-126"></a><span class="c1">########## VISUALIZE WORD EMBEDDING ##########</span>
<a id="__codelineno-3-127" name="__codelineno-3-127"></a><span class="c1"># Get the index-word dictionary</span>
<a id="__codelineno-3-128" name="__codelineno-3-128"></a><span class="n">reverse_word_index</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">index_word</span>
<a id="__codelineno-3-129" name="__codelineno-3-129"></a>
<a id="__codelineno-3-130" name="__codelineno-3-130"></a><span class="c1"># Get the embedding layer from the model (i.e. first layer)</span>
<a id="__codelineno-3-131" name="__codelineno-3-131"></a><span class="n">embedding_layer</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-3-132" name="__codelineno-3-132"></a>
<a id="__codelineno-3-133" name="__codelineno-3-133"></a><span class="c1"># Get the weights of the embedding layer</span>
<a id="__codelineno-3-134" name="__codelineno-3-134"></a><span class="n">embedding_weights</span> <span class="o">=</span> <span class="n">embedding_layer</span><span class="o">.</span><span class="n">get_weights</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-3-135" name="__codelineno-3-135"></a>
<a id="__codelineno-3-136" name="__codelineno-3-136"></a><span class="c1"># Print the shape. Expected is (vocab_size, embedding_dim)</span>
<a id="__codelineno-3-137" name="__codelineno-3-137"></a><span class="nb">print</span><span class="p">(</span><span class="n">embedding_weights</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> 
<a id="__codelineno-3-138" name="__codelineno-3-138"></a>
<a id="__codelineno-3-139" name="__codelineno-3-139"></a><span class="c1"># Open writeable files</span>
<a id="__codelineno-3-140" name="__codelineno-3-140"></a><span class="n">out_v</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;vecs.tsv&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<a id="__codelineno-3-141" name="__codelineno-3-141"></a><span class="n">out_m</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;meta.tsv&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<a id="__codelineno-3-142" name="__codelineno-3-142"></a>
<a id="__codelineno-3-143" name="__codelineno-3-143"></a><span class="c1"># Initialize the loop. Start counting at `1` because `0` is just for the padding</span>
<a id="__codelineno-3-144" name="__codelineno-3-144"></a><span class="k">for</span> <span class="n">word_num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">vocab_size</span><span class="p">):</span>
<a id="__codelineno-3-145" name="__codelineno-3-145"></a>
<a id="__codelineno-3-146" name="__codelineno-3-146"></a>  <span class="c1"># Get the word associated at the current index</span>
<a id="__codelineno-3-147" name="__codelineno-3-147"></a>  <span class="n">word_name</span> <span class="o">=</span> <span class="n">reverse_word_index</span><span class="p">[</span><span class="n">word_num</span><span class="p">]</span>
<a id="__codelineno-3-148" name="__codelineno-3-148"></a>
<a id="__codelineno-3-149" name="__codelineno-3-149"></a>  <span class="c1"># Get the embedding weights associated with the current index</span>
<a id="__codelineno-3-150" name="__codelineno-3-150"></a>  <span class="n">word_embedding</span> <span class="o">=</span> <span class="n">embedding_weights</span><span class="p">[</span><span class="n">word_num</span><span class="p">]</span>
<a id="__codelineno-3-151" name="__codelineno-3-151"></a>
<a id="__codelineno-3-152" name="__codelineno-3-152"></a>  <span class="c1"># Write the word name</span>
<a id="__codelineno-3-153" name="__codelineno-3-153"></a>  <span class="n">out_m</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">word_name</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-3-154" name="__codelineno-3-154"></a>
<a id="__codelineno-3-155" name="__codelineno-3-155"></a>  <span class="c1"># Write the word embedding</span>
<a id="__codelineno-3-156" name="__codelineno-3-156"></a>  <span class="n">out_v</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">word_embedding</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-3-157" name="__codelineno-3-157"></a>
<a id="__codelineno-3-158" name="__codelineno-3-158"></a><span class="c1"># Close the files</span>
<a id="__codelineno-3-159" name="__codelineno-3-159"></a><span class="n">out_v</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-3-160" name="__codelineno-3-160"></a><span class="n">out_m</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-3-161" name="__codelineno-3-161"></a>
<a id="__codelineno-3-162" name="__codelineno-3-162"></a><span class="c1"># Import files utilities in Colab</span>
<a id="__codelineno-3-163" name="__codelineno-3-163"></a><span class="k">try</span><span class="p">:</span>
<a id="__codelineno-3-164" name="__codelineno-3-164"></a>  <span class="kn">from</span> <span class="nn">google.colab</span> <span class="kn">import</span> <span class="n">files</span>
<a id="__codelineno-3-165" name="__codelineno-3-165"></a><span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
<a id="__codelineno-3-166" name="__codelineno-3-166"></a>  <span class="k">pass</span>
<a id="__codelineno-3-167" name="__codelineno-3-167"></a>
<a id="__codelineno-3-168" name="__codelineno-3-168"></a><span class="c1"># Download the files</span>
<a id="__codelineno-3-169" name="__codelineno-3-169"></a><span class="k">else</span><span class="p">:</span>
<a id="__codelineno-3-170" name="__codelineno-3-170"></a>  <span class="n">files</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s1">&#39;vecs.tsv&#39;</span><span class="p">)</span>
<a id="__codelineno-3-171" name="__codelineno-3-171"></a>  <span class="n">files</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s1">&#39;meta.tsv&#39;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
</details>
<h3 id="exercise-bbc-news-archive">Exercise: BBC News Archive</h3>
<p><strong>Dataset:</strong> BBC text archive</p>
<p><strong>Assignment:</strong> design a neural network to train the dataset</p>
<details class="- success">
<summary>Final code for the exercise</summary>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">  1</a></span>
<span class="normal"><a href="#__codelineno-4-2">  2</a></span>
<span class="normal"><a href="#__codelineno-4-3">  3</a></span>
<span class="normal"><a href="#__codelineno-4-4">  4</a></span>
<span class="normal"><a href="#__codelineno-4-5">  5</a></span>
<span class="normal"><a href="#__codelineno-4-6">  6</a></span>
<span class="normal"><a href="#__codelineno-4-7">  7</a></span>
<span class="normal"><a href="#__codelineno-4-8">  8</a></span>
<span class="normal"><a href="#__codelineno-4-9">  9</a></span>
<span class="normal"><a href="#__codelineno-4-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-4-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-4-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-4-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-4-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-4-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-4-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-4-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-4-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-4-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-4-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-4-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-4-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-4-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-4-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-4-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-4-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-4-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-4-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-4-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-4-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-4-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-4-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-4-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-4-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-4-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-4-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-4-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-4-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-4-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-4-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-4-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-4-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-4-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-4-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-4-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-4-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-4-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-4-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-4-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-4-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-4-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-4-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-4-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-4-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-4-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-4-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-4-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-4-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-4-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-4-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-4-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-4-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-4-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-4-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-4-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-4-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-4-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-4-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-4-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-4-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-4-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-4-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-4-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-4-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-4-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-4-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-4-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-4-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-4-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-4-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-4-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-4-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-4-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-4-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-4-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-4-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-4-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-4-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-4-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-4-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-4-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-4-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-4-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-4-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-4-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-4-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-4-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-4-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-4-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-4-100">100</a></span>
<span class="normal"><a href="#__codelineno-4-101">101</a></span>
<span class="normal"><a href="#__codelineno-4-102">102</a></span>
<span class="normal"><a href="#__codelineno-4-103">103</a></span>
<span class="normal"><a href="#__codelineno-4-104">104</a></span>
<span class="normal"><a href="#__codelineno-4-105">105</a></span>
<span class="normal"><a href="#__codelineno-4-106">106</a></span>
<span class="normal"><a href="#__codelineno-4-107">107</a></span>
<span class="normal"><a href="#__codelineno-4-108">108</a></span>
<span class="normal"><a href="#__codelineno-4-109">109</a></span>
<span class="normal"><a href="#__codelineno-4-110">110</a></span>
<span class="normal"><a href="#__codelineno-4-111">111</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="kn">import</span> <span class="nn">csv</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.preprocessing.text</span> <span class="kn">import</span> <span class="n">Tokenizer</span>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.preprocessing.sequence</span> <span class="kn">import</span> <span class="n">pad_sequences</span>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a>
<a id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="c1"># bbc-text.csv</span>
<a id="__codelineno-4-8" name="__codelineno-4-8"></a><span class="err">!</span><span class="n">gdown</span> <span class="o">--</span><span class="nb">id</span> <span class="mi">1</span><span class="n">rX10xeI3eUJmOLsc4pOPY6AnCLO8DxNj</span>
<a id="__codelineno-4-9" name="__codelineno-4-9"></a>
<a id="__codelineno-4-10" name="__codelineno-4-10"></a><span class="n">vocab_size</span> <span class="o">=</span> <span class="mi">1000</span> <span class="c1"># IN-LINE CODE HERE</span>
<a id="__codelineno-4-11" name="__codelineno-4-11"></a><span class="n">embedding_dim</span> <span class="o">=</span> <span class="mi">16</span> <span class="c1"># IN-LINE CODE HERE</span>
<a id="__codelineno-4-12" name="__codelineno-4-12"></a><span class="n">max_length</span> <span class="o">=</span> <span class="mi">120</span> <span class="c1"># IN-LINE CODE HERE</span>
<a id="__codelineno-4-13" name="__codelineno-4-13"></a><span class="n">trunc_type</span><span class="o">=</span><span class="s1">&#39;post&#39;</span> <span class="c1"># IN-LINE CODE HERE</span>
<a id="__codelineno-4-14" name="__codelineno-4-14"></a><span class="n">padding_type</span><span class="o">=</span><span class="s1">&#39;post&#39;</span> <span class="c1"># IN-LINE CODE HERE</span>
<a id="__codelineno-4-15" name="__codelineno-4-15"></a><span class="n">oov_tok</span> <span class="o">=</span> <span class="s2">&quot;&lt;OOV&gt;&quot;</span> <span class="c1"># IN-LINE CODE HERE</span>
<a id="__codelineno-4-16" name="__codelineno-4-16"></a><span class="n">training_portion</span> <span class="o">=</span> <span class="mf">.8</span>
<a id="__codelineno-4-17" name="__codelineno-4-17"></a>
<a id="__codelineno-4-18" name="__codelineno-4-18"></a><span class="n">sentences</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-4-19" name="__codelineno-4-19"></a><span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-4-20" name="__codelineno-4-20"></a><span class="n">stopwords</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;about&quot;</span><span class="p">,</span> <span class="s2">&quot;above&quot;</span><span class="p">,</span> <span class="s2">&quot;after&quot;</span><span class="p">,</span> <span class="s2">&quot;again&quot;</span><span class="p">,</span> <span class="s2">&quot;against&quot;</span><span class="p">,</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="s2">&quot;am&quot;</span><span class="p">,</span> <span class="s2">&quot;an&quot;</span><span class="p">,</span> <span class="s2">&quot;and&quot;</span><span class="p">,</span> <span class="s2">&quot;any&quot;</span><span class="p">,</span> <span class="s2">&quot;are&quot;</span><span class="p">,</span> <span class="s2">&quot;as&quot;</span><span class="p">,</span> <span class="s2">&quot;at&quot;</span><span class="p">,</span> <span class="s2">&quot;be&quot;</span><span class="p">,</span> <span class="s2">&quot;because&quot;</span><span class="p">,</span> <span class="s2">&quot;been&quot;</span><span class="p">,</span> <span class="s2">&quot;before&quot;</span><span class="p">,</span> <span class="s2">&quot;being&quot;</span><span class="p">,</span> <span class="s2">&quot;below&quot;</span><span class="p">,</span> <span class="s2">&quot;between&quot;</span><span class="p">,</span> <span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="s2">&quot;but&quot;</span><span class="p">,</span> <span class="s2">&quot;by&quot;</span><span class="p">,</span> <span class="s2">&quot;could&quot;</span><span class="p">,</span> <span class="s2">&quot;did&quot;</span><span class="p">,</span> <span class="s2">&quot;do&quot;</span><span class="p">,</span> <span class="s2">&quot;does&quot;</span><span class="p">,</span> <span class="s2">&quot;doing&quot;</span><span class="p">,</span> <span class="s2">&quot;down&quot;</span><span class="p">,</span> <span class="s2">&quot;during&quot;</span><span class="p">,</span> <span class="s2">&quot;each&quot;</span><span class="p">,</span> <span class="s2">&quot;few&quot;</span><span class="p">,</span> <span class="s2">&quot;for&quot;</span><span class="p">,</span> <span class="s2">&quot;from&quot;</span><span class="p">,</span> <span class="s2">&quot;further&quot;</span><span class="p">,</span> <span class="s2">&quot;had&quot;</span><span class="p">,</span> <span class="s2">&quot;has&quot;</span><span class="p">,</span> <span class="s2">&quot;have&quot;</span><span class="p">,</span> <span class="s2">&quot;having&quot;</span><span class="p">,</span> <span class="s2">&quot;he&quot;</span><span class="p">,</span> <span class="s2">&quot;he&#39;d&quot;</span><span class="p">,</span> <span class="s2">&quot;he&#39;ll&quot;</span><span class="p">,</span> <span class="s2">&quot;he&#39;s&quot;</span><span class="p">,</span> <span class="s2">&quot;her&quot;</span><span class="p">,</span> <span class="s2">&quot;here&quot;</span><span class="p">,</span> <span class="s2">&quot;here&#39;s&quot;</span><span class="p">,</span> <span class="s2">&quot;hers&quot;</span><span class="p">,</span> <span class="s2">&quot;herself&quot;</span><span class="p">,</span> <span class="s2">&quot;him&quot;</span><span class="p">,</span> <span class="s2">&quot;himself&quot;</span><span class="p">,</span> <span class="s2">&quot;his&quot;</span><span class="p">,</span> <span class="s2">&quot;how&quot;</span><span class="p">,</span> <span class="s2">&quot;how&#39;s&quot;</span><span class="p">,</span> <span class="s2">&quot;i&quot;</span><span class="p">,</span> <span class="s2">&quot;i&#39;d&quot;</span><span class="p">,</span> <span class="s2">&quot;i&#39;ll&quot;</span><span class="p">,</span> <span class="s2">&quot;i&#39;m&quot;</span><span class="p">,</span> <span class="s2">&quot;i&#39;ve&quot;</span><span class="p">,</span> <span class="s2">&quot;if&quot;</span><span class="p">,</span> <span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="s2">&quot;into&quot;</span><span class="p">,</span> <span class="s2">&quot;is&quot;</span><span class="p">,</span> <span class="s2">&quot;it&quot;</span><span class="p">,</span> <span class="s2">&quot;it&#39;s&quot;</span><span class="p">,</span> <span class="s2">&quot;its&quot;</span><span class="p">,</span> <span class="s2">&quot;itself&quot;</span><span class="p">,</span> <span class="s2">&quot;let&#39;s&quot;</span><span class="p">,</span> <span class="s2">&quot;me&quot;</span><span class="p">,</span> <span class="s2">&quot;more&quot;</span><span class="p">,</span> <span class="s2">&quot;most&quot;</span><span class="p">,</span> <span class="s2">&quot;my&quot;</span><span class="p">,</span> <span class="s2">&quot;myself&quot;</span><span class="p">,</span> <span class="s2">&quot;nor&quot;</span><span class="p">,</span> <span class="s2">&quot;of&quot;</span><span class="p">,</span> <span class="s2">&quot;on&quot;</span><span class="p">,</span> <span class="s2">&quot;once&quot;</span><span class="p">,</span> <span class="s2">&quot;only&quot;</span><span class="p">,</span> <span class="s2">&quot;or&quot;</span><span class="p">,</span> <span class="s2">&quot;other&quot;</span><span class="p">,</span> <span class="s2">&quot;ought&quot;</span><span class="p">,</span> <span class="s2">&quot;our&quot;</span><span class="p">,</span> <span class="s2">&quot;ours&quot;</span><span class="p">,</span> <span class="s2">&quot;ourselves&quot;</span><span class="p">,</span> <span class="s2">&quot;out&quot;</span><span class="p">,</span> <span class="s2">&quot;over&quot;</span><span class="p">,</span> <span class="s2">&quot;own&quot;</span><span class="p">,</span> <span class="s2">&quot;same&quot;</span><span class="p">,</span> <span class="s2">&quot;she&quot;</span><span class="p">,</span> <span class="s2">&quot;she&#39;d&quot;</span><span class="p">,</span> <span class="s2">&quot;she&#39;ll&quot;</span><span class="p">,</span> <span class="s2">&quot;she&#39;s&quot;</span><span class="p">,</span> <span class="s2">&quot;should&quot;</span><span class="p">,</span> <span class="s2">&quot;so&quot;</span><span class="p">,</span> <span class="s2">&quot;some&quot;</span><span class="p">,</span> <span class="s2">&quot;such&quot;</span><span class="p">,</span> <span class="s2">&quot;than&quot;</span><span class="p">,</span> <span class="s2">&quot;that&quot;</span><span class="p">,</span> <span class="s2">&quot;that&#39;s&quot;</span><span class="p">,</span> <span class="s2">&quot;the&quot;</span><span class="p">,</span> <span class="s2">&quot;their&quot;</span><span class="p">,</span> <span class="s2">&quot;theirs&quot;</span><span class="p">,</span> <span class="s2">&quot;them&quot;</span><span class="p">,</span> <span class="s2">&quot;themselves&quot;</span><span class="p">,</span> <span class="s2">&quot;then&quot;</span><span class="p">,</span> <span class="s2">&quot;there&quot;</span><span class="p">,</span> <span class="s2">&quot;there&#39;s&quot;</span><span class="p">,</span> <span class="s2">&quot;these&quot;</span><span class="p">,</span> <span class="s2">&quot;they&quot;</span><span class="p">,</span> <span class="s2">&quot;they&#39;d&quot;</span><span class="p">,</span> <span class="s2">&quot;they&#39;ll&quot;</span><span class="p">,</span> <span class="s2">&quot;they&#39;re&quot;</span><span class="p">,</span> <span class="s2">&quot;they&#39;ve&quot;</span><span class="p">,</span> <span class="s2">&quot;this&quot;</span><span class="p">,</span> <span class="s2">&quot;those&quot;</span><span class="p">,</span> <span class="s2">&quot;through&quot;</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="s2">&quot;too&quot;</span><span class="p">,</span> <span class="s2">&quot;under&quot;</span><span class="p">,</span> <span class="s2">&quot;until&quot;</span><span class="p">,</span> <span class="s2">&quot;up&quot;</span><span class="p">,</span> <span class="s2">&quot;very&quot;</span><span class="p">,</span> <span class="s2">&quot;was&quot;</span><span class="p">,</span> <span class="s2">&quot;we&quot;</span><span class="p">,</span> <span class="s2">&quot;we&#39;d&quot;</span><span class="p">,</span> <span class="s2">&quot;we&#39;ll&quot;</span><span class="p">,</span> <span class="s2">&quot;we&#39;re&quot;</span><span class="p">,</span> <span class="s2">&quot;we&#39;ve&quot;</span><span class="p">,</span> <span class="s2">&quot;were&quot;</span><span class="p">,</span> <span class="s2">&quot;what&quot;</span><span class="p">,</span> <span class="s2">&quot;what&#39;s&quot;</span><span class="p">,</span> <span class="s2">&quot;when&quot;</span><span class="p">,</span> <span class="s2">&quot;when&#39;s&quot;</span><span class="p">,</span> <span class="s2">&quot;where&quot;</span><span class="p">,</span> <span class="s2">&quot;where&#39;s&quot;</span><span class="p">,</span> <span class="s2">&quot;which&quot;</span><span class="p">,</span> <span class="s2">&quot;while&quot;</span><span class="p">,</span> <span class="s2">&quot;who&quot;</span><span class="p">,</span> <span class="s2">&quot;who&#39;s&quot;</span><span class="p">,</span> <span class="s2">&quot;whom&quot;</span><span class="p">,</span> <span class="s2">&quot;why&quot;</span><span class="p">,</span> <span class="s2">&quot;why&#39;s&quot;</span><span class="p">,</span> <span class="s2">&quot;with&quot;</span><span class="p">,</span> <span class="s2">&quot;would&quot;</span><span class="p">,</span> <span class="s2">&quot;you&quot;</span><span class="p">,</span> <span class="s2">&quot;you&#39;d&quot;</span><span class="p">,</span> <span class="s2">&quot;you&#39;ll&quot;</span><span class="p">,</span> <span class="s2">&quot;you&#39;re&quot;</span><span class="p">,</span> <span class="s2">&quot;you&#39;ve&quot;</span><span class="p">,</span> <span class="s2">&quot;your&quot;</span><span class="p">,</span> <span class="s2">&quot;yours&quot;</span><span class="p">,</span> <span class="s2">&quot;yourself&quot;</span><span class="p">,</span> <span class="s2">&quot;yourselves&quot;</span> <span class="p">]</span>
<a id="__codelineno-4-21" name="__codelineno-4-21"></a><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">stopwords</span><span class="p">))</span>
<a id="__codelineno-4-22" name="__codelineno-4-22"></a>
<a id="__codelineno-4-23" name="__codelineno-4-23"></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;./bbc-text.csv&quot;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
<a id="__codelineno-4-24" name="__codelineno-4-24"></a>    <span class="c1">### START CODE HERE</span>
<a id="__codelineno-4-25" name="__codelineno-4-25"></a>    <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
<a id="__codelineno-4-26" name="__codelineno-4-26"></a>    <span class="nb">next</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
<a id="__codelineno-4-27" name="__codelineno-4-27"></a>    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
<a id="__codelineno-4-28" name="__codelineno-4-28"></a>        <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-4-29" name="__codelineno-4-29"></a>        <span class="n">sentence</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-4-30" name="__codelineno-4-30"></a>        <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">stopwords</span><span class="p">:</span>
<a id="__codelineno-4-31" name="__codelineno-4-31"></a>            <span class="n">token</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">word</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span>
<a id="__codelineno-4-32" name="__codelineno-4-32"></a>            <span class="n">sentence</span> <span class="o">=</span> <span class="n">sentence</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
<a id="__codelineno-4-33" name="__codelineno-4-33"></a>        <span class="n">sentences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span>
<a id="__codelineno-4-34" name="__codelineno-4-34"></a>    <span class="c1">### END CODE HERE</span>
<a id="__codelineno-4-35" name="__codelineno-4-35"></a>
<a id="__codelineno-4-36" name="__codelineno-4-36"></a><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">))</span>
<a id="__codelineno-4-37" name="__codelineno-4-37"></a><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sentences</span><span class="p">))</span>
<a id="__codelineno-4-38" name="__codelineno-4-38"></a><span class="nb">print</span><span class="p">(</span><span class="n">sentences</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-4-39" name="__codelineno-4-39"></a>
<a id="__codelineno-4-40" name="__codelineno-4-40"></a><span class="n">train_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sentences</span><span class="p">)</span> <span class="o">*</span> <span class="n">training_portion</span><span class="p">)</span> <span class="c1"># IN-LINE CODE HERE</span>
<a id="__codelineno-4-41" name="__codelineno-4-41"></a>
<a id="__codelineno-4-42" name="__codelineno-4-42"></a><span class="n">train_sentences</span> <span class="o">=</span> <span class="n">sentences</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span> <span class="c1"># IN-LINE CODE HERE</span>
<a id="__codelineno-4-43" name="__codelineno-4-43"></a><span class="n">train_labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span> <span class="c1"># IN-LINE CODE HERE</span>
<a id="__codelineno-4-44" name="__codelineno-4-44"></a>
<a id="__codelineno-4-45" name="__codelineno-4-45"></a><span class="n">validation_sentences</span> <span class="o">=</span> <span class="n">sentences</span><span class="p">[</span><span class="n">train_size</span><span class="p">:]</span> <span class="c1"># IN-LINE CODE HERE</span>
<a id="__codelineno-4-46" name="__codelineno-4-46"></a><span class="n">validation_labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">train_size</span><span class="p">:]</span> <span class="c1"># IN-LINE CODE HERE</span>
<a id="__codelineno-4-47" name="__codelineno-4-47"></a>
<a id="__codelineno-4-48" name="__codelineno-4-48"></a><span class="nb">print</span><span class="p">(</span><span class="n">train_size</span><span class="p">)</span>
<a id="__codelineno-4-49" name="__codelineno-4-49"></a><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">train_sentences</span><span class="p">))</span>
<a id="__codelineno-4-50" name="__codelineno-4-50"></a><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">train_labels</span><span class="p">))</span>
<a id="__codelineno-4-51" name="__codelineno-4-51"></a><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">validation_sentences</span><span class="p">))</span>
<a id="__codelineno-4-52" name="__codelineno-4-52"></a><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">validation_labels</span><span class="p">))</span>
<a id="__codelineno-4-53" name="__codelineno-4-53"></a>
<a id="__codelineno-4-54" name="__codelineno-4-54"></a><span class="n">tokenizer</span> <span class="o">=</span> <span class="n">Tokenizer</span><span class="p">(</span><span class="n">num_words</span> <span class="o">=</span> <span class="n">vocab_size</span><span class="p">,</span> <span class="n">oov_token</span><span class="o">=</span><span class="n">oov_tok</span><span class="p">)</span> <span class="c1"># IN-LINE CODE HERE</span>
<a id="__codelineno-4-55" name="__codelineno-4-55"></a><span class="n">tokenizer</span><span class="o">.</span><span class="n">fit_on_texts</span><span class="p">(</span><span class="n">train_sentences</span><span class="p">)</span> <span class="c1"># IN-LINE CODE HERE</span>
<a id="__codelineno-4-56" name="__codelineno-4-56"></a><span class="n">word_index</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">word_index</span> <span class="c1"># IN-LINE CODE HERE</span>
<a id="__codelineno-4-57" name="__codelineno-4-57"></a>
<a id="__codelineno-4-58" name="__codelineno-4-58"></a><span class="n">train_sequences</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">texts_to_sequences</span><span class="p">(</span><span class="n">train_sentences</span><span class="p">)</span> <span class="c1"># IN-LINE CODE HERE</span>
<a id="__codelineno-4-59" name="__codelineno-4-59"></a><span class="n">train_padded</span> <span class="o">=</span> <span class="n">pad_sequences</span><span class="p">(</span><span class="n">train_sequences</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding_type</span><span class="p">,</span> <span class="n">maxlen</span><span class="o">=</span><span class="n">max_length</span><span class="p">)</span> <span class="c1"># IN-LINE CODE HERE</span>
<a id="__codelineno-4-60" name="__codelineno-4-60"></a>
<a id="__codelineno-4-61" name="__codelineno-4-61"></a><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">train_sequences</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<a id="__codelineno-4-62" name="__codelineno-4-62"></a><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">train_padded</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<a id="__codelineno-4-63" name="__codelineno-4-63"></a>
<a id="__codelineno-4-64" name="__codelineno-4-64"></a><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">train_sequences</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<a id="__codelineno-4-65" name="__codelineno-4-65"></a><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">train_padded</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<a id="__codelineno-4-66" name="__codelineno-4-66"></a>
<a id="__codelineno-4-67" name="__codelineno-4-67"></a><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">train_sequences</span><span class="p">[</span><span class="mi">10</span><span class="p">]))</span>
<a id="__codelineno-4-68" name="__codelineno-4-68"></a><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">train_padded</span><span class="p">[</span><span class="mi">10</span><span class="p">]))</span>
<a id="__codelineno-4-69" name="__codelineno-4-69"></a>
<a id="__codelineno-4-70" name="__codelineno-4-70"></a><span class="n">validation_sequences</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">texts_to_sequences</span><span class="p">(</span><span class="n">validation_sentences</span><span class="p">)</span> <span class="c1"># IN-LINE CODE HERE</span>
<a id="__codelineno-4-71" name="__codelineno-4-71"></a><span class="n">validation_padded</span> <span class="o">=</span> <span class="n">pad_sequences</span><span class="p">(</span><span class="n">validation_sequences</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding_type</span><span class="p">,</span> <span class="n">maxlen</span><span class="o">=</span><span class="n">max_length</span><span class="p">)</span> <span class="c1"># IN-LINE CODE HERE</span>
<a id="__codelineno-4-72" name="__codelineno-4-72"></a>
<a id="__codelineno-4-73" name="__codelineno-4-73"></a><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">validation_sequences</span><span class="p">))</span>
<a id="__codelineno-4-74" name="__codelineno-4-74"></a><span class="nb">print</span><span class="p">(</span><span class="n">validation_padded</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<a id="__codelineno-4-75" name="__codelineno-4-75"></a>
<a id="__codelineno-4-76" name="__codelineno-4-76"></a><span class="n">label_tokenizer</span> <span class="o">=</span> <span class="n">Tokenizer</span><span class="p">()</span> <span class="c1"># IN-LINE CODE HERE</span>
<a id="__codelineno-4-77" name="__codelineno-4-77"></a><span class="n">label_tokenizer</span><span class="o">.</span><span class="n">fit_on_texts</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="c1"># IN-LINE CODE HERE</span>
<a id="__codelineno-4-78" name="__codelineno-4-78"></a>
<a id="__codelineno-4-79" name="__codelineno-4-79"></a><span class="n">training_label_seq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">label_tokenizer</span><span class="o">.</span><span class="n">texts_to_sequences</span><span class="p">(</span><span class="n">train_labels</span><span class="p">))</span> <span class="c1"># IN-LINE CODE HERE</span>
<a id="__codelineno-4-80" name="__codelineno-4-80"></a><span class="n">validation_label_seq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">label_tokenizer</span><span class="o">.</span><span class="n">texts_to_sequences</span><span class="p">(</span><span class="n">validation_labels</span><span class="p">))</span> <span class="c1"># IN-LINE CODE HERE</span>
<a id="__codelineno-4-81" name="__codelineno-4-81"></a>
<a id="__codelineno-4-82" name="__codelineno-4-82"></a><span class="nb">print</span><span class="p">(</span><span class="n">training_label_seq</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-4-83" name="__codelineno-4-83"></a><span class="nb">print</span><span class="p">(</span><span class="n">training_label_seq</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-4-84" name="__codelineno-4-84"></a><span class="nb">print</span><span class="p">(</span><span class="n">training_label_seq</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<a id="__codelineno-4-85" name="__codelineno-4-85"></a><span class="nb">print</span><span class="p">(</span><span class="n">training_label_seq</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<a id="__codelineno-4-86" name="__codelineno-4-86"></a>
<a id="__codelineno-4-87" name="__codelineno-4-87"></a><span class="nb">print</span><span class="p">(</span><span class="n">validation_label_seq</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-4-88" name="__codelineno-4-88"></a><span class="nb">print</span><span class="p">(</span><span class="n">validation_label_seq</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-4-89" name="__codelineno-4-89"></a><span class="nb">print</span><span class="p">(</span><span class="n">validation_label_seq</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<a id="__codelineno-4-90" name="__codelineno-4-90"></a><span class="nb">print</span><span class="p">(</span><span class="n">validation_label_seq</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<a id="__codelineno-4-91" name="__codelineno-4-91"></a>
<a id="__codelineno-4-92" name="__codelineno-4-92"></a><span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
<a id="__codelineno-4-93" name="__codelineno-4-93"></a>    <span class="c1">### START CODE HERE</span>
<a id="__codelineno-4-94" name="__codelineno-4-94"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">vocab_size</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="p">,</span> <span class="n">input_length</span><span class="o">=</span><span class="n">max_length</span><span class="p">),</span>
<a id="__codelineno-4-95" name="__codelineno-4-95"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">GlobalAveragePooling1D</span><span class="p">(),</span>
<a id="__codelineno-4-96" name="__codelineno-4-96"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
<a id="__codelineno-4-97" name="__codelineno-4-97"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;softmax&#39;</span><span class="p">)</span>
<a id="__codelineno-4-98" name="__codelineno-4-98"></a>    <span class="c1">### END CODE HERE</span>
<a id="__codelineno-4-99" name="__codelineno-4-99"></a><span class="p">])</span>
<a id="__codelineno-4-100" name="__codelineno-4-100"></a><span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">&#39;sparse_categorical_crossentropy&#39;</span><span class="p">,</span><span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span><span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">])</span>
<a id="__codelineno-4-101" name="__codelineno-4-101"></a><span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
<a id="__codelineno-4-102" name="__codelineno-4-102"></a>
<a id="__codelineno-4-103" name="__codelineno-4-103"></a><span class="n">num_epochs</span> <span class="o">=</span> <span class="mi">30</span>
<a id="__codelineno-4-104" name="__codelineno-4-104"></a><span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
<a id="__codelineno-4-105" name="__codelineno-4-105"></a>    <span class="c1">### START CODE HERE</span>
<a id="__codelineno-4-106" name="__codelineno-4-106"></a>    <span class="n">train_padded</span><span class="p">,</span> 
<a id="__codelineno-4-107" name="__codelineno-4-107"></a>    <span class="n">training_label_seq</span><span class="p">,</span> 
<a id="__codelineno-4-108" name="__codelineno-4-108"></a>    <span class="n">epochs</span><span class="o">=</span><span class="n">num_epochs</span><span class="p">,</span> 
<a id="__codelineno-4-109" name="__codelineno-4-109"></a>    <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">validation_padded</span><span class="p">,</span> <span class="n">validation_label_seq</span><span class="p">),</span> 
<a id="__codelineno-4-110" name="__codelineno-4-110"></a>    <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-4-111" name="__codelineno-4-111"></a>    <span class="c1">### END CODE HERE</span>
</code></pre></div>
</td></tr></table>
</details>
<p><a name="week-3"></a></p>
<h2 id="week-3-sequence-model"><strong>Week 3: Sequence Model</strong></h2>
<p>Using only <code>Embeddings</code> hasn't shown a promising outcome, since it doesn't take wording sequence into account. It 
handles all words as the same. In this week's lecture, we will learn how the model can take the position of a word 
in a sentence into account.</p>
<ul>
<li>
<p><strong>RNN:</strong> or Recurrent Neural Network is a class of neural network that has internal memory to use its previous data 
combined with its new data to train a neural network. An RNN has a loop system unlike a normal neural network that 
which when data is passed, the data will be gone. With this mechanism, RNN can take benefit of the sequence that 
which the data occurred.</p>
</li>
<li>
<p><strong>LSTM:</strong> or Long-Short Term Memory on addition to the RNN, an LSTM has an additional state called 'Cell State' to 
pass data from an early stage to a much later stage. While RNNs can only recall data from their previous state, LSTMs 
can recall data from much wider states. Furthermore, LSTM is bi-directional, which makes the position of a word more 
likely to make sense when training a model.</p>
</li>
</ul>
<h3 id="lecture-1-imdb-subwords-8k-with-single-layer-lstm">Lecture 1: IMDB Subwords 8K with Single Layer LSTM</h3>
<details class="- success">
<summary>Lecture 1: IMDB Subwords 8K with Single Layer LSTM</summary>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-5-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-5-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-5-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-5-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-5-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-5-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-5-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-5-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-5-10">10</a></span>
<span class="normal"><a href="#__codelineno-5-11">11</a></span>
<span class="normal"><a href="#__codelineno-5-12">12</a></span>
<span class="normal"><a href="#__codelineno-5-13">13</a></span>
<span class="normal"><a href="#__codelineno-5-14">14</a></span>
<span class="normal"><a href="#__codelineno-5-15">15</a></span>
<span class="normal"><a href="#__codelineno-5-16">16</a></span>
<span class="normal"><a href="#__codelineno-5-17">17</a></span>
<span class="normal"><a href="#__codelineno-5-18">18</a></span>
<span class="normal"><a href="#__codelineno-5-19">19</a></span>
<span class="normal"><a href="#__codelineno-5-20">20</a></span>
<span class="normal"><a href="#__codelineno-5-21">21</a></span>
<span class="normal"><a href="#__codelineno-5-22">22</a></span>
<span class="normal"><a href="#__codelineno-5-23">23</a></span>
<span class="normal"><a href="#__codelineno-5-24">24</a></span>
<span class="normal"><a href="#__codelineno-5-25">25</a></span>
<span class="normal"><a href="#__codelineno-5-26">26</a></span>
<span class="normal"><a href="#__codelineno-5-27">27</a></span>
<span class="normal"><a href="#__codelineno-5-28">28</a></span>
<span class="normal"><a href="#__codelineno-5-29">29</a></span>
<span class="normal"><a href="#__codelineno-5-30">30</a></span>
<span class="normal"><a href="#__codelineno-5-31">31</a></span>
<span class="normal"><a href="#__codelineno-5-32">32</a></span>
<span class="normal"><a href="#__codelineno-5-33">33</a></span>
<span class="normal"><a href="#__codelineno-5-34">34</a></span>
<span class="normal"><a href="#__codelineno-5-35">35</a></span>
<span class="normal"><a href="#__codelineno-5-36">36</a></span>
<span class="normal"><a href="#__codelineno-5-37">37</a></span>
<span class="normal"><a href="#__codelineno-5-38">38</a></span>
<span class="normal"><a href="#__codelineno-5-39">39</a></span>
<span class="normal"><a href="#__codelineno-5-40">40</a></span>
<span class="normal"><a href="#__codelineno-5-41">41</a></span>
<span class="normal"><a href="#__codelineno-5-42">42</a></span>
<span class="normal"><a href="#__codelineno-5-43">43</a></span>
<span class="normal"><a href="#__codelineno-5-44">44</a></span>
<span class="normal"><a href="#__codelineno-5-45">45</a></span>
<span class="normal"><a href="#__codelineno-5-46">46</a></span>
<span class="normal"><a href="#__codelineno-5-47">47</a></span>
<span class="normal"><a href="#__codelineno-5-48">48</a></span>
<span class="normal"><a href="#__codelineno-5-49">49</a></span>
<span class="normal"><a href="#__codelineno-5-50">50</a></span>
<span class="normal"><a href="#__codelineno-5-51">51</a></span>
<span class="normal"><a href="#__codelineno-5-52">52</a></span>
<span class="normal"><a href="#__codelineno-5-53">53</a></span>
<span class="normal"><a href="#__codelineno-5-54">54</a></span>
<span class="normal"><a href="#__codelineno-5-55">55</a></span>
<span class="normal"><a href="#__codelineno-5-56">56</a></span>
<span class="normal"><a href="#__codelineno-5-57">57</a></span>
<span class="normal"><a href="#__codelineno-5-58">58</a></span>
<span class="normal"><a href="#__codelineno-5-59">59</a></span>
<span class="normal"><a href="#__codelineno-5-60">60</a></span>
<span class="normal"><a href="#__codelineno-5-61">61</a></span>
<span class="normal"><a href="#__codelineno-5-62">62</a></span>
<span class="normal"><a href="#__codelineno-5-63">63</a></span>
<span class="normal"><a href="#__codelineno-5-64">64</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="kn">import</span> <span class="nn">tensorflow_datasets</span> <span class="k">as</span> <span class="nn">tfds</span>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a>
<a id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="c1">##### DOWNLOAD DATASET #####</span>
<a id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="c1"># Download the subword encoded pretokenized dataset</span>
<a id="__codelineno-5-9" name="__codelineno-5-9"></a><span class="n">dataset</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">tfds</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;imdb_reviews/subwords8k&#39;</span><span class="p">,</span> <span class="n">with_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">as_supervised</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-5-10" name="__codelineno-5-10"></a>
<a id="__codelineno-5-11" name="__codelineno-5-11"></a><span class="c1"># Get the tokenizer</span>
<a id="__codelineno-5-12" name="__codelineno-5-12"></a><span class="n">tokenizer</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">encoder</span>
<a id="__codelineno-5-13" name="__codelineno-5-13"></a>
<a id="__codelineno-5-14" name="__codelineno-5-14"></a><span class="c1">##### PREPROCESS DATA #####</span>
<a id="__codelineno-5-15" name="__codelineno-5-15"></a><span class="n">BUFFER_SIZE</span> <span class="o">=</span> <span class="mi">10000</span>
<a id="__codelineno-5-16" name="__codelineno-5-16"></a><span class="n">BATCH_SIZE</span> <span class="o">=</span> <span class="mi">256</span>
<a id="__codelineno-5-17" name="__codelineno-5-17"></a>
<a id="__codelineno-5-18" name="__codelineno-5-18"></a><span class="c1"># Get the train and test splits</span>
<a id="__codelineno-5-19" name="__codelineno-5-19"></a><span class="n">train_data</span><span class="p">,</span> <span class="n">test_data</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">],</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">],</span> 
<a id="__codelineno-5-20" name="__codelineno-5-20"></a>
<a id="__codelineno-5-21" name="__codelineno-5-21"></a><span class="c1"># Shuffle the training data</span>
<a id="__codelineno-5-22" name="__codelineno-5-22"></a><span class="n">train_dataset</span> <span class="o">=</span> <span class="n">train_data</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">BUFFER_SIZE</span><span class="p">)</span>
<a id="__codelineno-5-23" name="__codelineno-5-23"></a>
<a id="__codelineno-5-24" name="__codelineno-5-24"></a><span class="c1"># Batch and pad the datasets to the maximum length of the sequences</span>
<a id="__codelineno-5-25" name="__codelineno-5-25"></a><span class="n">train_dataset</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="o">.</span><span class="n">padded_batch</span><span class="p">(</span><span class="n">BATCH_SIZE</span><span class="p">)</span>
<a id="__codelineno-5-26" name="__codelineno-5-26"></a><span class="n">test_dataset</span> <span class="o">=</span> <span class="n">test_data</span><span class="o">.</span><span class="n">padded_batch</span><span class="p">(</span><span class="n">BATCH_SIZE</span><span class="p">)</span>
<a id="__codelineno-5-27" name="__codelineno-5-27"></a>
<a id="__codelineno-5-28" name="__codelineno-5-28"></a><span class="c1">##### CREATE, COMPILE AND RUN MODEL #####</span>
<a id="__codelineno-5-29" name="__codelineno-5-29"></a><span class="c1"># Hyperparameters</span>
<a id="__codelineno-5-30" name="__codelineno-5-30"></a><span class="n">embedding_dim</span> <span class="o">=</span> <span class="mi">64</span>
<a id="__codelineno-5-31" name="__codelineno-5-31"></a><span class="n">lstm_dim</span> <span class="o">=</span> <span class="mi">64</span>
<a id="__codelineno-5-32" name="__codelineno-5-32"></a><span class="n">dense_dim</span> <span class="o">=</span> <span class="mi">64</span>
<a id="__codelineno-5-33" name="__codelineno-5-33"></a>
<a id="__codelineno-5-34" name="__codelineno-5-34"></a><span class="c1"># Build the model</span>
<a id="__codelineno-5-35" name="__codelineno-5-35"></a><span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
<a id="__codelineno-5-36" name="__codelineno-5-36"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">vocab_size</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="p">),</span>
<a id="__codelineno-5-37" name="__codelineno-5-37"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Bidirectional</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="n">lstm_dim</span><span class="p">)),</span>
<a id="__codelineno-5-38" name="__codelineno-5-38"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">dense_dim</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
<a id="__codelineno-5-39" name="__codelineno-5-39"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;sigmoid&#39;</span><span class="p">)</span>
<a id="__codelineno-5-40" name="__codelineno-5-40"></a><span class="p">])</span>
<a id="__codelineno-5-41" name="__codelineno-5-41"></a>
<a id="__codelineno-5-42" name="__codelineno-5-42"></a><span class="c1"># Print the model summary</span>
<a id="__codelineno-5-43" name="__codelineno-5-43"></a><span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
<a id="__codelineno-5-44" name="__codelineno-5-44"></a>
<a id="__codelineno-5-45" name="__codelineno-5-45"></a><span class="c1"># Set the training parameters</span>
<a id="__codelineno-5-46" name="__codelineno-5-46"></a><span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">&#39;binary_crossentropy&#39;</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">])</span>
<a id="__codelineno-5-47" name="__codelineno-5-47"></a>
<a id="__codelineno-5-48" name="__codelineno-5-48"></a><span class="n">NUM_EPOCHS</span> <span class="o">=</span> <span class="mi">10</span>
<a id="__codelineno-5-49" name="__codelineno-5-49"></a>
<a id="__codelineno-5-50" name="__codelineno-5-50"></a><span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="n">NUM_EPOCHS</span><span class="p">,</span> <span class="n">validation_data</span><span class="o">=</span><span class="n">test_dataset</span><span class="p">)</span>
<a id="__codelineno-5-51" name="__codelineno-5-51"></a>
<a id="__codelineno-5-52" name="__codelineno-5-52"></a><span class="c1">##### EVALUATE DATA #####</span>
<a id="__codelineno-5-53" name="__codelineno-5-53"></a><span class="c1"># Plot utility</span>
<a id="__codelineno-5-54" name="__codelineno-5-54"></a><span class="k">def</span> <span class="nf">plot_graphs</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
<a id="__codelineno-5-55" name="__codelineno-5-55"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="n">string</span><span class="p">])</span>
<a id="__codelineno-5-56" name="__codelineno-5-56"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;val_&#39;</span><span class="o">+</span><span class="n">string</span><span class="p">])</span>
<a id="__codelineno-5-57" name="__codelineno-5-57"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Epochs&quot;</span><span class="p">)</span>
<a id="__codelineno-5-58" name="__codelineno-5-58"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
<a id="__codelineno-5-59" name="__codelineno-5-59"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="n">string</span><span class="p">,</span> <span class="s1">&#39;val_&#39;</span><span class="o">+</span><span class="n">string</span><span class="p">])</span>
<a id="__codelineno-5-60" name="__codelineno-5-60"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<a id="__codelineno-5-61" name="__codelineno-5-61"></a>
<a id="__codelineno-5-62" name="__codelineno-5-62"></a><span class="c1"># Plot the accuracy and results </span>
<a id="__codelineno-5-63" name="__codelineno-5-63"></a><span class="n">plot_graphs</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="s2">&quot;accuracy&quot;</span><span class="p">)</span>
<a id="__codelineno-5-64" name="__codelineno-5-64"></a><span class="n">plot_graphs</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="s2">&quot;loss&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
</details>
<h3 id="lecture-2-imdb-subwords-8k-with-multi-layer-lstm">Lecture 2: IMDB Subwords 8K with Multi Layer LSTM</h3>
<details class="- success">
<summary>Lecture 2: IMDB Subwords 8K with Multi Layer LSTM</summary>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-6-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-6-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-6-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-6-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-6-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-6-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-6-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-6-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-6-10">10</a></span>
<span class="normal"><a href="#__codelineno-6-11">11</a></span>
<span class="normal"><a href="#__codelineno-6-12">12</a></span>
<span class="normal"><a href="#__codelineno-6-13">13</a></span>
<span class="normal"><a href="#__codelineno-6-14">14</a></span>
<span class="normal"><a href="#__codelineno-6-15">15</a></span>
<span class="normal"><a href="#__codelineno-6-16">16</a></span>
<span class="normal"><a href="#__codelineno-6-17">17</a></span>
<span class="normal"><a href="#__codelineno-6-18">18</a></span>
<span class="normal"><a href="#__codelineno-6-19">19</a></span>
<span class="normal"><a href="#__codelineno-6-20">20</a></span>
<span class="normal"><a href="#__codelineno-6-21">21</a></span>
<span class="normal"><a href="#__codelineno-6-22">22</a></span>
<span class="normal"><a href="#__codelineno-6-23">23</a></span>
<span class="normal"><a href="#__codelineno-6-24">24</a></span>
<span class="normal"><a href="#__codelineno-6-25">25</a></span>
<span class="normal"><a href="#__codelineno-6-26">26</a></span>
<span class="normal"><a href="#__codelineno-6-27">27</a></span>
<span class="normal"><a href="#__codelineno-6-28">28</a></span>
<span class="normal"><a href="#__codelineno-6-29">29</a></span>
<span class="normal"><a href="#__codelineno-6-30">30</a></span>
<span class="normal"><a href="#__codelineno-6-31">31</a></span>
<span class="normal"><a href="#__codelineno-6-32">32</a></span>
<span class="normal"><a href="#__codelineno-6-33">33</a></span>
<span class="normal"><a href="#__codelineno-6-34">34</a></span>
<span class="normal"><a href="#__codelineno-6-35">35</a></span>
<span class="normal"><a href="#__codelineno-6-36">36</a></span>
<span class="normal"><a href="#__codelineno-6-37">37</a></span>
<span class="normal"><a href="#__codelineno-6-38">38</a></span>
<span class="normal"><a href="#__codelineno-6-39">39</a></span>
<span class="normal"><a href="#__codelineno-6-40">40</a></span>
<span class="normal"><a href="#__codelineno-6-41">41</a></span>
<span class="normal"><a href="#__codelineno-6-42">42</a></span>
<span class="normal"><a href="#__codelineno-6-43">43</a></span>
<span class="normal"><a href="#__codelineno-6-44">44</a></span>
<span class="normal"><a href="#__codelineno-6-45">45</a></span>
<span class="normal"><a href="#__codelineno-6-46">46</a></span>
<span class="normal"><a href="#__codelineno-6-47">47</a></span>
<span class="normal"><a href="#__codelineno-6-48">48</a></span>
<span class="normal"><a href="#__codelineno-6-49">49</a></span>
<span class="normal"><a href="#__codelineno-6-50">50</a></span>
<span class="normal"><a href="#__codelineno-6-51">51</a></span>
<span class="normal"><a href="#__codelineno-6-52">52</a></span>
<span class="normal"><a href="#__codelineno-6-53">53</a></span>
<span class="normal"><a href="#__codelineno-6-54">54</a></span>
<span class="normal"><a href="#__codelineno-6-55">55</a></span>
<span class="normal"><a href="#__codelineno-6-56">56</a></span>
<span class="normal"><a href="#__codelineno-6-57">57</a></span>
<span class="normal"><a href="#__codelineno-6-58">58</a></span>
<span class="normal"><a href="#__codelineno-6-59">59</a></span>
<span class="normal"><a href="#__codelineno-6-60">60</a></span>
<span class="normal"><a href="#__codelineno-6-61">61</a></span>
<span class="normal"><a href="#__codelineno-6-62">62</a></span>
<span class="normal"><a href="#__codelineno-6-63">63</a></span>
<span class="normal"><a href="#__codelineno-6-64">64</a></span>
<span class="normal"><a href="#__codelineno-6-65">65</a></span>
<span class="normal"><a href="#__codelineno-6-66">66</a></span>
<span class="normal"><a href="#__codelineno-6-67">67</a></span>
<span class="normal"><a href="#__codelineno-6-68">68</a></span>
<span class="normal"><a href="#__codelineno-6-69">69</a></span>
<span class="normal"><a href="#__codelineno-6-70">70</a></span>
<span class="normal"><a href="#__codelineno-6-71">71</a></span>
<span class="normal"><a href="#__codelineno-6-72">72</a></span>
<span class="normal"><a href="#__codelineno-6-73">73</a></span>
<span class="normal"><a href="#__codelineno-6-74">74</a></span>
<span class="normal"><a href="#__codelineno-6-75">75</a></span>
<span class="normal"><a href="#__codelineno-6-76">76</a></span>
<span class="normal"><a href="#__codelineno-6-77">77</a></span>
<span class="normal"><a href="#__codelineno-6-78">78</a></span>
<span class="normal"><a href="#__codelineno-6-79">79</a></span>
<span class="normal"><a href="#__codelineno-6-80">80</a></span>
<span class="normal"><a href="#__codelineno-6-81">81</a></span>
<span class="normal"><a href="#__codelineno-6-82">82</a></span>
<span class="normal"><a href="#__codelineno-6-83">83</a></span>
<span class="normal"><a href="#__codelineno-6-84">84</a></span>
<span class="normal"><a href="#__codelineno-6-85">85</a></span>
<span class="normal"><a href="#__codelineno-6-86">86</a></span>
<span class="normal"><a href="#__codelineno-6-87">87</a></span>
<span class="normal"><a href="#__codelineno-6-88">88</a></span>
<span class="normal"><a href="#__codelineno-6-89">89</a></span>
<span class="normal"><a href="#__codelineno-6-90">90</a></span>
<span class="normal"><a href="#__codelineno-6-91">91</a></span>
<span class="normal"><a href="#__codelineno-6-92">92</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="kn">import</span> <span class="nn">tensorflow_datasets</span> <span class="k">as</span> <span class="nn">tfds</span>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<a id="__codelineno-6-6" name="__codelineno-6-6"></a>
<a id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="c1">##### DOWNLOAD DATASET #####</span>
<a id="__codelineno-6-8" name="__codelineno-6-8"></a><span class="c1"># Download the subword encoded pretokenized dataset</span>
<a id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="n">dataset</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">tfds</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;imdb_reviews/subwords8k&#39;</span><span class="p">,</span> <span class="n">with_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">as_supervised</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-6-10" name="__codelineno-6-10"></a>
<a id="__codelineno-6-11" name="__codelineno-6-11"></a><span class="c1"># Get the tokenizer</span>
<a id="__codelineno-6-12" name="__codelineno-6-12"></a><span class="n">tokenizer</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">encoder</span>
<a id="__codelineno-6-13" name="__codelineno-6-13"></a>
<a id="__codelineno-6-14" name="__codelineno-6-14"></a><span class="c1">##### PREPROCESS DATA #####</span>
<a id="__codelineno-6-15" name="__codelineno-6-15"></a><span class="n">BUFFER_SIZE</span> <span class="o">=</span> <span class="mi">10000</span>
<a id="__codelineno-6-16" name="__codelineno-6-16"></a><span class="n">BATCH_SIZE</span> <span class="o">=</span> <span class="mi">256</span>
<a id="__codelineno-6-17" name="__codelineno-6-17"></a>
<a id="__codelineno-6-18" name="__codelineno-6-18"></a><span class="c1"># Get the train and test splits</span>
<a id="__codelineno-6-19" name="__codelineno-6-19"></a><span class="n">train_data</span><span class="p">,</span> <span class="n">test_data</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">],</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">],</span> 
<a id="__codelineno-6-20" name="__codelineno-6-20"></a>
<a id="__codelineno-6-21" name="__codelineno-6-21"></a><span class="c1"># Shuffle the training data</span>
<a id="__codelineno-6-22" name="__codelineno-6-22"></a><span class="n">train_dataset</span> <span class="o">=</span> <span class="n">train_data</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">BUFFER_SIZE</span><span class="p">)</span>
<a id="__codelineno-6-23" name="__codelineno-6-23"></a>
<a id="__codelineno-6-24" name="__codelineno-6-24"></a><span class="c1"># Batch and pad the datasets to the maximum length of the sequences</span>
<a id="__codelineno-6-25" name="__codelineno-6-25"></a><span class="n">train_dataset</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="o">.</span><span class="n">padded_batch</span><span class="p">(</span><span class="n">BATCH_SIZE</span><span class="p">)</span>
<a id="__codelineno-6-26" name="__codelineno-6-26"></a><span class="n">test_dataset</span> <span class="o">=</span> <span class="n">test_data</span><span class="o">.</span><span class="n">padded_batch</span><span class="p">(</span><span class="n">BATCH_SIZE</span><span class="p">)</span>
<a id="__codelineno-6-27" name="__codelineno-6-27"></a>
<a id="__codelineno-6-28" name="__codelineno-6-28"></a><span class="c1">##### CREATE, COMPILE AND RUN MODEL #####</span>
<a id="__codelineno-6-29" name="__codelineno-6-29"></a><span class="c1"># Hyperparameters</span>
<a id="__codelineno-6-30" name="__codelineno-6-30"></a><span class="n">batch_size</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-6-31" name="__codelineno-6-31"></a><span class="n">timesteps</span> <span class="o">=</span> <span class="mi">20</span>
<a id="__codelineno-6-32" name="__codelineno-6-32"></a><span class="n">features</span> <span class="o">=</span> <span class="mi">16</span>
<a id="__codelineno-6-33" name="__codelineno-6-33"></a><span class="n">lstm_dim</span> <span class="o">=</span> <span class="mi">8</span>
<a id="__codelineno-6-34" name="__codelineno-6-34"></a>
<a id="__codelineno-6-35" name="__codelineno-6-35"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;batch_size: </span><span class="si">{</span><span class="n">batch_size</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-6-36" name="__codelineno-6-36"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;timesteps (sequence length): </span><span class="si">{</span><span class="n">timesteps</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-6-37" name="__codelineno-6-37"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;features (embedding size): </span><span class="si">{</span><span class="n">features</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-6-38" name="__codelineno-6-38"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;lstm output units: </span><span class="si">{</span><span class="n">lstm_dim</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-6-39" name="__codelineno-6-39"></a>
<a id="__codelineno-6-40" name="__codelineno-6-40"></a><span class="c1"># Define array input with random values</span>
<a id="__codelineno-6-41" name="__codelineno-6-41"></a><span class="n">random_input</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span><span class="n">timesteps</span><span class="p">,</span><span class="n">features</span><span class="p">)</span>
<a id="__codelineno-6-42" name="__codelineno-6-42"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;shape of input array: </span><span class="si">{</span><span class="n">random_input</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-6-43" name="__codelineno-6-43"></a>
<a id="__codelineno-6-44" name="__codelineno-6-44"></a><span class="c1"># Define LSTM that returns a single output</span>
<a id="__codelineno-6-45" name="__codelineno-6-45"></a><span class="n">lstm</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="n">lstm_dim</span><span class="p">)</span>
<a id="__codelineno-6-46" name="__codelineno-6-46"></a><span class="n">result</span> <span class="o">=</span> <span class="n">lstm</span><span class="p">(</span><span class="n">random_input</span><span class="p">)</span>
<a id="__codelineno-6-47" name="__codelineno-6-47"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;shape of lstm output(return_sequences=False): </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-6-48" name="__codelineno-6-48"></a>
<a id="__codelineno-6-49" name="__codelineno-6-49"></a><span class="c1"># Define LSTM that returns a sequence</span>
<a id="__codelineno-6-50" name="__codelineno-6-50"></a><span class="n">lstm_rs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="n">lstm_dim</span><span class="p">,</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-6-51" name="__codelineno-6-51"></a><span class="n">result</span> <span class="o">=</span> <span class="n">lstm_rs</span><span class="p">(</span><span class="n">random_input</span><span class="p">)</span>
<a id="__codelineno-6-52" name="__codelineno-6-52"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;shape of lstm output(return_sequences=True): </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-6-53" name="__codelineno-6-53"></a>
<a id="__codelineno-6-54" name="__codelineno-6-54"></a><span class="c1"># Hyperparameters</span>
<a id="__codelineno-6-55" name="__codelineno-6-55"></a><span class="n">embedding_dim</span> <span class="o">=</span> <span class="mi">64</span>
<a id="__codelineno-6-56" name="__codelineno-6-56"></a><span class="n">lstm1_dim</span> <span class="o">=</span> <span class="mi">64</span>
<a id="__codelineno-6-57" name="__codelineno-6-57"></a><span class="n">lstm2_dim</span> <span class="o">=</span> <span class="mi">32</span>
<a id="__codelineno-6-58" name="__codelineno-6-58"></a><span class="n">dense_dim</span> <span class="o">=</span> <span class="mi">64</span>
<a id="__codelineno-6-59" name="__codelineno-6-59"></a>
<a id="__codelineno-6-60" name="__codelineno-6-60"></a><span class="c1"># Build the model</span>
<a id="__codelineno-6-61" name="__codelineno-6-61"></a><span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
<a id="__codelineno-6-62" name="__codelineno-6-62"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">vocab_size</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="p">),</span>
<a id="__codelineno-6-63" name="__codelineno-6-63"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Bidirectional</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="n">lstm1_dim</span><span class="p">,</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">)),</span>
<a id="__codelineno-6-64" name="__codelineno-6-64"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Bidirectional</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="n">lstm2_dim</span><span class="p">)),</span>
<a id="__codelineno-6-65" name="__codelineno-6-65"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">dense_dim</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
<a id="__codelineno-6-66" name="__codelineno-6-66"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;sigmoid&#39;</span><span class="p">)</span>
<a id="__codelineno-6-67" name="__codelineno-6-67"></a><span class="p">])</span>
<a id="__codelineno-6-68" name="__codelineno-6-68"></a>
<a id="__codelineno-6-69" name="__codelineno-6-69"></a><span class="c1"># Print the model summary</span>
<a id="__codelineno-6-70" name="__codelineno-6-70"></a><span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
<a id="__codelineno-6-71" name="__codelineno-6-71"></a>
<a id="__codelineno-6-72" name="__codelineno-6-72"></a><span class="c1"># Set the training parameters</span>
<a id="__codelineno-6-73" name="__codelineno-6-73"></a><span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">&#39;binary_crossentropy&#39;</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">])</span>
<a id="__codelineno-6-74" name="__codelineno-6-74"></a>
<a id="__codelineno-6-75" name="__codelineno-6-75"></a><span class="n">NUM_EPOCHS</span> <span class="o">=</span> <span class="mi">10</span>
<a id="__codelineno-6-76" name="__codelineno-6-76"></a>
<a id="__codelineno-6-77" name="__codelineno-6-77"></a><span class="c1"># Train the model</span>
<a id="__codelineno-6-78" name="__codelineno-6-78"></a><span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="n">NUM_EPOCHS</span><span class="p">,</span> <span class="n">validation_data</span><span class="o">=</span><span class="n">test_dataset</span><span class="p">)</span>
<a id="__codelineno-6-79" name="__codelineno-6-79"></a>
<a id="__codelineno-6-80" name="__codelineno-6-80"></a><span class="c1">##### EVALUATE DATA #####</span>
<a id="__codelineno-6-81" name="__codelineno-6-81"></a><span class="c1"># Plot utility</span>
<a id="__codelineno-6-82" name="__codelineno-6-82"></a><span class="k">def</span> <span class="nf">plot_graphs</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
<a id="__codelineno-6-83" name="__codelineno-6-83"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="n">string</span><span class="p">])</span>
<a id="__codelineno-6-84" name="__codelineno-6-84"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;val_&#39;</span><span class="o">+</span><span class="n">string</span><span class="p">])</span>
<a id="__codelineno-6-85" name="__codelineno-6-85"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Epochs&quot;</span><span class="p">)</span>
<a id="__codelineno-6-86" name="__codelineno-6-86"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
<a id="__codelineno-6-87" name="__codelineno-6-87"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="n">string</span><span class="p">,</span> <span class="s1">&#39;val_&#39;</span><span class="o">+</span><span class="n">string</span><span class="p">])</span>
<a id="__codelineno-6-88" name="__codelineno-6-88"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<a id="__codelineno-6-89" name="__codelineno-6-89"></a>
<a id="__codelineno-6-90" name="__codelineno-6-90"></a><span class="c1"># Plot the accuracy and results </span>
<a id="__codelineno-6-91" name="__codelineno-6-91"></a><span class="n">plot_graphs</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="s2">&quot;accuracy&quot;</span><span class="p">)</span>
<a id="__codelineno-6-92" name="__codelineno-6-92"></a><span class="n">plot_graphs</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="s2">&quot;loss&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
</details>
<h3 id="lecture-3-imdb-subwords-8k-with-1d-convolutional-layer">Lecture 3: IMDB Subwords 8K with 1D Convolutional Layer</h3>
<details class="- success">
<summary>Lecture 3: IMDB Subwords 8K with 1D Convolutional Layer</summary>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-7-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-7-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-7-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-7-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-7-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-7-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-7-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-7-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-7-10">10</a></span>
<span class="normal"><a href="#__codelineno-7-11">11</a></span>
<span class="normal"><a href="#__codelineno-7-12">12</a></span>
<span class="normal"><a href="#__codelineno-7-13">13</a></span>
<span class="normal"><a href="#__codelineno-7-14">14</a></span>
<span class="normal"><a href="#__codelineno-7-15">15</a></span>
<span class="normal"><a href="#__codelineno-7-16">16</a></span>
<span class="normal"><a href="#__codelineno-7-17">17</a></span>
<span class="normal"><a href="#__codelineno-7-18">18</a></span>
<span class="normal"><a href="#__codelineno-7-19">19</a></span>
<span class="normal"><a href="#__codelineno-7-20">20</a></span>
<span class="normal"><a href="#__codelineno-7-21">21</a></span>
<span class="normal"><a href="#__codelineno-7-22">22</a></span>
<span class="normal"><a href="#__codelineno-7-23">23</a></span>
<span class="normal"><a href="#__codelineno-7-24">24</a></span>
<span class="normal"><a href="#__codelineno-7-25">25</a></span>
<span class="normal"><a href="#__codelineno-7-26">26</a></span>
<span class="normal"><a href="#__codelineno-7-27">27</a></span>
<span class="normal"><a href="#__codelineno-7-28">28</a></span>
<span class="normal"><a href="#__codelineno-7-29">29</a></span>
<span class="normal"><a href="#__codelineno-7-30">30</a></span>
<span class="normal"><a href="#__codelineno-7-31">31</a></span>
<span class="normal"><a href="#__codelineno-7-32">32</a></span>
<span class="normal"><a href="#__codelineno-7-33">33</a></span>
<span class="normal"><a href="#__codelineno-7-34">34</a></span>
<span class="normal"><a href="#__codelineno-7-35">35</a></span>
<span class="normal"><a href="#__codelineno-7-36">36</a></span>
<span class="normal"><a href="#__codelineno-7-37">37</a></span>
<span class="normal"><a href="#__codelineno-7-38">38</a></span>
<span class="normal"><a href="#__codelineno-7-39">39</a></span>
<span class="normal"><a href="#__codelineno-7-40">40</a></span>
<span class="normal"><a href="#__codelineno-7-41">41</a></span>
<span class="normal"><a href="#__codelineno-7-42">42</a></span>
<span class="normal"><a href="#__codelineno-7-43">43</a></span>
<span class="normal"><a href="#__codelineno-7-44">44</a></span>
<span class="normal"><a href="#__codelineno-7-45">45</a></span>
<span class="normal"><a href="#__codelineno-7-46">46</a></span>
<span class="normal"><a href="#__codelineno-7-47">47</a></span>
<span class="normal"><a href="#__codelineno-7-48">48</a></span>
<span class="normal"><a href="#__codelineno-7-49">49</a></span>
<span class="normal"><a href="#__codelineno-7-50">50</a></span>
<span class="normal"><a href="#__codelineno-7-51">51</a></span>
<span class="normal"><a href="#__codelineno-7-52">52</a></span>
<span class="normal"><a href="#__codelineno-7-53">53</a></span>
<span class="normal"><a href="#__codelineno-7-54">54</a></span>
<span class="normal"><a href="#__codelineno-7-55">55</a></span>
<span class="normal"><a href="#__codelineno-7-56">56</a></span>
<span class="normal"><a href="#__codelineno-7-57">57</a></span>
<span class="normal"><a href="#__codelineno-7-58">58</a></span>
<span class="normal"><a href="#__codelineno-7-59">59</a></span>
<span class="normal"><a href="#__codelineno-7-60">60</a></span>
<span class="normal"><a href="#__codelineno-7-61">61</a></span>
<span class="normal"><a href="#__codelineno-7-62">62</a></span>
<span class="normal"><a href="#__codelineno-7-63">63</a></span>
<span class="normal"><a href="#__codelineno-7-64">64</a></span>
<span class="normal"><a href="#__codelineno-7-65">65</a></span>
<span class="normal"><a href="#__codelineno-7-66">66</a></span>
<span class="normal"><a href="#__codelineno-7-67">67</a></span>
<span class="normal"><a href="#__codelineno-7-68">68</a></span>
<span class="normal"><a href="#__codelineno-7-69">69</a></span>
<span class="normal"><a href="#__codelineno-7-70">70</a></span>
<span class="normal"><a href="#__codelineno-7-71">71</a></span>
<span class="normal"><a href="#__codelineno-7-72">72</a></span>
<span class="normal"><a href="#__codelineno-7-73">73</a></span>
<span class="normal"><a href="#__codelineno-7-74">74</a></span>
<span class="normal"><a href="#__codelineno-7-75">75</a></span>
<span class="normal"><a href="#__codelineno-7-76">76</a></span>
<span class="normal"><a href="#__codelineno-7-77">77</a></span>
<span class="normal"><a href="#__codelineno-7-78">78</a></span>
<span class="normal"><a href="#__codelineno-7-79">79</a></span>
<span class="normal"><a href="#__codelineno-7-80">80</a></span>
<span class="normal"><a href="#__codelineno-7-81">81</a></span>
<span class="normal"><a href="#__codelineno-7-82">82</a></span>
<span class="normal"><a href="#__codelineno-7-83">83</a></span>
<span class="normal"><a href="#__codelineno-7-84">84</a></span>
<span class="normal"><a href="#__codelineno-7-85">85</a></span>
<span class="normal"><a href="#__codelineno-7-86">86</a></span>
<span class="normal"><a href="#__codelineno-7-87">87</a></span>
<span class="normal"><a href="#__codelineno-7-88">88</a></span>
<span class="normal"><a href="#__codelineno-7-89">89</a></span>
<span class="normal"><a href="#__codelineno-7-90">90</a></span>
<span class="normal"><a href="#__codelineno-7-91">91</a></span>
<span class="normal"><a href="#__codelineno-7-92">92</a></span>
<span class="normal"><a href="#__codelineno-7-93">93</a></span>
<span class="normal"><a href="#__codelineno-7-94">94</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<a id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="kn">import</span> <span class="nn">tensorflow_datasets</span> <span class="k">as</span> <span class="nn">tfds</span>
<a id="__codelineno-7-6" name="__codelineno-7-6"></a>
<a id="__codelineno-7-7" name="__codelineno-7-7"></a><span class="c1">##### DOWNLOAD DATASET #####</span>
<a id="__codelineno-7-8" name="__codelineno-7-8"></a><span class="c1"># Download the subword encoded pretokenized dataset</span>
<a id="__codelineno-7-9" name="__codelineno-7-9"></a><span class="n">dataset</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">tfds</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;imdb_reviews/subwords8k&#39;</span><span class="p">,</span> <span class="n">with_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">as_supervised</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-7-10" name="__codelineno-7-10"></a>
<a id="__codelineno-7-11" name="__codelineno-7-11"></a><span class="c1"># Get the tokenizer</span>
<a id="__codelineno-7-12" name="__codelineno-7-12"></a><span class="n">tokenizer</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">encoder</span>
<a id="__codelineno-7-13" name="__codelineno-7-13"></a>
<a id="__codelineno-7-14" name="__codelineno-7-14"></a><span class="c1">##### PREPROCESS DATA #####</span>
<a id="__codelineno-7-15" name="__codelineno-7-15"></a><span class="n">BUFFER_SIZE</span> <span class="o">=</span> <span class="mi">10000</span>
<a id="__codelineno-7-16" name="__codelineno-7-16"></a><span class="n">BATCH_SIZE</span> <span class="o">=</span> <span class="mi">256</span>
<a id="__codelineno-7-17" name="__codelineno-7-17"></a>
<a id="__codelineno-7-18" name="__codelineno-7-18"></a><span class="c1"># Get the train and test splits</span>
<a id="__codelineno-7-19" name="__codelineno-7-19"></a><span class="n">train_data</span><span class="p">,</span> <span class="n">test_data</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">],</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">],</span> 
<a id="__codelineno-7-20" name="__codelineno-7-20"></a>
<a id="__codelineno-7-21" name="__codelineno-7-21"></a><span class="c1"># Shuffle the training data</span>
<a id="__codelineno-7-22" name="__codelineno-7-22"></a><span class="n">train_dataset</span> <span class="o">=</span> <span class="n">train_data</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">BUFFER_SIZE</span><span class="p">)</span>
<a id="__codelineno-7-23" name="__codelineno-7-23"></a>
<a id="__codelineno-7-24" name="__codelineno-7-24"></a><span class="c1"># Batch and pad the datasets to the maximum length of the sequences</span>
<a id="__codelineno-7-25" name="__codelineno-7-25"></a><span class="n">train_dataset</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="o">.</span><span class="n">padded_batch</span><span class="p">(</span><span class="n">BATCH_SIZE</span><span class="p">)</span>
<a id="__codelineno-7-26" name="__codelineno-7-26"></a><span class="n">test_dataset</span> <span class="o">=</span> <span class="n">test_data</span><span class="o">.</span><span class="n">padded_batch</span><span class="p">(</span><span class="n">BATCH_SIZE</span><span class="p">)</span>
<a id="__codelineno-7-27" name="__codelineno-7-27"></a>
<a id="__codelineno-7-28" name="__codelineno-7-28"></a><span class="c1">##### CREATE, COMPILE AND RUN MODEL #####</span>
<a id="__codelineno-7-29" name="__codelineno-7-29"></a><span class="c1"># Hyperparameters</span>
<a id="__codelineno-7-30" name="__codelineno-7-30"></a><span class="n">batch_size</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-7-31" name="__codelineno-7-31"></a><span class="n">timesteps</span> <span class="o">=</span> <span class="mi">20</span>
<a id="__codelineno-7-32" name="__codelineno-7-32"></a><span class="n">features</span> <span class="o">=</span> <span class="mi">20</span>
<a id="__codelineno-7-33" name="__codelineno-7-33"></a><span class="n">filters</span> <span class="o">=</span> <span class="mi">128</span>
<a id="__codelineno-7-34" name="__codelineno-7-34"></a><span class="n">kernel_size</span> <span class="o">=</span> <span class="mi">5</span>
<a id="__codelineno-7-35" name="__codelineno-7-35"></a>
<a id="__codelineno-7-36" name="__codelineno-7-36"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;batch_size: </span><span class="si">{</span><span class="n">batch_size</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-7-37" name="__codelineno-7-37"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;timesteps (sequence length): </span><span class="si">{</span><span class="n">timesteps</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-7-38" name="__codelineno-7-38"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;features (embedding size): </span><span class="si">{</span><span class="n">features</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-7-39" name="__codelineno-7-39"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;filters: </span><span class="si">{</span><span class="n">filters</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-7-40" name="__codelineno-7-40"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;kernel_size: </span><span class="si">{</span><span class="n">kernel_size</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-7-41" name="__codelineno-7-41"></a>
<a id="__codelineno-7-42" name="__codelineno-7-42"></a><span class="c1"># Define array input with random values</span>
<a id="__codelineno-7-43" name="__codelineno-7-43"></a><span class="n">random_input</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span><span class="n">timesteps</span><span class="p">,</span><span class="n">features</span><span class="p">)</span>
<a id="__codelineno-7-44" name="__codelineno-7-44"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;shape of input array: </span><span class="si">{</span><span class="n">random_input</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-7-45" name="__codelineno-7-45"></a>
<a id="__codelineno-7-46" name="__codelineno-7-46"></a><span class="c1"># Pass array to convolution layer and inspect output shape</span>
<a id="__codelineno-7-47" name="__codelineno-7-47"></a><span class="n">conv1d</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Conv1D</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="n">filters</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="n">kernel_size</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">)</span>
<a id="__codelineno-7-48" name="__codelineno-7-48"></a><span class="n">result</span> <span class="o">=</span> <span class="n">conv1d</span><span class="p">(</span><span class="n">random_input</span><span class="p">)</span>
<a id="__codelineno-7-49" name="__codelineno-7-49"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;shape of conv1d output: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-7-50" name="__codelineno-7-50"></a>
<a id="__codelineno-7-51" name="__codelineno-7-51"></a><span class="c1"># Pass array to max pooling layer and inspect output shape</span>
<a id="__codelineno-7-52" name="__codelineno-7-52"></a><span class="n">gmp</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">GlobalMaxPooling1D</span><span class="p">()</span>
<a id="__codelineno-7-53" name="__codelineno-7-53"></a><span class="n">result</span> <span class="o">=</span> <span class="n">gmp</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<a id="__codelineno-7-54" name="__codelineno-7-54"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;shape of global max pooling output: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-7-55" name="__codelineno-7-55"></a>
<a id="__codelineno-7-56" name="__codelineno-7-56"></a><span class="c1"># Hyperparameters</span>
<a id="__codelineno-7-57" name="__codelineno-7-57"></a><span class="n">embedding_dim</span> <span class="o">=</span> <span class="mi">64</span>
<a id="__codelineno-7-58" name="__codelineno-7-58"></a><span class="n">filters</span> <span class="o">=</span> <span class="mi">128</span>
<a id="__codelineno-7-59" name="__codelineno-7-59"></a><span class="n">kernel_size</span> <span class="o">=</span> <span class="mi">5</span>
<a id="__codelineno-7-60" name="__codelineno-7-60"></a><span class="n">dense_dim</span> <span class="o">=</span> <span class="mi">64</span>
<a id="__codelineno-7-61" name="__codelineno-7-61"></a>
<a id="__codelineno-7-62" name="__codelineno-7-62"></a><span class="c1"># Build the model</span>
<a id="__codelineno-7-63" name="__codelineno-7-63"></a><span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
<a id="__codelineno-7-64" name="__codelineno-7-64"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">vocab_size</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="p">),</span>
<a id="__codelineno-7-65" name="__codelineno-7-65"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Conv1D</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="n">filters</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="n">kernel_size</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
<a id="__codelineno-7-66" name="__codelineno-7-66"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">GlobalMaxPooling1D</span><span class="p">(),</span>
<a id="__codelineno-7-67" name="__codelineno-7-67"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">dense_dim</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
<a id="__codelineno-7-68" name="__codelineno-7-68"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;sigmoid&#39;</span><span class="p">)</span>
<a id="__codelineno-7-69" name="__codelineno-7-69"></a><span class="p">])</span>
<a id="__codelineno-7-70" name="__codelineno-7-70"></a>
<a id="__codelineno-7-71" name="__codelineno-7-71"></a><span class="c1"># Print the model summary</span>
<a id="__codelineno-7-72" name="__codelineno-7-72"></a><span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
<a id="__codelineno-7-73" name="__codelineno-7-73"></a>
<a id="__codelineno-7-74" name="__codelineno-7-74"></a><span class="c1"># Set the training parameters</span>
<a id="__codelineno-7-75" name="__codelineno-7-75"></a><span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">&#39;binary_crossentropy&#39;</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">])</span>
<a id="__codelineno-7-76" name="__codelineno-7-76"></a>
<a id="__codelineno-7-77" name="__codelineno-7-77"></a><span class="n">NUM_EPOCHS</span> <span class="o">=</span> <span class="mi">10</span>
<a id="__codelineno-7-78" name="__codelineno-7-78"></a>
<a id="__codelineno-7-79" name="__codelineno-7-79"></a><span class="c1"># Train the model</span>
<a id="__codelineno-7-80" name="__codelineno-7-80"></a><span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="n">NUM_EPOCHS</span><span class="p">,</span> <span class="n">validation_data</span><span class="o">=</span><span class="n">test_dataset</span><span class="p">)</span>
<a id="__codelineno-7-81" name="__codelineno-7-81"></a>
<a id="__codelineno-7-82" name="__codelineno-7-82"></a><span class="c1">##### EVALUATE DATA #####</span>
<a id="__codelineno-7-83" name="__codelineno-7-83"></a><span class="c1"># Plot utility</span>
<a id="__codelineno-7-84" name="__codelineno-7-84"></a><span class="k">def</span> <span class="nf">plot_graphs</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
<a id="__codelineno-7-85" name="__codelineno-7-85"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="n">string</span><span class="p">])</span>
<a id="__codelineno-7-86" name="__codelineno-7-86"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;val_&#39;</span><span class="o">+</span><span class="n">string</span><span class="p">])</span>
<a id="__codelineno-7-87" name="__codelineno-7-87"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Epochs&quot;</span><span class="p">)</span>
<a id="__codelineno-7-88" name="__codelineno-7-88"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
<a id="__codelineno-7-89" name="__codelineno-7-89"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="n">string</span><span class="p">,</span> <span class="s1">&#39;val_&#39;</span><span class="o">+</span><span class="n">string</span><span class="p">])</span>
<a id="__codelineno-7-90" name="__codelineno-7-90"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<a id="__codelineno-7-91" name="__codelineno-7-91"></a>
<a id="__codelineno-7-92" name="__codelineno-7-92"></a><span class="c1"># Plot the accuracy and results </span>
<a id="__codelineno-7-93" name="__codelineno-7-93"></a><span class="n">plot_graphs</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="s2">&quot;accuracy&quot;</span><span class="p">)</span>
<a id="__codelineno-7-94" name="__codelineno-7-94"></a><span class="n">plot_graphs</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="s2">&quot;loss&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
</details>
<h3 id="lecture-4-imdb-reviews-with-gru">Lecture 4: IMDB Reviews with GRU</h3>
<details class="- success">
<summary>Lecture 4: IMDB Reviews with GRU</summary>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">  1</a></span>
<span class="normal"><a href="#__codelineno-8-2">  2</a></span>
<span class="normal"><a href="#__codelineno-8-3">  3</a></span>
<span class="normal"><a href="#__codelineno-8-4">  4</a></span>
<span class="normal"><a href="#__codelineno-8-5">  5</a></span>
<span class="normal"><a href="#__codelineno-8-6">  6</a></span>
<span class="normal"><a href="#__codelineno-8-7">  7</a></span>
<span class="normal"><a href="#__codelineno-8-8">  8</a></span>
<span class="normal"><a href="#__codelineno-8-9">  9</a></span>
<span class="normal"><a href="#__codelineno-8-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-8-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-8-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-8-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-8-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-8-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-8-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-8-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-8-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-8-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-8-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-8-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-8-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-8-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-8-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-8-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-8-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-8-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-8-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-8-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-8-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-8-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-8-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-8-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-8-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-8-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-8-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-8-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-8-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-8-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-8-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-8-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-8-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-8-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-8-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-8-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-8-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-8-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-8-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-8-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-8-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-8-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-8-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-8-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-8-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-8-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-8-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-8-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-8-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-8-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-8-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-8-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-8-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-8-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-8-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-8-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-8-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-8-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-8-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-8-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-8-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-8-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-8-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-8-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-8-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-8-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-8-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-8-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-8-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-8-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-8-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-8-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-8-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-8-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-8-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-8-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-8-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-8-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-8-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-8-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-8-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-8-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-8-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-8-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-8-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-8-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-8-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-8-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-8-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-8-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-8-100">100</a></span>
<span class="normal"><a href="#__codelineno-8-101">101</a></span>
<span class="normal"><a href="#__codelineno-8-102">102</a></span>
<span class="normal"><a href="#__codelineno-8-103">103</a></span>
<span class="normal"><a href="#__codelineno-8-104">104</a></span>
<span class="normal"><a href="#__codelineno-8-105">105</a></span>
<span class="normal"><a href="#__codelineno-8-106">106</a></span>
<span class="normal"><a href="#__codelineno-8-107">107</a></span>
<span class="normal"><a href="#__codelineno-8-108">108</a></span>
<span class="normal"><a href="#__codelineno-8-109">109</a></span>
<span class="normal"><a href="#__codelineno-8-110">110</a></span>
<span class="normal"><a href="#__codelineno-8-111">111</a></span>
<span class="normal"><a href="#__codelineno-8-112">112</a></span>
<span class="normal"><a href="#__codelineno-8-113">113</a></span>
<span class="normal"><a href="#__codelineno-8-114">114</a></span>
<span class="normal"><a href="#__codelineno-8-115">115</a></span>
<span class="normal"><a href="#__codelineno-8-116">116</a></span>
<span class="normal"><a href="#__codelineno-8-117">117</a></span>
<span class="normal"><a href="#__codelineno-8-118">118</a></span>
<span class="normal"><a href="#__codelineno-8-119">119</a></span>
<span class="normal"><a href="#__codelineno-8-120">120</a></span>
<span class="normal"><a href="#__codelineno-8-121">121</a></span>
<span class="normal"><a href="#__codelineno-8-122">122</a></span>
<span class="normal"><a href="#__codelineno-8-123">123</a></span>
<span class="normal"><a href="#__codelineno-8-124">124</a></span>
<span class="normal"><a href="#__codelineno-8-125">125</a></span>
<span class="normal"><a href="#__codelineno-8-126">126</a></span>
<span class="normal"><a href="#__codelineno-8-127">127</a></span>
<span class="normal"><a href="#__codelineno-8-128">128</a></span>
<span class="normal"><a href="#__codelineno-8-129">129</a></span>
<span class="normal"><a href="#__codelineno-8-130">130</a></span>
<span class="normal"><a href="#__codelineno-8-131">131</a></span>
<span class="normal"><a href="#__codelineno-8-132">132</a></span>
<span class="normal"><a href="#__codelineno-8-133">133</a></span>
<span class="normal"><a href="#__codelineno-8-134">134</a></span>
<span class="normal"><a href="#__codelineno-8-135">135</a></span>
<span class="normal"><a href="#__codelineno-8-136">136</a></span>
<span class="normal"><a href="#__codelineno-8-137">137</a></span>
<span class="normal"><a href="#__codelineno-8-138">138</a></span>
<span class="normal"><a href="#__codelineno-8-139">139</a></span>
<span class="normal"><a href="#__codelineno-8-140">140</a></span>
<span class="normal"><a href="#__codelineno-8-141">141</a></span>
<span class="normal"><a href="#__codelineno-8-142">142</a></span>
<span class="normal"><a href="#__codelineno-8-143">143</a></span>
<span class="normal"><a href="#__codelineno-8-144">144</a></span>
<span class="normal"><a href="#__codelineno-8-145">145</a></span>
<span class="normal"><a href="#__codelineno-8-146">146</a></span>
<span class="normal"><a href="#__codelineno-8-147">147</a></span>
<span class="normal"><a href="#__codelineno-8-148">148</a></span>
<span class="normal"><a href="#__codelineno-8-149">149</a></span>
<span class="normal"><a href="#__codelineno-8-150">150</a></span>
<span class="normal"><a href="#__codelineno-8-151">151</a></span>
<span class="normal"><a href="#__codelineno-8-152">152</a></span>
<span class="normal"><a href="#__codelineno-8-153">153</a></span>
<span class="normal"><a href="#__codelineno-8-154">154</a></span>
<span class="normal"><a href="#__codelineno-8-155">155</a></span>
<span class="normal"><a href="#__codelineno-8-156">156</a></span>
<span class="normal"><a href="#__codelineno-8-157">157</a></span>
<span class="normal"><a href="#__codelineno-8-158">158</a></span>
<span class="normal"><a href="#__codelineno-8-159">159</a></span>
<span class="normal"><a href="#__codelineno-8-160">160</a></span>
<span class="normal"><a href="#__codelineno-8-161">161</a></span>
<span class="normal"><a href="#__codelineno-8-162">162</a></span>
<span class="normal"><a href="#__codelineno-8-163">163</a></span>
<span class="normal"><a href="#__codelineno-8-164">164</a></span>
<span class="normal"><a href="#__codelineno-8-165">165</a></span>
<span class="normal"><a href="#__codelineno-8-166">166</a></span>
<span class="normal"><a href="#__codelineno-8-167">167</a></span>
<span class="normal"><a href="#__codelineno-8-168">168</a></span>
<span class="normal"><a href="#__codelineno-8-169">169</a></span>
<span class="normal"><a href="#__codelineno-8-170">170</a></span>
<span class="normal"><a href="#__codelineno-8-171">171</a></span>
<span class="normal"><a href="#__codelineno-8-172">172</a></span>
<span class="normal"><a href="#__codelineno-8-173">173</a></span>
<span class="normal"><a href="#__codelineno-8-174">174</a></span>
<span class="normal"><a href="#__codelineno-8-175">175</a></span>
<span class="normal"><a href="#__codelineno-8-176">176</a></span>
<span class="normal"><a href="#__codelineno-8-177">177</a></span>
<span class="normal"><a href="#__codelineno-8-178">178</a></span>
<span class="normal"><a href="#__codelineno-8-179">179</a></span>
<span class="normal"><a href="#__codelineno-8-180">180</a></span>
<span class="normal"><a href="#__codelineno-8-181">181</a></span>
<span class="normal"><a href="#__codelineno-8-182">182</a></span>
<span class="normal"><a href="#__codelineno-8-183">183</a></span>
<span class="normal"><a href="#__codelineno-8-184">184</a></span>
<span class="normal"><a href="#__codelineno-8-185">185</a></span>
<span class="normal"><a href="#__codelineno-8-186">186</a></span>
<span class="normal"><a href="#__codelineno-8-187">187</a></span>
<span class="normal"><a href="#__codelineno-8-188">188</a></span>
<span class="normal"><a href="#__codelineno-8-189">189</a></span>
<span class="normal"><a href="#__codelineno-8-190">190</a></span>
<span class="normal"><a href="#__codelineno-8-191">191</a></span>
<span class="normal"><a href="#__codelineno-8-192">192</a></span>
<span class="normal"><a href="#__codelineno-8-193">193</a></span>
<span class="normal"><a href="#__codelineno-8-194">194</a></span>
<span class="normal"><a href="#__codelineno-8-195">195</a></span>
<span class="normal"><a href="#__codelineno-8-196">196</a></span>
<span class="normal"><a href="#__codelineno-8-197">197</a></span>
<span class="normal"><a href="#__codelineno-8-198">198</a></span>
<span class="normal"><a href="#__codelineno-8-199">199</a></span>
<span class="normal"><a href="#__codelineno-8-200">200</a></span>
<span class="normal"><a href="#__codelineno-8-201">201</a></span>
<span class="normal"><a href="#__codelineno-8-202">202</a></span>
<span class="normal"><a href="#__codelineno-8-203">203</a></span>
<span class="normal"><a href="#__codelineno-8-204">204</a></span>
<span class="normal"><a href="#__codelineno-8-205">205</a></span>
<span class="normal"><a href="#__codelineno-8-206">206</a></span>
<span class="normal"><a href="#__codelineno-8-207">207</a></span>
<span class="normal"><a href="#__codelineno-8-208">208</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="kn">import</span> <span class="nn">tensorflow_datasets</span> <span class="k">as</span> <span class="nn">tfds</span>
<a id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<a id="__codelineno-8-6" name="__codelineno-8-6"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.preprocessing.text</span> <span class="kn">import</span> <span class="n">Tokenizer</span>
<a id="__codelineno-8-7" name="__codelineno-8-7"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.preprocessing.sequence</span> <span class="kn">import</span> <span class="n">pad_sequences</span>
<a id="__codelineno-8-8" name="__codelineno-8-8"></a>
<a id="__codelineno-8-9" name="__codelineno-8-9"></a><span class="c1">##### DOWNLOAD DATASET #####</span>
<a id="__codelineno-8-10" name="__codelineno-8-10"></a><span class="c1"># Download the plain text dataset</span>
<a id="__codelineno-8-11" name="__codelineno-8-11"></a><span class="n">imdb</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">tfds</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;imdb_reviews&#39;</span><span class="p">,</span> <span class="n">with_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">as_supervised</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-8-12" name="__codelineno-8-12"></a>
<a id="__codelineno-8-13" name="__codelineno-8-13"></a><span class="c1"># Get the train and test sets</span>
<a id="__codelineno-8-14" name="__codelineno-8-14"></a><span class="n">train_data</span><span class="p">,</span> <span class="n">test_data</span> <span class="o">=</span> <span class="n">imdb</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">],</span> <span class="n">imdb</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span>
<a id="__codelineno-8-15" name="__codelineno-8-15"></a>
<a id="__codelineno-8-16" name="__codelineno-8-16"></a><span class="c1"># Initialize sentences and labels lists</span>
<a id="__codelineno-8-17" name="__codelineno-8-17"></a><span class="n">training_sentences</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-8-18" name="__codelineno-8-18"></a><span class="n">training_labels</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-8-19" name="__codelineno-8-19"></a>
<a id="__codelineno-8-20" name="__codelineno-8-20"></a><span class="n">testing_sentences</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-8-21" name="__codelineno-8-21"></a><span class="n">testing_labels</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-8-22" name="__codelineno-8-22"></a>
<a id="__codelineno-8-23" name="__codelineno-8-23"></a><span class="c1"># Loop over all training examples and save the sentences and labels</span>
<a id="__codelineno-8-24" name="__codelineno-8-24"></a><span class="k">for</span> <span class="n">s</span><span class="p">,</span><span class="n">l</span> <span class="ow">in</span> <span class="n">train_data</span><span class="p">:</span>
<a id="__codelineno-8-25" name="__codelineno-8-25"></a>  <span class="n">training_sentences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">))</span>
<a id="__codelineno-8-26" name="__codelineno-8-26"></a>  <span class="n">training_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
<a id="__codelineno-8-27" name="__codelineno-8-27"></a>
<a id="__codelineno-8-28" name="__codelineno-8-28"></a><span class="c1"># Loop over all test examples and save the sentences and labels</span>
<a id="__codelineno-8-29" name="__codelineno-8-29"></a><span class="k">for</span> <span class="n">s</span><span class="p">,</span><span class="n">l</span> <span class="ow">in</span> <span class="n">test_data</span><span class="p">:</span>
<a id="__codelineno-8-30" name="__codelineno-8-30"></a>  <span class="n">testing_sentences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">))</span>
<a id="__codelineno-8-31" name="__codelineno-8-31"></a>  <span class="n">testing_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
<a id="__codelineno-8-32" name="__codelineno-8-32"></a>
<a id="__codelineno-8-33" name="__codelineno-8-33"></a><span class="c1"># Convert labels lists to numpy array</span>
<a id="__codelineno-8-34" name="__codelineno-8-34"></a><span class="n">training_labels_final</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">training_labels</span><span class="p">)</span>
<a id="__codelineno-8-35" name="__codelineno-8-35"></a><span class="n">testing_labels_final</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">testing_labels</span><span class="p">)</span>
<a id="__codelineno-8-36" name="__codelineno-8-36"></a>
<a id="__codelineno-8-37" name="__codelineno-8-37"></a><span class="c1">##### PREPROCESS DATA #####</span>
<a id="__codelineno-8-38" name="__codelineno-8-38"></a><span class="c1"># Parameters</span>
<a id="__codelineno-8-39" name="__codelineno-8-39"></a><span class="n">vocab_size</span> <span class="o">=</span> <span class="mi">10000</span>
<a id="__codelineno-8-40" name="__codelineno-8-40"></a><span class="n">max_length</span> <span class="o">=</span> <span class="mi">120</span>
<a id="__codelineno-8-41" name="__codelineno-8-41"></a><span class="n">trunc_type</span><span class="o">=</span><span class="s1">&#39;post&#39;</span>
<a id="__codelineno-8-42" name="__codelineno-8-42"></a><span class="n">oov_tok</span> <span class="o">=</span> <span class="s2">&quot;&lt;OOV&gt;&quot;</span>
<a id="__codelineno-8-43" name="__codelineno-8-43"></a>
<a id="__codelineno-8-44" name="__codelineno-8-44"></a><span class="c1"># Initialize the Tokenizer class</span>
<a id="__codelineno-8-45" name="__codelineno-8-45"></a><span class="n">tokenizer</span> <span class="o">=</span> <span class="n">Tokenizer</span><span class="p">(</span><span class="n">num_words</span> <span class="o">=</span> <span class="n">vocab_size</span><span class="p">,</span> <span class="n">oov_token</span><span class="o">=</span><span class="n">oov_tok</span><span class="p">)</span>
<a id="__codelineno-8-46" name="__codelineno-8-46"></a>
<a id="__codelineno-8-47" name="__codelineno-8-47"></a><span class="c1"># Generate the word index dictionary for the training sentences</span>
<a id="__codelineno-8-48" name="__codelineno-8-48"></a><span class="n">tokenizer</span><span class="o">.</span><span class="n">fit_on_texts</span><span class="p">(</span><span class="n">training_sentences</span><span class="p">)</span>
<a id="__codelineno-8-49" name="__codelineno-8-49"></a><span class="n">word_index</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">word_index</span>
<a id="__codelineno-8-50" name="__codelineno-8-50"></a>
<a id="__codelineno-8-51" name="__codelineno-8-51"></a><span class="c1"># Generate and pad the training sequences</span>
<a id="__codelineno-8-52" name="__codelineno-8-52"></a><span class="n">sequences</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">texts_to_sequences</span><span class="p">(</span><span class="n">training_sentences</span><span class="p">)</span>
<a id="__codelineno-8-53" name="__codelineno-8-53"></a><span class="n">padded</span> <span class="o">=</span> <span class="n">pad_sequences</span><span class="p">(</span><span class="n">sequences</span><span class="p">,</span><span class="n">maxlen</span><span class="o">=</span><span class="n">max_length</span><span class="p">,</span> <span class="n">truncating</span><span class="o">=</span><span class="n">trunc_type</span><span class="p">)</span>
<a id="__codelineno-8-54" name="__codelineno-8-54"></a>
<a id="__codelineno-8-55" name="__codelineno-8-55"></a><span class="c1"># Generate and pad the test sequences</span>
<a id="__codelineno-8-56" name="__codelineno-8-56"></a><span class="n">testing_sequences</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">texts_to_sequences</span><span class="p">(</span><span class="n">testing_sentences</span><span class="p">)</span>
<a id="__codelineno-8-57" name="__codelineno-8-57"></a><span class="n">testing_padded</span> <span class="o">=</span> <span class="n">pad_sequences</span><span class="p">(</span><span class="n">testing_sequences</span><span class="p">,</span><span class="n">maxlen</span><span class="o">=</span><span class="n">max_length</span><span class="p">)</span>
<a id="__codelineno-8-58" name="__codelineno-8-58"></a>
<a id="__codelineno-8-59" name="__codelineno-8-59"></a><span class="c1">##### PLOT UTILITY #####</span>
<a id="__codelineno-8-60" name="__codelineno-8-60"></a><span class="c1"># Plot Utility</span>
<a id="__codelineno-8-61" name="__codelineno-8-61"></a><span class="k">def</span> <span class="nf">plot_graphs</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
<a id="__codelineno-8-62" name="__codelineno-8-62"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="n">string</span><span class="p">])</span>
<a id="__codelineno-8-63" name="__codelineno-8-63"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;val_&#39;</span><span class="o">+</span><span class="n">string</span><span class="p">])</span>
<a id="__codelineno-8-64" name="__codelineno-8-64"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Epochs&quot;</span><span class="p">)</span>
<a id="__codelineno-8-65" name="__codelineno-8-65"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
<a id="__codelineno-8-66" name="__codelineno-8-66"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="n">string</span><span class="p">,</span> <span class="s1">&#39;val_&#39;</span><span class="o">+</span><span class="n">string</span><span class="p">])</span>
<a id="__codelineno-8-67" name="__codelineno-8-67"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<a id="__codelineno-8-68" name="__codelineno-8-68"></a>
<a id="__codelineno-8-69" name="__codelineno-8-69"></a><span class="c1">############### MODEL 1: FLATTEN ###############</span>
<a id="__codelineno-8-70" name="__codelineno-8-70"></a><span class="c1">##### CREATE, COMPILE AND RUN MODEL #####</span>
<a id="__codelineno-8-71" name="__codelineno-8-71"></a><span class="c1"># Parameters</span>
<a id="__codelineno-8-72" name="__codelineno-8-72"></a><span class="n">embedding_dim</span> <span class="o">=</span> <span class="mi">16</span>
<a id="__codelineno-8-73" name="__codelineno-8-73"></a><span class="n">dense_dim</span> <span class="o">=</span> <span class="mi">6</span>
<a id="__codelineno-8-74" name="__codelineno-8-74"></a>
<a id="__codelineno-8-75" name="__codelineno-8-75"></a><span class="c1"># Model Definition with a Flatten layer</span>
<a id="__codelineno-8-76" name="__codelineno-8-76"></a><span class="n">model_flatten</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
<a id="__codelineno-8-77" name="__codelineno-8-77"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">vocab_size</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="p">,</span> <span class="n">input_length</span><span class="o">=</span><span class="n">max_length</span><span class="p">),</span>
<a id="__codelineno-8-78" name="__codelineno-8-78"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Flatten</span><span class="p">(),</span>
<a id="__codelineno-8-79" name="__codelineno-8-79"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">dense_dim</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
<a id="__codelineno-8-80" name="__codelineno-8-80"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;sigmoid&#39;</span><span class="p">)</span>
<a id="__codelineno-8-81" name="__codelineno-8-81"></a><span class="p">])</span>
<a id="__codelineno-8-82" name="__codelineno-8-82"></a>
<a id="__codelineno-8-83" name="__codelineno-8-83"></a><span class="c1"># Set the training parameters</span>
<a id="__codelineno-8-84" name="__codelineno-8-84"></a><span class="n">model_flatten</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">&#39;binary_crossentropy&#39;</span><span class="p">,</span><span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span><span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">])</span>
<a id="__codelineno-8-85" name="__codelineno-8-85"></a>
<a id="__codelineno-8-86" name="__codelineno-8-86"></a><span class="c1"># Print the model summary</span>
<a id="__codelineno-8-87" name="__codelineno-8-87"></a><span class="n">model_flatten</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
<a id="__codelineno-8-88" name="__codelineno-8-88"></a>
<a id="__codelineno-8-89" name="__codelineno-8-89"></a><span class="n">NUM_EPOCHS</span> <span class="o">=</span> <span class="mi">10</span>
<a id="__codelineno-8-90" name="__codelineno-8-90"></a><span class="n">BATCH_SIZE</span> <span class="o">=</span> <span class="mi">128</span>
<a id="__codelineno-8-91" name="__codelineno-8-91"></a>
<a id="__codelineno-8-92" name="__codelineno-8-92"></a><span class="c1"># Train the model</span>
<a id="__codelineno-8-93" name="__codelineno-8-93"></a><span class="n">history_flatten</span> <span class="o">=</span> <span class="n">model_flatten</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">padded</span><span class="p">,</span> <span class="n">training_labels_final</span><span class="p">,</span> 
<a id="__codelineno-8-94" name="__codelineno-8-94"></a>                                    <span class="n">batch_size</span><span class="o">=</span><span class="n">BATCH_SIZE</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="n">NUM_EPOCHS</span><span class="p">,</span> 
<a id="__codelineno-8-95" name="__codelineno-8-95"></a>                                    <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">testing_padded</span><span class="p">,</span> 
<a id="__codelineno-8-96" name="__codelineno-8-96"></a>                                                     <span class="n">testing_labels_final</span><span class="p">))</span>
<a id="__codelineno-8-97" name="__codelineno-8-97"></a>
<a id="__codelineno-8-98" name="__codelineno-8-98"></a><span class="c1">##### EVALUATE DATA #####</span>
<a id="__codelineno-8-99" name="__codelineno-8-99"></a><span class="c1"># Plot the accuracy and loss history</span>
<a id="__codelineno-8-100" name="__codelineno-8-100"></a><span class="n">plot_graphs</span><span class="p">(</span><span class="n">history_flatten</span><span class="p">,</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">)</span>
<a id="__codelineno-8-101" name="__codelineno-8-101"></a><span class="n">plot_graphs</span><span class="p">(</span><span class="n">history_flatten</span><span class="p">,</span> <span class="s1">&#39;loss&#39;</span><span class="p">)</span>
<a id="__codelineno-8-102" name="__codelineno-8-102"></a>
<a id="__codelineno-8-103" name="__codelineno-8-103"></a><span class="c1">############### MODEL 2: LSTM ###############</span>
<a id="__codelineno-8-104" name="__codelineno-8-104"></a><span class="c1">##### CREATE, COMPILE AND RUN MODEL #####</span>
<a id="__codelineno-8-105" name="__codelineno-8-105"></a><span class="c1"># Parameters</span>
<a id="__codelineno-8-106" name="__codelineno-8-106"></a><span class="n">embedding_dim</span> <span class="o">=</span> <span class="mi">16</span>
<a id="__codelineno-8-107" name="__codelineno-8-107"></a><span class="n">lstm_dim</span> <span class="o">=</span> <span class="mi">32</span>
<a id="__codelineno-8-108" name="__codelineno-8-108"></a><span class="n">dense_dim</span> <span class="o">=</span> <span class="mi">6</span>
<a id="__codelineno-8-109" name="__codelineno-8-109"></a>
<a id="__codelineno-8-110" name="__codelineno-8-110"></a><span class="c1"># Model Definition with LSTM</span>
<a id="__codelineno-8-111" name="__codelineno-8-111"></a><span class="n">model_lstm</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
<a id="__codelineno-8-112" name="__codelineno-8-112"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">vocab_size</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="p">,</span> <span class="n">input_length</span><span class="o">=</span><span class="n">max_length</span><span class="p">),</span>
<a id="__codelineno-8-113" name="__codelineno-8-113"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Bidirectional</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="n">lstm_dim</span><span class="p">)),</span>
<a id="__codelineno-8-114" name="__codelineno-8-114"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">dense_dim</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
<a id="__codelineno-8-115" name="__codelineno-8-115"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;sigmoid&#39;</span><span class="p">)</span>
<a id="__codelineno-8-116" name="__codelineno-8-116"></a><span class="p">])</span>
<a id="__codelineno-8-117" name="__codelineno-8-117"></a>
<a id="__codelineno-8-118" name="__codelineno-8-118"></a><span class="c1"># Set the training parameters</span>
<a id="__codelineno-8-119" name="__codelineno-8-119"></a><span class="n">model_lstm</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">&#39;binary_crossentropy&#39;</span><span class="p">,</span><span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span><span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">])</span>
<a id="__codelineno-8-120" name="__codelineno-8-120"></a>
<a id="__codelineno-8-121" name="__codelineno-8-121"></a><span class="c1"># Print the model summary</span>
<a id="__codelineno-8-122" name="__codelineno-8-122"></a><span class="n">model_lstm</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
<a id="__codelineno-8-123" name="__codelineno-8-123"></a>
<a id="__codelineno-8-124" name="__codelineno-8-124"></a><span class="n">NUM_EPOCHS</span> <span class="o">=</span> <span class="mi">10</span>
<a id="__codelineno-8-125" name="__codelineno-8-125"></a><span class="n">BATCH_SIZE</span> <span class="o">=</span> <span class="mi">128</span>
<a id="__codelineno-8-126" name="__codelineno-8-126"></a>
<a id="__codelineno-8-127" name="__codelineno-8-127"></a><span class="c1"># Train the model</span>
<a id="__codelineno-8-128" name="__codelineno-8-128"></a><span class="n">history_lstm</span> <span class="o">=</span> <span class="n">model_lstm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">padded</span><span class="p">,</span> <span class="n">training_labels_final</span><span class="p">,</span> 
<a id="__codelineno-8-129" name="__codelineno-8-129"></a>                              <span class="n">batch_size</span><span class="o">=</span><span class="n">BATCH_SIZE</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="n">NUM_EPOCHS</span><span class="p">,</span> 
<a id="__codelineno-8-130" name="__codelineno-8-130"></a>                              <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">testing_padded</span><span class="p">,</span> 
<a id="__codelineno-8-131" name="__codelineno-8-131"></a>                                               <span class="n">testing_labels_final</span><span class="p">))</span>
<a id="__codelineno-8-132" name="__codelineno-8-132"></a>
<a id="__codelineno-8-133" name="__codelineno-8-133"></a><span class="c1">##### EVALUATE DATA #####</span>
<a id="__codelineno-8-134" name="__codelineno-8-134"></a><span class="c1"># Plot the accuracy and loss history</span>
<a id="__codelineno-8-135" name="__codelineno-8-135"></a><span class="n">plot_graphs</span><span class="p">(</span><span class="n">history_lstm</span><span class="p">,</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">)</span>
<a id="__codelineno-8-136" name="__codelineno-8-136"></a><span class="n">plot_graphs</span><span class="p">(</span><span class="n">history_lstm</span><span class="p">,</span> <span class="s1">&#39;loss&#39;</span><span class="p">)</span>
<a id="__codelineno-8-137" name="__codelineno-8-137"></a>
<a id="__codelineno-8-138" name="__codelineno-8-138"></a><span class="c1">############### MODEL 3: GRU ###############</span>
<a id="__codelineno-8-139" name="__codelineno-8-139"></a><span class="c1">##### CREATE, COMPILE AND RUN MODEL #####</span>
<a id="__codelineno-8-140" name="__codelineno-8-140"></a><span class="c1"># Parameters</span>
<a id="__codelineno-8-141" name="__codelineno-8-141"></a><span class="n">embedding_dim</span> <span class="o">=</span> <span class="mi">16</span>
<a id="__codelineno-8-142" name="__codelineno-8-142"></a><span class="n">gru_dim</span> <span class="o">=</span> <span class="mi">32</span>
<a id="__codelineno-8-143" name="__codelineno-8-143"></a><span class="n">dense_dim</span> <span class="o">=</span> <span class="mi">6</span>
<a id="__codelineno-8-144" name="__codelineno-8-144"></a>
<a id="__codelineno-8-145" name="__codelineno-8-145"></a><span class="c1"># Model Definition with GRU</span>
<a id="__codelineno-8-146" name="__codelineno-8-146"></a><span class="n">model_gru</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
<a id="__codelineno-8-147" name="__codelineno-8-147"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">vocab_size</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="p">,</span> <span class="n">input_length</span><span class="o">=</span><span class="n">max_length</span><span class="p">),</span>
<a id="__codelineno-8-148" name="__codelineno-8-148"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Bidirectional</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">GRU</span><span class="p">(</span><span class="n">gru_dim</span><span class="p">)),</span>
<a id="__codelineno-8-149" name="__codelineno-8-149"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">dense_dim</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
<a id="__codelineno-8-150" name="__codelineno-8-150"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;sigmoid&#39;</span><span class="p">)</span>
<a id="__codelineno-8-151" name="__codelineno-8-151"></a><span class="p">])</span>
<a id="__codelineno-8-152" name="__codelineno-8-152"></a>
<a id="__codelineno-8-153" name="__codelineno-8-153"></a><span class="c1"># Set the training parameters</span>
<a id="__codelineno-8-154" name="__codelineno-8-154"></a><span class="n">model_gru</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">&#39;binary_crossentropy&#39;</span><span class="p">,</span><span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span><span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">])</span>
<a id="__codelineno-8-155" name="__codelineno-8-155"></a>
<a id="__codelineno-8-156" name="__codelineno-8-156"></a><span class="c1"># Print the model summary</span>
<a id="__codelineno-8-157" name="__codelineno-8-157"></a><span class="n">model_gru</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
<a id="__codelineno-8-158" name="__codelineno-8-158"></a>
<a id="__codelineno-8-159" name="__codelineno-8-159"></a><span class="n">NUM_EPOCHS</span> <span class="o">=</span> <span class="mi">10</span>
<a id="__codelineno-8-160" name="__codelineno-8-160"></a><span class="n">BATCH_SIZE</span> <span class="o">=</span> <span class="mi">128</span>
<a id="__codelineno-8-161" name="__codelineno-8-161"></a>
<a id="__codelineno-8-162" name="__codelineno-8-162"></a><span class="c1"># Train the model</span>
<a id="__codelineno-8-163" name="__codelineno-8-163"></a><span class="n">history_gru</span> <span class="o">=</span> <span class="n">model_gru</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">padded</span><span class="p">,</span> <span class="n">training_labels_final</span><span class="p">,</span> 
<a id="__codelineno-8-164" name="__codelineno-8-164"></a>                            <span class="n">batch_size</span><span class="o">=</span><span class="n">BATCH_SIZE</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="n">NUM_EPOCHS</span><span class="p">,</span> 
<a id="__codelineno-8-165" name="__codelineno-8-165"></a>                            <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">testing_padded</span><span class="p">,</span> 
<a id="__codelineno-8-166" name="__codelineno-8-166"></a>                                             <span class="n">testing_labels_final</span><span class="p">))</span>
<a id="__codelineno-8-167" name="__codelineno-8-167"></a>
<a id="__codelineno-8-168" name="__codelineno-8-168"></a><span class="c1">##### EVALUATE DATA #####</span>
<a id="__codelineno-8-169" name="__codelineno-8-169"></a><span class="c1"># Plot the accuracy and loss history</span>
<a id="__codelineno-8-170" name="__codelineno-8-170"></a><span class="n">plot_graphs</span><span class="p">(</span><span class="n">history_gru</span><span class="p">,</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">)</span>
<a id="__codelineno-8-171" name="__codelineno-8-171"></a><span class="n">plot_graphs</span><span class="p">(</span><span class="n">history_gru</span><span class="p">,</span> <span class="s1">&#39;loss&#39;</span><span class="p">)</span>
<a id="__codelineno-8-172" name="__codelineno-8-172"></a>
<a id="__codelineno-8-173" name="__codelineno-8-173"></a><span class="c1">############### MODEL 4: CONVOLUTION ###############</span>
<a id="__codelineno-8-174" name="__codelineno-8-174"></a><span class="c1">##### CREATE, COMPILE AND RUN MODEL #####</span>
<a id="__codelineno-8-175" name="__codelineno-8-175"></a><span class="c1"># Parameters</span>
<a id="__codelineno-8-176" name="__codelineno-8-176"></a><span class="n">embedding_dim</span> <span class="o">=</span> <span class="mi">16</span>
<a id="__codelineno-8-177" name="__codelineno-8-177"></a><span class="n">filters</span> <span class="o">=</span> <span class="mi">128</span>
<a id="__codelineno-8-178" name="__codelineno-8-178"></a><span class="n">kernel_size</span> <span class="o">=</span> <span class="mi">5</span>
<a id="__codelineno-8-179" name="__codelineno-8-179"></a><span class="n">dense_dim</span> <span class="o">=</span> <span class="mi">6</span>
<a id="__codelineno-8-180" name="__codelineno-8-180"></a>
<a id="__codelineno-8-181" name="__codelineno-8-181"></a><span class="c1"># Model Definition with Conv1D</span>
<a id="__codelineno-8-182" name="__codelineno-8-182"></a><span class="n">model_conv</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
<a id="__codelineno-8-183" name="__codelineno-8-183"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">vocab_size</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="p">,</span> <span class="n">input_length</span><span class="o">=</span><span class="n">max_length</span><span class="p">),</span>
<a id="__codelineno-8-184" name="__codelineno-8-184"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Conv1D</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span> <span class="n">kernel_size</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
<a id="__codelineno-8-185" name="__codelineno-8-185"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">GlobalAveragePooling1D</span><span class="p">(),</span>
<a id="__codelineno-8-186" name="__codelineno-8-186"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">dense_dim</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
<a id="__codelineno-8-187" name="__codelineno-8-187"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;sigmoid&#39;</span><span class="p">)</span>
<a id="__codelineno-8-188" name="__codelineno-8-188"></a><span class="p">])</span>
<a id="__codelineno-8-189" name="__codelineno-8-189"></a>
<a id="__codelineno-8-190" name="__codelineno-8-190"></a><span class="c1"># Set the training parameters</span>
<a id="__codelineno-8-191" name="__codelineno-8-191"></a><span class="n">model_conv</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">&#39;binary_crossentropy&#39;</span><span class="p">,</span><span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span><span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">])</span>
<a id="__codelineno-8-192" name="__codelineno-8-192"></a>
<a id="__codelineno-8-193" name="__codelineno-8-193"></a><span class="c1"># Print the model summary</span>
<a id="__codelineno-8-194" name="__codelineno-8-194"></a><span class="n">model_conv</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
<a id="__codelineno-8-195" name="__codelineno-8-195"></a>
<a id="__codelineno-8-196" name="__codelineno-8-196"></a><span class="n">NUM_EPOCHS</span> <span class="o">=</span> <span class="mi">10</span>
<a id="__codelineno-8-197" name="__codelineno-8-197"></a><span class="n">BATCH_SIZE</span> <span class="o">=</span> <span class="mi">128</span>
<a id="__codelineno-8-198" name="__codelineno-8-198"></a>
<a id="__codelineno-8-199" name="__codelineno-8-199"></a><span class="c1"># Train the model</span>
<a id="__codelineno-8-200" name="__codelineno-8-200"></a><span class="n">history_conv</span> <span class="o">=</span> <span class="n">model_conv</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">padded</span><span class="p">,</span> <span class="n">training_labels_final</span><span class="p">,</span> 
<a id="__codelineno-8-201" name="__codelineno-8-201"></a>                              <span class="n">batch_size</span><span class="o">=</span><span class="n">BATCH_SIZE</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="n">NUM_EPOCHS</span><span class="p">,</span> 
<a id="__codelineno-8-202" name="__codelineno-8-202"></a>                              <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">testing_padded</span><span class="p">,</span> 
<a id="__codelineno-8-203" name="__codelineno-8-203"></a>                                               <span class="n">testing_labels_final</span><span class="p">))</span>
<a id="__codelineno-8-204" name="__codelineno-8-204"></a>
<a id="__codelineno-8-205" name="__codelineno-8-205"></a><span class="c1">##### EVALUATE DATA #####</span>
<a id="__codelineno-8-206" name="__codelineno-8-206"></a><span class="c1"># Plot the accuracy and loss history</span>
<a id="__codelineno-8-207" name="__codelineno-8-207"></a><span class="n">plot_graphs</span><span class="p">(</span><span class="n">history_conv</span><span class="p">,</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">)</span>
<a id="__codelineno-8-208" name="__codelineno-8-208"></a><span class="n">plot_graphs</span><span class="p">(</span><span class="n">history_conv</span><span class="p">,</span> <span class="s1">&#39;loss&#39;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
</details>
<h3 id="lecture-5-sarcasm-with-bidirectional-lstm">Lecture 5: Sarcasm with Bidirectional LSTM</h3>
<details class="- success">
<summary>Lecture 5: Sarcasm with Bidirectional LSTM</summary>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-9-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-9-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-9-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-9-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-9-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-9-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-9-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-9-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-9-10">10</a></span>
<span class="normal"><a href="#__codelineno-9-11">11</a></span>
<span class="normal"><a href="#__codelineno-9-12">12</a></span>
<span class="normal"><a href="#__codelineno-9-13">13</a></span>
<span class="normal"><a href="#__codelineno-9-14">14</a></span>
<span class="normal"><a href="#__codelineno-9-15">15</a></span>
<span class="normal"><a href="#__codelineno-9-16">16</a></span>
<span class="normal"><a href="#__codelineno-9-17">17</a></span>
<span class="normal"><a href="#__codelineno-9-18">18</a></span>
<span class="normal"><a href="#__codelineno-9-19">19</a></span>
<span class="normal"><a href="#__codelineno-9-20">20</a></span>
<span class="normal"><a href="#__codelineno-9-21">21</a></span>
<span class="normal"><a href="#__codelineno-9-22">22</a></span>
<span class="normal"><a href="#__codelineno-9-23">23</a></span>
<span class="normal"><a href="#__codelineno-9-24">24</a></span>
<span class="normal"><a href="#__codelineno-9-25">25</a></span>
<span class="normal"><a href="#__codelineno-9-26">26</a></span>
<span class="normal"><a href="#__codelineno-9-27">27</a></span>
<span class="normal"><a href="#__codelineno-9-28">28</a></span>
<span class="normal"><a href="#__codelineno-9-29">29</a></span>
<span class="normal"><a href="#__codelineno-9-30">30</a></span>
<span class="normal"><a href="#__codelineno-9-31">31</a></span>
<span class="normal"><a href="#__codelineno-9-32">32</a></span>
<span class="normal"><a href="#__codelineno-9-33">33</a></span>
<span class="normal"><a href="#__codelineno-9-34">34</a></span>
<span class="normal"><a href="#__codelineno-9-35">35</a></span>
<span class="normal"><a href="#__codelineno-9-36">36</a></span>
<span class="normal"><a href="#__codelineno-9-37">37</a></span>
<span class="normal"><a href="#__codelineno-9-38">38</a></span>
<span class="normal"><a href="#__codelineno-9-39">39</a></span>
<span class="normal"><a href="#__codelineno-9-40">40</a></span>
<span class="normal"><a href="#__codelineno-9-41">41</a></span>
<span class="normal"><a href="#__codelineno-9-42">42</a></span>
<span class="normal"><a href="#__codelineno-9-43">43</a></span>
<span class="normal"><a href="#__codelineno-9-44">44</a></span>
<span class="normal"><a href="#__codelineno-9-45">45</a></span>
<span class="normal"><a href="#__codelineno-9-46">46</a></span>
<span class="normal"><a href="#__codelineno-9-47">47</a></span>
<span class="normal"><a href="#__codelineno-9-48">48</a></span>
<span class="normal"><a href="#__codelineno-9-49">49</a></span>
<span class="normal"><a href="#__codelineno-9-50">50</a></span>
<span class="normal"><a href="#__codelineno-9-51">51</a></span>
<span class="normal"><a href="#__codelineno-9-52">52</a></span>
<span class="normal"><a href="#__codelineno-9-53">53</a></span>
<span class="normal"><a href="#__codelineno-9-54">54</a></span>
<span class="normal"><a href="#__codelineno-9-55">55</a></span>
<span class="normal"><a href="#__codelineno-9-56">56</a></span>
<span class="normal"><a href="#__codelineno-9-57">57</a></span>
<span class="normal"><a href="#__codelineno-9-58">58</a></span>
<span class="normal"><a href="#__codelineno-9-59">59</a></span>
<span class="normal"><a href="#__codelineno-9-60">60</a></span>
<span class="normal"><a href="#__codelineno-9-61">61</a></span>
<span class="normal"><a href="#__codelineno-9-62">62</a></span>
<span class="normal"><a href="#__codelineno-9-63">63</a></span>
<span class="normal"><a href="#__codelineno-9-64">64</a></span>
<span class="normal"><a href="#__codelineno-9-65">65</a></span>
<span class="normal"><a href="#__codelineno-9-66">66</a></span>
<span class="normal"><a href="#__codelineno-9-67">67</a></span>
<span class="normal"><a href="#__codelineno-9-68">68</a></span>
<span class="normal"><a href="#__codelineno-9-69">69</a></span>
<span class="normal"><a href="#__codelineno-9-70">70</a></span>
<span class="normal"><a href="#__codelineno-9-71">71</a></span>
<span class="normal"><a href="#__codelineno-9-72">72</a></span>
<span class="normal"><a href="#__codelineno-9-73">73</a></span>
<span class="normal"><a href="#__codelineno-9-74">74</a></span>
<span class="normal"><a href="#__codelineno-9-75">75</a></span>
<span class="normal"><a href="#__codelineno-9-76">76</a></span>
<span class="normal"><a href="#__codelineno-9-77">77</a></span>
<span class="normal"><a href="#__codelineno-9-78">78</a></span>
<span class="normal"><a href="#__codelineno-9-79">79</a></span>
<span class="normal"><a href="#__codelineno-9-80">80</a></span>
<span class="normal"><a href="#__codelineno-9-81">81</a></span>
<span class="normal"><a href="#__codelineno-9-82">82</a></span>
<span class="normal"><a href="#__codelineno-9-83">83</a></span>
<span class="normal"><a href="#__codelineno-9-84">84</a></span>
<span class="normal"><a href="#__codelineno-9-85">85</a></span>
<span class="normal"><a href="#__codelineno-9-86">86</a></span>
<span class="normal"><a href="#__codelineno-9-87">87</a></span>
<span class="normal"><a href="#__codelineno-9-88">88</a></span>
<span class="normal"><a href="#__codelineno-9-89">89</a></span>
<span class="normal"><a href="#__codelineno-9-90">90</a></span>
<span class="normal"><a href="#__codelineno-9-91">91</a></span>
<span class="normal"><a href="#__codelineno-9-92">92</a></span>
<span class="normal"><a href="#__codelineno-9-93">93</a></span>
<span class="normal"><a href="#__codelineno-9-94">94</a></span>
<span class="normal"><a href="#__codelineno-9-95">95</a></span>
<span class="normal"><a href="#__codelineno-9-96">96</a></span>
<span class="normal"><a href="#__codelineno-9-97">97</a></span>
<span class="normal"><a href="#__codelineno-9-98">98</a></span>
<span class="normal"><a href="#__codelineno-9-99">99</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="kn">import</span> <span class="nn">json</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<a id="__codelineno-9-4" name="__codelineno-9-4"></a>
<a id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<a id="__codelineno-9-6" name="__codelineno-9-6"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.preprocessing.text</span> <span class="kn">import</span> <span class="n">Tokenizer</span>
<a id="__codelineno-9-7" name="__codelineno-9-7"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.preprocessing.sequence</span> <span class="kn">import</span> <span class="n">pad_sequences</span>
<a id="__codelineno-9-8" name="__codelineno-9-8"></a>
<a id="__codelineno-9-9" name="__codelineno-9-9"></a><span class="c1">##### DOWNLOAD DATASET #####</span>
<a id="__codelineno-9-10" name="__codelineno-9-10"></a><span class="c1"># Download the dataset</span>
<a id="__codelineno-9-11" name="__codelineno-9-11"></a><span class="err">!</span><span class="n">gdown</span> <span class="o">--</span><span class="nb">id</span> <span class="mi">1</span><span class="n">xRU3xY5</span><span class="o">-</span><span class="n">tkiPGvlz5xBJ18_pHWSRzI4v</span>
<a id="__codelineno-9-12" name="__codelineno-9-12"></a>
<a id="__codelineno-9-13" name="__codelineno-9-13"></a><span class="c1"># Load the JSON file</span>
<a id="__codelineno-9-14" name="__codelineno-9-14"></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;./sarcasm.json&quot;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-9-15" name="__codelineno-9-15"></a>    <span class="n">datastore</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<a id="__codelineno-9-16" name="__codelineno-9-16"></a>
<a id="__codelineno-9-17" name="__codelineno-9-17"></a><span class="c1"># Initialize the lists</span>
<a id="__codelineno-9-18" name="__codelineno-9-18"></a><span class="n">sentences</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-9-19" name="__codelineno-9-19"></a><span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-9-20" name="__codelineno-9-20"></a>
<a id="__codelineno-9-21" name="__codelineno-9-21"></a><span class="c1"># Collect sentences and labels into the lists</span>
<a id="__codelineno-9-22" name="__codelineno-9-22"></a><span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">datastore</span><span class="p">:</span>
<a id="__codelineno-9-23" name="__codelineno-9-23"></a>    <span class="n">sentences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;headline&#39;</span><span class="p">])</span>
<a id="__codelineno-9-24" name="__codelineno-9-24"></a>    <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;is_sarcastic&#39;</span><span class="p">])</span>
<a id="__codelineno-9-25" name="__codelineno-9-25"></a>
<a id="__codelineno-9-26" name="__codelineno-9-26"></a><span class="n">training_size</span> <span class="o">=</span> <span class="mi">20000</span>
<a id="__codelineno-9-27" name="__codelineno-9-27"></a>
<a id="__codelineno-9-28" name="__codelineno-9-28"></a><span class="c1"># Split the sentences</span>
<a id="__codelineno-9-29" name="__codelineno-9-29"></a><span class="n">training_sentences</span> <span class="o">=</span> <span class="n">sentences</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">training_size</span><span class="p">]</span>
<a id="__codelineno-9-30" name="__codelineno-9-30"></a><span class="n">testing_sentences</span> <span class="o">=</span> <span class="n">sentences</span><span class="p">[</span><span class="n">training_size</span><span class="p">:]</span>
<a id="__codelineno-9-31" name="__codelineno-9-31"></a>
<a id="__codelineno-9-32" name="__codelineno-9-32"></a><span class="c1"># Split the labels</span>
<a id="__codelineno-9-33" name="__codelineno-9-33"></a><span class="n">training_labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">training_size</span><span class="p">]</span>
<a id="__codelineno-9-34" name="__codelineno-9-34"></a><span class="n">testing_labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">training_size</span><span class="p">:]</span>
<a id="__codelineno-9-35" name="__codelineno-9-35"></a>
<a id="__codelineno-9-36" name="__codelineno-9-36"></a><span class="c1">##### PREPROCESS DATA #####</span>
<a id="__codelineno-9-37" name="__codelineno-9-37"></a><span class="n">vocab_size</span> <span class="o">=</span> <span class="mi">10000</span>
<a id="__codelineno-9-38" name="__codelineno-9-38"></a><span class="n">max_length</span> <span class="o">=</span> <span class="mi">120</span>
<a id="__codelineno-9-39" name="__codelineno-9-39"></a><span class="n">trunc_type</span><span class="o">=</span><span class="s1">&#39;post&#39;</span>
<a id="__codelineno-9-40" name="__codelineno-9-40"></a><span class="n">padding_type</span><span class="o">=</span><span class="s1">&#39;post&#39;</span>
<a id="__codelineno-9-41" name="__codelineno-9-41"></a><span class="n">oov_tok</span> <span class="o">=</span> <span class="s2">&quot;&lt;OOV&gt;&quot;</span>
<a id="__codelineno-9-42" name="__codelineno-9-42"></a>
<a id="__codelineno-9-43" name="__codelineno-9-43"></a><span class="c1"># Initialize the Tokenizer class</span>
<a id="__codelineno-9-44" name="__codelineno-9-44"></a><span class="n">tokenizer</span> <span class="o">=</span> <span class="n">Tokenizer</span><span class="p">(</span><span class="n">num_words</span><span class="o">=</span><span class="n">vocab_size</span><span class="p">,</span> <span class="n">oov_token</span><span class="o">=</span><span class="n">oov_tok</span><span class="p">)</span>
<a id="__codelineno-9-45" name="__codelineno-9-45"></a>
<a id="__codelineno-9-46" name="__codelineno-9-46"></a><span class="c1"># Generate the word index dictionary</span>
<a id="__codelineno-9-47" name="__codelineno-9-47"></a><span class="n">tokenizer</span><span class="o">.</span><span class="n">fit_on_texts</span><span class="p">(</span><span class="n">training_sentences</span><span class="p">)</span>
<a id="__codelineno-9-48" name="__codelineno-9-48"></a><span class="n">word_index</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">word_index</span>
<a id="__codelineno-9-49" name="__codelineno-9-49"></a>
<a id="__codelineno-9-50" name="__codelineno-9-50"></a><span class="c1"># Generate and pad the training sequences</span>
<a id="__codelineno-9-51" name="__codelineno-9-51"></a><span class="n">training_sequences</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">texts_to_sequences</span><span class="p">(</span><span class="n">training_sentences</span><span class="p">)</span>
<a id="__codelineno-9-52" name="__codelineno-9-52"></a><span class="n">training_padded</span> <span class="o">=</span> <span class="n">pad_sequences</span><span class="p">(</span><span class="n">training_sequences</span><span class="p">,</span> <span class="n">maxlen</span><span class="o">=</span><span class="n">max_length</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding_type</span><span class="p">,</span> <span class="n">truncating</span><span class="o">=</span><span class="n">trunc_type</span><span class="p">)</span>
<a id="__codelineno-9-53" name="__codelineno-9-53"></a>
<a id="__codelineno-9-54" name="__codelineno-9-54"></a><span class="c1"># Generate and pad the testing sequences</span>
<a id="__codelineno-9-55" name="__codelineno-9-55"></a><span class="n">testing_sequences</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">texts_to_sequences</span><span class="p">(</span><span class="n">testing_sentences</span><span class="p">)</span>
<a id="__codelineno-9-56" name="__codelineno-9-56"></a><span class="n">testing_padded</span> <span class="o">=</span> <span class="n">pad_sequences</span><span class="p">(</span><span class="n">testing_sequences</span><span class="p">,</span> <span class="n">maxlen</span><span class="o">=</span><span class="n">max_length</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding_type</span><span class="p">,</span> <span class="n">truncating</span><span class="o">=</span><span class="n">trunc_type</span><span class="p">)</span>
<a id="__codelineno-9-57" name="__codelineno-9-57"></a>
<a id="__codelineno-9-58" name="__codelineno-9-58"></a><span class="c1"># Convert the labels lists into numpy arrays</span>
<a id="__codelineno-9-59" name="__codelineno-9-59"></a><span class="n">training_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">training_labels</span><span class="p">)</span>
<a id="__codelineno-9-60" name="__codelineno-9-60"></a><span class="n">testing_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">testing_labels</span><span class="p">)</span>
<a id="__codelineno-9-61" name="__codelineno-9-61"></a>
<a id="__codelineno-9-62" name="__codelineno-9-62"></a><span class="c1">##### CREATE, COMPILE AND RUN MODEL #####</span>
<a id="__codelineno-9-63" name="__codelineno-9-63"></a><span class="c1"># Parameters</span>
<a id="__codelineno-9-64" name="__codelineno-9-64"></a><span class="n">embedding_dim</span> <span class="o">=</span> <span class="mi">16</span>
<a id="__codelineno-9-65" name="__codelineno-9-65"></a><span class="n">lstm_dim</span> <span class="o">=</span> <span class="mi">32</span>
<a id="__codelineno-9-66" name="__codelineno-9-66"></a><span class="n">dense_dim</span> <span class="o">=</span> <span class="mi">24</span>
<a id="__codelineno-9-67" name="__codelineno-9-67"></a>
<a id="__codelineno-9-68" name="__codelineno-9-68"></a><span class="c1"># Model Definition with LSTM</span>
<a id="__codelineno-9-69" name="__codelineno-9-69"></a><span class="n">model_lstm</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
<a id="__codelineno-9-70" name="__codelineno-9-70"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">vocab_size</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="p">,</span> <span class="n">input_length</span><span class="o">=</span><span class="n">max_length</span><span class="p">),</span>
<a id="__codelineno-9-71" name="__codelineno-9-71"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Bidirectional</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="n">lstm_dim</span><span class="p">)),</span>
<a id="__codelineno-9-72" name="__codelineno-9-72"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">dense_dim</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
<a id="__codelineno-9-73" name="__codelineno-9-73"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;sigmoid&#39;</span><span class="p">)</span>
<a id="__codelineno-9-74" name="__codelineno-9-74"></a><span class="p">])</span>
<a id="__codelineno-9-75" name="__codelineno-9-75"></a>
<a id="__codelineno-9-76" name="__codelineno-9-76"></a><span class="c1"># Set the training parameters</span>
<a id="__codelineno-9-77" name="__codelineno-9-77"></a><span class="n">model_lstm</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">&#39;binary_crossentropy&#39;</span><span class="p">,</span><span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span><span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">])</span>
<a id="__codelineno-9-78" name="__codelineno-9-78"></a>
<a id="__codelineno-9-79" name="__codelineno-9-79"></a><span class="c1"># Print the model summary</span>
<a id="__codelineno-9-80" name="__codelineno-9-80"></a><span class="n">model_lstm</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
<a id="__codelineno-9-81" name="__codelineno-9-81"></a>
<a id="__codelineno-9-82" name="__codelineno-9-82"></a><span class="n">NUM_EPOCHS</span> <span class="o">=</span> <span class="mi">10</span>
<a id="__codelineno-9-83" name="__codelineno-9-83"></a>
<a id="__codelineno-9-84" name="__codelineno-9-84"></a><span class="c1"># Train the model</span>
<a id="__codelineno-9-85" name="__codelineno-9-85"></a><span class="n">history_lstm</span> <span class="o">=</span> <span class="n">model_lstm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">training_padded</span><span class="p">,</span> <span class="n">training_labels</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="n">NUM_EPOCHS</span><span class="p">,</span> <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">testing_padded</span><span class="p">,</span> <span class="n">testing_labels</span><span class="p">))</span>
<a id="__codelineno-9-86" name="__codelineno-9-86"></a>
<a id="__codelineno-9-87" name="__codelineno-9-87"></a><span class="c1">##### EVALUATE DATA #####</span>
<a id="__codelineno-9-88" name="__codelineno-9-88"></a><span class="c1"># Plot Utility</span>
<a id="__codelineno-9-89" name="__codelineno-9-89"></a><span class="k">def</span> <span class="nf">plot_graphs</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
<a id="__codelineno-9-90" name="__codelineno-9-90"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="n">string</span><span class="p">])</span>
<a id="__codelineno-9-91" name="__codelineno-9-91"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;val_&#39;</span><span class="o">+</span><span class="n">string</span><span class="p">])</span>
<a id="__codelineno-9-92" name="__codelineno-9-92"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Epochs&quot;</span><span class="p">)</span>
<a id="__codelineno-9-93" name="__codelineno-9-93"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
<a id="__codelineno-9-94" name="__codelineno-9-94"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="n">string</span><span class="p">,</span> <span class="s1">&#39;val_&#39;</span><span class="o">+</span><span class="n">string</span><span class="p">])</span>
<a id="__codelineno-9-95" name="__codelineno-9-95"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<a id="__codelineno-9-96" name="__codelineno-9-96"></a>
<a id="__codelineno-9-97" name="__codelineno-9-97"></a><span class="c1"># Plot the accuracy and loss history</span>
<a id="__codelineno-9-98" name="__codelineno-9-98"></a><span class="n">plot_graphs</span><span class="p">(</span><span class="n">history_lstm</span><span class="p">,</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">)</span>
<a id="__codelineno-9-99" name="__codelineno-9-99"></a><span class="n">plot_graphs</span><span class="p">(</span><span class="n">history_lstm</span><span class="p">,</span> <span class="s1">&#39;loss&#39;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
</details>
<h3 id="lecture-6-sarcasm-with-1d-convolutional-layer">Lecture 6: Sarcasm with 1D Convolutional Layer</h3>
<details class="- success">
<summary>Lecture 6: Sarcasm with 1D Convolutional Layer</summary>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1">  1</a></span>
<span class="normal"><a href="#__codelineno-10-2">  2</a></span>
<span class="normal"><a href="#__codelineno-10-3">  3</a></span>
<span class="normal"><a href="#__codelineno-10-4">  4</a></span>
<span class="normal"><a href="#__codelineno-10-5">  5</a></span>
<span class="normal"><a href="#__codelineno-10-6">  6</a></span>
<span class="normal"><a href="#__codelineno-10-7">  7</a></span>
<span class="normal"><a href="#__codelineno-10-8">  8</a></span>
<span class="normal"><a href="#__codelineno-10-9">  9</a></span>
<span class="normal"><a href="#__codelineno-10-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-10-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-10-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-10-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-10-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-10-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-10-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-10-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-10-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-10-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-10-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-10-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-10-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-10-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-10-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-10-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-10-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-10-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-10-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-10-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-10-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-10-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-10-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-10-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-10-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-10-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-10-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-10-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-10-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-10-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-10-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-10-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-10-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-10-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-10-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-10-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-10-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-10-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-10-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-10-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-10-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-10-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-10-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-10-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-10-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-10-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-10-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-10-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-10-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-10-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-10-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-10-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-10-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-10-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-10-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-10-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-10-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-10-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-10-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-10-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-10-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-10-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-10-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-10-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-10-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-10-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-10-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-10-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-10-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-10-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-10-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-10-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-10-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-10-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-10-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-10-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-10-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-10-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-10-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-10-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-10-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-10-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-10-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-10-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-10-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-10-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-10-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-10-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-10-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-10-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-10-100">100</a></span>
<span class="normal"><a href="#__codelineno-10-101">101</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="kn">import</span> <span class="nn">json</span>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a>
<a id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<a id="__codelineno-10-6" name="__codelineno-10-6"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.preprocessing.text</span> <span class="kn">import</span> <span class="n">Tokenizer</span>
<a id="__codelineno-10-7" name="__codelineno-10-7"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.preprocessing.sequence</span> <span class="kn">import</span> <span class="n">pad_sequences</span>
<a id="__codelineno-10-8" name="__codelineno-10-8"></a>
<a id="__codelineno-10-9" name="__codelineno-10-9"></a><span class="c1">##### DOWNLOAD DATASET #####</span>
<a id="__codelineno-10-10" name="__codelineno-10-10"></a><span class="c1"># Download the dataset</span>
<a id="__codelineno-10-11" name="__codelineno-10-11"></a><span class="err">!</span><span class="n">gdown</span> <span class="o">--</span><span class="nb">id</span> <span class="mi">1</span><span class="n">xRU3xY5</span><span class="o">-</span><span class="n">tkiPGvlz5xBJ18_pHWSRzI4v</span>
<a id="__codelineno-10-12" name="__codelineno-10-12"></a>
<a id="__codelineno-10-13" name="__codelineno-10-13"></a><span class="c1"># Load the JSON file</span>
<a id="__codelineno-10-14" name="__codelineno-10-14"></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;./sarcasm.json&quot;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-10-15" name="__codelineno-10-15"></a>    <span class="n">datastore</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<a id="__codelineno-10-16" name="__codelineno-10-16"></a>
<a id="__codelineno-10-17" name="__codelineno-10-17"></a><span class="c1"># Initialize the lists</span>
<a id="__codelineno-10-18" name="__codelineno-10-18"></a><span class="n">sentences</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-10-19" name="__codelineno-10-19"></a><span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-10-20" name="__codelineno-10-20"></a>
<a id="__codelineno-10-21" name="__codelineno-10-21"></a><span class="c1"># Collect sentences and labels into the lists</span>
<a id="__codelineno-10-22" name="__codelineno-10-22"></a><span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">datastore</span><span class="p">:</span>
<a id="__codelineno-10-23" name="__codelineno-10-23"></a>    <span class="n">sentences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;headline&#39;</span><span class="p">])</span>
<a id="__codelineno-10-24" name="__codelineno-10-24"></a>    <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;is_sarcastic&#39;</span><span class="p">])</span>
<a id="__codelineno-10-25" name="__codelineno-10-25"></a>
<a id="__codelineno-10-26" name="__codelineno-10-26"></a><span class="n">training_size</span> <span class="o">=</span> <span class="mi">20000</span>
<a id="__codelineno-10-27" name="__codelineno-10-27"></a>
<a id="__codelineno-10-28" name="__codelineno-10-28"></a><span class="c1"># Split the sentences</span>
<a id="__codelineno-10-29" name="__codelineno-10-29"></a><span class="n">training_sentences</span> <span class="o">=</span> <span class="n">sentences</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">training_size</span><span class="p">]</span>
<a id="__codelineno-10-30" name="__codelineno-10-30"></a><span class="n">testing_sentences</span> <span class="o">=</span> <span class="n">sentences</span><span class="p">[</span><span class="n">training_size</span><span class="p">:]</span>
<a id="__codelineno-10-31" name="__codelineno-10-31"></a>
<a id="__codelineno-10-32" name="__codelineno-10-32"></a><span class="c1"># Split the labels</span>
<a id="__codelineno-10-33" name="__codelineno-10-33"></a><span class="n">training_labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">training_size</span><span class="p">]</span>
<a id="__codelineno-10-34" name="__codelineno-10-34"></a><span class="n">testing_labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">training_size</span><span class="p">:]</span>
<a id="__codelineno-10-35" name="__codelineno-10-35"></a>
<a id="__codelineno-10-36" name="__codelineno-10-36"></a><span class="c1">##### PREPROCESS DATA #####</span>
<a id="__codelineno-10-37" name="__codelineno-10-37"></a><span class="n">vocab_size</span> <span class="o">=</span> <span class="mi">10000</span>
<a id="__codelineno-10-38" name="__codelineno-10-38"></a><span class="n">max_length</span> <span class="o">=</span> <span class="mi">120</span>
<a id="__codelineno-10-39" name="__codelineno-10-39"></a><span class="n">trunc_type</span><span class="o">=</span><span class="s1">&#39;post&#39;</span>
<a id="__codelineno-10-40" name="__codelineno-10-40"></a><span class="n">padding_type</span><span class="o">=</span><span class="s1">&#39;post&#39;</span>
<a id="__codelineno-10-41" name="__codelineno-10-41"></a><span class="n">oov_tok</span> <span class="o">=</span> <span class="s2">&quot;&lt;OOV&gt;&quot;</span>
<a id="__codelineno-10-42" name="__codelineno-10-42"></a>
<a id="__codelineno-10-43" name="__codelineno-10-43"></a><span class="c1"># Initialize the Tokenizer class</span>
<a id="__codelineno-10-44" name="__codelineno-10-44"></a><span class="n">tokenizer</span> <span class="o">=</span> <span class="n">Tokenizer</span><span class="p">(</span><span class="n">num_words</span><span class="o">=</span><span class="n">vocab_size</span><span class="p">,</span> <span class="n">oov_token</span><span class="o">=</span><span class="n">oov_tok</span><span class="p">)</span>
<a id="__codelineno-10-45" name="__codelineno-10-45"></a>
<a id="__codelineno-10-46" name="__codelineno-10-46"></a><span class="c1"># Generate the word index dictionary</span>
<a id="__codelineno-10-47" name="__codelineno-10-47"></a><span class="n">tokenizer</span><span class="o">.</span><span class="n">fit_on_texts</span><span class="p">(</span><span class="n">training_sentences</span><span class="p">)</span>
<a id="__codelineno-10-48" name="__codelineno-10-48"></a><span class="n">word_index</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">word_index</span>
<a id="__codelineno-10-49" name="__codelineno-10-49"></a>
<a id="__codelineno-10-50" name="__codelineno-10-50"></a><span class="c1"># Generate and pad the training sequences</span>
<a id="__codelineno-10-51" name="__codelineno-10-51"></a><span class="n">training_sequences</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">texts_to_sequences</span><span class="p">(</span><span class="n">training_sentences</span><span class="p">)</span>
<a id="__codelineno-10-52" name="__codelineno-10-52"></a><span class="n">training_padded</span> <span class="o">=</span> <span class="n">pad_sequences</span><span class="p">(</span><span class="n">training_sequences</span><span class="p">,</span> <span class="n">maxlen</span><span class="o">=</span><span class="n">max_length</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding_type</span><span class="p">,</span> <span class="n">truncating</span><span class="o">=</span><span class="n">trunc_type</span><span class="p">)</span>
<a id="__codelineno-10-53" name="__codelineno-10-53"></a>
<a id="__codelineno-10-54" name="__codelineno-10-54"></a><span class="c1"># Generate and pad the testing sequences</span>
<a id="__codelineno-10-55" name="__codelineno-10-55"></a><span class="n">testing_sequences</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">texts_to_sequences</span><span class="p">(</span><span class="n">testing_sentences</span><span class="p">)</span>
<a id="__codelineno-10-56" name="__codelineno-10-56"></a><span class="n">testing_padded</span> <span class="o">=</span> <span class="n">pad_sequences</span><span class="p">(</span><span class="n">testing_sequences</span><span class="p">,</span> <span class="n">maxlen</span><span class="o">=</span><span class="n">max_length</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding_type</span><span class="p">,</span> <span class="n">truncating</span><span class="o">=</span><span class="n">trunc_type</span><span class="p">)</span>
<a id="__codelineno-10-57" name="__codelineno-10-57"></a>
<a id="__codelineno-10-58" name="__codelineno-10-58"></a><span class="c1"># Convert the labels lists into numpy arrays</span>
<a id="__codelineno-10-59" name="__codelineno-10-59"></a><span class="n">training_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">training_labels</span><span class="p">)</span>
<a id="__codelineno-10-60" name="__codelineno-10-60"></a><span class="n">testing_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">testing_labels</span><span class="p">)</span>
<a id="__codelineno-10-61" name="__codelineno-10-61"></a>
<a id="__codelineno-10-62" name="__codelineno-10-62"></a><span class="c1">##### CREATE, COMPILE AND RUN MODEL #####</span>
<a id="__codelineno-10-63" name="__codelineno-10-63"></a><span class="c1"># Parameters</span>
<a id="__codelineno-10-64" name="__codelineno-10-64"></a><span class="n">embedding_dim</span> <span class="o">=</span> <span class="mi">16</span>
<a id="__codelineno-10-65" name="__codelineno-10-65"></a><span class="n">filters</span> <span class="o">=</span> <span class="mi">128</span>
<a id="__codelineno-10-66" name="__codelineno-10-66"></a><span class="n">kernel_size</span> <span class="o">=</span> <span class="mi">5</span>
<a id="__codelineno-10-67" name="__codelineno-10-67"></a><span class="n">dense_dim</span> <span class="o">=</span> <span class="mi">6</span>
<a id="__codelineno-10-68" name="__codelineno-10-68"></a>
<a id="__codelineno-10-69" name="__codelineno-10-69"></a><span class="c1"># Model Definition with Conv1D</span>
<a id="__codelineno-10-70" name="__codelineno-10-70"></a><span class="n">model_conv</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
<a id="__codelineno-10-71" name="__codelineno-10-71"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">vocab_size</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="p">,</span> <span class="n">input_length</span><span class="o">=</span><span class="n">max_length</span><span class="p">),</span>
<a id="__codelineno-10-72" name="__codelineno-10-72"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Conv1D</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span> <span class="n">kernel_size</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
<a id="__codelineno-10-73" name="__codelineno-10-73"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">GlobalMaxPooling1D</span><span class="p">(),</span>
<a id="__codelineno-10-74" name="__codelineno-10-74"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">dense_dim</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
<a id="__codelineno-10-75" name="__codelineno-10-75"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;sigmoid&#39;</span><span class="p">)</span>
<a id="__codelineno-10-76" name="__codelineno-10-76"></a><span class="p">])</span>
<a id="__codelineno-10-77" name="__codelineno-10-77"></a>
<a id="__codelineno-10-78" name="__codelineno-10-78"></a><span class="c1"># Set the training parameters</span>
<a id="__codelineno-10-79" name="__codelineno-10-79"></a><span class="n">model_conv</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">&#39;binary_crossentropy&#39;</span><span class="p">,</span><span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span><span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">])</span>
<a id="__codelineno-10-80" name="__codelineno-10-80"></a>
<a id="__codelineno-10-81" name="__codelineno-10-81"></a><span class="c1"># Print the model summary</span>
<a id="__codelineno-10-82" name="__codelineno-10-82"></a><span class="n">model_conv</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
<a id="__codelineno-10-83" name="__codelineno-10-83"></a>
<a id="__codelineno-10-84" name="__codelineno-10-84"></a><span class="n">NUM_EPOCHS</span> <span class="o">=</span> <span class="mi">10</span>
<a id="__codelineno-10-85" name="__codelineno-10-85"></a>
<a id="__codelineno-10-86" name="__codelineno-10-86"></a><span class="c1"># Train the model</span>
<a id="__codelineno-10-87" name="__codelineno-10-87"></a><span class="n">history_conv</span> <span class="o">=</span> <span class="n">model_conv</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">training_padded</span><span class="p">,</span> <span class="n">training_labels</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="n">NUM_EPOCHS</span><span class="p">,</span> <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">testing_padded</span><span class="p">,</span> <span class="n">testing_labels</span><span class="p">))</span>
<a id="__codelineno-10-88" name="__codelineno-10-88"></a>
<a id="__codelineno-10-89" name="__codelineno-10-89"></a><span class="c1">##### EVALUATE DATA #####</span>
<a id="__codelineno-10-90" name="__codelineno-10-90"></a><span class="c1"># Plot Utility</span>
<a id="__codelineno-10-91" name="__codelineno-10-91"></a><span class="k">def</span> <span class="nf">plot_graphs</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
<a id="__codelineno-10-92" name="__codelineno-10-92"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="n">string</span><span class="p">])</span>
<a id="__codelineno-10-93" name="__codelineno-10-93"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;val_&#39;</span><span class="o">+</span><span class="n">string</span><span class="p">])</span>
<a id="__codelineno-10-94" name="__codelineno-10-94"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Epochs&quot;</span><span class="p">)</span>
<a id="__codelineno-10-95" name="__codelineno-10-95"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
<a id="__codelineno-10-96" name="__codelineno-10-96"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="n">string</span><span class="p">,</span> <span class="s1">&#39;val_&#39;</span><span class="o">+</span><span class="n">string</span><span class="p">])</span>
<a id="__codelineno-10-97" name="__codelineno-10-97"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<a id="__codelineno-10-98" name="__codelineno-10-98"></a>
<a id="__codelineno-10-99" name="__codelineno-10-99"></a><span class="c1"># Plot the accuracy and loss history</span>
<a id="__codelineno-10-100" name="__codelineno-10-100"></a><span class="n">plot_graphs</span><span class="p">(</span><span class="n">history_conv</span><span class="p">,</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">)</span>
<a id="__codelineno-10-101" name="__codelineno-10-101"></a><span class="n">plot_graphs</span><span class="p">(</span><span class="n">history_conv</span><span class="p">,</span> <span class="s1">&#39;loss&#39;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
</details>
<h3 id="exercise-overfitting-in-nlp">Exercise: Overfitting in NLP</h3>
<p><strong>Assignment:</strong> Create an NLP model on a large dataset</p>
<details class="- success">
<summary>Final code for the exercise</summary>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1">  1</a></span>
<span class="normal"><a href="#__codelineno-11-2">  2</a></span>
<span class="normal"><a href="#__codelineno-11-3">  3</a></span>
<span class="normal"><a href="#__codelineno-11-4">  4</a></span>
<span class="normal"><a href="#__codelineno-11-5">  5</a></span>
<span class="normal"><a href="#__codelineno-11-6">  6</a></span>
<span class="normal"><a href="#__codelineno-11-7">  7</a></span>
<span class="normal"><a href="#__codelineno-11-8">  8</a></span>
<span class="normal"><a href="#__codelineno-11-9">  9</a></span>
<span class="normal"><a href="#__codelineno-11-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-11-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-11-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-11-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-11-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-11-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-11-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-11-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-11-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-11-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-11-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-11-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-11-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-11-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-11-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-11-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-11-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-11-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-11-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-11-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-11-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-11-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-11-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-11-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-11-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-11-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-11-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-11-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-11-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-11-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-11-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-11-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-11-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-11-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-11-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-11-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-11-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-11-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-11-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-11-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-11-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-11-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-11-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-11-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-11-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-11-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-11-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-11-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-11-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-11-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-11-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-11-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-11-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-11-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-11-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-11-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-11-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-11-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-11-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-11-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-11-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-11-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-11-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-11-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-11-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-11-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-11-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-11-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-11-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-11-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-11-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-11-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-11-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-11-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-11-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-11-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-11-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-11-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-11-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-11-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-11-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-11-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-11-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-11-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-11-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-11-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-11-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-11-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-11-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-11-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-11-100">100</a></span>
<span class="normal"><a href="#__codelineno-11-101">101</a></span>
<span class="normal"><a href="#__codelineno-11-102">102</a></span>
<span class="normal"><a href="#__codelineno-11-103">103</a></span>
<span class="normal"><a href="#__codelineno-11-104">104</a></span>
<span class="normal"><a href="#__codelineno-11-105">105</a></span>
<span class="normal"><a href="#__codelineno-11-106">106</a></span>
<span class="normal"><a href="#__codelineno-11-107">107</a></span>
<span class="normal"><a href="#__codelineno-11-108">108</a></span>
<span class="normal"><a href="#__codelineno-11-109">109</a></span>
<span class="normal"><a href="#__codelineno-11-110">110</a></span>
<span class="normal"><a href="#__codelineno-11-111">111</a></span>
<span class="normal"><a href="#__codelineno-11-112">112</a></span>
<span class="normal"><a href="#__codelineno-11-113">113</a></span>
<span class="normal"><a href="#__codelineno-11-114">114</a></span>
<span class="normal"><a href="#__codelineno-11-115">115</a></span>
<span class="normal"><a href="#__codelineno-11-116">116</a></span>
<span class="normal"><a href="#__codelineno-11-117">117</a></span>
<span class="normal"><a href="#__codelineno-11-118">118</a></span>
<span class="normal"><a href="#__codelineno-11-119">119</a></span>
<span class="normal"><a href="#__codelineno-11-120">120</a></span>
<span class="normal"><a href="#__codelineno-11-121">121</a></span>
<span class="normal"><a href="#__codelineno-11-122">122</a></span>
<span class="normal"><a href="#__codelineno-11-123">123</a></span>
<span class="normal"><a href="#__codelineno-11-124">124</a></span>
<span class="normal"><a href="#__codelineno-11-125">125</a></span>
<span class="normal"><a href="#__codelineno-11-126">126</a></span>
<span class="normal"><a href="#__codelineno-11-127">127</a></span>
<span class="normal"><a href="#__codelineno-11-128">128</a></span>
<span class="normal"><a href="#__codelineno-11-129">129</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="kn">import</span> <span class="nn">json</span>
<a id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<a id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="kn">import</span> <span class="nn">csv</span>
<a id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="kn">import</span> <span class="nn">random</span>
<a id="__codelineno-11-5" name="__codelineno-11-5"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a id="__codelineno-11-6" name="__codelineno-11-6"></a>
<a id="__codelineno-11-7" name="__codelineno-11-7"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.preprocessing.text</span> <span class="kn">import</span> <span class="n">Tokenizer</span>
<a id="__codelineno-11-8" name="__codelineno-11-8"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.preprocessing.sequence</span> <span class="kn">import</span> <span class="n">pad_sequences</span>
<a id="__codelineno-11-9" name="__codelineno-11-9"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.utils</span> <span class="kn">import</span> <span class="n">to_categorical</span>
<a id="__codelineno-11-10" name="__codelineno-11-10"></a><span class="kn">from</span> <span class="nn">tensorflow.keras</span> <span class="kn">import</span> <span class="n">regularizers</span>
<a id="__codelineno-11-11" name="__codelineno-11-11"></a>
<a id="__codelineno-11-12" name="__codelineno-11-12"></a>
<a id="__codelineno-11-13" name="__codelineno-11-13"></a><span class="n">embedding_dim</span> <span class="o">=</span> <span class="mi">100</span>
<a id="__codelineno-11-14" name="__codelineno-11-14"></a><span class="n">max_length</span> <span class="o">=</span> <span class="mi">16</span>
<a id="__codelineno-11-15" name="__codelineno-11-15"></a><span class="n">trunc_type</span><span class="o">=</span><span class="s1">&#39;post&#39;</span>
<a id="__codelineno-11-16" name="__codelineno-11-16"></a><span class="n">padding_type</span><span class="o">=</span><span class="s1">&#39;post&#39;</span>
<a id="__codelineno-11-17" name="__codelineno-11-17"></a><span class="n">oov_tok</span> <span class="o">=</span> <span class="s2">&quot;&lt;OOV&gt;&quot;</span>
<a id="__codelineno-11-18" name="__codelineno-11-18"></a><span class="n">training_size</span><span class="o">=</span><span class="mi">160000</span>
<a id="__codelineno-11-19" name="__codelineno-11-19"></a><span class="n">test_portion</span><span class="o">=</span><span class="mf">.1</span>
<a id="__codelineno-11-20" name="__codelineno-11-20"></a>
<a id="__codelineno-11-21" name="__codelineno-11-21"></a><span class="n">corpus</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-11-22" name="__codelineno-11-22"></a>
<a id="__codelineno-11-23" name="__codelineno-11-23"></a><span class="c1"># training_cleaned.csv</span>
<a id="__codelineno-11-24" name="__codelineno-11-24"></a><span class="err">!</span><span class="n">gdown</span> <span class="o">--</span><span class="nb">id</span> <span class="mi">1</span><span class="n">wd8KaeCSHxt</span><span class="o">-</span><span class="n">nEpMeuHFSNWrDp8joUXJ</span>
<a id="__codelineno-11-25" name="__codelineno-11-25"></a>
<a id="__codelineno-11-26" name="__codelineno-11-26"></a><span class="n">num_sentences</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-11-27" name="__codelineno-11-27"></a>
<a id="__codelineno-11-28" name="__codelineno-11-28"></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;./training_cleaned.csv&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
<a id="__codelineno-11-29" name="__codelineno-11-29"></a>    <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
<a id="__codelineno-11-30" name="__codelineno-11-30"></a>    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
<a id="__codelineno-11-31" name="__codelineno-11-31"></a>        <span class="n">list_item</span><span class="o">=</span><span class="p">[]</span>
<a id="__codelineno-11-32" name="__codelineno-11-32"></a>        <span class="c1"># START CODE HERE</span>
<a id="__codelineno-11-33" name="__codelineno-11-33"></a>        <span class="n">list_item</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
<a id="__codelineno-11-34" name="__codelineno-11-34"></a>        <span class="n">this_label</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-11-35" name="__codelineno-11-35"></a>        <span class="k">if</span> <span class="n">this_label</span><span class="o">==</span><span class="s1">&#39;0&#39;</span><span class="p">:</span>
<a id="__codelineno-11-36" name="__codelineno-11-36"></a>            <span class="n">list_item</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-11-37" name="__codelineno-11-37"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-11-38" name="__codelineno-11-38"></a>            <span class="n">list_item</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-11-39" name="__codelineno-11-39"></a>        <span class="c1"># END CODE HERE</span>
<a id="__codelineno-11-40" name="__codelineno-11-40"></a>        <span class="n">num_sentences</span> <span class="o">=</span> <span class="n">num_sentences</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-11-41" name="__codelineno-11-41"></a>        <span class="n">corpus</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">list_item</span><span class="p">)</span>
<a id="__codelineno-11-42" name="__codelineno-11-42"></a>
<a id="__codelineno-11-43" name="__codelineno-11-43"></a><span class="nb">print</span><span class="p">(</span><span class="n">num_sentences</span><span class="p">)</span>
<a id="__codelineno-11-44" name="__codelineno-11-44"></a><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">corpus</span><span class="p">))</span>
<a id="__codelineno-11-45" name="__codelineno-11-45"></a><span class="nb">print</span><span class="p">(</span><span class="n">corpus</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-11-46" name="__codelineno-11-46"></a>
<a id="__codelineno-11-47" name="__codelineno-11-47"></a><span class="n">sentences</span><span class="o">=</span><span class="p">[]</span>
<a id="__codelineno-11-48" name="__codelineno-11-48"></a><span class="n">labels</span><span class="o">=</span><span class="p">[]</span>
<a id="__codelineno-11-49" name="__codelineno-11-49"></a><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">corpus</span><span class="p">)</span>
<a id="__codelineno-11-50" name="__codelineno-11-50"></a><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">training_size</span><span class="p">):</span>
<a id="__codelineno-11-51" name="__codelineno-11-51"></a>    <span class="n">sentences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">corpus</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># IN-LINE CODE HERE</span>
<a id="__codelineno-11-52" name="__codelineno-11-52"></a>    <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">corpus</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># IN-LINE CODE HERE</span>
<a id="__codelineno-11-53" name="__codelineno-11-53"></a>
<a id="__codelineno-11-54" name="__codelineno-11-54"></a>
<a id="__codelineno-11-55" name="__codelineno-11-55"></a><span class="n">tokenizer</span> <span class="o">=</span> <span class="n">Tokenizer</span><span class="p">()</span>
<a id="__codelineno-11-56" name="__codelineno-11-56"></a><span class="n">tokenizer</span><span class="o">.</span><span class="n">fit_on_texts</span><span class="p">(</span><span class="n">sentences</span><span class="p">)</span> <span class="c1"># IN-LINE CODE HERE</span>
<a id="__codelineno-11-57" name="__codelineno-11-57"></a>
<a id="__codelineno-11-58" name="__codelineno-11-58"></a><span class="n">word_index</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">word_index</span>
<a id="__codelineno-11-59" name="__codelineno-11-59"></a><span class="n">vocab_size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">word_index</span><span class="p">)</span> <span class="c1"># IN-LINE CODE HERE</span>
<a id="__codelineno-11-60" name="__codelineno-11-60"></a>
<a id="__codelineno-11-61" name="__codelineno-11-61"></a><span class="n">sequences</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">texts_to_sequences</span><span class="p">(</span><span class="n">sentences</span><span class="p">)</span> <span class="c1"># IN-LINE CODE HERE</span>
<a id="__codelineno-11-62" name="__codelineno-11-62"></a><span class="n">padded</span> <span class="o">=</span> <span class="n">pad_sequences</span><span class="p">(</span>
<a id="__codelineno-11-63" name="__codelineno-11-63"></a>    <span class="c1"># START CODE HERE</span>
<a id="__codelineno-11-64" name="__codelineno-11-64"></a>    <span class="n">sequences</span><span class="p">,</span> 
<a id="__codelineno-11-65" name="__codelineno-11-65"></a>    <span class="n">maxlen</span><span class="o">=</span><span class="n">max_length</span><span class="p">,</span> 
<a id="__codelineno-11-66" name="__codelineno-11-66"></a>    <span class="n">padding</span><span class="o">=</span><span class="n">padding_type</span><span class="p">,</span> 
<a id="__codelineno-11-67" name="__codelineno-11-67"></a>    <span class="n">truncating</span><span class="o">=</span><span class="n">trunc_type</span><span class="p">)</span>
<a id="__codelineno-11-68" name="__codelineno-11-68"></a>    <span class="c1"># END CODE HERE</span>
<a id="__codelineno-11-69" name="__codelineno-11-69"></a>
<a id="__codelineno-11-70" name="__codelineno-11-70"></a><span class="n">split</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">test_portion</span> <span class="o">*</span> <span class="n">training_size</span><span class="p">)</span>
<a id="__codelineno-11-71" name="__codelineno-11-71"></a>
<a id="__codelineno-11-72" name="__codelineno-11-72"></a><span class="n">test_sequences</span> <span class="o">=</span> <span class="n">padded</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">split</span><span class="p">]</span> <span class="c1"># IN-LINE CODE HERE</span>
<a id="__codelineno-11-73" name="__codelineno-11-73"></a><span class="n">training_sequences</span> <span class="o">=</span> <span class="n">padded</span><span class="p">[</span><span class="n">split</span><span class="p">:</span><span class="n">training_size</span><span class="p">]</span> <span class="c1"># IN-LINE CODE HERE</span>
<a id="__codelineno-11-74" name="__codelineno-11-74"></a><span class="n">test_labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">split</span><span class="p">]</span> <span class="c1"># IN-LINE CODE HERE</span>
<a id="__codelineno-11-75" name="__codelineno-11-75"></a><span class="n">training_labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">split</span><span class="p">:</span><span class="n">training_size</span><span class="p">]</span> <span class="c1"># IN-LINE CODE HERE</span>
<a id="__codelineno-11-76" name="__codelineno-11-76"></a>
<a id="__codelineno-11-77" name="__codelineno-11-77"></a><span class="c1"># glove.6B.100d.txt</span>
<a id="__codelineno-11-78" name="__codelineno-11-78"></a><span class="err">!</span><span class="n">gdown</span> <span class="o">--</span><span class="nb">id</span> <span class="mi">1</span><span class="n">W5vZy2etitAblLdFn8_DxnsQKzfFJ98g</span>
<a id="__codelineno-11-79" name="__codelineno-11-79"></a>
<a id="__codelineno-11-80" name="__codelineno-11-80"></a><span class="n">embeddings_index</span> <span class="o">=</span> <span class="p">{};</span>
<a id="__codelineno-11-81" name="__codelineno-11-81"></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./glove.6B.100d.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-11-82" name="__codelineno-11-82"></a>    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-11-83" name="__codelineno-11-83"></a>        <span class="n">values</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<a id="__codelineno-11-84" name="__codelineno-11-84"></a>        <span class="n">word</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-11-85" name="__codelineno-11-85"></a>        <span class="n">coefs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
<a id="__codelineno-11-86" name="__codelineno-11-86"></a>        <span class="n">embeddings_index</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">=</span> <span class="n">coefs</span>
<a id="__codelineno-11-87" name="__codelineno-11-87"></a>
<a id="__codelineno-11-88" name="__codelineno-11-88"></a><span class="n">embeddings_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">vocab_size</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="p">))</span>
<a id="__codelineno-11-89" name="__codelineno-11-89"></a>
<a id="__codelineno-11-90" name="__codelineno-11-90"></a><span class="k">for</span> <span class="n">word</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">word_index</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-11-91" name="__codelineno-11-91"></a>    <span class="n">embedding_vector</span> <span class="o">=</span> <span class="n">embeddings_index</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
<a id="__codelineno-11-92" name="__codelineno-11-92"></a>    <span class="k">if</span> <span class="n">embedding_vector</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-11-93" name="__codelineno-11-93"></a>        <span class="n">embeddings_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">embedding_vector</span>
<a id="__codelineno-11-94" name="__codelineno-11-94"></a>
<a id="__codelineno-11-95" name="__codelineno-11-95"></a><span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
<a id="__codelineno-11-96" name="__codelineno-11-96"></a>    <span class="c1"># START CODE HERE</span>
<a id="__codelineno-11-97" name="__codelineno-11-97"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">vocab_size</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> 
<a id="__codelineno-11-98" name="__codelineno-11-98"></a>                              <span class="n">embedding_dim</span><span class="p">,</span> 
<a id="__codelineno-11-99" name="__codelineno-11-99"></a>                              <span class="n">input_length</span><span class="o">=</span><span class="n">max_length</span><span class="p">,</span> 
<a id="__codelineno-11-100" name="__codelineno-11-100"></a>                              <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="n">embeddings_matrix</span><span class="p">],</span> 
<a id="__codelineno-11-101" name="__codelineno-11-101"></a>                              <span class="n">trainable</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
<a id="__codelineno-11-102" name="__codelineno-11-102"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">),</span>
<a id="__codelineno-11-103" name="__codelineno-11-103"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Conv1D</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
<a id="__codelineno-11-104" name="__codelineno-11-104"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">MaxPooling1D</span><span class="p">(</span><span class="n">pool_size</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span>
<a id="__codelineno-11-105" name="__codelineno-11-105"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">64</span><span class="p">),</span>
<a id="__codelineno-11-106" name="__codelineno-11-106"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;sigmoid&#39;</span><span class="p">)</span>
<a id="__codelineno-11-107" name="__codelineno-11-107"></a>    <span class="c1"># END CODE HERE</span>
<a id="__codelineno-11-108" name="__codelineno-11-108"></a><span class="p">])</span>
<a id="__codelineno-11-109" name="__codelineno-11-109"></a><span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
<a id="__codelineno-11-110" name="__codelineno-11-110"></a>    <span class="c1"># START CODE HERE</span>
<a id="__codelineno-11-111" name="__codelineno-11-111"></a>    <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;binary_crossentropy&#39;</span><span class="p">,</span>
<a id="__codelineno-11-112" name="__codelineno-11-112"></a>    <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span>
<a id="__codelineno-11-113" name="__codelineno-11-113"></a>    <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">])</span>
<a id="__codelineno-11-114" name="__codelineno-11-114"></a>    <span class="c1"># END CODE HERE</span>
<a id="__codelineno-11-115" name="__codelineno-11-115"></a><span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
<a id="__codelineno-11-116" name="__codelineno-11-116"></a>
<a id="__codelineno-11-117" name="__codelineno-11-117"></a><span class="n">num_epochs</span> <span class="o">=</span> <span class="mi">50</span>
<a id="__codelineno-11-118" name="__codelineno-11-118"></a>
<a id="__codelineno-11-119" name="__codelineno-11-119"></a><span class="n">training_padded</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">training_sequences</span><span class="p">)</span>
<a id="__codelineno-11-120" name="__codelineno-11-120"></a><span class="n">training_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">training_labels</span><span class="p">)</span>
<a id="__codelineno-11-121" name="__codelineno-11-121"></a><span class="n">testing_padded</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">test_sequences</span><span class="p">)</span>
<a id="__codelineno-11-122" name="__codelineno-11-122"></a><span class="n">testing_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">test_labels</span><span class="p">)</span>
<a id="__codelineno-11-123" name="__codelineno-11-123"></a>
<a id="__codelineno-11-124" name="__codelineno-11-124"></a><span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">training_padded</span><span class="p">,</span> 
<a id="__codelineno-11-125" name="__codelineno-11-125"></a>                    <span class="n">training_labels</span><span class="p">,</span> 
<a id="__codelineno-11-126" name="__codelineno-11-126"></a>                    <span class="n">epochs</span><span class="o">=</span><span class="n">num_epochs</span><span class="p">,</span> 
<a id="__codelineno-11-127" name="__codelineno-11-127"></a>                    <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">testing_padded</span><span class="p">,</span> 
<a id="__codelineno-11-128" name="__codelineno-11-128"></a>                                     <span class="n">testing_labels</span><span class="p">),</span> 
<a id="__codelineno-11-129" name="__codelineno-11-129"></a>                    <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
</details>
<p><a name="week-4"></a></p>
<h2 id="week-4-sequence-models-and-literature"><strong>Week 4: Sequence models and literature</strong></h2>
<p>This week will use all the knowledge from the previous weeks to train an ml model and use the model to create poetry. 
In other words, the model will use the previous word(s) to predict the next word. By doing so, the model can pretend 
if it were writing.</p>
<h3 id="lecture-code-1-create-texts-using-ml-from-simple-texts">Lecture Code 1: Create Texts using ML from Simple Texts</h3>
<details class="- success">
<summary>Lecture Code 1: Create Texts using ML from Simple Texts</summary>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-12-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-12-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-12-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-12-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-12-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-12-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-12-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-12-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-12-10">10</a></span>
<span class="normal"><a href="#__codelineno-12-11">11</a></span>
<span class="normal"><a href="#__codelineno-12-12">12</a></span>
<span class="normal"><a href="#__codelineno-12-13">13</a></span>
<span class="normal"><a href="#__codelineno-12-14">14</a></span>
<span class="normal"><a href="#__codelineno-12-15">15</a></span>
<span class="normal"><a href="#__codelineno-12-16">16</a></span>
<span class="normal"><a href="#__codelineno-12-17">17</a></span>
<span class="normal"><a href="#__codelineno-12-18">18</a></span>
<span class="normal"><a href="#__codelineno-12-19">19</a></span>
<span class="normal"><a href="#__codelineno-12-20">20</a></span>
<span class="normal"><a href="#__codelineno-12-21">21</a></span>
<span class="normal"><a href="#__codelineno-12-22">22</a></span>
<span class="normal"><a href="#__codelineno-12-23">23</a></span>
<span class="normal"><a href="#__codelineno-12-24">24</a></span>
<span class="normal"><a href="#__codelineno-12-25">25</a></span>
<span class="normal"><a href="#__codelineno-12-26">26</a></span>
<span class="normal"><a href="#__codelineno-12-27">27</a></span>
<span class="normal"><a href="#__codelineno-12-28">28</a></span>
<span class="normal"><a href="#__codelineno-12-29">29</a></span>
<span class="normal"><a href="#__codelineno-12-30">30</a></span>
<span class="normal"><a href="#__codelineno-12-31">31</a></span>
<span class="normal"><a href="#__codelineno-12-32">32</a></span>
<span class="normal"><a href="#__codelineno-12-33">33</a></span>
<span class="normal"><a href="#__codelineno-12-34">34</a></span>
<span class="normal"><a href="#__codelineno-12-35">35</a></span>
<span class="normal"><a href="#__codelineno-12-36">36</a></span>
<span class="normal"><a href="#__codelineno-12-37">37</a></span>
<span class="normal"><a href="#__codelineno-12-38">38</a></span>
<span class="normal"><a href="#__codelineno-12-39">39</a></span>
<span class="normal"><a href="#__codelineno-12-40">40</a></span>
<span class="normal"><a href="#__codelineno-12-41">41</a></span>
<span class="normal"><a href="#__codelineno-12-42">42</a></span>
<span class="normal"><a href="#__codelineno-12-43">43</a></span>
<span class="normal"><a href="#__codelineno-12-44">44</a></span>
<span class="normal"><a href="#__codelineno-12-45">45</a></span>
<span class="normal"><a href="#__codelineno-12-46">46</a></span>
<span class="normal"><a href="#__codelineno-12-47">47</a></span>
<span class="normal"><a href="#__codelineno-12-48">48</a></span>
<span class="normal"><a href="#__codelineno-12-49">49</a></span>
<span class="normal"><a href="#__codelineno-12-50">50</a></span>
<span class="normal"><a href="#__codelineno-12-51">51</a></span>
<span class="normal"><a href="#__codelineno-12-52">52</a></span>
<span class="normal"><a href="#__codelineno-12-53">53</a></span>
<span class="normal"><a href="#__codelineno-12-54">54</a></span>
<span class="normal"><a href="#__codelineno-12-55">55</a></span>
<span class="normal"><a href="#__codelineno-12-56">56</a></span>
<span class="normal"><a href="#__codelineno-12-57">57</a></span>
<span class="normal"><a href="#__codelineno-12-58">58</a></span>
<span class="normal"><a href="#__codelineno-12-59">59</a></span>
<span class="normal"><a href="#__codelineno-12-60">60</a></span>
<span class="normal"><a href="#__codelineno-12-61">61</a></span>
<span class="normal"><a href="#__codelineno-12-62">62</a></span>
<span class="normal"><a href="#__codelineno-12-63">63</a></span>
<span class="normal"><a href="#__codelineno-12-64">64</a></span>
<span class="normal"><a href="#__codelineno-12-65">65</a></span>
<span class="normal"><a href="#__codelineno-12-66">66</a></span>
<span class="normal"><a href="#__codelineno-12-67">67</a></span>
<span class="normal"><a href="#__codelineno-12-68">68</a></span>
<span class="normal"><a href="#__codelineno-12-69">69</a></span>
<span class="normal"><a href="#__codelineno-12-70">70</a></span>
<span class="normal"><a href="#__codelineno-12-71">71</a></span>
<span class="normal"><a href="#__codelineno-12-72">72</a></span>
<span class="normal"><a href="#__codelineno-12-73">73</a></span>
<span class="normal"><a href="#__codelineno-12-74">74</a></span>
<span class="normal"><a href="#__codelineno-12-75">75</a></span>
<span class="normal"><a href="#__codelineno-12-76">76</a></span>
<span class="normal"><a href="#__codelineno-12-77">77</a></span>
<span class="normal"><a href="#__codelineno-12-78">78</a></span>
<span class="normal"><a href="#__codelineno-12-79">79</a></span>
<span class="normal"><a href="#__codelineno-12-80">80</a></span>
<span class="normal"><a href="#__codelineno-12-81">81</a></span>
<span class="normal"><a href="#__codelineno-12-82">82</a></span>
<span class="normal"><a href="#__codelineno-12-83">83</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a>
<a id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.preprocessing.sequence</span> <span class="kn">import</span> <span class="n">pad_sequences</span>
<a id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">Embedding</span><span class="p">,</span> <span class="n">LSTM</span><span class="p">,</span> <span class="n">Dense</span><span class="p">,</span> <span class="n">Bidirectional</span>
<a id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.preprocessing.text</span> <span class="kn">import</span> <span class="n">Tokenizer</span>
<a id="__codelineno-12-6" name="__codelineno-12-6"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.models</span> <span class="kn">import</span> <span class="n">Sequential</span>
<a id="__codelineno-12-7" name="__codelineno-12-7"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.optimizers</span> <span class="kn">import</span> <span class="n">Adam</span>
<a id="__codelineno-12-8" name="__codelineno-12-8"></a>
<a id="__codelineno-12-9" name="__codelineno-12-9"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span> 
<a id="__codelineno-12-10" name="__codelineno-12-10"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<a id="__codelineno-12-11" name="__codelineno-12-11"></a>
<a id="__codelineno-12-12" name="__codelineno-12-12"></a><span class="n">tokenizer</span> <span class="o">=</span> <span class="n">Tokenizer</span><span class="p">()</span>
<a id="__codelineno-12-13" name="__codelineno-12-13"></a>
<a id="__codelineno-12-14" name="__codelineno-12-14"></a><span class="n">data</span><span class="o">=</span><span class="s2">&quot;In the town of Athy one Jeremy Lanigan </span><span class="se">\n</span><span class="s2"> Battered away til he hadnt a pound. </span><span class="se">\n</span><span class="s2">His father died and made him a man again </span><span class="se">\n</span><span class="s2"> Left him a farm and ten acres of ground. </span><span class="se">\n</span><span class="s2">He gave a grand party for friends and relations </span><span class="se">\n</span><span class="s2">Who didnt forget him when come to the wall, </span><span class="se">\n</span><span class="s2">And if youll but listen Ill make your eyes glisten </span><span class="se">\n</span><span class="s2">Of the rows and the ructions of Lanigans Ball. </span><span class="se">\n</span><span class="s2">Myself to be sure got free invitation, </span><span class="se">\n</span><span class="s2">For all the nice girls and boys I might ask, </span><span class="se">\n</span><span class="s2">And just in a minute both friends and relations </span><span class="se">\n</span><span class="s2">Were dancing round merry as bees round a cask. </span><span class="se">\n</span><span class="s2">Judy ODaly, that nice little milliner, </span><span class="se">\n</span><span class="s2">She tipped me a wink for to give her a call, </span><span class="se">\n</span><span class="s2">And I soon arrived with Peggy McGilligan </span><span class="se">\n</span><span class="s2">Just in time for Lanigans Ball. </span><span class="se">\n</span><span class="s2">There were lashings of punch and wine for the ladies, </span><span class="se">\n</span><span class="s2">Potatoes and cakes; there was bacon and tea, </span><span class="se">\n</span><span class="s2">There were the Nolans, Dolans, OGradys </span><span class="se">\n</span><span class="s2">Courting the girls and dancing away. </span><span class="se">\n</span><span class="s2">Songs they went round as plenty as water, </span><span class="se">\n</span><span class="s2">The harp that once sounded in Taras old hall,</span><span class="se">\n</span><span class="s2">Sweet Nelly Gray and The Rat Catchers Daughter,</span><span class="se">\n</span><span class="s2">All singing together at Lanigans Ball. </span><span class="se">\n</span><span class="s2">They were doing all kinds of nonsensical polkas </span><span class="se">\n</span><span class="s2">All round the room in a whirligig. </span><span class="se">\n</span><span class="s2">Julia and I, we banished their nonsense </span><span class="se">\n</span><span class="s2">And tipped them the twist of a reel and a jig. </span><span class="se">\n</span><span class="s2">Ach mavrone, how the girls got all mad at me </span><span class="se">\n</span><span class="s2">Danced til youd think the ceiling would fall. </span><span class="se">\n</span><span class="s2">For I spent three weeks at Brooks Academy </span><span class="se">\n</span><span class="s2">Learning new steps for Lanigans Ball. </span><span class="se">\n</span><span class="s2">Three long weeks I spent up in Dublin, </span><span class="se">\n</span><span class="s2">Three long weeks to learn nothing at all,</span><span class="se">\n</span><span class="s2"> Three long weeks I spent up in Dublin, </span><span class="se">\n</span><span class="s2">Learning new steps for Lanigans Ball. </span><span class="se">\n</span><span class="s2">She stepped out and I stepped in again, </span><span class="se">\n</span><span class="s2">I stepped out and she stepped in again, </span><span class="se">\n</span><span class="s2">She stepped out and I stepped in again, </span><span class="se">\n</span><span class="s2">Learning new steps for Lanigans Ball. </span><span class="se">\n</span><span class="s2">Boys were all merry and the girls they were hearty </span><span class="se">\n</span><span class="s2">And danced all around in couples and groups, </span><span class="se">\n</span><span class="s2">Til an accident happened, young Terrance McCarthy </span><span class="se">\n</span><span class="s2">Put his right leg through miss Finnertys hoops. </span><span class="se">\n</span><span class="s2">Poor creature fainted and cried Meelia murther, </span><span class="se">\n</span><span class="s2">Called for her brothers and gathered them all. </span><span class="se">\n</span><span class="s2">Carmody swore that hed go no further </span><span class="se">\n</span><span class="s2">Til he had satisfaction at Lanigans Ball. </span><span class="se">\n</span><span class="s2">In the midst of the row miss Kerrigan fainted, </span><span class="se">\n</span><span class="s2">Her cheeks at the same time as red as a rose. </span><span class="se">\n</span><span class="s2">Some of the lads declared she was painted, </span><span class="se">\n</span><span class="s2">She took a small drop too much, I suppose. </span><span class="se">\n</span><span class="s2">Her sweetheart, Ned Morgan, so powerful and able, </span><span class="se">\n</span><span class="s2">When he saw his fair colleen stretched out by the wall, </span><span class="se">\n</span><span class="s2">Tore the left leg from under the table </span><span class="se">\n</span><span class="s2">And smashed all the Chaneys at Lanigans Ball. </span><span class="se">\n</span><span class="s2">Boys, oh boys, twas then there were runctions. </span><span class="se">\n</span><span class="s2">Myself got a lick from big Phelim McHugh. </span><span class="se">\n</span><span class="s2">I soon replied to his introduction </span><span class="se">\n</span><span class="s2">And kicked up a terrible hullabaloo. </span><span class="se">\n</span><span class="s2">Old Casey, the piper, was near being strangled. </span><span class="se">\n</span><span class="s2">They squeezed up his pipes, bellows, chanters and all. </span><span class="se">\n</span><span class="s2">The girls, in their ribbons, they got all entangled </span><span class="se">\n</span><span class="s2">And that put an end to Lanigans Ball.&quot;</span>
<a id="__codelineno-12-15" name="__codelineno-12-15"></a>
<a id="__codelineno-12-16" name="__codelineno-12-16"></a><span class="n">corpus</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-12-17" name="__codelineno-12-17"></a>
<a id="__codelineno-12-18" name="__codelineno-12-18"></a><span class="n">tokenizer</span><span class="o">.</span><span class="n">fit_on_texts</span><span class="p">(</span><span class="n">corpus</span><span class="p">)</span>
<a id="__codelineno-12-19" name="__codelineno-12-19"></a><span class="n">total_words</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">word_index</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-12-20" name="__codelineno-12-20"></a>
<a id="__codelineno-12-21" name="__codelineno-12-21"></a><span class="nb">print</span><span class="p">(</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">word_index</span><span class="p">)</span>
<a id="__codelineno-12-22" name="__codelineno-12-22"></a><span class="nb">print</span><span class="p">(</span><span class="n">total_words</span><span class="p">)</span>
<a id="__codelineno-12-23" name="__codelineno-12-23"></a>
<a id="__codelineno-12-24" name="__codelineno-12-24"></a><span class="n">input_sequences</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-12-25" name="__codelineno-12-25"></a><span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">corpus</span><span class="p">:</span>
<a id="__codelineno-12-26" name="__codelineno-12-26"></a>    <span class="n">token_list</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">texts_to_sequences</span><span class="p">([</span><span class="n">line</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-12-27" name="__codelineno-12-27"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">token_list</span><span class="p">)):</span>
<a id="__codelineno-12-28" name="__codelineno-12-28"></a>        <span class="n">n_gram_sequence</span> <span class="o">=</span> <span class="n">token_list</span><span class="p">[:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-12-29" name="__codelineno-12-29"></a>        <span class="n">input_sequences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n_gram_sequence</span><span class="p">)</span>
<a id="__codelineno-12-30" name="__codelineno-12-30"></a>
<a id="__codelineno-12-31" name="__codelineno-12-31"></a><span class="c1"># pad sequences </span>
<a id="__codelineno-12-32" name="__codelineno-12-32"></a><span class="n">max_sequence_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">input_sequences</span><span class="p">])</span>
<a id="__codelineno-12-33" name="__codelineno-12-33"></a><span class="n">input_sequences</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pad_sequences</span><span class="p">(</span><span class="n">input_sequences</span><span class="p">,</span> <span class="n">maxlen</span><span class="o">=</span><span class="n">max_sequence_len</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;pre&#39;</span><span class="p">))</span>
<a id="__codelineno-12-34" name="__codelineno-12-34"></a>
<a id="__codelineno-12-35" name="__codelineno-12-35"></a><span class="c1"># create predictors and label</span>
<a id="__codelineno-12-36" name="__codelineno-12-36"></a><span class="n">xs</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">input_sequences</span><span class="p">[:,:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">input_sequences</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-12-37" name="__codelineno-12-37"></a>
<a id="__codelineno-12-38" name="__codelineno-12-38"></a><span class="n">ys</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">to_categorical</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">num_classes</span><span class="o">=</span><span class="n">total_words</span><span class="p">)</span>
<a id="__codelineno-12-39" name="__codelineno-12-39"></a>
<a id="__codelineno-12-40" name="__codelineno-12-40"></a><span class="nb">print</span><span class="p">(</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">word_index</span><span class="p">[</span><span class="s1">&#39;in&#39;</span><span class="p">])</span>
<a id="__codelineno-12-41" name="__codelineno-12-41"></a><span class="nb">print</span><span class="p">(</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">word_index</span><span class="p">[</span><span class="s1">&#39;the&#39;</span><span class="p">])</span>
<a id="__codelineno-12-42" name="__codelineno-12-42"></a><span class="nb">print</span><span class="p">(</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">word_index</span><span class="p">[</span><span class="s1">&#39;town&#39;</span><span class="p">])</span>
<a id="__codelineno-12-43" name="__codelineno-12-43"></a><span class="nb">print</span><span class="p">(</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">word_index</span><span class="p">[</span><span class="s1">&#39;of&#39;</span><span class="p">])</span>
<a id="__codelineno-12-44" name="__codelineno-12-44"></a><span class="nb">print</span><span class="p">(</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">word_index</span><span class="p">[</span><span class="s1">&#39;athy&#39;</span><span class="p">])</span>
<a id="__codelineno-12-45" name="__codelineno-12-45"></a><span class="nb">print</span><span class="p">(</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">word_index</span><span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">])</span>
<a id="__codelineno-12-46" name="__codelineno-12-46"></a><span class="nb">print</span><span class="p">(</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">word_index</span><span class="p">[</span><span class="s1">&#39;jeremy&#39;</span><span class="p">])</span>
<a id="__codelineno-12-47" name="__codelineno-12-47"></a><span class="nb">print</span><span class="p">(</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">word_index</span><span class="p">[</span><span class="s1">&#39;lanigan&#39;</span><span class="p">])</span>
<a id="__codelineno-12-48" name="__codelineno-12-48"></a>
<a id="__codelineno-12-49" name="__codelineno-12-49"></a><span class="nb">print</span><span class="p">(</span><span class="n">xs</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
<a id="__codelineno-12-50" name="__codelineno-12-50"></a><span class="nb">print</span><span class="p">(</span><span class="n">ys</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
<a id="__codelineno-12-51" name="__codelineno-12-51"></a>
<a id="__codelineno-12-52" name="__codelineno-12-52"></a><span class="nb">print</span><span class="p">(</span><span class="n">xs</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
<a id="__codelineno-12-53" name="__codelineno-12-53"></a><span class="nb">print</span><span class="p">(</span><span class="n">ys</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
<a id="__codelineno-12-54" name="__codelineno-12-54"></a>
<a id="__codelineno-12-55" name="__codelineno-12-55"></a><span class="nb">print</span><span class="p">(</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">word_index</span><span class="p">)</span>
<a id="__codelineno-12-56" name="__codelineno-12-56"></a>
<a id="__codelineno-12-57" name="__codelineno-12-57"></a><span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">()</span>
<a id="__codelineno-12-58" name="__codelineno-12-58"></a><span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Embedding</span><span class="p">(</span><span class="n">total_words</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="n">input_length</span><span class="o">=</span><span class="n">max_sequence_len</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-12-59" name="__codelineno-12-59"></a><span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Bidirectional</span><span class="p">(</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">20</span><span class="p">)))</span>
<a id="__codelineno-12-60" name="__codelineno-12-60"></a><span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">total_words</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;softmax&#39;</span><span class="p">))</span>
<a id="__codelineno-12-61" name="__codelineno-12-61"></a><span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">&#39;categorical_crossentropy&#39;</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">])</span>
<a id="__codelineno-12-62" name="__codelineno-12-62"></a><span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-12-63" name="__codelineno-12-63"></a>
<a id="__codelineno-12-64" name="__codelineno-12-64"></a><span class="k">def</span> <span class="nf">plot_graphs</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
<a id="__codelineno-12-65" name="__codelineno-12-65"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="n">string</span><span class="p">])</span>
<a id="__codelineno-12-66" name="__codelineno-12-66"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Epochs&quot;</span><span class="p">)</span>
<a id="__codelineno-12-67" name="__codelineno-12-67"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
<a id="__codelineno-12-68" name="__codelineno-12-68"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<a id="__codelineno-12-69" name="__codelineno-12-69"></a>
<a id="__codelineno-12-70" name="__codelineno-12-70"></a><span class="n">seed_text</span> <span class="o">=</span> <span class="s2">&quot;Laurence went to dublin&quot;</span>
<a id="__codelineno-12-71" name="__codelineno-12-71"></a><span class="n">next_words</span> <span class="o">=</span> <span class="mi">100</span>
<a id="__codelineno-12-72" name="__codelineno-12-72"></a>
<a id="__codelineno-12-73" name="__codelineno-12-73"></a><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">next_words</span><span class="p">):</span>
<a id="__codelineno-12-74" name="__codelineno-12-74"></a>    <span class="n">token_list</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">texts_to_sequences</span><span class="p">([</span><span class="n">seed_text</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-12-75" name="__codelineno-12-75"></a>    <span class="n">token_list</span> <span class="o">=</span> <span class="n">pad_sequences</span><span class="p">([</span><span class="n">token_list</span><span class="p">],</span> <span class="n">maxlen</span><span class="o">=</span><span class="n">max_sequence_len</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;pre&#39;</span><span class="p">)</span>
<a id="__codelineno-12-76" name="__codelineno-12-76"></a>    <span class="n">predicted</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict_classes</span><span class="p">(</span><span class="n">token_list</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-12-77" name="__codelineno-12-77"></a>    <span class="n">output_word</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-12-78" name="__codelineno-12-78"></a>    <span class="k">for</span> <span class="n">word</span><span class="p">,</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">word_index</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-12-79" name="__codelineno-12-79"></a>        <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="n">predicted</span><span class="p">:</span>
<a id="__codelineno-12-80" name="__codelineno-12-80"></a>            <span class="n">output_word</span> <span class="o">=</span> <span class="n">word</span>
<a id="__codelineno-12-81" name="__codelineno-12-81"></a>            <span class="k">break</span>
<a id="__codelineno-12-82" name="__codelineno-12-82"></a>    <span class="n">seed_text</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">output_word</span>
<a id="__codelineno-12-83" name="__codelineno-12-83"></a><span class="nb">print</span><span class="p">(</span><span class="n">seed_text</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
</details>
<h3 id="lecture-code-2-generating-text-from-irish-lyrics">Lecture Code 2: Generating Text from Irish Lyrics</h3>
<p><strong>Dataset:</strong> a lyric from an <a href="https://github.com/https-deeplearning-ai/tensorflow-1-public/blob/main/C3/W4/misc/Laurences_generated_poetry.txt">Irish song</a> that has 263 vocabularies</p>
<details class="- success">
<summary>Lecture Code 2: Generating Text from Irish Lyrics</summary>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1">  1</a></span>
<span class="normal"><a href="#__codelineno-13-2">  2</a></span>
<span class="normal"><a href="#__codelineno-13-3">  3</a></span>
<span class="normal"><a href="#__codelineno-13-4">  4</a></span>
<span class="normal"><a href="#__codelineno-13-5">  5</a></span>
<span class="normal"><a href="#__codelineno-13-6">  6</a></span>
<span class="normal"><a href="#__codelineno-13-7">  7</a></span>
<span class="normal"><a href="#__codelineno-13-8">  8</a></span>
<span class="normal"><a href="#__codelineno-13-9">  9</a></span>
<span class="normal"><a href="#__codelineno-13-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-13-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-13-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-13-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-13-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-13-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-13-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-13-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-13-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-13-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-13-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-13-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-13-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-13-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-13-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-13-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-13-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-13-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-13-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-13-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-13-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-13-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-13-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-13-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-13-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-13-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-13-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-13-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-13-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-13-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-13-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-13-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-13-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-13-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-13-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-13-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-13-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-13-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-13-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-13-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-13-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-13-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-13-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-13-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-13-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-13-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-13-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-13-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-13-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-13-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-13-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-13-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-13-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-13-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-13-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-13-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-13-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-13-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-13-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-13-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-13-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-13-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-13-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-13-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-13-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-13-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-13-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-13-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-13-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-13-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-13-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-13-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-13-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-13-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-13-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-13-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-13-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-13-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-13-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-13-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-13-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-13-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-13-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-13-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-13-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-13-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-13-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-13-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-13-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-13-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-13-100">100</a></span>
<span class="normal"><a href="#__codelineno-13-101">101</a></span>
<span class="normal"><a href="#__codelineno-13-102">102</a></span>
<span class="normal"><a href="#__codelineno-13-103">103</a></span>
<span class="normal"><a href="#__codelineno-13-104">104</a></span>
<span class="normal"><a href="#__codelineno-13-105">105</a></span>
<span class="normal"><a href="#__codelineno-13-106">106</a></span>
<span class="normal"><a href="#__codelineno-13-107">107</a></span>
<span class="normal"><a href="#__codelineno-13-108">108</a></span>
<span class="normal"><a href="#__codelineno-13-109">109</a></span>
<span class="normal"><a href="#__codelineno-13-110">110</a></span>
<span class="normal"><a href="#__codelineno-13-111">111</a></span>
<span class="normal"><a href="#__codelineno-13-112">112</a></span>
<span class="normal"><a href="#__codelineno-13-113">113</a></span>
<span class="normal"><a href="#__codelineno-13-114">114</a></span>
<span class="normal"><a href="#__codelineno-13-115">115</a></span>
<span class="normal"><a href="#__codelineno-13-116">116</a></span>
<span class="normal"><a href="#__codelineno-13-117">117</a></span>
<span class="normal"><a href="#__codelineno-13-118">118</a></span>
<span class="normal"><a href="#__codelineno-13-119">119</a></span>
<span class="normal"><a href="#__codelineno-13-120">120</a></span>
<span class="normal"><a href="#__codelineno-13-121">121</a></span>
<span class="normal"><a href="#__codelineno-13-122">122</a></span>
<span class="normal"><a href="#__codelineno-13-123">123</a></span>
<span class="normal"><a href="#__codelineno-13-124">124</a></span>
<span class="normal"><a href="#__codelineno-13-125">125</a></span>
<span class="normal"><a href="#__codelineno-13-126">126</a></span>
<span class="normal"><a href="#__codelineno-13-127">127</a></span>
<span class="normal"><a href="#__codelineno-13-128">128</a></span>
<span class="normal"><a href="#__codelineno-13-129">129</a></span>
<span class="normal"><a href="#__codelineno-13-130">130</a></span>
<span class="normal"><a href="#__codelineno-13-131">131</a></span>
<span class="normal"><a href="#__codelineno-13-132">132</a></span>
<span class="normal"><a href="#__codelineno-13-133">133</a></span>
<span class="normal"><a href="#__codelineno-13-134">134</a></span>
<span class="normal"><a href="#__codelineno-13-135">135</a></span>
<span class="normal"><a href="#__codelineno-13-136">136</a></span>
<span class="normal"><a href="#__codelineno-13-137">137</a></span>
<span class="normal"><a href="#__codelineno-13-138">138</a></span>
<span class="normal"><a href="#__codelineno-13-139">139</a></span>
<span class="normal"><a href="#__codelineno-13-140">140</a></span>
<span class="normal"><a href="#__codelineno-13-141">141</a></span>
<span class="normal"><a href="#__codelineno-13-142">142</a></span>
<span class="normal"><a href="#__codelineno-13-143">143</a></span>
<span class="normal"><a href="#__codelineno-13-144">144</a></span>
<span class="normal"><a href="#__codelineno-13-145">145</a></span>
<span class="normal"><a href="#__codelineno-13-146">146</a></span>
<span class="normal"><a href="#__codelineno-13-147">147</a></span>
<span class="normal"><a href="#__codelineno-13-148">148</a></span>
<span class="normal"><a href="#__codelineno-13-149">149</a></span>
<span class="normal"><a href="#__codelineno-13-150">150</a></span>
<span class="normal"><a href="#__codelineno-13-151">151</a></span>
<span class="normal"><a href="#__codelineno-13-152">152</a></span>
<span class="normal"><a href="#__codelineno-13-153">153</a></span>
<span class="normal"><a href="#__codelineno-13-154">154</a></span>
<span class="normal"><a href="#__codelineno-13-155">155</a></span>
<span class="normal"><a href="#__codelineno-13-156">156</a></span>
<span class="normal"><a href="#__codelineno-13-157">157</a></span>
<span class="normal"><a href="#__codelineno-13-158">158</a></span>
<span class="normal"><a href="#__codelineno-13-159">159</a></span>
<span class="normal"><a href="#__codelineno-13-160">160</a></span>
<span class="normal"><a href="#__codelineno-13-161">161</a></span>
<span class="normal"><a href="#__codelineno-13-162">162</a></span>
<span class="normal"><a href="#__codelineno-13-163">163</a></span>
<span class="normal"><a href="#__codelineno-13-164">164</a></span>
<span class="normal"><a href="#__codelineno-13-165">165</a></span>
<span class="normal"><a href="#__codelineno-13-166">166</a></span>
<span class="normal"><a href="#__codelineno-13-167">167</a></span>
<span class="normal"><a href="#__codelineno-13-168">168</a></span>
<span class="normal"><a href="#__codelineno-13-169">169</a></span>
<span class="normal"><a href="#__codelineno-13-170">170</a></span>
<span class="normal"><a href="#__codelineno-13-171">171</a></span>
<span class="normal"><a href="#__codelineno-13-172">172</a></span>
<span class="normal"><a href="#__codelineno-13-173">173</a></span>
<span class="normal"><a href="#__codelineno-13-174">174</a></span>
<span class="normal"><a href="#__codelineno-13-175">175</a></span>
<span class="normal"><a href="#__codelineno-13-176">176</a></span>
<span class="normal"><a href="#__codelineno-13-177">177</a></span>
<span class="normal"><a href="#__codelineno-13-178">178</a></span>
<span class="normal"><a href="#__codelineno-13-179">179</a></span>
<span class="normal"><a href="#__codelineno-13-180">180</a></span>
<span class="normal"><a href="#__codelineno-13-181">181</a></span>
<span class="normal"><a href="#__codelineno-13-182">182</a></span>
<span class="normal"><a href="#__codelineno-13-183">183</a></span>
<span class="normal"><a href="#__codelineno-13-184">184</a></span>
<span class="normal"><a href="#__codelineno-13-185">185</a></span>
<span class="normal"><a href="#__codelineno-13-186">186</a></span>
<span class="normal"><a href="#__codelineno-13-187">187</a></span>
<span class="normal"><a href="#__codelineno-13-188">188</a></span>
<span class="normal"><a href="#__codelineno-13-189">189</a></span>
<span class="normal"><a href="#__codelineno-13-190">190</a></span>
<span class="normal"><a href="#__codelineno-13-191">191</a></span>
<span class="normal"><a href="#__codelineno-13-192">192</a></span>
<span class="normal"><a href="#__codelineno-13-193">193</a></span>
<span class="normal"><a href="#__codelineno-13-194">194</a></span>
<span class="normal"><a href="#__codelineno-13-195">195</a></span>
<span class="normal"><a href="#__codelineno-13-196">196</a></span>
<span class="normal"><a href="#__codelineno-13-197">197</a></span>
<span class="normal"><a href="#__codelineno-13-198">198</a></span>
<span class="normal"><a href="#__codelineno-13-199">199</a></span>
<span class="normal"><a href="#__codelineno-13-200">200</a></span>
<span class="normal"><a href="#__codelineno-13-201">201</a></span>
<span class="normal"><a href="#__codelineno-13-202">202</a></span>
<span class="normal"><a href="#__codelineno-13-203">203</a></span>
<span class="normal"><a href="#__codelineno-13-204">204</a></span>
<span class="normal"><a href="#__codelineno-13-205">205</a></span>
<span class="normal"><a href="#__codelineno-13-206">206</a></span>
<span class="normal"><a href="#__codelineno-13-207">207</a></span>
<span class="normal"><a href="#__codelineno-13-208">208</a></span>
<span class="normal"><a href="#__codelineno-13-209">209</a></span>
<span class="normal"><a href="#__codelineno-13-210">210</a></span>
<span class="normal"><a href="#__codelineno-13-211">211</a></span>
<span class="normal"><a href="#__codelineno-13-212">212</a></span>
<span class="normal"><a href="#__codelineno-13-213">213</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<a id="__codelineno-13-5" name="__codelineno-13-5"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.preprocessing.sequence</span> <span class="kn">import</span> <span class="n">pad_sequences</span>
<a id="__codelineno-13-6" name="__codelineno-13-6"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">Embedding</span><span class="p">,</span> <span class="n">LSTM</span><span class="p">,</span> <span class="n">Dense</span><span class="p">,</span> <span class="n">Bidirectional</span>
<a id="__codelineno-13-7" name="__codelineno-13-7"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.preprocessing.text</span> <span class="kn">import</span> <span class="n">Tokenizer</span>
<a id="__codelineno-13-8" name="__codelineno-13-8"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.models</span> <span class="kn">import</span> <span class="n">Sequential</span>
<a id="__codelineno-13-9" name="__codelineno-13-9"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.optimizers</span> <span class="kn">import</span> <span class="n">Adam</span>
<a id="__codelineno-13-10" name="__codelineno-13-10"></a>
<a id="__codelineno-13-11" name="__codelineno-13-11"></a><span class="c1">########## DOWNLOAD DATASET ##########</span>
<a id="__codelineno-13-12" name="__codelineno-13-12"></a><span class="c1"># Download the dataset</span>
<a id="__codelineno-13-13" name="__codelineno-13-13"></a><span class="err">!</span><span class="n">gdown</span> <span class="o">--</span><span class="nb">id</span> <span class="mi">15</span><span class="n">UqmiIm0xwh9mt0IYq2z3jHaauxQSTQT</span>
<a id="__codelineno-13-14" name="__codelineno-13-14"></a>
<a id="__codelineno-13-15" name="__codelineno-13-15"></a><span class="c1"># Load the dataset</span>
<a id="__codelineno-13-16" name="__codelineno-13-16"></a><span class="n">data</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./irish-lyrics-eof.txt&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<a id="__codelineno-13-17" name="__codelineno-13-17"></a>
<a id="__codelineno-13-18" name="__codelineno-13-18"></a><span class="c1"># Lowercase and split the text</span>
<a id="__codelineno-13-19" name="__codelineno-13-19"></a><span class="n">corpus</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-13-20" name="__codelineno-13-20"></a>
<a id="__codelineno-13-21" name="__codelineno-13-21"></a><span class="c1"># Preview the result</span>
<a id="__codelineno-13-22" name="__codelineno-13-22"></a><span class="nb">print</span><span class="p">(</span><span class="n">corpus</span><span class="p">)</span>
<a id="__codelineno-13-23" name="__codelineno-13-23"></a>
<a id="__codelineno-13-24" name="__codelineno-13-24"></a><span class="c1"># Initialize the Tokenizer class</span>
<a id="__codelineno-13-25" name="__codelineno-13-25"></a><span class="n">tokenizer</span> <span class="o">=</span> <span class="n">Tokenizer</span><span class="p">()</span>
<a id="__codelineno-13-26" name="__codelineno-13-26"></a>
<a id="__codelineno-13-27" name="__codelineno-13-27"></a><span class="c1"># Generate the word index dictionary</span>
<a id="__codelineno-13-28" name="__codelineno-13-28"></a><span class="n">tokenizer</span><span class="o">.</span><span class="n">fit_on_texts</span><span class="p">(</span><span class="n">corpus</span><span class="p">)</span>
<a id="__codelineno-13-29" name="__codelineno-13-29"></a>
<a id="__codelineno-13-30" name="__codelineno-13-30"></a><span class="c1"># Define the total words. You add 1 for the index `0` which is just the padding token.</span>
<a id="__codelineno-13-31" name="__codelineno-13-31"></a><span class="n">total_words</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">word_index</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-13-32" name="__codelineno-13-32"></a>
<a id="__codelineno-13-33" name="__codelineno-13-33"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;word index dictionary: </span><span class="si">{</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">word_index</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-13-34" name="__codelineno-13-34"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;total words: </span><span class="si">{</span><span class="n">total_words</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-13-35" name="__codelineno-13-35"></a>
<a id="__codelineno-13-36" name="__codelineno-13-36"></a><span class="c1">########## PREPROCESS THE DATA ##########</span>
<a id="__codelineno-13-37" name="__codelineno-13-37"></a><span class="c1"># Initialize the sequences list</span>
<a id="__codelineno-13-38" name="__codelineno-13-38"></a><span class="n">input_sequences</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-13-39" name="__codelineno-13-39"></a>
<a id="__codelineno-13-40" name="__codelineno-13-40"></a><span class="c1"># Loop over every line</span>
<a id="__codelineno-13-41" name="__codelineno-13-41"></a><span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">corpus</span><span class="p">:</span>
<a id="__codelineno-13-42" name="__codelineno-13-42"></a>
<a id="__codelineno-13-43" name="__codelineno-13-43"></a>    <span class="c1"># Tokenize the current line</span>
<a id="__codelineno-13-44" name="__codelineno-13-44"></a>    <span class="n">token_list</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">texts_to_sequences</span><span class="p">([</span><span class="n">line</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-13-45" name="__codelineno-13-45"></a>
<a id="__codelineno-13-46" name="__codelineno-13-46"></a>    <span class="c1"># Loop over the line several times to generate the subphrases</span>
<a id="__codelineno-13-47" name="__codelineno-13-47"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">token_list</span><span class="p">)):</span>
<a id="__codelineno-13-48" name="__codelineno-13-48"></a>
<a id="__codelineno-13-49" name="__codelineno-13-49"></a>        <span class="c1"># Generate the subphrase</span>
<a id="__codelineno-13-50" name="__codelineno-13-50"></a>        <span class="n">n_gram_sequence</span> <span class="o">=</span> <span class="n">token_list</span><span class="p">[:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-13-51" name="__codelineno-13-51"></a>
<a id="__codelineno-13-52" name="__codelineno-13-52"></a>        <span class="c1"># Append the subphrase to the sequences list</span>
<a id="__codelineno-13-53" name="__codelineno-13-53"></a>        <span class="n">input_sequences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n_gram_sequence</span><span class="p">)</span>
<a id="__codelineno-13-54" name="__codelineno-13-54"></a>
<a id="__codelineno-13-55" name="__codelineno-13-55"></a><span class="c1"># Get the length of the longest line</span>
<a id="__codelineno-13-56" name="__codelineno-13-56"></a><span class="n">max_sequence_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">input_sequences</span><span class="p">])</span>
<a id="__codelineno-13-57" name="__codelineno-13-57"></a>
<a id="__codelineno-13-58" name="__codelineno-13-58"></a><span class="c1"># Pad all sequences</span>
<a id="__codelineno-13-59" name="__codelineno-13-59"></a><span class="n">input_sequences</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pad_sequences</span><span class="p">(</span><span class="n">input_sequences</span><span class="p">,</span> <span class="n">maxlen</span><span class="o">=</span><span class="n">max_sequence_len</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;pre&#39;</span><span class="p">))</span>
<a id="__codelineno-13-60" name="__codelineno-13-60"></a>
<a id="__codelineno-13-61" name="__codelineno-13-61"></a><span class="c1"># Create inputs and label by splitting the last token in the subphrases</span>
<a id="__codelineno-13-62" name="__codelineno-13-62"></a><span class="n">xs</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">input_sequences</span><span class="p">[:,:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">input_sequences</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-13-63" name="__codelineno-13-63"></a>
<a id="__codelineno-13-64" name="__codelineno-13-64"></a><span class="c1"># Convert the label into one-hot arrays</span>
<a id="__codelineno-13-65" name="__codelineno-13-65"></a><span class="n">ys</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">to_categorical</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">num_classes</span><span class="o">=</span><span class="n">total_words</span><span class="p">)</span>
<a id="__codelineno-13-66" name="__codelineno-13-66"></a>
<a id="__codelineno-13-67" name="__codelineno-13-67"></a><span class="c1"># Get sample sentence</span>
<a id="__codelineno-13-68" name="__codelineno-13-68"></a><span class="n">sentence</span> <span class="o">=</span> <span class="n">corpus</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<a id="__codelineno-13-69" name="__codelineno-13-69"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;sample sentence: </span><span class="si">{</span><span class="n">sentence</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-13-70" name="__codelineno-13-70"></a>
<a id="__codelineno-13-71" name="__codelineno-13-71"></a><span class="c1"># Initialize token list</span>
<a id="__codelineno-13-72" name="__codelineno-13-72"></a><span class="n">token_list</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-13-73" name="__codelineno-13-73"></a>
<a id="__codelineno-13-74" name="__codelineno-13-74"></a><span class="c1"># Look up the indices of each word and append to the list</span>
<a id="__codelineno-13-75" name="__codelineno-13-75"></a><span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">sentence</span><span class="p">:</span> 
<a id="__codelineno-13-76" name="__codelineno-13-76"></a>  <span class="n">token_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">word_index</span><span class="p">[</span><span class="n">word</span><span class="p">])</span>
<a id="__codelineno-13-77" name="__codelineno-13-77"></a>
<a id="__codelineno-13-78" name="__codelineno-13-78"></a><span class="c1"># Print the token list</span>
<a id="__codelineno-13-79" name="__codelineno-13-79"></a><span class="nb">print</span><span class="p">(</span><span class="n">token_list</span><span class="p">)</span>
<a id="__codelineno-13-80" name="__codelineno-13-80"></a>
<a id="__codelineno-13-81" name="__codelineno-13-81"></a><span class="c1"># Pick element</span>
<a id="__codelineno-13-82" name="__codelineno-13-82"></a><span class="n">elem_number</span> <span class="o">=</span> <span class="mi">5</span>
<a id="__codelineno-13-83" name="__codelineno-13-83"></a>
<a id="__codelineno-13-84" name="__codelineno-13-84"></a><span class="c1"># Print token list and phrase</span>
<a id="__codelineno-13-85" name="__codelineno-13-85"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;token list: </span><span class="si">{</span><span class="n">xs</span><span class="p">[</span><span class="n">elem_number</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-13-86" name="__codelineno-13-86"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;decoded to text: </span><span class="si">{</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">sequences_to_texts</span><span class="p">([</span><span class="n">xs</span><span class="p">[</span><span class="n">elem_number</span><span class="p">]])</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-13-87" name="__codelineno-13-87"></a>
<a id="__codelineno-13-88" name="__codelineno-13-88"></a><span class="c1"># Print label</span>
<a id="__codelineno-13-89" name="__codelineno-13-89"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;one-hot label: </span><span class="si">{</span><span class="n">ys</span><span class="p">[</span><span class="n">elem_number</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-13-90" name="__codelineno-13-90"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;index of label: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">ys</span><span class="p">[</span><span class="n">elem_number</span><span class="p">])</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-13-91" name="__codelineno-13-91"></a>
<a id="__codelineno-13-92" name="__codelineno-13-92"></a><span class="c1"># Pick element</span>
<a id="__codelineno-13-93" name="__codelineno-13-93"></a><span class="n">elem_number</span> <span class="o">=</span> <span class="mi">4</span>
<a id="__codelineno-13-94" name="__codelineno-13-94"></a>
<a id="__codelineno-13-95" name="__codelineno-13-95"></a><span class="c1"># Print token list and phrase</span>
<a id="__codelineno-13-96" name="__codelineno-13-96"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;token list: </span><span class="si">{</span><span class="n">xs</span><span class="p">[</span><span class="n">elem_number</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-13-97" name="__codelineno-13-97"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;decoded to text: </span><span class="si">{</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">sequences_to_texts</span><span class="p">([</span><span class="n">xs</span><span class="p">[</span><span class="n">elem_number</span><span class="p">]])</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-13-98" name="__codelineno-13-98"></a>
<a id="__codelineno-13-99" name="__codelineno-13-99"></a><span class="c1"># Print label</span>
<a id="__codelineno-13-100" name="__codelineno-13-100"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;one-hot label: </span><span class="si">{</span><span class="n">ys</span><span class="p">[</span><span class="n">elem_number</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-13-101" name="__codelineno-13-101"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;index of label: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">ys</span><span class="p">[</span><span class="n">elem_number</span><span class="p">])</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-13-102" name="__codelineno-13-102"></a>
<a id="__codelineno-13-103" name="__codelineno-13-103"></a><span class="c1">########## BUILD AND COMPILE MODEL ##########</span>
<a id="__codelineno-13-104" name="__codelineno-13-104"></a><span class="c1"># Hyperparameters</span>
<a id="__codelineno-13-105" name="__codelineno-13-105"></a><span class="n">embedding_dim</span> <span class="o">=</span> <span class="mi">100</span>
<a id="__codelineno-13-106" name="__codelineno-13-106"></a><span class="n">lstm_units</span> <span class="o">=</span> <span class="mi">150</span>
<a id="__codelineno-13-107" name="__codelineno-13-107"></a><span class="n">learning_rate</span> <span class="o">=</span> <span class="mf">0.01</span>
<a id="__codelineno-13-108" name="__codelineno-13-108"></a>
<a id="__codelineno-13-109" name="__codelineno-13-109"></a><span class="c1"># Build the model</span>
<a id="__codelineno-13-110" name="__codelineno-13-110"></a><span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">([</span>
<a id="__codelineno-13-111" name="__codelineno-13-111"></a>          <span class="n">Embedding</span><span class="p">(</span><span class="n">total_words</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="p">,</span> <span class="n">input_length</span><span class="o">=</span><span class="n">max_sequence_len</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
<a id="__codelineno-13-112" name="__codelineno-13-112"></a>          <span class="n">Bidirectional</span><span class="p">(</span><span class="n">LSTM</span><span class="p">(</span><span class="n">lstm_units</span><span class="p">)),</span>
<a id="__codelineno-13-113" name="__codelineno-13-113"></a>          <span class="n">Dense</span><span class="p">(</span><span class="n">total_words</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;softmax&#39;</span><span class="p">)</span>
<a id="__codelineno-13-114" name="__codelineno-13-114"></a><span class="p">])</span>
<a id="__codelineno-13-115" name="__codelineno-13-115"></a>
<a id="__codelineno-13-116" name="__codelineno-13-116"></a><span class="c1"># Use categorical crossentropy because this is a multi-class problem</span>
<a id="__codelineno-13-117" name="__codelineno-13-117"></a><span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
<a id="__codelineno-13-118" name="__codelineno-13-118"></a>    <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;categorical_crossentropy&#39;</span><span class="p">,</span> 
<a id="__codelineno-13-119" name="__codelineno-13-119"></a>    <span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="n">learning_rate</span><span class="p">),</span> 
<a id="__codelineno-13-120" name="__codelineno-13-120"></a>    <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">]</span>
<a id="__codelineno-13-121" name="__codelineno-13-121"></a>    <span class="p">)</span>
<a id="__codelineno-13-122" name="__codelineno-13-122"></a>
<a id="__codelineno-13-123" name="__codelineno-13-123"></a><span class="c1"># Print the model summary</span>
<a id="__codelineno-13-124" name="__codelineno-13-124"></a><span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
<a id="__codelineno-13-125" name="__codelineno-13-125"></a>
<a id="__codelineno-13-126" name="__codelineno-13-126"></a><span class="c1">########## TRAIN MODEL ##########</span>
<a id="__codelineno-13-127" name="__codelineno-13-127"></a><span class="n">epochs</span> <span class="o">=</span> <span class="mi">100</span>
<a id="__codelineno-13-128" name="__codelineno-13-128"></a>
<a id="__codelineno-13-129" name="__codelineno-13-129"></a><span class="c1"># Train the model</span>
<a id="__codelineno-13-130" name="__codelineno-13-130"></a><span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="n">epochs</span><span class="p">)</span>
<a id="__codelineno-13-131" name="__codelineno-13-131"></a>
<a id="__codelineno-13-132" name="__codelineno-13-132"></a><span class="c1">########## VISUALIZE RESULT ##########</span>
<a id="__codelineno-13-133" name="__codelineno-13-133"></a><span class="c1"># Plot utility</span>
<a id="__codelineno-13-134" name="__codelineno-13-134"></a><span class="k">def</span> <span class="nf">plot_graphs</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
<a id="__codelineno-13-135" name="__codelineno-13-135"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="n">string</span><span class="p">])</span>
<a id="__codelineno-13-136" name="__codelineno-13-136"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Epochs&quot;</span><span class="p">)</span>
<a id="__codelineno-13-137" name="__codelineno-13-137"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
<a id="__codelineno-13-138" name="__codelineno-13-138"></a>  <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<a id="__codelineno-13-139" name="__codelineno-13-139"></a>
<a id="__codelineno-13-140" name="__codelineno-13-140"></a><span class="c1"># Visualize the accuracy</span>
<a id="__codelineno-13-141" name="__codelineno-13-141"></a><span class="n">plot_graphs</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">)</span>
<a id="__codelineno-13-142" name="__codelineno-13-142"></a>
<a id="__codelineno-13-143" name="__codelineno-13-143"></a><span class="c1">########## GENERATE RANDOM TEXT ##########</span>
<a id="__codelineno-13-144" name="__codelineno-13-144"></a><span class="c1"># Define seed text</span>
<a id="__codelineno-13-145" name="__codelineno-13-145"></a><span class="n">seed_text</span> <span class="o">=</span> <span class="s2">&quot;help me obi-wan kinobi youre my only hope&quot;</span>
<a id="__codelineno-13-146" name="__codelineno-13-146"></a>
<a id="__codelineno-13-147" name="__codelineno-13-147"></a><span class="c1"># Define total words to predict</span>
<a id="__codelineno-13-148" name="__codelineno-13-148"></a><span class="n">next_words</span> <span class="o">=</span> <span class="mi">100</span>
<a id="__codelineno-13-149" name="__codelineno-13-149"></a>
<a id="__codelineno-13-150" name="__codelineno-13-150"></a><span class="c1"># Loop until desired length is reached</span>
<a id="__codelineno-13-151" name="__codelineno-13-151"></a><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">next_words</span><span class="p">):</span>
<a id="__codelineno-13-152" name="__codelineno-13-152"></a>
<a id="__codelineno-13-153" name="__codelineno-13-153"></a>    <span class="c1"># Convert the seed text to a token sequence</span>
<a id="__codelineno-13-154" name="__codelineno-13-154"></a>    <span class="n">token_list</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">texts_to_sequences</span><span class="p">([</span><span class="n">seed_text</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-13-155" name="__codelineno-13-155"></a>
<a id="__codelineno-13-156" name="__codelineno-13-156"></a>    <span class="c1"># Pad the sequence</span>
<a id="__codelineno-13-157" name="__codelineno-13-157"></a>    <span class="n">token_list</span> <span class="o">=</span> <span class="n">pad_sequences</span><span class="p">([</span><span class="n">token_list</span><span class="p">],</span> <span class="n">maxlen</span><span class="o">=</span><span class="n">max_sequence_len</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;pre&#39;</span><span class="p">)</span>
<a id="__codelineno-13-158" name="__codelineno-13-158"></a>
<a id="__codelineno-13-159" name="__codelineno-13-159"></a>    <span class="c1"># Feed to the model and get the probabilities for each index</span>
<a id="__codelineno-13-160" name="__codelineno-13-160"></a>    <span class="n">probabilities</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">token_list</span><span class="p">)</span>
<a id="__codelineno-13-161" name="__codelineno-13-161"></a>
<a id="__codelineno-13-162" name="__codelineno-13-162"></a>    <span class="c1"># Get the index with the highest probability</span>
<a id="__codelineno-13-163" name="__codelineno-13-163"></a>    <span class="n">predicted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">probabilities</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-13-164" name="__codelineno-13-164"></a>
<a id="__codelineno-13-165" name="__codelineno-13-165"></a>    <span class="c1"># Ignore if index is 0 because that is just the padding.</span>
<a id="__codelineno-13-166" name="__codelineno-13-166"></a>    <span class="k">if</span> <span class="n">predicted</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-13-167" name="__codelineno-13-167"></a>
<a id="__codelineno-13-168" name="__codelineno-13-168"></a>        <span class="c1"># Look up the word associated with the index. </span>
<a id="__codelineno-13-169" name="__codelineno-13-169"></a>        <span class="n">output_word</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">index_word</span><span class="p">[</span><span class="n">predicted</span><span class="p">]</span>
<a id="__codelineno-13-170" name="__codelineno-13-170"></a>
<a id="__codelineno-13-171" name="__codelineno-13-171"></a>        <span class="c1"># Combine with the seed text</span>
<a id="__codelineno-13-172" name="__codelineno-13-172"></a>        <span class="n">seed_text</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">output_word</span>
<a id="__codelineno-13-173" name="__codelineno-13-173"></a>
<a id="__codelineno-13-174" name="__codelineno-13-174"></a><span class="c1"># Print the result  </span>
<a id="__codelineno-13-175" name="__codelineno-13-175"></a><span class="nb">print</span><span class="p">(</span><span class="n">seed_text</span><span class="p">)</span>
<a id="__codelineno-13-176" name="__codelineno-13-176"></a>
<a id="__codelineno-13-177" name="__codelineno-13-177"></a><span class="c1">########## GENERATE RANDOM TEXT 2 ##########</span>
<a id="__codelineno-13-178" name="__codelineno-13-178"></a><span class="c1"># Define seed text</span>
<a id="__codelineno-13-179" name="__codelineno-13-179"></a><span class="n">seed_text</span> <span class="o">=</span> <span class="s2">&quot;help me obi-wan kinobi youre my only hope&quot;</span>
<a id="__codelineno-13-180" name="__codelineno-13-180"></a>
<a id="__codelineno-13-181" name="__codelineno-13-181"></a><span class="c1"># Define total words to predict</span>
<a id="__codelineno-13-182" name="__codelineno-13-182"></a><span class="n">next_words</span> <span class="o">=</span> <span class="mi">100</span>
<a id="__codelineno-13-183" name="__codelineno-13-183"></a>
<a id="__codelineno-13-184" name="__codelineno-13-184"></a><span class="c1"># Loop until desired length is reached</span>
<a id="__codelineno-13-185" name="__codelineno-13-185"></a><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">next_words</span><span class="p">):</span>
<a id="__codelineno-13-186" name="__codelineno-13-186"></a>
<a id="__codelineno-13-187" name="__codelineno-13-187"></a>    <span class="c1"># Convert the seed text to a token sequence</span>
<a id="__codelineno-13-188" name="__codelineno-13-188"></a>  <span class="n">token_list</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">texts_to_sequences</span><span class="p">([</span><span class="n">seed_text</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-13-189" name="__codelineno-13-189"></a>
<a id="__codelineno-13-190" name="__codelineno-13-190"></a>    <span class="c1"># Pad the sequence</span>
<a id="__codelineno-13-191" name="__codelineno-13-191"></a>  <span class="n">token_list</span> <span class="o">=</span> <span class="n">pad_sequences</span><span class="p">([</span><span class="n">token_list</span><span class="p">],</span> <span class="n">maxlen</span><span class="o">=</span><span class="n">max_sequence_len</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;pre&#39;</span><span class="p">)</span>
<a id="__codelineno-13-192" name="__codelineno-13-192"></a>
<a id="__codelineno-13-193" name="__codelineno-13-193"></a>    <span class="c1"># Feed to the model and get the probabilities for each index</span>
<a id="__codelineno-13-194" name="__codelineno-13-194"></a>  <span class="n">probabilities</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">token_list</span><span class="p">)</span>
<a id="__codelineno-13-195" name="__codelineno-13-195"></a>
<a id="__codelineno-13-196" name="__codelineno-13-196"></a>  <span class="c1"># Pick a random number from [1,2,3]</span>
<a id="__codelineno-13-197" name="__codelineno-13-197"></a>  <span class="n">choice</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
<a id="__codelineno-13-198" name="__codelineno-13-198"></a>
<a id="__codelineno-13-199" name="__codelineno-13-199"></a>  <span class="c1"># Sort the probabilities in ascending order </span>
<a id="__codelineno-13-200" name="__codelineno-13-200"></a>  <span class="c1"># and get the random choice from the end of the array</span>
<a id="__codelineno-13-201" name="__codelineno-13-201"></a>  <span class="n">predicted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">probabilities</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="n">choice</span><span class="p">]</span>
<a id="__codelineno-13-202" name="__codelineno-13-202"></a>
<a id="__codelineno-13-203" name="__codelineno-13-203"></a>    <span class="c1"># Ignore if index is 0 because that is just the padding.</span>
<a id="__codelineno-13-204" name="__codelineno-13-204"></a>  <span class="k">if</span> <span class="n">predicted</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-13-205" name="__codelineno-13-205"></a>
<a id="__codelineno-13-206" name="__codelineno-13-206"></a>        <span class="c1"># Look up the word associated with the index. </span>
<a id="__codelineno-13-207" name="__codelineno-13-207"></a>      <span class="n">output_word</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">index_word</span><span class="p">[</span><span class="n">predicted</span><span class="p">]</span>
<a id="__codelineno-13-208" name="__codelineno-13-208"></a>
<a id="__codelineno-13-209" name="__codelineno-13-209"></a>        <span class="c1"># Combine with the seed text</span>
<a id="__codelineno-13-210" name="__codelineno-13-210"></a>      <span class="n">seed_text</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">output_word</span>
<a id="__codelineno-13-211" name="__codelineno-13-211"></a>
<a id="__codelineno-13-212" name="__codelineno-13-212"></a><span class="c1"># Print the result  </span>
<a id="__codelineno-13-213" name="__codelineno-13-213"></a><span class="nb">print</span><span class="p">(</span><span class="n">seed_text</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
</details>
<h3 id="exercise-using-lstms-create-poetry">Exercise: Using LSTMs Create Poetry</h3>
<p><strong>Assignment:</strong> Create an ML model and use the model to create a poetry</p>
<details class="- success">
<summary>Final code for the exercise</summary>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-14-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-14-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-14-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-14-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-14-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-14-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-14-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-14-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-14-10">10</a></span>
<span class="normal"><a href="#__codelineno-14-11">11</a></span>
<span class="normal"><a href="#__codelineno-14-12">12</a></span>
<span class="normal"><a href="#__codelineno-14-13">13</a></span>
<span class="normal"><a href="#__codelineno-14-14">14</a></span>
<span class="normal"><a href="#__codelineno-14-15">15</a></span>
<span class="normal"><a href="#__codelineno-14-16">16</a></span>
<span class="normal"><a href="#__codelineno-14-17">17</a></span>
<span class="normal"><a href="#__codelineno-14-18">18</a></span>
<span class="normal"><a href="#__codelineno-14-19">19</a></span>
<span class="normal"><a href="#__codelineno-14-20">20</a></span>
<span class="normal"><a href="#__codelineno-14-21">21</a></span>
<span class="normal"><a href="#__codelineno-14-22">22</a></span>
<span class="normal"><a href="#__codelineno-14-23">23</a></span>
<span class="normal"><a href="#__codelineno-14-24">24</a></span>
<span class="normal"><a href="#__codelineno-14-25">25</a></span>
<span class="normal"><a href="#__codelineno-14-26">26</a></span>
<span class="normal"><a href="#__codelineno-14-27">27</a></span>
<span class="normal"><a href="#__codelineno-14-28">28</a></span>
<span class="normal"><a href="#__codelineno-14-29">29</a></span>
<span class="normal"><a href="#__codelineno-14-30">30</a></span>
<span class="normal"><a href="#__codelineno-14-31">31</a></span>
<span class="normal"><a href="#__codelineno-14-32">32</a></span>
<span class="normal"><a href="#__codelineno-14-33">33</a></span>
<span class="normal"><a href="#__codelineno-14-34">34</a></span>
<span class="normal"><a href="#__codelineno-14-35">35</a></span>
<span class="normal"><a href="#__codelineno-14-36">36</a></span>
<span class="normal"><a href="#__codelineno-14-37">37</a></span>
<span class="normal"><a href="#__codelineno-14-38">38</a></span>
<span class="normal"><a href="#__codelineno-14-39">39</a></span>
<span class="normal"><a href="#__codelineno-14-40">40</a></span>
<span class="normal"><a href="#__codelineno-14-41">41</a></span>
<span class="normal"><a href="#__codelineno-14-42">42</a></span>
<span class="normal"><a href="#__codelineno-14-43">43</a></span>
<span class="normal"><a href="#__codelineno-14-44">44</a></span>
<span class="normal"><a href="#__codelineno-14-45">45</a></span>
<span class="normal"><a href="#__codelineno-14-46">46</a></span>
<span class="normal"><a href="#__codelineno-14-47">47</a></span>
<span class="normal"><a href="#__codelineno-14-48">48</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.preprocessing.sequence</span> <span class="kn">import</span> <span class="n">pad_sequences</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">Embedding</span><span class="p">,</span> <span class="n">LSTM</span><span class="p">,</span> <span class="n">Dense</span><span class="p">,</span> <span class="n">Dropout</span><span class="p">,</span> <span class="n">Bidirectional</span>
<a id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.preprocessing.text</span> <span class="kn">import</span> <span class="n">Tokenizer</span>
<a id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.models</span> <span class="kn">import</span> <span class="n">Sequential</span>
<a id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.optimizers</span> <span class="kn">import</span> <span class="n">Adam</span>
<a id="__codelineno-14-6" name="__codelineno-14-6"></a><span class="kn">from</span> <span class="nn">tensorflow.keras</span> <span class="kn">import</span> <span class="n">regularizers</span>
<a id="__codelineno-14-7" name="__codelineno-14-7"></a><span class="kn">import</span> <span class="nn">tensorflow.keras.utils</span> <span class="k">as</span> <span class="nn">ku</span> 
<a id="__codelineno-14-8" name="__codelineno-14-8"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span> 
<a id="__codelineno-14-9" name="__codelineno-14-9"></a>
<a id="__codelineno-14-10" name="__codelineno-14-10"></a><span class="n">tokenizer</span> <span class="o">=</span> <span class="n">Tokenizer</span><span class="p">()</span>
<a id="__codelineno-14-11" name="__codelineno-14-11"></a>
<a id="__codelineno-14-12" name="__codelineno-14-12"></a><span class="err">!</span><span class="n">gdown</span> <span class="o">--</span><span class="nb">id</span> <span class="mi">108</span><span class="n">jAePKK4R3BVYBbYJZ32JWUwxeMg20K</span>
<a id="__codelineno-14-13" name="__codelineno-14-13"></a>
<a id="__codelineno-14-14" name="__codelineno-14-14"></a><span class="n">data</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./sonnets.txt&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<a id="__codelineno-14-15" name="__codelineno-14-15"></a>
<a id="__codelineno-14-16" name="__codelineno-14-16"></a><span class="n">corpus</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-14-17" name="__codelineno-14-17"></a>
<a id="__codelineno-14-18" name="__codelineno-14-18"></a>
<a id="__codelineno-14-19" name="__codelineno-14-19"></a><span class="n">tokenizer</span><span class="o">.</span><span class="n">fit_on_texts</span><span class="p">(</span><span class="n">corpus</span><span class="p">)</span>
<a id="__codelineno-14-20" name="__codelineno-14-20"></a><span class="n">total_words</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">word_index</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-14-21" name="__codelineno-14-21"></a>
<a id="__codelineno-14-22" name="__codelineno-14-22"></a><span class="n">input_sequences</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-14-23" name="__codelineno-14-23"></a><span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">corpus</span><span class="p">:</span>
<a id="__codelineno-14-24" name="__codelineno-14-24"></a>    <span class="n">token_list</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">texts_to_sequences</span><span class="p">([</span><span class="n">line</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-14-25" name="__codelineno-14-25"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">token_list</span><span class="p">)):</span>
<a id="__codelineno-14-26" name="__codelineno-14-26"></a>        <span class="n">n_gram_sequence</span> <span class="o">=</span> <span class="n">token_list</span><span class="p">[:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-14-27" name="__codelineno-14-27"></a>        <span class="n">input_sequences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n_gram_sequence</span><span class="p">)</span>
<a id="__codelineno-14-28" name="__codelineno-14-28"></a>
<a id="__codelineno-14-29" name="__codelineno-14-29"></a><span class="n">max_sequence_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">input_sequences</span><span class="p">])</span>
<a id="__codelineno-14-30" name="__codelineno-14-30"></a><span class="n">input_sequences</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pad_sequences</span><span class="p">(</span><span class="n">input_sequences</span><span class="p">,</span> <span class="n">maxlen</span><span class="o">=</span><span class="n">max_sequence_len</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;pre&#39;</span><span class="p">))</span>
<a id="__codelineno-14-31" name="__codelineno-14-31"></a>
<a id="__codelineno-14-32" name="__codelineno-14-32"></a><span class="n">predictors</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">input_sequences</span><span class="p">[:,:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">input_sequences</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-14-33" name="__codelineno-14-33"></a>
<a id="__codelineno-14-34" name="__codelineno-14-34"></a><span class="n">label</span> <span class="o">=</span> <span class="n">ku</span><span class="o">.</span><span class="n">to_categorical</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">num_classes</span><span class="o">=</span><span class="n">total_words</span><span class="p">)</span>
<a id="__codelineno-14-35" name="__codelineno-14-35"></a>
<a id="__codelineno-14-36" name="__codelineno-14-36"></a><span class="c1"># START CODE HERE</span>
<a id="__codelineno-14-37" name="__codelineno-14-37"></a><span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">()</span>
<a id="__codelineno-14-38" name="__codelineno-14-38"></a><span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Embedding</span><span class="p">(</span><span class="n">total_words</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">input_length</span><span class="o">=</span><span class="n">max_sequence_len</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-14-39" name="__codelineno-14-39"></a><span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Bidirectional</span><span class="p">(</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="n">return_sequences</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)))</span>
<a id="__codelineno-14-40" name="__codelineno-14-40"></a><span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">))</span>
<a id="__codelineno-14-41" name="__codelineno-14-41"></a><span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span>
<a id="__codelineno-14-42" name="__codelineno-14-42"></a><span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">total_words</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">kernel_regularizer</span><span class="o">=</span><span class="n">regularizers</span><span class="o">.</span><span class="n">l2</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)))</span>
<a id="__codelineno-14-43" name="__codelineno-14-43"></a><span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">total_words</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;softmax&#39;</span><span class="p">))</span>
<a id="__codelineno-14-44" name="__codelineno-14-44"></a>
<a id="__codelineno-14-45" name="__codelineno-14-45"></a><span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">&#39;categorical_crossentropy&#39;</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">])</span>
<a id="__codelineno-14-46" name="__codelineno-14-46"></a><span class="c1"># END CODE HERE</span>
<a id="__codelineno-14-47" name="__codelineno-14-47"></a>
<a id="__codelineno-14-48" name="__codelineno-14-48"></a><span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">predictors</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
</details>

              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../cs-part-2/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Part 2 - CNN in TF" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Part 2 - CNN in TF
            </div>
          </div>
        </a>
      
      
        
        <a href="../cs-part-4/" class="md-footer__link md-footer__link--next" aria-label="Next: Part 4 - Time Series" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Part 4 - Time Series
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2020 - 2022 Mark Schwarz
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["search.suggest", "search.highlight", "search.tabs.link", "content.tabs.link", "navigation.indexes", "navigation.tabs", "navigation.top"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../../../assets/javascripts/workers/search.cefbb252.min.js"}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.a5f8ea78.min.js"></script>
      
    
  </body>
</html>